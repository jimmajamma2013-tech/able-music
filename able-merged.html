<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Able</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
    <!--
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘                         ABLE THEME SYSTEM                                 â•‘
    â•‘                   Dashboard & Artist Profile Sync                         â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    THEME MODES (3 options):
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 1. â˜€ï¸ LIGHT MODE (default)                                              â”‚
    â”‚    - All panels: Light backgrounds, dark text                           â”‚
    â”‚    - Best for: Daytime work, bright environments                        â”‚
    â”‚    - Artist profile: Full light theme                                   â”‚
    â”‚                                                                          â”‚
    â”‚ 2. ðŸŒ— CONTRAST MODE (unique to dashboard)                               â”‚
    â”‚    - Sidebar: Dark background, light text                               â”‚
    â”‚    - Content + Preview: Light backgrounds                               â”‚
    â”‚    - Best for: Reducing sidebar eye strain while keeping content brightâ”‚
    â”‚    - Artist profile: Falls back to light mode                           â”‚
    â”‚                                                                          â”‚
    â”‚ 3. ðŸŒ™ DARK MODE                                                          â”‚
    â”‚    - All panels: Dark backgrounds, light text                           â”‚
    â”‚    - Best for: Night work, low-light environments                       â”‚
    â”‚    - Artist profile: Full dark theme                                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    
    HOW IT WORKS:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â€¢ localStorage Key: 'able_theme' (shared between dashboard & artist profile)
    â€¢ Theme Attribute: data-theme="light|dark|contrast" on <html>
    â€¢ Light mode: NO data-theme attribute (CSS :root defaults)
    â€¢ Dark/Contrast: data-theme attribute triggers [data-theme="..."] CSS rules
    
    SYNCHRONIZATION:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    Dashboard â†’ Artist Profile:
      - User sets theme in dashboard â†’ saved to localStorage('able_theme')
      - Artist profile reads same localStorage key on load
      - Themes match automatically (light, dark work on both)
      - Contrast mode only exists in dashboard (artist shows light)
    
    Artist Profile â†’ Dashboard:
      - If user has visited artist profile and set theme
      - Dashboard reads localStorage('able_theme') on load
      - Applies saved theme automatically
    
    PREVIEW PANEL:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â€¢ Shows LIVE preview of how artist profile will look
    â€¢ Updates when theme changes via updatePreviewTheme()
    â€¢ Dark mode preview: Uses same colors as artist profile dark theme
    â€¢ Contrast mode preview: Shows light (since contrast is dashboard-only)
    
    CSS ARCHITECTURE:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    :root { /* Light mode variables */ }
    [data-theme="dark"] { /* Override with dark colors */ }
    [data-theme="contrast"] { /* Override ONLY sidebar with dark */ }
    
    COLOR VARIABLES (match artist profile):
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    Light:
      --bg-primary: #f7f7f6
      --text-primary: #0a0a0a
      --accent: #0891b2 (teal)
    
    Dark:
      --bg-primary: #1a1918
      --text-primary: #ffffff
      --accent: #0891b2 (teal)
    
    Contrast (sidebar only):
      --sidebar-bg: #2d2d2d
      --sidebar-text: #ffffff
    
    FUTURE COMPATIBILITY:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â€¢ To add new theme: Add CSS in [data-theme="newtheme"] block
    â€¢ Update validThemes array in setTheme()
    â€¢ Add button in sidebar-footer
    â€¢ Colors automatically sync to artist profile if using same var names
    
    -->
    <style>

        :root {
            /* Light Mode (default) */
            --bg-primary: #f7f7f6;
            --bg-secondary: #ffffff;
            --bg-tertiary: #fafaf9;
            --text-primary: #0a0a0a;
            --text-secondary: #525252;
            --text-tertiary: #737373;
            
            /* Teal accent to match artist profile */
            --accent: #0891b2;
            --accent-hover: #0e7490;
            --accent-soft: #ecfeff;
            --accent-gradient: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%);
            
            /* Status colors */
            --border: #e7e5e4;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            
            /* Premium shadows */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.04);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.12);
            --shadow-glow: 0 0 20px rgba(8, 145, 178, 0.3);
            
            /* Smooth animations */
            --ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
            --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
            --ease-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);

            /* ===================================
               PHASE 1: DESIGN SYSTEM REFINEMENT
               =================================== */
            
            /* Typography Scale - Desktop */
            --font-hero: 36px;
            --font-h1: 28px;
            --font-h2: 20px;
            --font-h3: 17px;
            --font-body: 15px;
            --font-small: 14px;
            --font-tiny: 12px;
            --font-caption: 11px;
            
            /* Line Heights */
            --line-hero: 40px;
            --line-h1: 32px;
            --line-h2: 24px;
            --line-h3: 24px;
            --line-body: 24px;
            --line-small: 20px;
            --line-tiny: 16px;
            --line-caption: 14px;
            
            /* Font Weights */
            --weight-black: 900;
            --weight-bold: 700;
            --weight-semibold: 600;
            --weight-medium: 500;
            --weight-regular: 400;
            
            /* Spacing Scale (4px baseline) */
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 12px;
            --space-lg: 16px;
            --space-xl: 20px;
            --space-2xl: 24px;
            --space-3xl: 32px;
            --space-4xl: 40px;
            --space-5xl: 48px;
            
            /* Expanded Color Palette */
            --teal-50: #f0fdfa;
            --teal-100: #ccfbf1;
            --teal-200: #99f6e4;
            --teal-300: #5eead4;
            --teal-400: #2dd4bf;
            --teal-500: #14b8a6;
            --teal-600: #0891b2; /* Primary */
            --teal-700: #0e7490;
            --teal-800: #155e75;
            --teal-900: #164e63;
            
            /* Semantic Colors - Richer */
            --success-light: #d1fae5;
            --success: #10b981;
            --success-dark: #059669;
            
            --error-light: #fee2e2;
            --error: #ef4444;
            --error-dark: #dc2626;
            
            --warning-light: #fef3c7;
            --warning: #f59e0b;
            --warning-dark: #d97706;
            
            --info-light: #dbeafe;
            --info: #3b82f6;
            --info-dark: #2563eb;
            
            /* Elevation System (softer, warmer shadows) */
            --elevation-0: none;
            --elevation-1: 0 1px 3px rgba(0, 0, 0, 0.04);
            --elevation-2: 0 2px 8px rgba(0, 0, 0, 0.05);
            --elevation-3: 0 4px 16px rgba(0, 0, 0, 0.06);
            --elevation-4: 0 8px 32px rgba(0, 0, 0, 0.08);
            --elevation-5: 0 16px 48px rgba(0, 0, 0, 0.10);
            
            /* Border Radius System (subtly rounder) */
            --radius-sm: 8px;
            --radius-md: 10px;
            --radius-lg: 14px;
            --radius-xl: 18px;
            --radius-2xl: 24px;
            --radius-full: 9999px;
            
            /* Transitions */
            --transition-fast: 150ms;
            --transition-base: 200ms;
            --transition-slow: 300ms;

            /* Icon Sizing System */
            --icon-xs: 16px;
            --icon-sm: 20px;
            --icon-md: 24px;
            --icon-lg: 32px;
            --icon-xl: 40px;

            /* â”€â”€ Focus Ring â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
            --focus-ring-color: rgba(8, 145, 178, 0.50);
            --focus-ring-width: 3px;

            /* â”€â”€ Profile embed containment â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
            --card-embed-radius: 12px;  /* matches existing JS-generated wrappers */

            /* â”€â”€ Image-mode / glassmorphism card overlay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
            --card-glass-bg:     rgba(255, 255, 255, 0.72);
            --card-glass-blur:   12px;
            --card-glass-border: rgba(255, 255, 255, 0.28);

            /* â”€â”€ Prompt 1 â€” design tokens (alias layer; no appearance change) â”€â”€ */
            --token-radius-sm:    var(--radius-sm);         /* 8px  */
            --token-radius-md:    var(--radius-md);         /* 10px */
            --token-radius-lg:    var(--card-embed-radius); /* 12px â€” profile-preview card shell */
            --token-space-1:      var(--space-xs);          /* 4px  */
            --token-space-2:      var(--space-sm);          /* 8px  */
            --token-space-3:      var(--space-md);          /* 12px */
            --token-space-4:      var(--space-lg);          /* 16px */
            --token-border-color: var(--border);            /* legacy alias â€” keep */
            --token-border:       var(--border);            /* short alias used in components */
            --token-surface-1:    var(--bg-secondary);      /* card face */
            --token-surface-2:    var(--bg-tertiary);       /* alt / sunken surface */
            --token-text-1:       var(--text-primary);
            --token-text-2:       var(--text-secondary);
            --token-shadow-1:     var(--elevation-2);       /* 0 2px 8px rgba(0,0,0,.05) */
            --token-focus-ring:   var(--focus-ring-color);  /* keyboard focus outline colour */

            /* â”€â”€ Prompt 2 â€” type scale (maps to existing sizes; no visual jump) â”€â”€ */
            --token-text-xs:       var(--font-caption);     /* 11px â€” labels, captions */
            --token-text-sm:       var(--font-tiny);        /* 12px â€” secondary body   */
            --token-text-md:       var(--font-small);       /* 14px â€” card body/titles */
            --token-text-lg:       var(--font-body);        /* 15px â€” primary body     */
            --token-leading-tight:  1.2;                    /* headings                */
            --token-leading-normal: 1.5;                    /* body / readable prose   */
        }

        /* Dark Mode */
        [data-theme="dark"] {
            --bg-primary: #1a1918;
            --bg-secondary: #2a2928;
            --bg-tertiary: #3a3836;
            --text-primary: #ffffff;
            --text-secondary: #f0efee;
            --text-tertiary: #c4bfba;

            --accent: #0891b2;
            --accent-hover: #0e7490;
            --accent-soft: #164e63;
            --accent-gradient: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%);

            --border: #4f4f56;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;

            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.5);
            --shadow-glow: 0 0 20px rgba(8, 145, 178, 0.4);

            /* Glass overlay â€” dark variant */
            --card-glass-bg:     rgba(30, 28, 27, 0.75);
            --card-glass-border: rgba(255, 255, 255, 0.12);
        }

        /* Contrast Mode (dark background + light cards for readability) */
        [data-theme="contrast"] {
            /* Dark backgrounds like dark mode */
            --bg-primary: #1a1918;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f7f7f6;
            
            /* Light text on dark background */
            --text-primary: #ffffff;
            --text-secondary: #f0efee;
            --text-tertiary: #c4bfba;
            
            --accent: #0891b2;
            --accent-hover: #0e7490;
            --accent-soft: #ecfeff;
            --accent-gradient: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%);
            
            --border: #e7e5e4;
            
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.5);
            --shadow-glow: 0 0 20px rgba(8, 145, 178, 0.4);
        }

        /* Contrast mode - dark sidebar like dark mode */
        [data-theme="contrast"] .sidebar {
            background: linear-gradient(180deg, #2a2928 0%, #1a1918 100%) !important;
            box-shadow: 
                var(--elevation-2),
                inset -1px 0 0 rgba(255, 255, 255, 0.05);
        }

        [data-theme="contrast"] .sidebar-header {
            background: #2a2928 !important;
        }

        /* Contrast mode - light cards with dark text */
        [data-theme="contrast"] .card {
            background: #ffffff;
            color: #0a0a0a;
            border-color: #e7e5e4;
        }

        [data-theme="contrast"] .card-title,
        [data-theme="contrast"] .editor-title,
        [data-theme="contrast"] .form-label {
            color: #0a0a0a;
        }

        [data-theme="contrast"] .editor-subtitle,
        [data-theme="contrast"] .form-hint {
            color: #525252;
        }

        [data-theme="contrast"] .list-item {
            color: #0a0a0a;
        }

        [data-theme="contrast"] .list-item-title {
            color: #0a0a0a;
        }

        [data-theme="contrast"] .list-item-meta {
            color: #737373;
        }

        [data-theme="contrast"] .form-input,
        [data-theme="contrast"] .form-textarea {
            background: #fafaf9;
            color: #0a0a0a;
            border-color: #e7e5e4;
        }

        [data-theme="contrast"] .editor-header {
            color: #ffffff;
        }

        [data-theme="contrast"] .nav-tab {
            color: #c4bfba;
        }

        [data-theme="contrast"] .nav-tab:hover {
            background: rgba(255, 255, 255, 0.05);
            color: #ffffff;
        }

        [data-theme="contrast"] .nav-tab.active {
            background: rgba(8, 145, 178, 0.2);
            color: #06b6d4;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.65;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            font-feature-settings: 'kern' 1, 'liga' 1, 'calt' 1;
            overflow: hidden;
            height: 100vh;
            position: relative;
            /* Smooth momentum scrolling */
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
        }

        /* Subtle paper grain texture for light mode - matches artist profile */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.08;
            z-index: 0;
            pointer-events: none;
            background-image: 
                radial-gradient(circle at 20% 50%, transparent 0%, transparent 50%, rgba(0,0,0,0.05) 100%),
                url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
        }

        [data-theme="dark"] body::before {
            opacity: 0.06;
        }

        [data-theme="contrast"] body::before {
            opacity: 0.07;
        }

        /* Dashboard Layout */
        .dashboard-container {
            display: flex;
            height: 100vh;
            width: 100%;
            position: relative;
            z-index: 1;
            background: var(--bg-primary);
            overflow: hidden;
        }

        /* Signature atmospheric gradient - "Wow" element */
        .dashboard-container::before {
            content: '';
            position: absolute;
            top: -100px;
            left: 20%;
            width: 600px;
            height: 600px;
            background: radial-gradient(
                circle,
                rgba(8, 145, 178, 0.04) 0%,
                transparent 70%
            );
            pointer-events: none;
            z-index: 0;
            animation: floatGlow 20s ease-in-out infinite;
        }

        @keyframes floatGlow {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(50px, 30px) scale(1.1); }
        }

        /* Left Sidebar */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #ffffff 0%, #fafafa 100%);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            box-shadow: 
                var(--elevation-2),
                inset -1px 0 0 rgba(255, 255, 255, 0.5);
            position: relative;
        }

        /* Dark mode sidebar */
        [data-theme="dark"] .sidebar {
            background: linear-gradient(180deg, #2a2928 0%, #1a1918 100%);
            box-shadow: 
                var(--elevation-2),
                inset -1px 0 0 rgba(255, 255, 255, 0.05);
        }

        [data-theme="dark"] .sidebar-header {
            background: linear-gradient(150deg, rgba(8, 145, 178, 0.15) 0%, rgba(6, 182, 212, 0.06) 40%, #2a2928 100%);
        }

        [data-theme="dark"] .card:hover {
            box-shadow:
                var(--elevation-3),
                0 0 0 1px rgba(8, 145, 178, 0.25),
                inset 0 3px 0 rgba(8, 145, 178, 0.45);
            border-color: rgba(8, 145, 178, 0.2);
        }

        [data-theme="dark"] .card {
            box-shadow:
                var(--elevation-2),
                inset 0 3px 0 rgba(8, 145, 178, 0.22);
        }

        /* â”€â”€â”€ Light mode depth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           Cards are white on a near-white background. Strengthen contrast so
           each card reads as a distinct surface.
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        html:not([data-theme]) .editor-panel {
            background: #e9e7e4;   /* noticeably darker than card white (#fff) */
        }

        html:not([data-theme]) .card {
            border-color: #ccc8c4;
            box-shadow:
                0 1px 2px rgba(0, 0, 0, 0.05),
                0 4px 16px rgba(0, 0, 0, 0.09),
                0 1px 0 rgba(255, 255, 255, 1) inset,
                inset 0 3px 0 rgba(8, 145, 178, 0.35);
        }

        html:not([data-theme]) .card:hover {
            border-color: rgba(8, 145, 178, 0.3);
            box-shadow:
                0 2px 4px rgba(0, 0, 0, 0.06),
                0 8px 28px rgba(0, 0, 0, 0.11),
                0 0 0 1px rgba(8, 145, 178, 0.12),
                0 1px 0 rgba(255, 255, 255, 1) inset,
                inset 0 3px 0 rgba(8, 145, 178, 0.4);
        }

        /* Stronger panel dividers in light mode */
        html:not([data-theme]) .sidebar {
            border-right-color: #ccc8c4;
        }
        html:not([data-theme]) .preview-panel {
            border-left-color: #ccc8c4;
        }

        /* Internal card elements â€” give them visible borders so they don't
           disappear against the white card background */
        html:not([data-theme]) .stat-tile,
        html:not([data-theme]) .quick-action-tile {
            border-color: #d8d4d0;
        }

        html:not([data-theme]) .list-item {
            background: #fafaf9;
            border: 1px solid #e0dcd8;
            border-left: 3px solid rgba(8, 145, 178, 0.25);
        }

        html:not([data-theme]) .list-item:hover {
            background: #f5f3f1;
            border-color: rgba(8, 145, 178, 0.2);
            border-left-color: var(--accent);
        }

        html:not([data-theme]) .switch-group {
            border-color: #e0dcd8;
        }

        html:not([data-theme]) .preview-url-bar {
            border-color: #d0ccc8;
            background: #f5f3f1;
        }

        .sidebar::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            width: 1px;
            background: linear-gradient(180deg, 
                rgba(8, 145, 178, 0.1) 0%,
                transparent 50%,
                rgba(8, 145, 178, 0.05) 100%);
            pointer-events: none;
        }

        .sidebar-header {
            padding: var(--space-3xl) var(--space-2xl) var(--space-2xl);
            border-bottom: 1px solid var(--border);
            background: linear-gradient(150deg, rgba(8, 145, 178, 0.09) 0%, rgba(6, 182, 212, 0.04) 40%, #ffffff 100%);
        }

        /* Logo lockup */
        .logo-lockup {
            display: flex;
            align-items: center;
            gap: 9px;
            margin-bottom: 5px;
        }

        .logo-mark {
            display: flex;
            align-items: flex-end;
            flex-shrink: 0;
        }

        .logo {
            font-size: 22px;
            line-height: 1;
            font-weight: 900;
            letter-spacing: -0.04em;
            background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-tagline {
            font-size: 10px;
            font-weight: 600;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: var(--text-tertiary);
            margin-bottom: var(--space-sm);
            opacity: 0.75;
        }

        .artist-name {
            font-size: var(--font-tiny);
            line-height: 1.3;
            color: var(--text-tertiary);
            font-weight: var(--weight-semibold);
            letter-spacing: 0.01em;
        }

        .nav-tabs {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-lg) var(--space-md);
        }

        /* Teal scrollbar for sidebar nav list */
        .nav-tabs::-webkit-scrollbar { width: 3px; }
        .nav-tabs::-webkit-scrollbar-track { background: transparent; }
        .nav-tabs::-webkit-scrollbar-thumb {
            background: rgba(8, 145, 178, 0.25);
            border-radius: 2px;
        }
        .nav-tabs::-webkit-scrollbar-thumb:hover {
            background: rgba(8, 145, 178, 0.5);
        }

        .nav-tab-icon {
            font-size: 16px;
            line-height: 1;
            flex-shrink: 0;
            width: 20px;
            text-align: center;
        }

        .nav-tab {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: 14px var(--space-xl);
            padding-left: var(--space-lg);
            border-radius: 0;
            cursor: pointer;
            transition: all 0.25s var(--ease-smooth);
            color: var(--text-secondary);
            font-size: var(--font-body);
            line-height: var(--line-body);
            font-weight: var(--weight-semibold);
            letter-spacing: -0.01em;
            margin-bottom: 2px;
            border: none;
            position: relative;
        }

        .nav-tab::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            height: 0%;
            width: 3px;
            background: var(--accent-gradient);
            border-radius: 0 3px 3px 0;
            transition: height 0.3s var(--ease-spring);
        }

        .nav-tab:hover {
            background: rgba(8, 145, 178, 0.04);
            color: var(--text-primary);
        }

        .nav-tab:hover::before {
            height: 40%;
        }

        .nav-tab.active {
            background: rgba(8, 145, 178, 0.13);
            color: var(--accent);
            border-radius: 10px;
            font-weight: 700;
        }

        .nav-tab.active::before {
            height: 60%;
            box-shadow: 0 0 10px rgba(8, 145, 178, 0.5);
        }

        .sidebar-footer {
            padding: var(--space-lg);
            border-top: 1px solid var(--border);
        }

        .theme-toggle-group {
            display: flex;
            gap: 6px;
            background: var(--bg-tertiary);
            padding: 4px;
            border-radius: 10px;
            margin-bottom: 12px;
        }

        .theme-toggle-btn {
            flex: 1;
            padding: 8px;
            background: transparent;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-tertiary);
            cursor: pointer;
            transition: all 0.2s var(--ease-smooth);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .theme-toggle-btn:hover {
            color: var(--text-secondary);
            background: rgba(0, 0, 0, 0.02);
        }

        .theme-toggle-btn.active {
            background: var(--bg-secondary);
            color: var(--accent);
            box-shadow: var(--shadow-sm);
        }

        [data-theme="dark"] .theme-toggle-btn.active {
            background: var(--bg-tertiary);
        }

        [data-theme="contrast"] .theme-toggle-btn.active {
            background: var(--accent);
            color: white;
            box-shadow: 0 2px 8px rgba(8, 145, 178, 0.3);
        }

        [data-theme="contrast"] .theme-toggle-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        @keyframes publishShimmer {
            0%   { left: -100%; }
            40%  { left: 100%; }
            100% { left: 100%; }
        }

        .publish-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #0891b2 0%, #06b6d4 50%, #0e7490 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.2s var(--ease-smooth);
            box-shadow: 0 4px 16px rgba(8, 145, 178, 0.4), inset 0 1px 0 rgba(255,255,255,0.2);
            position: relative;
            overflow: hidden;
        }

        .publish-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 60%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.25), transparent);
            animation: publishShimmer 3.5s ease-in-out infinite;
        }

        .publish-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 28px rgba(8, 145, 178, 0.5), inset 0 1px 0 rgba(255,255,255,0.2);
        }

        .view-site-btn {
            width: 100%;
            padding: 12px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1.5px solid var(--border);
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s var(--ease-smooth);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .view-site-btn:hover {
            background: var(--bg-secondary);
            border-color: var(--accent);
            color: var(--accent);
            transform: translateY(-1px);
        }

        /* Editor Panel */
        .editor-panel {
            flex: 1;
            min-width: 0;
            background: var(--bg-primary);
            overflow-y: auto;
            padding: 32px;
            /* Smooth momentum scrolling for iOS and all browsers */
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
        }

        /* Teal scrollbar for editor panel */
        .editor-panel::-webkit-scrollbar { width: 5px; }
        .editor-panel::-webkit-scrollbar-track { background: transparent; }
        .editor-panel::-webkit-scrollbar-thumb {
            background: rgba(8, 145, 178, 0.25);
            border-radius: 3px;
        }
        .editor-panel::-webkit-scrollbar-thumb:hover {
            background: rgba(8, 145, 178, 0.55);
        }

        /* Teal scrollbar for sidebar nav */
        .sidebar::-webkit-scrollbar { width: 3px; }
        .sidebar::-webkit-scrollbar-track { background: transparent; }
        .sidebar::-webkit-scrollbar-thumb {
            background: rgba(8, 145, 178, 0.2);
            border-radius: 2px;
        }
        .sidebar::-webkit-scrollbar-thumb:hover {
            background: rgba(8, 145, 178, 0.45);
        }

        .editor-header {
            margin-bottom: var(--space-3xl);
        }

        .editor-title {
            font-size: var(--font-hero);
            line-height: var(--line-hero);
            font-weight: var(--weight-black);
            letter-spacing: -0.02em;
            margin-bottom: var(--space-sm);
            background: linear-gradient(120deg, var(--text-primary) 0%, var(--accent) 120%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .editor-subtitle {
            font-size: var(--font-body);
            line-height: var(--line-body);
            color: var(--text-secondary);
            font-weight: var(--weight-medium);
        }

        /* Form Elements */
        .form-group {
            margin-bottom: var(--space-2xl);
            position: relative;
        }

        /* Floating label container */
        .form-field {
            position: relative;
        }

        .form-label {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: var(--font-tiny);
            line-height: var(--line-tiny);
            font-weight: var(--weight-bold);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-tertiary);
            margin-bottom: var(--space-sm);
        }

        /* Floating label style */
        .floating-label {
            position: absolute;
            left: 16px;
            top: 16px;
            font-size: 15px;
            color: var(--text-tertiary);
            pointer-events: none;
            transition: all 0.2s var(--ease-smooth);
            background: transparent;
            padding: 0 4px;
            font-weight: 500;
            text-transform: none;
            letter-spacing: 0;
        }

        /* Float up when focused or has value */
        .form-input:focus ~ .floating-label,
        .form-input:not(:placeholder-shown) ~ .floating-label,
        .form-textarea:focus ~ .floating-label,
        .form-textarea:not(:placeholder-shown) ~ .floating-label {
            top: -8px;
            left: 12px;
            font-size: 11px;
            font-weight: 700;
            color: var(--accent);
            background: var(--bg-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Character counter */
        .char-counter {
            position: absolute;
            right: 16px;
            top: -8px;
            font-size: 11px;
            color: var(--text-tertiary);
            background: var(--bg-secondary);
            padding: 0 4px;
            font-weight: 600;
        }

        /* Validation icons */
        .validation-icon {
            position: absolute;
            right: 16px;
            top: 16px;
            font-size: 18px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .form-input.valid ~ .validation-icon.success,
        .form-textarea.valid ~ .validation-icon.success {
            opacity: 1;
        }

        .form-input.error ~ .validation-icon.error,
        .form-textarea.error ~ .validation-icon.error {
            opacity: 1;
        }

        /* Success state */
        .form-input.valid,
        .form-textarea.valid {
            border-color: var(--success);
        }

        .form-input.valid:focus,
        .form-textarea.valid:focus {
            box-shadow: 
                0 1px 2px rgba(0, 0, 0, 0.04) inset,
                0 0 0 4px rgba(16, 185, 129, 0.1);
        }

        /* Error state */
        .form-input.error,
        .form-textarea.error {
            border-color: var(--error);
        }

        .form-input.error:focus,
        .form-textarea.error:focus {
            box-shadow: 
                0 1px 2px rgba(0, 0, 0, 0.04) inset,
                0 0 0 4px rgba(239, 68, 68, 0.1);
        }

        .error-message {
            font-size: 12px;
            color: var(--error);
            margin-top: 6px;
            display: flex;
            align-items: center;
            gap: 4px;
            font-weight: 500;
        }

        .form-hint {
            font-size: var(--font-tiny);
            line-height: var(--line-tiny);
            font-weight: var(--weight-regular);
            text-transform: none;
            letter-spacing: 0;
            color: var(--text-tertiary);
            opacity: 0.8;
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 14px var(--space-lg);
            background: var(--bg-secondary);
            border: 1.5px solid var(--border);
            border-radius: var(--radius-lg);
            font-size: var(--font-body);
            line-height: var(--line-body);
            color: var(--text-primary);
            font-family: inherit;
            transition: all var(--transition-base) var(--ease-smooth);
            box-shadow: 
                0 1px 2px rgba(0, 0, 0, 0.04) inset,
                0 0 0 0 var(--teal-100);
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow:
                0 1px 2px rgba(0, 0, 0, 0.04) inset,
                0 0 0 4px rgba(8, 145, 178, 0.14),
                0 0 16px rgba(8, 145, 178, 0.12),
                0 1px 3px rgba(8, 145, 178, 0.1);
            background: var(--bg-primary);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
            line-height: 1.6;
        }

        .form-input::placeholder,
        .form-textarea::placeholder,
        .form-select::placeholder {
            color: var(--text-tertiary);
            opacity: 0.7;
        }

        /* Cards */
        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius-xl);
            padding: var(--space-2xl);
            margin-bottom: var(--space-xl);
            box-shadow:
                var(--elevation-2),
                inset 0 3px 0 rgba(8, 145, 178, 0.35),
                0 1px 0 rgba(255, 255, 255, 0.6) inset,
                0 -1px 0 rgba(0, 0, 0, 0.02) inset;
            transition: all var(--transition-base) var(--ease-smooth);
            position: relative;
            overflow: hidden;
        }

        /* â”€â”€ .able-card â€” profile-preview card shell (Prompt 1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .able-card {
            background: var(--token-surface-1);
            border: 1px solid var(--token-border);
            border-radius: var(--token-radius-lg);
            padding: var(--token-space-4);
            box-shadow: var(--token-shadow-1);
            max-width: 100%;
            box-sizing: border-box;
        }

        /* â”€â”€ .able-cardHeader â€” flex row helper for card title rows â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .able-cardHeader {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--token-space-3);
        }

        /* â”€â”€ Spacing-rhythm helpers (column stacks) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .able-stack-2 { display: flex; flex-direction: column; gap: var(--token-space-2); }
        .able-stack-3 { display: flex; flex-direction: column; gap: var(--token-space-3); }

        /* Light mode â€” give cards real depth so they lift off the page */
        html:not([data-theme]) .editor-panel {
            background: #e9e7e4;
        }

        html:not([data-theme]) .card {
            border-color: #ccc9c5;
            box-shadow:
                0 1px 2px rgba(0, 0, 0, 0.06),
                0 3px 10px rgba(0, 0, 0, 0.07),
                0 8px 20px rgba(0, 0, 0, 0.04),
                inset 0 3px 0 rgba(8, 145, 178, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 1);
        }

        html:not([data-theme]) .card:hover {
            border-color: rgba(8, 145, 178, 0.3);
            box-shadow:
                0 2px 4px rgba(0, 0, 0, 0.07),
                0 6px 20px rgba(0, 0, 0, 0.09),
                0 12px 32px rgba(0, 0, 0, 0.05),
                0 0 0 1px rgba(8, 145, 178, 0.12),
                inset 0 3px 0 rgba(8, 145, 178, 0.38),
                inset 0 1px 0 rgba(255, 255, 255, 1);
        }

        /* Inner elements â€” also need contrast against white card bg */
        html:not([data-theme]) .checklist-item,
        html:not([data-theme]) .stat-tile,
        html:not([data-theme]) .quick-action-tile,
        html:not([data-theme]) .switch-group,
        html:not([data-theme]) .mode-status-row,
        html:not([data-theme]) .list-item {
            background: #f4f2ef;
            border-color: #d4d0cb;
        }

        html:not([data-theme]) .checklist-item:hover,
        html:not([data-theme]) .stat-tile:hover,
        html:not([data-theme]) .quick-action-tile:hover,
        html:not([data-theme]) .switch-group:hover,
        html:not([data-theme]) .list-item:hover {
            background: #ebe8e4;
        }

        /* Column dividers â€” more visible in light mode */
        html:not([data-theme]) .sidebar {
            border-right-color: #ccc9c5;
            box-shadow: 2px 0 12px rgba(0, 0, 0, 0.06), inset -1px 0 0 rgba(255,255,255,0.6);
        }

        html:not([data-theme]) .preview-panel {
            border-left-color: #ccc9c5;
            box-shadow: -2px 0 12px rgba(0, 0, 0, 0.05), inset 1px 0 0 rgba(255,255,255,0.6);
        }

        .card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, 
                rgba(8, 145, 178, 0.02) 0%, 
                transparent 50%, 
                rgba(8, 145, 178, 0.01) 100%);
            opacity: 0;
            transition: opacity var(--transition-base);
            pointer-events: none;
        }

        .card:hover {
            box-shadow: 
                var(--elevation-3),
                0 0 0 1px rgba(8, 145, 178, 0.1),
                0 1px 0 rgba(255, 255, 255, 0.6) inset;
            transform: translateY(-2px);
            border-color: rgba(8, 145, 178, 0.15);
        }

        .card:hover::before {
            opacity: 1;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-xl);
        }

        .card-title {
            font-size: var(--font-h3);
            line-height: var(--line-h3);
            font-weight: var(--weight-bold);
            letter-spacing: -0.01em;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-title-icon {
            font-size: 20px;
            line-height: 1;
            opacity: 0.85;
            filter: drop-shadow(0 2px 4px rgba(8, 145, 178, 0.2));
            transition: filter 0.2s ease, opacity 0.2s ease;
        }

        .card:hover .card-title-icon {
            opacity: 1;
            filter: drop-shadow(0 2px 8px rgba(8, 145, 178, 0.4));
        }

        /* Enhanced Section Headers - Clean Flat Design */
        .appearance-section > .card:first-child .card-header {
            border-bottom: 2px solid var(--border);
            padding-bottom: 16px;
            margin-bottom: 20px;
        }

        .appearance-section > .card:first-child .card-title {
            font-size: 18px;
            color: var(--text-primary);
            font-weight: 700;
        }

        .card-action {
            padding: var(--space-sm) var(--space-md);
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            font-size: var(--font-tiny);
            line-height: var(--line-tiny);
            font-weight: var(--weight-semibold);
            cursor: pointer;
            transition: all var(--transition-base) var(--ease-smooth);
            color: var(--text-secondary);
        }

        .card-action:hover {
            background: var(--bg-secondary);
            border-color: var(--accent);
            color: var(--accent);
            transform: translateY(-1px);
            box-shadow: var(--elevation-1);
        }

        .card-action:active {
            transform: translateY(0);
        }

        .card-action.primary {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .card-action.primary:hover {
            background: var(--accent-hover);
        }

        /* â”€â”€ Consistent keyboard focus ring (all themes) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        :focus-visible {
            outline: var(--focus-ring-width) solid var(--focus-ring-color);
            outline-offset: 2px;
            border-radius: 2px;
        }

        /* Switch */
        .switch-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            margin-bottom: 12px;
            cursor: pointer;
            border: 1px solid transparent;
            transition: border-color 0.2s ease, background 0.2s ease;
        }

        .switch-group:hover {
            border-color: rgba(8, 145, 178, 0.2);
            background: var(--bg-secondary);
        }

        .switch-info {
            flex: 1;
        }

        .switch-label {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .switch-help {
            font-size: 12px;
            color: var(--text-tertiary);
        }

        /* OLD SWITCH STYLE - DISABLED (conflicts with checkbox switch)
        .switch {
            position: relative;
            width: 56px;
            height: 32px;
            background: var(--border);
            border-radius: 16px;
            transition: all 0.3s ease;
            flex-shrink: 0;
            cursor: pointer;
        }

        .switch:hover {
            background: var(--text-tertiary);
        }

        .switch.active {
            background: var(--accent);
            box-shadow: 0 0 0 4px rgba(8, 145, 178, 0.1);
        }

        .switch.active:hover {
            background: var(--teal-700);
        }

        .switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 26px;
            height: 26px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s var(--ease-spring);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .switch:active::after {
            width: 30px;
        }

        .switch.active::after {
            transform: translateX(24px);
        }
        END OLD SWITCH STYLE */

        /* Preview Panel Header */
        .preview-panel-header {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 14px;
            width: 100%;
        }

        .preview-url-bar {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 9px 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 10px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .preview-url-bar:hover {
            border-color: rgba(8, 145, 178, 0.3);
            box-shadow: 0 2px 8px rgba(8, 145, 178, 0.06);
        }
        .preview-url-lock {
            color: var(--success);
            font-size: 11px;
            flex-shrink: 0;
        }
        .preview-url-text {
            flex: 1;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            font-family: 'SF Mono', 'Fira Code', ui-monospace, monospace;
            letter-spacing: -0.01em;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .preview-url-text span {
            color: var(--accent);
        }
        .preview-url-actions {
            display: flex;
            gap: 5px;
            flex-shrink: 0;
        }
        .preview-url-btn {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 5px 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.18s ease;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            font-family: inherit;
        }
        .preview-url-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
            background: rgba(8, 145, 178, 0.06);
        }
        .preview-url-btn.primary {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }
        .preview-url-btn.primary:hover {
            background: var(--teal-700);
            border-color: var(--teal-700);
            color: white;
        }

        .preview-live-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            font-weight: 700;
            color: var(--success);
        }
        .preview-live-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse-dot 2s ease-in-out infinite;
        }

        /* Preview Panel */
        .preview-panel {
            width: 420px;
            flex-shrink: 0;
            background: var(--bg-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 32px 24px;
            overflow-y: auto;
            border-left: 1px solid var(--border);
            position: relative;
            box-shadow: 
                -4px 0 16px rgba(0, 0, 0, 0.04),
                inset 1px 0 0 rgba(255, 255, 255, 0.5);
            /* Smooth momentum scrolling */
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
        }

        /* Subtle radial gradient for depth */
        .preview-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse at top center, rgba(8, 145, 178, 0.10) 0%, transparent 65%);
            pointer-events: none;
            z-index: 0;
        }

        [data-theme="dark"] .preview-panel::before {
            background: radial-gradient(ellipse at top, rgba(8, 145, 178, 0.08) 0%, transparent 70%);
        }

        [data-theme="contrast"] .preview-panel::before {
            background: radial-gradient(ellipse at top, rgba(8, 145, 178, 0.03) 0%, transparent 70%);
        }

        .preview-panel > * {
            position: relative;
            z-index: 1;
        }

        /* Mode Switcher */
        .mode-switcher {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 20px;
            padding: 0 12px;
        }

        .mode-btn {
            padding: 10px;
            background: var(--bg-tertiary);
            border: 1px solid transparent;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s var(--ease-smooth);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .mode-btn:hover {
            background: var(--bg-secondary);
            border-color: rgba(8, 145, 178, 0.2);
            color: var(--text-primary);
            transform: translateY(-1px);
        }

        .mode-btn.active {
            background: linear-gradient(135deg, var(--accent) 0%, #06b6d4 100%) !important;
            color: white !important;
            border-color: transparent !important;
            box-shadow: 0 4px 14px rgba(8, 145, 178, 0.4), inset 0 1px 0 rgba(255,255,255,0.2) !important;
            font-weight: 700 !important;
        }

        .mode-btn.active:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 18px rgba(8, 145, 178, 0.5) !important;
        }

        /* Mode button icon and label typography */
        .mode-btn > span:first-child { font-size: 16px; line-height: 1; }
        .mode-btn > span:last-child  { font-size: 10px; }

        /* Preview panel device switcher */
        .preview-tab {
            flex: 1;
            padding: 10px;
            font-size: 12px;
            border: none;
            background: var(--bg-tertiary);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.2s;
        }
        .preview-tab > span:first-child { font-size: 16px; }
        .preview-tab.active {
            background: var(--accent);
            color: white;
            box-shadow: 0 2px 8px rgba(8, 145, 178, 0.25);
        }

        /* Add perspective for 3D effect */
        .preview-wrapper {
            perspective: 2000px;
            perspective-origin: center;
        }

        .preview-controls {
            display: flex;
            gap: 6px;
            margin-bottom: 16px;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 4px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08), 0 1px 3px rgba(0, 0, 0, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.8);
        }

        [data-theme="dark"] .preview-controls {
            background: rgba(42, 41, 40, 0.85);
            border: 1px solid rgba(8, 145, 178, 0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3), 0 0 0 1px rgba(8,145,178,0.08);
        }

        [data-theme="contrast"] .preview-controls {
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.8);
        }

        .preview-tab {
            padding: 8px 14px;
            border: none;
            background: transparent;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s var(--ease-smooth);
            color: var(--text-secondary);
            position: relative;
            white-space: nowrap;
        }

        .preview-tab:hover {
            color: var(--text-primary);
            background: rgba(8, 145, 178, 0.08);
        }

        .preview-tab.active {
            background: var(--accent);
            color: white;
            box-shadow: 0 4px 12px rgba(8, 145, 178, 0.3), 
                        0 0 0 1px rgba(8, 145, 178, 0.1);
        }

        .preview-tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
            opacity: 0.6;
        }

        .preview-frame {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.4s var(--ease-smooth);
            max-height: calc(100vh - 120px);
            position: relative;
        }

        /* Ambient glow behind preview */
        .preview-frame::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 130%;
            height: 130%;
            background: radial-gradient(
                ellipse at center,
                rgba(8, 145, 178, 0.22) 0%,
                rgba(6, 182, 212, 0.08) 50%,
                transparent 70%
            );
            z-index: -1;
            opacity: 0.6;
            transition: opacity 0.6s ease;
            pointer-events: none;
        }

        .preview-frame:hover::after {
            opacity: 1;
        }

        /* Preview frame dark mode - matches artist profile */
        .preview-frame[data-theme="dark"] {
            background: #1a1918;
        }

        .preview-frame[data-theme="dark"] .preview-content {
            background: #1a1918;
            color: #ffffff;
        }

        .preview-frame[data-theme="dark"] h2,
        .preview-frame[data-theme="dark"] .preview-artist-name {
            color: #ffffff;
        }

        .preview-frame[data-theme="dark"] p,
        .preview-frame[data-theme="dark"] .preview-bio {
            color: #c4bfba;
        }

        /* Realistic iPhone-style mobile preview */
        .preview-frame.mobile {
            width: 390px;
            height: 844px;
            border-radius: 50px;
            background: #1c1c1e;
            padding: 14px;
            position: relative;
            box-shadow: 
                0 0 0 2px #2c2c2e,
                0 0 0 3px #1c1c1e,
                0 30px 80px rgba(0, 0, 0, 0.3),
                0 10px 30px rgba(0, 0, 0, 0.2),
                inset 0 0 0 1px rgba(255, 255, 255, 0.1);
            animation: floatPreview 6s ease-in-out infinite;
        }

        @keyframes floatPreview {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-8px);
            }
        }

        /* Disable animation on hover for interaction */
        .preview-frame.mobile:hover {
            animation-play-state: paused;
        }

        /* Realistic notch */
        .preview-frame.mobile::before {
            content: '';
            position: absolute;
            top: 14px;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 30px;
            background: #1c1c1e;
            border-radius: 0 0 20px 20px;
            z-index: 100;
            box-shadow: 
                inset 0 -2px 4px rgba(0, 0, 0, 0.3),
                0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Camera and speaker cutout */
        .preview-frame.mobile::after {
            content: '';
            position: absolute;
            top: 24px;
            left: 50%;
            transform: translateX(-50%);
            width: 10px;
            height: 10px;
            background: radial-gradient(circle, #0a2540 0%, #000000 70%);
            border-radius: 50%;
            z-index: 101;
            box-shadow: 
                -30px 0 0 -1px rgba(20, 20, 30, 0.8),
                0 0 0 1px rgba(255, 255, 255, 0.1);
        }

        /* Dark theme for preview */
        .preview-frame[data-theme="dark"] .preview-content {
            background: #1a1918 !important;
        }

        .preview-frame[data-theme="dark"] h2,
        .preview-frame[data-theme="dark"] p {
            color: #ffffff !important;
        }

        /* Screen bezel reflection */
        .preview-frame.mobile .preview-content {
            border-radius: 38px;
            overflow-y: auto;
            overflow-x: hidden;
            height: 100%;
            position: relative;
            box-shadow: 
                inset 0 0 0 1px rgba(0, 0, 0, 0.1),
                0 0 20px rgba(0, 0, 0, 0.1);
            -webkit-overflow-scrolling: touch;
        }

        .preview-frame.mobile .preview-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 60%;
            background: linear-gradient(
                180deg,
                rgba(255, 255, 255, 0.05) 0%,
                rgba(255, 255, 255, 0) 100%
            );
            pointer-events: none;
            z-index: 1000;
            border-radius: 38px 38px 0 0;
        }

        /* Realistic browser-style desktop preview */
        .preview-frame.desktop {
            width: 100%;
            max-width: 1200px;
            height: calc(100vh - 120px);
            border-radius: 12px;
            background: var(--bg-secondary);
            box-shadow: 
                0 0 0 1px rgba(0, 0, 0, 0.1),
                0 30px 80px rgba(0, 0, 0, 0.15),
                0 10px 30px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        /* Browser chrome/toolbar */
        .preview-frame.desktop::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 48px;
            background: linear-gradient(180deg, #f5f5f5 0%, #e8e8e8 100%);
            border-bottom: 1px solid #d0d0d0;
            z-index: 10;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
        }

        [data-theme="dark"] .preview-frame.desktop::before {
            background: linear-gradient(180deg, #2a2928 0%, #1a1918 100%);
            border-bottom: 1px solid #3a3836;
        }

        /* Browser traffic lights / window controls */
        .preview-frame.desktop::after {
            content: '';
            position: absolute;
            top: 16px;
            left: 16px;
            width: 12px;
            height: 12px;
            background: #ed6a5e;
            border-radius: 50%;
            z-index: 11;
            box-shadow: 
                20px 0 0 0 #f4bf4f,
                40px 0 0 0 #61c554,
                0 0 0 0.5px rgba(0, 0, 0, 0.1),
                20px 0 0 0.5px rgba(0, 0, 0, 0.1),
                40px 0 0 0.5px rgba(0, 0, 0, 0.1);
        }

        .preview-frame.desktop .preview-content {
            margin-top: 48px;
            height: calc(100% - 48px);
        }

        .preview-content {
            width: 100%;
            height: 100%;
            background: #f7f7f6;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 20px;
            position: relative;
        }

        /* Better scrollbar styling */
        .preview-content::-webkit-scrollbar {
            width: 8px;
        }

        .preview-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .preview-content::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        .preview-content::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.3);
        }

        [data-theme="dark"] .preview-content::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
        }

        [data-theme="dark"] .preview-content::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Mobile preview content needs more top padding for notch */
        .preview-frame.mobile .preview-content {
            padding-top: 50px;
        }

        /* Preview loading shimmer effect */
        @keyframes shimmer {
            0% {
                background-position: -1000px 0;
            }
            100% {
                background-position: 1000px 0;
            }
        }

        .preview-loading {
            background: linear-gradient(
                90deg,
                var(--bg-tertiary) 0px,
                rgba(8, 145, 178, 0.1) 40px,
                var(--bg-tertiary) 80px
            );
            background-size: 1000px 100%;
            animation: shimmer 2s infinite linear;
        }

        /* Real-time preview update indicator */
        .preview-updating::after {
            content: '';
            position: absolute;
            top: 8px;
            right: 8px;
            width: 8px;
            height: 8px;
            background: var(--accent);
            border-radius: 50%;
            box-shadow: 0 0 0 0 rgba(8, 145, 178, 0.7);
            animation: pulse-dot 1.5s ease-out;
        }

        @keyframes pulse-dot {
            0% {
                box-shadow: 0 0 0 0 rgba(8, 145, 178, 0.7);
            }
            50% {
                box-shadow: 0 0 0 8px rgba(8, 145, 178, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(8, 145, 178, 0);
            }
        }

        /* Drag and drop visual feedback */
        .list-item.dragging {
            opacity: 0.5;
            cursor: grabbing !important;
        }

        .list-item[draggable="true"] {
            cursor: grab;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .list-item[draggable="true"]:active {
            cursor: grabbing;
        }

        .list-item[draggable="true"]:hover {
            transform: translateX(2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* Modal animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Mobile Preview Button - Only visible on small screens */
        .mobile-preview-btn {
            display: none; /* Hidden by default (desktop) */
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--accent-gradient);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 14px 24px;
            font-size: 15px;
            font-weight: 700;
            box-shadow: 
                0 8px 24px rgba(8, 145, 178, 0.4),
                0 2px 8px rgba(0, 0, 0, 0.1),
                0 1px 0 rgba(255, 255, 255, 0.2) inset;
            cursor: pointer;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            transition: all 0.3s var(--ease-smooth);
            user-select: none;
        }

        .mobile-preview-btn > * {
            line-height: 1;
        }

        .mobile-preview-btn:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 12px 32px rgba(8, 145, 178, 0.5),
                0 4px 12px rgba(0, 0, 0, 0.15),
                0 1px 0 rgba(255, 255, 255, 0.3) inset;
        }

        .mobile-preview-btn:active {
            transform: translateY(0);
            box-shadow: 
                0 4px 16px rgba(8, 145, 178, 0.3),
                0 2px 4px rgba(0, 0, 0, 0.2) inset;
        }

        /* Show button only on mobile (when preview panel is hidden) */
        /* Mobile Bottom Navigation Bar */
        .mobile-bottom-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-primary);
            border-top: 1px solid var(--border);
            padding: 8px 0;
            padding-bottom: max(8px, env(safe-area-inset-bottom));
            z-index: 1000;
            box-shadow: 
                0 -4px 16px rgba(0, 0, 0, 0.06),
                0 -1px 3px rgba(0, 0, 0, 0.03),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(10px);
            background: rgba(247, 247, 246, 0.95);
        }

        .mobile-bottom-nav-inner {
            display: flex;
            justify-content: space-around;
            align-items: center;
            max-width: 600px;
            margin: 0 auto;
        }

        .mobile-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 12px;
            min-width: 64px;
        }

        .mobile-nav-item:active {
            transform: scale(0.95);
        }

        .mobile-nav-icon {
            font-size: var(--icon-md);
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mobile-nav-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-tertiary);
            transition: color 0.2s ease;
            line-height: 1.2;
        }

        .mobile-nav-item.active .mobile-nav-label {
            color: var(--accent);
        }

        .mobile-nav-item.active {
            background: rgba(8, 145, 178, 0.1);
        }

        /* Mobile More Menu */
        .mobile-menu-option {
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: background 0.15s ease;
            font-weight: 600;
            font-size: 15px;
            color: var(--text-primary);
        }
        .mobile-menu-option:active,
        .mobile-menu-option:hover {
            background: var(--bg-tertiary);
        }
        .mobile-menu-option-icon {
            font-size: 24px;
            line-height: 1;
            flex-shrink: 0;
        }

        @media (max-width: 1024px) {
            .mobile-preview-btn {
                display: flex;
                bottom: 80px; /* Move up to avoid bottom nav */
            }

            .sidebar {
                display: none;
            }

            .mobile-bottom-nav {
                display: block;
            }

            .main-content {
                margin-left: 0;
                padding-top: 0;
                padding-bottom: 80px; /* Space for bottom nav */
            }

            .editor-panel {
                padding-bottom: 80px; /* Space for bottom nav */
                /* Smooth free scrolling */
                -webkit-overflow-scrolling: touch !important;
                scroll-behavior: smooth !important;
                overscroll-behavior-y: contain;
                touch-action: pan-y;
                will-change: scroll-position;
            }

            /* Ensure body and html allow proper scrolling on mobile */
            html, body {
                -webkit-overflow-scrolling: touch;
                overscroll-behavior-y: none;
            }

            .dashboard-container {
                flex-direction: column;
                overflow: visible;
                height: 100vh;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
            }

            /* Bigger touch targets on mobile */
            .list-item {
                padding: var(--space-lg) var(--space-md);
                min-height: 72px;
            }

            .btn {
                font-size: var(--font-body);
                padding: 14px var(--space-2xl);
            }

            .card-action {
                min-height: 44px;
                padding: 10px var(--space-lg);
            }

            .switch-group {
                padding: var(--space-lg);
                cursor: pointer;
                -webkit-tap-highlight-color: rgba(0, 0, 0, 0.05);
            }

            .nav-tab {
                min-height: 48px;
            }
        }

        /* Mobile-only: Single column layouts for better readability */
        @media (max-width: 768px) {
            :root {
                /* Mobile Typography Scale - Optimized for readability */
                --font-hero: 28px;
                --font-h1: 24px;
                --font-h2: 18px;
                --font-h3: 16px;
                --font-body: 16px; /* Larger for mobile! */
                --font-small: 14px;
                --font-tiny: 13px;
                --font-caption: 12px;
                
                /* Mobile Line Heights */
                --line-hero: 32px;
                --line-h1: 28px;
                --line-h2: 24px;
                --line-h3: 22px;
                --line-body: 24px;
                --line-small: 20px;
                --line-tiny: 18px;
                --line-caption: 16px;
            }

            /* Override inline grid styles to single column â€” scoped to the editor panel only */
            .editor-panel [style*="grid-template-columns: repeat(3, 1fr)"] {
                grid-template-columns: 1fr !important;
                gap: var(--space-md) !important;
            }
            /* Only force 2-col to 1-col inside cards, not analytics legend layouts */
            .editor-panel .card [style*="grid-template-columns: repeat(2, 1fr)"]:not(.analytics-legend) {
                grid-template-columns: 1fr !important;
                gap: var(--space-md) !important;
            }

            /* Make stat boxes more prominent on mobile */
            .editor-panel [style*="grid-template-columns: repeat(3, 1fr)"] > div {
                padding: var(--space-xl) !important;
                text-align: center;
            }

            /* Stack theme toggle buttons */
            .theme-toggle-group {
                flex-direction: column;
                gap: var(--space-sm);
            }

            .theme-toggle-btn {
                width: 100%;
            }

            /* Tasteful padding reduction for better space efficiency */
            .card {
                padding: var(--space-lg);
                margin-bottom: var(--space-lg);
                /* Snap to major card sections */
                scroll-snap-align: start;
                scroll-margin-top: 20px;
            }

            .card-header {
                margin-bottom: var(--space-md);
            }

            .editor-header {
                margin-bottom: var(--space-xl);
                padding-bottom: var(--space-lg);
            }

            .editor-title {
                font-size: var(--font-h1);
                line-height: var(--line-h1);
            }

            .editor-subtitle {
                font-size: var(--font-body);
                line-height: var(--line-body);
            }

            /* Maintain comfortable spacing for interactive elements */
            .list-item {
                padding: 14px 12px;
            }

            .switch-group {
                padding: 14px;
            }

            /* Keep auto-banner comfortable */
            .auto-banner {
                padding: var(--space-xl);
                margin-bottom: var(--space-lg);
                /* Snap to banner sections */
                scroll-snap-align: start;
                scroll-margin-top: 20px;
            }

            /* Sidebar footer in mobile context */
            .sidebar-footer {
                padding: var(--space-lg);
            }
        }

        /* Mobile Preview Overlay */
        .mobile-preview-overlay {
            display: none; /* Hidden by default */
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            z-index: 2000;
            animation: fadeIn 0.3s ease;
            overflow: hidden;
        }

        .mobile-preview-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .mobile-preview-container {
            width: 100%;
            max-width: 440px;
            max-height: 90vh;
            background: var(--bg-primary);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.4s var(--ease-spring);
            display: flex;
            flex-direction: column;
        }

        .mobile-preview-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--bg-secondary);
        }

        .mobile-preview-close {
            width: 40px;
            height: 40px;
            border: none;
            background: var(--bg-tertiary);
            border-radius: 10px;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mobile-preview-close:hover {
            background: var(--border);
            transform: rotate(90deg);
        }

        .mobile-preview-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            align-items: flex-start;
            justify-content: center;
        }

        #mobilePreviewContent {
            width: 100%;
            max-width: 390px;
        }

        /* Ensure mobile preview frame scales properly */
        #mobilePreviewContent .preview-frame {
            width: 100% !important;
            height: auto !important;
            max-height: none !important;
        }

        #mobilePreviewContent .preview-frame.mobile {
            border-radius: 40px;
        }

        /* ===================================
           AUTO-STATE TIMELINE BANNER - VERTICAL STEPPER
           =================================== */
        .timeline-banner {
            background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%);
            border-radius: 20px;
            padding: 28px;
            margin-bottom: 24px;
            box-shadow: 
                0 8px 24px rgba(8, 145, 178, 0.25),
                0 2px 8px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .timeline-banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .timeline-banner-header {
            position: relative;
            z-index: 1;
            margin-bottom: 20px;
        }

        .timeline-banner-title {
            font-size: 20px;
            font-weight: 900;
            color: #ffffff;
            margin-bottom: 6px;
            letter-spacing: -0.02em;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .timeline-banner-subtitle {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.95);
            line-height: 1.5;
            font-weight: 500;
        }

        .timeline-steps {
            position: relative;
            z-index: 1;
            margin-bottom: 16px;
        }

        .timeline-step {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            margin-bottom: 12px;
            position: relative;
        }

        .timeline-step:last-child {
            margin-bottom: 0;
        }

        .timeline-step::before {
            content: '';
            position: absolute;
            left: 21px;
            top: 42px;
            bottom: -12px;
            width: 2px;
            background: rgba(255, 255, 255, 0.3);
        }

        .timeline-step:last-child::before {
            display: none;
        }

        .timeline-step-icon {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
            position: relative;
            z-index: 1;
            transition: all 0.3s ease;
        }

        .timeline-step.active .timeline-step-icon {
            background: white;
            border-color: white;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            animation: pulseIcon 2s infinite;
        }

        @keyframes pulseIcon {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .timeline-step-content {
            flex: 1;
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 12px 16px;
            transition: all 0.3s ease;
        }

        .timeline-step.active .timeline-step-content {
            background: rgba(255, 255, 255, 0.95);
            border-color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .timeline-step-label {
            font-size: 10px;
            font-weight: 900;
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
            letter-spacing: 0.8px;
            margin-bottom: 4px;
        }

        .timeline-step.active .timeline-step-label {
            color: #0891b2;
        }

        .timeline-step-title {
            font-size: 15px;
            font-weight: 800;
            color: white;
            margin-bottom: 2px;
        }

        .timeline-step.active .timeline-step-title {
            color: #0a0a0a;
        }

        .timeline-step-detail {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
            line-height: 1.3;
        }

        .timeline-step.active .timeline-step-detail {
            color: #525252;
        }

        .timeline-cta {
            width: 100%;
            padding: 16px 28px;
            background: rgba(255, 255, 255, 0.18);
            backdrop-filter: blur(12px);
            border: 2px solid rgba(255, 255, 255, 0.35);
            border-radius: 14px;
            color: #ffffff;
            font-size: 16px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.3s var(--ease-smooth);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            z-index: 1;
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .timeline-cta:hover {
            background: rgba(255, 255, 255, 0.28);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
            box-shadow: 
                0 8px 20px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .timeline-cta:active {
            transform: translateY(0);
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .timeline-cta:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* ===================================
           ONBOARDING WIZARD
           =================================== */
        /* ===================================
           MODALS
           =================================== */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.2s ease;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-primary);
            border-radius: 16px;
            max-width: 560px;
            width: 100%;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s var(--ease-spring);
            display: flex;
            flex-direction: column;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 24px 28px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border: none;
            background: var(--bg-tertiary);
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
        }

        .modal-close:hover {
            background: var(--border);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 24px 28px;
            overflow-y: auto;
            flex: 1;
            /* Smooth momentum scrolling */
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
        }

        .modal-footer {
            padding: 20px 28px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        @media (max-width: 768px) {
            .modal {
                max-width: 100%;
                margin: 0;
                border-radius: 20px 20px 0 0;
                max-height: 85vh;
                position: fixed;
                bottom: 0;
            }

            .modal-header,
            .modal-body,
            .modal-footer {
                padding-left: 20px;
                padding-right: 20px;
            }

            .modal-footer {
                flex-direction: column-reverse;
            }

            .modal-footer .btn {
                width: 100%;
            }
        }

        /* ===================================
           EMPTY STATES
           =================================== */
        .empty-state {
            text-align: center;
            padding: 60px 32px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            border: 2px dashed rgba(8, 145, 178, 0.3);
        }

        @keyframes emptyIconFloat {
            0%, 100% { transform: translateY(0px); }
            50%       { transform: translateY(-8px); }
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.45;
            line-height: 1;
            display: inline-block;
            animation: emptyIconFloat 3.5s ease-in-out infinite;
        }

        .empty-state-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .empty-state-text {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 24px;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .empty-state-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }

        .empty-state-divider {
            font-size: 13px;
            color: var(--text-tertiary);
            font-weight: 600;
        }

        /* Compact empty state (for smaller cards) */
        .empty-state-compact {
            padding: 32px 24px;
        }

        .empty-state-compact .empty-state-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .empty-state-compact .empty-state-title {
            font-size: 16px;
        }

        .empty-state-compact .empty-state-text {
            font-size: 13px;
            margin-bottom: 16px;
        }

        @media (max-width: 768px) {
            .empty-state {
                padding: 48px 24px;
            }

            .empty-state-icon {
                font-size: 52px;
            }

            .empty-state-title {
                font-size: 16px;
            }

            .empty-state-text {
                font-size: 13px;
            }

            .empty-state-actions {
                flex-direction: column;
                width: 100%;
            }

            .empty-state-actions .btn {
                width: 100%;
            }

            .empty-state-divider {
                display: none;
            }
        }

        /* Mobile optimizations for timeline */
        @media (max-width: 768px) {
            .timeline-banner {
                padding: 20px 16px;
                border-radius: 16px;
                /* Snap to banner sections */
                scroll-snap-align: start;
                scroll-margin-top: 20px;
            }

            .timeline-banner-title {
                font-size: 18px;
            }

            .timeline-banner-subtitle {
                font-size: 13px;
            }

            .timeline-steps {
                margin-bottom: 14px;
            }

            .timeline-step {
                gap: 12px;
                margin-bottom: 10px;
            }

            .timeline-step::before {
                left: 18px;
                top: 38px;
                bottom: -10px;
            }

            .timeline-step-icon {
                width: 36px;
                height: 36px;
                font-size: 18px;
            }

            .timeline-step-content {
                padding: 10px 14px;
            }

            .timeline-step-label {
                font-size: 9px;
                margin-bottom: 3px;
            }

            .timeline-step-title {
                font-size: 14px;
            }

            .timeline-step-detail {
                font-size: 12px;
            }

            .timeline-cta {
                font-size: 14px;
                padding: 12px 18px;
            }
        }

        /* Platform Connection Cards */

        /* â”€â”€ Music Release Cards â”€â”€ */
        .release-card {
            background: var(--bg-secondary);
            border: 1.5px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 16px;
            margin-bottom: 12px;
            transition: box-shadow var(--transition-base);
        }
        .release-card:hover { box-shadow: var(--elevation-3); }
        .release-card-header { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
        .release-artwork-placeholder {
            width: 52px; height: 52px; border-radius: 8px;
            background: linear-gradient(135deg, var(--accent) 0%, #06b6d4 100%);
            flex-shrink: 0; display: flex; align-items: center; justify-content: center; font-size: 22px;
        }
        .release-info { flex: 1; min-width: 0; }
        .release-title { font-size: 15px; font-weight: 700; letter-spacing: -0.01em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .release-meta { font-size: 12px; color: var(--text-tertiary); margin-top: 2px; }
        .release-actions { display: flex; gap: 6px; }
        .release-platform-pills { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
        .release-card-footer { display:flex; align-items:center; justify-content:space-between; }
        .release-pill {
            display: inline-flex; align-items: center; gap: 4px;
            padding: 3px 9px; border-radius: 999px; font-size: 11px; font-weight: 800;
            border: 1.5px solid currentColor; opacity: 0.4;
        }
        .release-pill.has-url { opacity: 1; }
        .release-pill.sp { color: #1DB954; }
        .release-pill.am { color: #fc3c44; }
        .release-pill.sc { color: #ff5500; }
        .release-pill.yt { color: #ff0000; }
        .release-pill.tt { color: #555; }
        [data-theme="dark"] .release-pill.tt { color: #ccc; }
        .release-mode-badge {
            display: inline-flex; align-items: center; gap: 4px;
            padding: 3px 8px; border-radius: 6px; font-size: 11px; font-weight: 700;
            background: var(--accent-soft); color: var(--accent);
        }
        /* Embed player wrappers (used in preview Releases section) */
        .able-embedWrap {
            width: 100%; border-radius: var(--radius-lg, 12px);
            overflow: hidden; border: 1px solid var(--border);
            background: var(--bg-secondary);
        }
        .able-embedRatio { position: relative; width: 100%; padding-top: 56.25%; }
        .able-embedRatio iframe {
            position: absolute; inset: 0; width: 100%; height: 100%; border: 0; display: block;
        }
        /* Lazy embed placeholder */
        .able-embedLazy {
            display: flex; align-items: center; justify-content: center;
            flex-direction: column; gap: 8px; min-height: 180px;
            background: var(--bg-secondary);
        }
        .able-embedLoadBtn {
            padding: var(--space-sm) var(--space-lg);
            border-radius: var(--radius-full);
            border: 1px solid var(--border);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-weight: var(--weight-semibold);
            font-size: 13px; cursor: pointer;
            transition: transform 0.12s ease, box-shadow 0.12s ease;
        }
        .able-embedLoadBtn:hover { transform: translateY(-1px); box-shadow: var(--elevation-2, 0 4px 12px rgba(0,0,0,.12)); }
        .able-embedLoadBtn:active { transform: scale(0.97); }
        .able-embedHint { font-size: 11px; color: var(--text-tertiary); }
        body.glassmorphism-enabled .able-embedLazy {
            background: var(--card-glass-bg);
            backdrop-filter: blur(var(--card-glass-blur, 12px));
            border-color: var(--card-glass-border);
        }
        /* â”€â”€ Display Mode Toggle â”€â”€ */
        .display-mode-btn {
            padding: 14px 12px; border-radius: var(--radius-md);
            border: 2px solid var(--border); background: var(--bg-tertiary);
            cursor: pointer; text-align: center; transition: all var(--transition-base); user-select: none;
        }
        .display-mode-btn:hover { border-color: var(--accent); }
        .display-mode-btn.active { border-color: var(--accent); background: var(--accent-soft); color: var(--accent); }
        /* â”€â”€ Track Input Rows â”€â”€ */
        .track-input-row {
            display: grid; grid-template-columns: 28px 1fr 64px auto;
            gap: 6px; align-items: center;
        }
        .track-num-badge {
            width: 28px; height: 28px; border-radius: 6px;
            background: var(--bg-tertiary); border: 1px solid var(--border);
            display: flex; align-items: center; justify-content: center;
            font-size: 12px; font-weight: 700; color: var(--text-tertiary);
        }
        /* â”€â”€ Empty release state â”€â”€ */
        .music-empty {
            text-align: center; padding: 40px 24px;
            background: var(--bg-secondary); border: 2px dashed var(--border);
            border-radius: var(--radius-lg); margin-bottom: 16px;
        }
        .music-empty-icon { font-size: 40px; margin-bottom: 12px; opacity: 0.35; }
        .music-empty-title { font-size: 15px; font-weight: 700; margin-bottom: 6px; }
        .music-empty-text { font-size: 13px; color: var(--text-tertiary); line-height: 1.5; }


        /* â”€â”€ Platform List (rebuilt) â”€â”€ */
        .platform-list {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .platform-row {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 4px;
            border-bottom: 1px solid var(--border);
        }

        .platform-row:last-child {
            border-bottom: none;
        }

        .platform-row-icon {
            font-size: 20px;
            width: 28px;
            text-align: center;
            flex-shrink: 0;
        }

        .platform-row-name {
            font-size: 13px;
            font-weight: 700;
            width: 110px;
            flex-shrink: 0;
            color: var(--text-primary);
        }

        .platform-row-input {
            flex: 1;
            background: var(--bg-tertiary);
            border: 1.5px solid var(--border);
            border-radius: 8px;
            padding: 7px 10px;
            font-size: 12px;
            color: var(--text-primary);
            font-family: inherit;
            transition: border-color 0.15s ease;
            min-width: 0;
        }

        .platform-row-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .platform-row-input::placeholder {
            color: var(--text-tertiary);
        }

        .platform-row-status {
            font-size: 11px;
            font-weight: 700;
            width: 20px;
            text-align: center;
            flex-shrink: 0;
            transition: opacity 0.2s ease;
        }

        .platform-row-status.connected {
            color: var(--accent);
        }

        .platform-row-status.empty {
            color: var(--text-tertiary);
        }

        .platform-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        .platform-card {
            padding: 16px;
            background: var(--bg-secondary);
            border: 1.5px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s var(--ease-smooth);
            text-align: center;
        }

        .platform-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .platform-card.connected {
            background: var(--accent-soft);
            border-color: var(--accent);
        }

        .platform-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .platform-name {
            font-size: 13px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .platform-status {
            font-size: 11px;
            color: var(--text-tertiary);
        }

        .platform-card.connected .platform-status {
            color: var(--accent);
        }

        /* List Items */
        .list-item {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md);
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-sm);
            cursor: grab;
            transition: all var(--transition-base) var(--ease-smooth);
            border: 1px solid transparent;
            border-left: 3px solid rgba(8, 145, 178, 0.25);
        }

        .list-item:hover {
            background: var(--bg-secondary);
            box-shadow: var(--elevation-2), 0 0 0 1px rgba(8, 145, 178, 0.12);
            transform: translateY(-1px);
            border-left-color: var(--accent);
        }

        .list-item:active {
            cursor: grabbing;
            transform: scale(1.02);
            box-shadow: var(--elevation-3);
        }

        /* Drag and drop states */
        .list-item.dragging {
            opacity: 0.5;
            cursor: grabbing;
            transform: scale(1.05);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
            z-index: 1000;
        }

        .list-item.drag-over {
            border-top: 3px solid var(--accent);
            margin-top: 8px;
        }

        .drag-handle {
            font-size: var(--icon-sm);
            color: var(--text-tertiary);
            cursor: grab;
            padding: var(--space-sm);
            margin: calc(var(--space-sm) * -1);
            min-width: 44px;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            user-select: none;
        }

        .list-item-content {
            flex: 1;
        }

        .list-item-title {
            font-size: var(--font-small);
            line-height: var(--line-small);
            font-weight: var(--weight-semibold);
            margin-bottom: 2px;
        }

        .list-item-meta {
            font-size: var(--font-tiny);
            line-height: var(--line-tiny);
            color: var(--text-tertiary);
        }

        .list-item-actions {
            display: flex;
            gap: var(--space-sm);
        }

        .icon-btn {
            min-width: 44px;
            min-height: 44px;
            border: none;
            background: transparent;
            border-radius: var(--radius-md);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--icon-sm);
            line-height: 1;
            transition: all var(--transition-base) var(--ease-smooth);
            position: relative;
            user-select: none;
        }

        .icon-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: var(--radius-md);
            background: currentColor;
            opacity: 0;
            transition: opacity var(--transition-fast);
        }

        .icon-btn:hover {
            background: var(--bg-secondary);
            transform: scale(1.1);
        }

        .icon-btn:hover::before {
            opacity: 0.05;
        }

        .icon-btn:active {
            transform: scale(0.95);
        }

        .icon-btn.delete:hover {
            background: var(--error-light);
            color: var(--error);
        }

        .icon-btn.delete:hover::before {
            opacity: 0.1;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 48px 24px;
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .empty-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .empty-text {
            font-size: 14px;
            color: var(--text-tertiary);
            margin-bottom: 20px;
        }

        /* Buttons */
        .btn {
            padding: var(--space-md) var(--space-xl);
            border-radius: var(--radius-lg);
            font-size: var(--font-small);
            line-height: var(--line-small);
            font-weight: var(--weight-bold);
            cursor: pointer;
            transition: all var(--transition-base) var(--ease-smooth);
            border: none;
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            justify-content: center;
            min-height: 44px;
        }

        .btn > * {
            line-height: 1;
        }

        .btn:hover {
            transform: translateY(-1px);
        }

        .btn:active {
            transform: translateY(0);
            transition: all 0.1s var(--ease-smooth);
        }

        .btn-spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .btn-primary {
            background: var(--accent-gradient);
            color: white;
            box-shadow: 
                var(--elevation-3),
                0 1px 0 rgba(255, 255, 255, 0.15) inset,
                0 -1px 0 rgba(0, 0, 0, 0.1) inset;
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 
                var(--elevation-4), 
                var(--shadow-glow),
                0 1px 0 rgba(255, 255, 255, 0.2) inset,
                0 -1px 0 rgba(0, 0, 0, 0.1) inset;
        }

        .btn-primary:active {
            transform: translateY(0);
            box-shadow: 
                var(--elevation-2),
                0 1px 0 rgba(255, 255, 255, 0.1) inset,
                0 2px 4px rgba(0, 0, 0, 0.2) inset;
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1.5px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent);
            box-shadow: var(--elevation-1);
        }

        .btn-outline {
            background: transparent;
            color: var(--accent);
            border: 1.5px solid var(--accent);
        }

        .btn-outline:hover {
            background: var(--accent-soft);
        }

        /* Danger button variants */
        .btn-danger {
            width: 100%;
            background: var(--error);
            color: white;
            border: 2px solid var(--error);
            font-weight: 700;
        }
        .btn-danger:hover {
            background: #dc2626;
            border-color: #dc2626;
            transform: translateY(-1px);
        }
        .btn-danger-ghost {
            width: 100%;
            background: rgba(239, 68, 68, 0.08);
            color: var(--error);
            border: 1.5px solid rgba(239, 68, 68, 0.35);
            font-weight: 700;
        }
        .btn-danger-ghost:hover {
            background: rgba(239, 68, 68, 0.15);
            border-color: var(--error);
        }

        /* Disabled state for all buttons */
        .btn:disabled,
        .btn[disabled] {
            opacity: 0.45;
            cursor: not-allowed;
            pointer-events: none;
        }

        /* Full-width button utility */
        .btn-full { width: 100%; }

        /* ===================================
           OVERVIEW TAB
           =================================== */

        .overview-greeting {
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: var(--accent);
            opacity: 0.8;
            margin-bottom: 6px;
        }

        /* Setup progress */
        .setup-progress-wrap { margin: 12px 0 16px; }
        .setup-progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 7px;
        }
        .setup-progress-label {
            font-size: 11px;
            color: var(--text-tertiary);
            font-weight: 600;
        }
        .setup-progress-pct {
            font-size: 11px;
            font-weight: 700;
            color: var(--accent);
        }
        .setup-progress-track {
            height: 5px;
            background: var(--border);
            border-radius: 3px;
            overflow: hidden;
        }
        .setup-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent) 0%, #06b6d4 100%);
            border-radius: 3px;
            transition: width 0.55s var(--ease-smooth);
            width: 0%;
        }

        /* Checklist items */
        .checklist-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 11px 14px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.18s ease, transform 0.15s ease, border-left-color 0.18s ease;
            border-left: 3px solid rgba(8, 145, 178, 0.18);
            text-align: left;
        }
        .checklist-item:hover {
            background: var(--bg-secondary);
            border-left-color: var(--accent);
            transform: translateX(2px);
        }
        .checklist-icon {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background: var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-tertiary);
            font-size: 11px;
            font-weight: 800;
            flex-shrink: 0;
            transition: background 0.25s ease, color 0.25s ease;
        }
        .checklist-text { flex: 1; min-width: 0; }
        .checklist-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1px;
        }
        .checklist-sub {
            font-size: 11px;
            color: var(--text-tertiary);
        }
        .checklist-arrow {
            color: rgba(8, 145, 178, 0.35);
            font-size: 14px;
            flex-shrink: 0;
            transition: transform 0.18s ease, color 0.18s ease;
        }
        .checklist-item:hover .checklist-arrow {
            color: var(--accent);
            transform: translateX(3px);
        }

        /* Stat tiles */
        .stat-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 14px;
        }
        .stat-tile {
            padding: 14px 10px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            border: 1px solid var(--border);
            text-align: center;
            transition: border-color 0.18s, background 0.18s;
        }
        .stat-tile:hover {
            border-color: rgba(8, 145, 178, 0.3);
            background: var(--bg-secondary);
        }
        .stat-tile-tag {
            display: inline-block;
            font-size: 8px;
            font-weight: 800;
            letter-spacing: 0.06em;
            padding: 2px 5px;
            border-radius: 3px;
            margin-bottom: 3px;
        }
        .stat-tile-tag.teal  { background: rgba(8,145,178,0.12); color: var(--accent); }
        .stat-tile-tag.green { background: rgba(16,185,129,0.12); color: var(--success); }
        .stat-tile-value {
            font-size: 22px;
            font-weight: 900;
            letter-spacing: -0.02em;
            line-height: 1.1;
            margin-bottom: 3px;
        }
        .stat-tile-label {
            font-size: 10px;
            color: var(--text-tertiary);
            font-weight: 600;
            line-height: 1.4;
        }

        /* Quick action grid */
        .quick-action-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 4px;
        }
        .quick-action-tile {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 16px 6px 14px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.18s var(--ease-smooth);
            font-family: inherit;
            text-align: center;
            width: 100%;
        }
        .quick-action-tile:hover {
            background: var(--bg-secondary);
            border-color: rgba(8, 145, 178, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(8, 145, 178, 0.1);
        }
        .quick-action-tile:active { transform: translateY(0); }
        .quick-action-icon {
            width: 38px;
            height: 38px;
            background: rgba(8, 145, 178, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 17px;
            transition: background 0.18s;
        }
        .quick-action-tile:hover .quick-action-icon { background: rgba(8, 145, 178, 0.2); }
        .quick-action-label {
            font-size: 10px;
            font-weight: 700;
            color: var(--text-secondary);
            line-height: 1.3;
            letter-spacing: 0.01em;
        }

        /* Mode indicator */
        .mode-status-row {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 14px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            border: 1px solid var(--border);
            margin-bottom: 10px;
        }
        .mode-pulse-dot {
            width: 9px;
            height: 9px;
            border-radius: 50%;
            background: var(--accent);
            flex-shrink: 0;
            animation: modePulse 2.5s ease-in-out infinite;
        }
        @keyframes modePulse {
            0%, 100% { box-shadow: 0 0 0 3px rgba(8,145,178,0.18); }
            50%       { box-shadow: 0 0 0 7px rgba(8,145,178,0.04); }
        }
        .mode-status-name {
            font-size: 13px;
            font-weight: 700;
            color: var(--text-primary);
            flex: 1;
        }
        .mode-status-detail {
            font-size: 11px;
            color: var(--text-tertiary);
        }

        /* Status Badge */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            padding: var(--space-xs) var(--space-md);
            border-radius: var(--radius-sm);
            font-size: var(--font-tiny);
            line-height: var(--line-tiny);
            font-weight: var(--weight-bold);
            transition: all var(--transition-fast) var(--ease-smooth);
        }

        .badge:hover {
            transform: scale(1.05);
        }

        .badge-success {
            background: var(--success-light);
            color: var(--success-dark);
        }

        .badge-warning {
            background: var(--warning-light);
            color: var(--warning-dark);
        }

        /* ===================================
           BRAND COLOR PICKER
           =================================== */
        .color-presets {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }

        .color-preset {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.2s var(--ease-smooth);
            position: relative;
            flex-shrink: 0;
        }

        .color-preset:hover {
            transform: scale(1.1);
            border-color: var(--border);
        }

        .color-preset.active {
            border-color: var(--text-primary);
            box-shadow: 0 0 0 2px var(--bg-primary);
        }

        .color-preset.active::after {
            content: 'âœ“';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 18px;
            font-weight: 900;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .color-preset.custom {
            background: linear-gradient(135deg, #f87171 0%, #fb923c 25%, #fbbf24 50%, #34d399 75%, #60a5fa 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .color-preset.custom:hover {
            transform: scale(1.1) rotate(90deg);
        }

        .color-picker-input {
            position: absolute;
            width: 0;
            height: 0;
            opacity: 0;
            pointer-events: none;
        }

        /* ===================================
           BACKGROUND IMAGE CONTROLS
           =================================== */
        
        /* Slider Styles */
        /* ===================================
           ENHANCED SLIDER STYLES
           =================================== */
        
        .bg-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            appearance: none;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        /* Opacity Slider - Transparent to Opaque */
        #backgroundOpacitySlider {
            background: linear-gradient(to right, 
                rgba(var(--accent-rgb, 8, 145, 178), 0) 0%, 
                rgba(var(--accent-rgb, 8, 145, 178), 1) 100%);
            border: 1px solid var(--border);
        }

        /* Blur Slider - Sharp to Blurred */
        #backgroundBlurSlider {
            background: linear-gradient(to right, 
                var(--accent) 0%, 
                rgba(var(--accent-rgb, 8, 145, 178), 0.3) 100%);
            border: 1px solid var(--border);
        }

        /* Brightness Slider - Dark to Light */
        #backgroundBrightnessSlider {
            background: linear-gradient(to right, 
                #333 0%, 
                #888 50%, 
                #fff 100%);
            border: 1px solid var(--border);
        }

        /* Saturation Slider - Grayscale to Vibrant */
        #backgroundSaturationSlider {
            background: linear-gradient(to right, 
                #888 0%, 
                #ff0000 16.66%, 
                #ffff00 33.33%, 
                #00ff00 50%, 
                #00ffff 66.66%, 
                #0000ff 83.33%, 
                #ff00ff 100%);
            border: 1px solid var(--border);
        }

        .bg-slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            cursor: grab;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3), 
                        0 0 0 2px var(--accent);
            transition: all 0.2s;
            border: 3px solid var(--accent);
        }

        .bg-slider::-webkit-slider-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.4),
                        0 0 0 3px var(--accent);
        }

        .bg-slider::-webkit-slider-thumb:active {
            cursor: grabbing;
            transform: scale(1.05);
        }

        .bg-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            cursor: grab;
            border: 3px solid var(--accent);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .bg-slider::-moz-range-thumb:hover {
            transform: scale(1.15);
        }

        .bg-slider::-moz-range-thumb:active {
            cursor: grabbing;
        }

        /* Slider Container Enhancement */
        .slider-container {
            position: relative;
            padding: 4px 0;
        }

        .slider-value-display {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--accent);
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            white-space: nowrap;
        }

        .slider-value-display::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 4px solid transparent;
            border-right: 4px solid transparent;
            border-top: 4px solid var(--accent);
        }

        .bg-slider:hover + .slider-value-display,
        .bg-slider:active + .slider-value-display {
            opacity: 1;
        }

        /* ===================================
           ENHANCED PRESET BUTTONS
           =================================== */
        
        .preset-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .preset-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 12px 8px;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 11px;
            font-weight: 700;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s var(--ease-smooth);
            position: relative;
        }

        .preset-btn:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent);
            color: var(--text-primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .preset-btn:active {
            transform: translateY(0);
        }

        .preset-icon {
            font-size: 20px;
            line-height: 1;
            filter: grayscale(0.3);
            transition: filter 0.2s;
        }

        .preset-btn:hover .preset-icon {
            filter: grayscale(0);
        }

        /* Toggle Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .switch .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-tertiary);
            border: 2px solid var(--border);
            transition: 0.3s;
            border-radius: 24px;
        }

        .switch .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        .switch input:checked + .slider {
            background: linear-gradient(135deg, var(--accent) 0%, #06b6d4 100%);
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(8, 145, 178, 0.15);
        }

        .switch input:checked + .slider:before {
            transform: translateX(20px);
            box-shadow: 0 2px 8px rgba(8, 145, 178, 0.35);
        }

        /* Glassmorphism Effect - ONLY ON PREVIEW PANEL */
        body.glassmorphism-enabled .preview-frame .card,
        body.glassmorphism-enabled .preview-frame [class*="cta-item"],
        body.glassmorphism-enabled .preview-content > div > div {
            background: var(--card-glass-bg) !important;
            backdrop-filter: blur(var(--card-glass-blur)) !important;
            -webkit-backdrop-filter: blur(var(--card-glass-blur)) !important;
            border: 1px solid var(--card-glass-border) !important;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1) !important;
        }

        /* Dark mode: --card-glass-bg and --card-glass-border are overridden by [data-theme="dark"] */
        [data-theme="dark"].glassmorphism-enabled .preview-frame .card,
        [data-theme="dark"].glassmorphism-enabled .preview-frame [class*="cta-item"] {
            background: var(--card-glass-bg) !important;
            border: 1px solid var(--card-glass-border) !important;
        }

        .color-preview-bar {
            margin-top: 16px;
            padding: 16px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .color-preview-text {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .color-preview-swatch {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .color-preview-dot {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid var(--border);
        }

        /* ===================================
           COLOR PALETTE SYSTEM
           =================================== */
        
        .palette-card {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.2s var(--ease-smooth);
            text-align: center;
        }

        .palette-card:hover {
            border-color: var(--accent);
            transform: translateY(-1px);
        }

        .palette-card.active {
            border-color: var(--accent);
            background: var(--accent-soft);
        }

        .palette-colors {
            display: flex;
            gap: 4px;
            margin-bottom: 6px;
            justify-content: center;
        }

        .palette-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 1px solid rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }

        .palette-name {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* ===================================
           APPEARANCE SECTION NAVIGATION
           =================================== */
        
        .appearance-nav {
            position: sticky;
            top: 0;
            z-index: 100;
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border);
            margin: -24px -24px 24px -24px;
            padding: 12px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
        }

        .appearance-nav-inner {
            display: flex;
            gap: 4px;
            overflow-x: auto;
            flex: 1;
            scrollbar-width: none;
        }

        .appearance-nav-inner::-webkit-scrollbar {
            display: none;
        }

        .appearance-nav-link {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.2s var(--ease-smooth);
            white-space: nowrap;
            cursor: pointer;
            border: 1px solid transparent;
        }

        .appearance-nav-link:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-color: var(--border);
        }

        .appearance-nav-link.active {
            background: var(--bg-secondary);
            color: var(--accent);
            border-color: var(--accent);
        }

        .appearance-nav-link .nav-icon {
            font-size: 16px;
            line-height: 1;
        }

        .btn-reset-all {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s var(--ease-smooth);
            flex-shrink: 0;
        }

        .btn-reset-all:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent);
            color: var(--accent);
        }

        .btn-reset-all span:first-child {
            font-size: 16px;
            line-height: 1;
        }

        .appearance-section {
            scroll-margin-top: 80px;
        }

        /* Theme Option Buttons */
        .theme-option {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 0;
            cursor: pointer;
            transition: all 0.2s var(--ease-smooth);
            overflow: hidden;
        }

        .theme-option:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .theme-option.active {
            border-color: var(--accent);
            border-width: 3px;
            box-shadow: 0 0 0 3px var(--accent-soft);
        }

        .theme-preview {
            height: 80px;
            display: flex;
            align-items: flex-start;
            justify-content: flex-start;
        }

        .theme-label {
            padding: 12px;
            font-size: 14px;
            font-weight: 600;
            text-align: center;
            background: var(--bg-primary);
            border-top: 1px solid var(--border);
        }

        /* ===================================
           APPEARANCE OPTIONS
           =================================== */
        
        /* Button Style Options */
        .button-style-option {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s var(--ease-smooth);
            text-align: center;
        }

        .button-style-option:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .button-style-option.active {
            border-color: var(--accent);
            background: var(--accent-soft);
        }

        .button-style-preview {
            width: 100%;
            padding: 12px 20px;
            margin-bottom: 12px;
            font-size: 14px;
            font-weight: 600;
            background: var(--accent);
            color: white;
            border: none;
            transition: all 0.2s;
        }

        .button-style-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        /* Font Options */
        .font-option {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s var(--ease-smooth);
            text-align: center;
        }

        .font-option:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .font-option.active {
            border-color: var(--accent);
            background: var(--accent-soft);
        }

        .font-preview {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
            line-height: 1.2;
        }

        .font-option[data-font="serif"] .font-preview {
            font-family: Georgia, serif;
        }

        .font-option[data-font="sans"] .font-preview {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        }

        .font-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        /* Background Pattern Options */
        .background-option {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s var(--ease-smooth);
        }

        .background-option:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .background-option.active {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-soft);
        }

        .background-preview {
            height: 80px;
            position: relative;
        }

        .background-preview.grain {
            background: #f7f7f6;
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="400"><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="4" stitchTiles="stitch"/></filter><rect width="400" height="400" filter="url(%23noise)" opacity="0.03"/></svg>');
        }

        .background-preview.solid {
            background: #f7f7f6;
        }

        .background-preview.gradient {
            background: linear-gradient(135deg, #f7f7f6 0%, #ffffff 50%, #f7f7f6 100%);
        }

        .background-label {
            padding: 12px;
            font-size: 13px;
            font-weight: 600;
            text-align: center;
            background: var(--bg-primary);
            border-top: 1px solid var(--border);
        }

        /* Button style classes applied to actual buttons */
        .btn-style-rounded {
            border-radius: 12px;
        }

        .btn-style-sharp {
            border-radius: 4px;
        }

        .btn-style-pill {
            border-radius: 100px;
        }

        /* ===================================
           TIER 1 CUSTOMIZATIONS
           =================================== */

        /* Aesthetic Presets - Complete Visual Themes */
        [data-aesthetic="y2k"] {
            --accent: #ff00ff;
            --bg-primary: #000033;
            --bg-secondary: #1a0033;
            --text-primary: #00ffff;
        }

        [data-aesthetic="vhs"] {
            --accent: #ff6b35;
            filter: contrast(1.1) saturate(1.2);
        }

        [data-aesthetic="brutalist"] {
            --accent: #000000;
            --border: #000000;
        }

        [data-aesthetic="glass"] {
            --card-bg: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
        }

        [data-aesthetic="film"] {
            --accent: #d4a574;
            filter: sepia(0.15) contrast(1.05);
        }

        [data-aesthetic="vaporwave"] {
            --accent: #ff71ce;
            --bg-primary: #01cdfe;
            --bg-secondary: #b967ff;
        }

        [data-aesthetic="gothic"] {
            --accent: #8b0000;
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --text-primary: #e8e8e8;
        }

        [data-aesthetic="summer"] {
            --accent: #ffd60a;
            --bg-primary: #ffe8d6;
            --bg-secondary: #fff5e1;
        }

        [data-aesthetic="punk"] {
            --accent: #ff006e;
            transform: rotate(-0.5deg);
        }

        [data-aesthetic="luxury"] {
            --accent: #d4af37;
            letter-spacing: 0.02em;
        }

        /* Animation Styles */
        .anim-smooth * {
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1) !important;
            transition-duration: 0.3s !important;
        }

        .anim-bouncy * {
            transition-timing-function: cubic-bezier(0.68, -0.55, 0.265, 1.55) !important;
            transition-duration: 0.4s !important;
        }

        .anim-snappy * {
            transition-timing-function: cubic-bezier(0.4, 0, 1, 1) !important;
            transition-duration: 0.15s !important;
        }

        .anim-glitchy * {
            transition-timing-function: steps(3, jump-none) !important;
            transition-duration: 0.2s !important;
        }

        .anim-none * {
            transition: none !important;
            animation: none !important;
        }

        /* Card Styles */
        .cards-elevated .card,
        .cards-elevated [class*="cta-item"],
        .cards-elevated .preview-frame > div > div[style*="background"] {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08) !important;
        }

        .cards-flat .card,
        .cards-flat [class*="cta-item"],
        .cards-flat .preview-frame > div > div[style*="background"] {
            box-shadow: none !important;
        }

        .cards-outlined .card,
        .cards-outlined [class*="cta-item"],
        .cards-outlined .preview-frame > div > div[style*="background"] {
            box-shadow: none !important;
            border: 3px solid var(--border) !important;
            background: transparent !important;
        }

        .cards-neumorphic .card,
        .cards-neumorphic [class*="cta-item"],
        .cards-neumorphic .preview-frame > div > div[style*="background"] {
            box-shadow: 8px 8px 16px rgba(0, 0, 0, 0.1), -8px -8px 16px rgba(255, 255, 255, 0.7) !important;
            border: 1px solid rgba(255, 255, 255, 0.5) !important;
        }

        .cards-neon .card,
        .cards-neon [class*="cta-item"],
        .cards-neon .preview-frame > div > div[style*="background"] {
            box-shadow: 0 0 20px var(--accent), 0 0 40px var(--accent) !important;
            border: 2px solid var(--accent) !important;
            background: rgba(0, 0, 0, 0.3) !important;
        }

        .cards-handdrawn .card,
        .cards-handdrawn [class*="cta-item"],
        .cards-handdrawn .preview-frame > div > div[style*="background"] {
            border: 3px solid var(--text-primary) !important;
            border-radius: 255px 25px 225px 25px/25px 225px 25px 255px !important;
            box-shadow: none !important;
        }

        /* Corner Styles */
        .corners-rounded .card,
        .corners-rounded button:not(.color-preset),
        .corners-rounded .btn,
        .corners-rounded input,
        .corners-rounded .preview-frame > div > div[style*="background"] {
            border-radius: 12px !important;
        }

        .corners-extra-rounded .card,
        .corners-extra-rounded button:not(.color-preset),
        .corners-extra-rounded .btn,
        .corners-extra-rounded input,
        .corners-extra-rounded .preview-frame > div > div[style*="background"] {
            border-radius: 24px !important;
        }

        .corners-sharp .card,
        .corners-sharp button:not(.color-preset),
        .corners-sharp .btn,
        .corners-sharp input,
        .corners-sharp .preview-frame > div > div[style*="background"] {
            border-radius: 0 !important;
        }

        .corners-mixed .card {
            border-radius: 4px !important;
        }

        .corners-mixed button:not(.color-preset),
        .corners-mixed .btn {
            border-radius: 16px !important;
        }

        .corners-organic .card,
        .corners-organic button:not(.color-preset),
        .corners-organic .btn,
        .corners-organic .preview-frame > div > div[style*="background"] {
            border-radius: 25px 8px 25px 8px !important;
        }

        /* Style option cards (for the Appearance tab itself) */
        .style-option {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s var(--ease-smooth);
            text-align: center;
        }

        .style-option:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .style-option.active {
            border-color: var(--accent);
            background: var(--accent-soft);
        }

        .style-preview {
            height: 60px;
            margin-bottom: 12px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .style-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .style-description {
            font-size: 11px;
            color: var(--text-tertiary);
        }

        .badge-info {
            background: var(--teal-100);
            color: var(--teal-700);
        }

        /* Universal Icon & Emoji Refinement */
        [data-icon],
        .icon,
        .emoji {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            user-select: none;
        }

        /* Prevent emoji baseline shift */
        .list-item-title,
        .card-title,
        .nav-tab span,
        .btn {
            display: flex;
            align-items: center;
        }

        /* Icon size utilities */
        .icon-xs { font-size: var(--icon-xs); }
        .icon-sm { font-size: var(--icon-sm); }
        .icon-md { font-size: var(--icon-md); }
        .icon-lg { font-size: var(--icon-lg); }
        .icon-xl { font-size: var(--icon-xl); }

        /* ===================================
           PHASE 3: LOADING STATES
           =================================== */
        
        /* Skeleton loading animation */
        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .skeleton {
            background: linear-gradient(
                90deg,
                var(--bg-tertiary) 0%,
                var(--bg-secondary) 50%,
                var(--bg-tertiary) 100%
            );
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s ease-in-out infinite;
            border-radius: var(--radius-md);
            opacity: 0.7;
        }

        .skeleton-text {
            height: 16px;
            margin-bottom: var(--space-sm);
        }

        .skeleton-title {
            height: 24px;
            width: 60%;
            margin-bottom: var(--space-md);
        }

        .skeleton-card {
            height: 120px;
            margin-bottom: var(--space-lg);
        }

        /* Loading spinner */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        /* Button loading state */
        .btn.loading {
            position: relative;
            color: transparent;
            pointer-events: none;
        }

        .btn.loading::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        /* Smooth fade-in for loaded content */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.4s var(--ease-smooth) forwards;
        }

        /* Optimistic UI - instant feedback */
        .optimistic-update {
            opacity: 0.6;
            pointer-events: none;
        }

        /* ===================================
           VALIDATION & ERROR STATES
           =================================== */
        
        /* Input error state */
        .form-input.error,
        .form-textarea.error,
        .form-select.error {
            border-color: var(--error);
            box-shadow: 
                0 1px 2px rgba(0, 0, 0, 0.04) inset,
                0 0 0 3px var(--error-light);
        }

        .form-input.error:focus,
        .form-textarea.error:focus,
        .form-select.error:focus {
            border-color: var(--error);
            box-shadow: 
                0 1px 2px rgba(0, 0, 0, 0.04) inset,
                0 0 0 4px var(--error-light);
        }

        /* Success state */
        .form-input.success,
        .form-textarea.success,
        .form-select.success {
            border-color: var(--success);
            box-shadow: 
                0 1px 2px rgba(0, 0, 0, 0.04) inset,
                0 0 0 3px var(--success-light);
        }

        /* Error message */
        .error-message {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            margin-top: var(--space-xs);
            font-size: var(--font-tiny);
            line-height: var(--line-tiny);
            color: var(--error);
            font-weight: var(--weight-medium);
            animation: slideDown 0.2s var(--ease-smooth);
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-4px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .error-message::before {
            content: 'âš ï¸';
            font-size: 14px;
        }

        /* Success message */
        .success-message {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            margin-top: var(--space-xs);
            font-size: var(--font-tiny);
            line-height: var(--line-tiny);
            color: var(--success-dark);
            font-weight: var(--weight-medium);
        }

        .success-message::before {
            content: 'âœ“';
            font-size: 14px;
            font-weight: var(--weight-bold);
        }

        /* Character counter */
        .char-counter {
            font-size: var(--font-caption);
            color: var(--text-tertiary);
            margin-top: var(--space-xs);
            text-align: right;
        }

        .char-counter.warning {
            color: var(--warning);
        }

        .char-counter.error {
            color: var(--error);
        }

        /* ===================================
           AUTO-STATE VISUAL TIMELINE
           =================================== */
        
        .timeline-container {
            margin: 20px 0;
            padding: 24px 0;
        }

        .timeline-track {
            position: relative;
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            margin: 40px 0 60px 0;
        }

        .timeline-progress {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: linear-gradient(90deg, var(--teal-500), var(--teal-600));
            border-radius: 2px;
            transition: width 0.5s var(--ease-smooth);
        }

        .timeline-marker {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 16px;
            height: 16px;
            background: white;
            border: 3px solid var(--border);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s var(--ease-smooth);
        }

        .timeline-marker.active {
            width: 20px;
            height: 20px;
            border-color: var(--teal-500);
            box-shadow: 0 0 0 4px var(--teal-100);
        }

        .timeline-marker:hover {
            transform: translate(-50%, -50%) scale(1.2);
        }

        .timeline-label {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            font-size: var(--font-caption);
            font-weight: var(--weight-semibold);
            color: var(--text-secondary);
            white-space: nowrap;
            text-align: center;
        }

        .timeline-label.active {
            color: var(--teal-600);
            font-weight: var(--weight-bold);
        }

        .timeline-date {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: var(--font-tiny);
            color: var(--text-tertiary);
            white-space: nowrap;
        }

        .timeline-phase {
            position: absolute;
            top: 50px;
            font-size: var(--font-caption);
            color: var(--text-tertiary);
            white-space: nowrap;
            padding: 4px 8px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
        }

        .mode-card {
            display: grid;
            grid-template-columns: 60px 1fr;
            gap: 16px;
            padding: 16px;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: var(--radius-lg);
            margin-bottom: 12px;
            transition: all 0.2s var(--ease-smooth);
        }

        .mode-card.active {
            border-color: var(--teal-500);
            background: var(--teal-50);
            box-shadow: 0 0 0 4px var(--teal-100);
        }

        .mode-icon {
            width: 60px;
            height: 60px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            background: white;
            border: 2px solid var(--border);
        }

        .mode-card.active .mode-icon {
            border-color: var(--teal-500);
            background: white;
            box-shadow: var(--elevation-2);
        }

        .mode-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .mode-title {
            font-size: var(--font-base);
            font-weight: var(--weight-bold);
            color: var(--text-primary);
            line-height: var(--line-base);
        }

        .mode-timing {
            font-size: var(--font-small);
            font-weight: var(--weight-semibold);
            color: var(--teal-600);
            line-height: var(--line-small);
        }

        .mode-description {
            font-size: var(--font-small);
            color: var(--text-secondary);
            line-height: var(--line-small);
        }

        .mode-example {
            font-size: var(--font-small);
            color: var(--text-tertiary);
            font-style: italic;
            line-height: var(--line-small);
        }

        /* ===================================
           DEMO CONTENT BADGES
           =================================== */
        
        .demo-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #78350f;
            font-size: 11px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(251, 191, 36, 0.3);
        }

        .demo-banner {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #fbbf24;
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .demo-banner-icon {
            font-size: 32px;
            line-height: 1;
        }

        .demo-banner-content {
            flex: 1;
        }

        .demo-banner-title {
            font-size: 15px;
            font-weight: 800;
            color: #78350f;
            margin-bottom: 4px;
        }

        .demo-banner-text {
            font-size: 13px;
            color: #92400e;
            line-height: 1.5;
        }

        .demo-overlay {
            position: relative;
        }

        .demo-overlay::after {
            content: 'ðŸ“‹ DEMO DATA';
            position: absolute;
            top: 8px;
            right: 8px;
            background: #fbbf24;
            color: #78350f;
            font-size: 10px;
            font-weight: 800;
            padding: 4px 8px;
            border-radius: 4px;
            letter-spacing: 0.5px;
            pointer-events: none;
        }

        /* Image Upload */
        .image-upload {
            position: relative;
            width: 100%;
            height: 200px;
            border: 2px dashed var(--border);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s var(--ease-smooth);
            overflow: hidden;
        }

        .image-upload:hover {
            border-color: var(--accent);
            background: var(--accent-soft);
        }

        .image-upload.has-image {
            border-style: solid;
        }

        .upload-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .upload-placeholder {
            text-align: center;
        }

        .upload-icon {
            font-size: 40px;
            margin-bottom: 8px;
            color: var(--text-tertiary);
        }

        .upload-text {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        /* Auto-populate Banner */
        .auto-banner {
            background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%);
            color: white;
            padding: 20px 24px;
            border-radius: 12px;
            margin-bottom: 24px;
            box-shadow: 0 4px 12px rgba(8, 145, 178, 0.3);
        }

        .auto-banner-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .auto-banner-text {
            font-size: 13px;
            opacity: 0.95;
            margin-bottom: 16px;
        }

        .auto-banner-actions {
            display: flex;
            gap: 8px;
        }

        .auto-banner-btn {
            padding: 10px 16px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            color: white;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s var(--ease-smooth);
        }

        .auto-banner-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .auto-banner-btn--soon {
            position: relative;
            opacity: 0.55;
            cursor: not-allowed;
        }
        .auto-banner-btn--soon:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        .soon-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #fbbf24;
            color: #000;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 9px;
            font-weight: 800;
            letter-spacing: 0.04em;
        }

        /* Tab Content */
        /* â”€â”€ Full Page Overlay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        #fullPageOverlay {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 9999;
            background: var(--bg-primary);
            overflow-y: auto;
            overflow-x: hidden;
        }

        #fullPageOverlay.active {
            display: block;
        }

        #fullPageBackBtn {
            position: fixed;
            top: 16px;
            left: 16px;
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            color: #fff;
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 100px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 16px rgba(0,0,0,0.3);
        }

        #fullPageBackBtn:hover {
            background: rgba(0, 0, 0, 0.8);
            transform: translateX(-2px);
        }

        /* Full page profile â€” no phone frame, full viewport width */
        #fullPageOverlay .full-page-profile {
            min-height: 100vh;
            max-width: 480px;
            margin: 0 auto;
        }

        /* In full-page view, profile-preview fills the container */
        #fullPageContent .profile-preview {
            min-height: 100vh;
            overflow: visible;
        }

        /* Full-page: restore fixed positioning for floating elements */
        #fullPageContent .profile-preview .audio-player,
        #fullPageContent .profile-preview .cart-button,
        #fullPageContent .profile-preview .theme-toggle,
        #fullPageContent .profile-preview .quick-actions,
        #fullPageContent .profile-preview .section-nav,
        #fullPageContent .profile-preview .scroll-progress,
        #fullPageContent .profile-preview .progress-bar {
            position: fixed;
        }

        #fullPageContent .profile-preview .event-tooltip,
        #fullPageContent .profile-preview .event-popup,
        #fullPageContent .profile-preview .popup-overlay,
        #fullPageContent .profile-preview .cart-panel,
        #fullPageContent .profile-preview .confetti {
            position: fixed;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes cardRiseIn {
            from { opacity: 0; transform: translateY(20px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        .tab-content.active > * {
            animation: cardRiseIn 0.5s cubic-bezier(0.22, 1, 0.36, 1) both;
        }
        .tab-content.active > *:nth-child(1) { animation-delay: 0.00s; }
        .tab-content.active > *:nth-child(2) { animation-delay: 0.07s; }
        .tab-content.active > *:nth-child(3) { animation-delay: 0.13s; }
        .tab-content.active > *:nth-child(4) { animation-delay: 0.19s; }
        .tab-content.active > *:nth-child(5) { animation-delay: 0.24s; }
        .tab-content.active > *:nth-child(6) { animation-delay: 0.29s; }
        .tab-content.active > *:nth-child(7) { animation-delay: 0.33s; }
        .tab-content.active > *:nth-child(8) { animation-delay: 0.37s; }

        @media (prefers-reduced-motion: reduce) {
            .tab-content.active > * { animation: none; }
        }

        /* Responsive */
        @media (max-width: 600px) {
            .preview-panel {
                display: none;
            }
        }

        @media (max-width: 1280px) and (min-width: 601px) {
            .preview-panel {
                width: 340px;
                padding: 20px 16px;
            }
            .preview-frame {
                max-width: 300px !important;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -280px;
                top: 0;
                height: 100vh;
                z-index: 1000;
                transition: left 0.3s var(--ease-smooth);
            }

            .sidebar.open {
                left: 0;
            }

            .editor-panel {
                padding: 20px;
            }

        .platform-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Success Toast */
        .toast {
            position: fixed;
            bottom: var(--space-2xl);
            right: var(--space-2xl);
            background: var(--success-dark);
            color: white;
            padding: var(--space-lg) var(--space-xl);
            border-radius: var(--radius-lg);
            box-shadow: 
                var(--elevation-4),
                0 2px 8px rgba(0, 0, 0, 0.15),
                0 1px 0 rgba(255, 255, 255, 0.15) inset;
            display: flex;
            align-items: center;
            gap: var(--space-md);
            font-size: var(--font-small);
            line-height: var(--line-small);
            font-weight: var(--weight-semibold);
            opacity: 0;
            transform: translateY(20px);
            transition: all var(--transition-slow) var(--ease-spring);
            pointer-events: none;
            z-index: 2000;
            backdrop-filter: blur(10px);
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
            box-shadow:
                0 8px 32px rgba(5, 150, 105, 0.3),
                0 4px 16px rgba(0, 0, 0, 0.2),
                0 1px 0 rgba(255, 255, 255, 0.2) inset;
        }

        .toast--error {
            background: #dc2626;
        }
        .toast--error.show {
            box-shadow:
                0 8px 32px rgba(220, 38, 38, 0.35),
                0 4px 16px rgba(0, 0, 0, 0.2),
                0 1px 0 rgba(255, 255, 255, 0.15) inset;
        }
        .toast--warning {
            background: #d97706;
        }
        .toast--warning.show {
            box-shadow:
                0 8px 32px rgba(217, 119, 6, 0.35),
                0 4px 16px rgba(0, 0, 0, 0.2),
                0 1px 0 rgba(255, 255, 255, 0.15) inset;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           EMBEDDED PROFILE STYLES â€” scoped to .profile-preview
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        /* Base styles for the embedded profile container */
        .profile-preview {
            position: relative;
            overflow: visible;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100%;
            line-height: var(--token-leading-normal); /* base readable rhythm; specific rules override */
        }

        /* :root removed */

        .profile-preview[data-theme="dark"] {
            --bg-primary: #1a1918;
            --bg-secondary: #2a2928;
            --bg-tertiary: #3a3836;
            --text-primary: #ffffff;
            --text-secondary: #f0efee;
            --text-tertiary: #c4bfba;
            --border: #4f4f56;
        }

        .profile-preview[data-theme="contrast"] {
            --bg-primary: #2d2d2d;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f8f8f8;
            --text-primary: #000000;
            --text-secondary: #525252;
            --text-tertiary: #737373;
            --border: #e5e5e5;
            --accent: #0891b2;
            --accent-hover: #0e7490;
            --accent-soft: #ecfeff;
            --heading-color: #ffffff;
            --card-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
        }

        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Global touch fixes */
        .profile-preview button,
        .profile-preview a,
        .profile-preview .clickable {
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        /* Premium spring physics easing */
        /* :root removed */

        /* html removed */

        /* body removed */

        /* Subtle paper grain texture for light mode */
        .profile-preview::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.05;
            z-index: -1;
            pointer-events: none;
            background-image: 
                radial-gradient(circle at 20% 50%, transparent 0%, transparent 50%, rgba(0,0,0,0.05) 100%),
                url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
        }

        /* Enhanced texture for half moon mode - subtle fabric/canvas feel */
        [data-theme="contrast"] /* body removed */

        .profile-preview[data-theme="contrast"] body::before {
            opacity: 0.05;
        }

        .profile-preview[data-theme="dark"] body::before {
            opacity: 0.04;
        }

        * {
            transition: background-color 0.25s ease, color 0.25s ease, border-color 0.25s ease;
        }

        /* Preserve specific transitions that shouldn't be overridden */
        .profile-preview .hero-card,
        .profile-preview .streaming-btn,
        .profile-preview .merch-card,
        .profile-preview .tour-card,
        .profile-preview .section,
        .profile-preview .btn-primary,
        .profile-preview .ripple {
            transition: all 0.2s ease !important;
        }

        .profile-preview .section {
            transition: opacity 0.6s ease-out, transform 0.6s ease-out !important;
        }

        .profile-preview .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 18px;
        }

        @media (min-width: 768px) {
        .profile-preview .container {
                max-width: 600px;
                padding: 36px;
            }
        }

        /* Header */
        .profile-preview .page-header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: var(--bg-primary);
            padding: 10px 0;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        /* Scroll progress indicator */
        .profile-preview .scroll-progress {
            position: absolute;
            top: 0;
            left: 0;
            height: 2px;
            background: var(--accent);
            width: 0%;
            z-index: 101;
            transition: width 0.1s ease-out;
            box-shadow: 0 0 8px rgba(8, 145, 178, 0.4);
        }

        .profile-preview .header-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        .profile-preview .header-title {
            font-size: 15px;
            font-weight: 900;
            color: var(--text-primary);
            font-feature-settings: 'kern' 1;
            letter-spacing: -0.02em;
        }

        .profile-preview[data-theme="contrast"] .header-title {
            color: #ffffff;
        }

        .profile-preview .header-subtitle {
            font-size: 11px;
            font-variant-numeric: tabular-nums;
        }
            color: var(--text-tertiary);
            font-weight: 600;
        }

        .profile-preview[data-theme="contrast"] .header-subtitle {
            color: #a3a3a3;
        }

        .profile-preview .settings-toggle {
            width: 40px;
            height: 40px;
            border: 1px solid rgba(0, 0, 0, 0.08);
            border-radius: 12px;
            background: var(--bg-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.2s ease;
            flex-shrink: 0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .profile-preview .settings-toggle:hover {
            background: var(--bg-tertiary);
        }

        .profile-preview .settings-toggle.active {
            background: var(--accent);
            border-color: var(--accent);
        }

        .profile-preview .controls-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.06);
            border: 1px solid var(--border);
            margin-top: 12px;
            display: none;
        }

        .profile-preview .controls-card.visible {
            display: block;
        }

        .profile-preview .control-section {
            margin-bottom: 16px;
        }

        .profile-preview .control-section:last-child {
            margin-bottom: 0;
        }

        .profile-preview .control-label {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-tertiary);
            margin-bottom: 6px;
        }

        /* Color Presets */
        .profile-preview .color-presets {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .profile-preview .color-preset {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .profile-preview .color-preset:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .profile-preview .color-preset.active {
            border-color: var(--bg-primary);
            box-shadow: 0 0 0 2px var(--accent), 0 4px 12px rgba(0, 0, 0, 0.2);
            transform: scale(1.05);
        }

        .profile-preview .color-preset.custom {
            background: linear-gradient(135deg, 
                #ff0000 0%, #ff7f00 16.66%, #ffff00 33.33%, 
                #00ff00 50%, #0000ff 66.66%, #8b00ff 83.33%, #ff0000 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 900;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
        }

        .profile-preview .color-preset.custom:hover {
            transform: scale(1.15) rotate(90deg);
        }

        .profile-preview .segmented-control {
            display: flex;
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 4px;
        }

        .profile-preview .segmented-control button {
            flex: 1;
            padding: 11px 18px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 700;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .profile-preview .segmented-control button.active {
            background: var(--bg-secondary);
            color: var(--text-primary);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .profile-preview .auto-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .profile-preview .auto-info {
            flex: 1;
        }

        .profile-preview .auto-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .profile-preview .auto-help {
            font-size: 12px;
            color: var(--text-tertiary);
        }

        .profile-preview .switch {
            position: relative;
            width: 50px;
            height: 28px;
            background: var(--bg-tertiary);
            border-radius: 14px;
            transition: background 0.3s ease;
            border: 2px solid var(--border);
            flex-shrink: 0;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .profile-preview .switch.active {
            background: var(--accent);
            border-color: var(--accent);
        }

        .profile-preview .switch-knob {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .profile-preview .switch.active .switch-knob {
            transform: translateX(22px);
        }

        .profile-preview .release-settings {
            margin-top: 18px;
            padding-top: 18px;
            border-top: 1px solid var(--border);
            display: none;
        }

        .profile-preview .release-settings.visible {
            display: block;
        }

        .profile-preview .settings-title {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 14px;
        }

        .profile-preview .setting-group {
            margin-bottom: 14px;
        }

        .profile-preview .setting-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .profile-preview .setting-input {
            width: 100%;
            padding: 11px 14px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
        }

        .profile-preview .radio-group {
            display: flex;
            gap: 18px;
        }

        .profile-preview .radio-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            cursor: pointer;
        }

        .profile-preview .auto-status {
            display: inline-block;
            padding: 9px 14px;
            background: var(--accent-soft);
            color: var(--accent);
            border-radius: 8px;
            font-size: 13px;
            font-weight: 700;
        }

        /* YouTube Short Hero */
        .profile-preview .hero-card {
            background: #000;
            border-radius: 0;
            overflow: hidden;
            box-shadow: none;
            border: none;
            margin-left: -18px;
            margin-right: -18px;
            width: calc(100% + 36px);
            margin-bottom: 0;
            will-change: transform;
            transition: transform 0.1s ease-out;
            opacity: 1;
            transform: translateY(0);
        }

        @keyframes hero-fade-in {
        to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes heroGradientShift {
            0%   { background-position: 0% 0%; }
            50%  { background-position: 100% 100%; }
            100% { background-position: 0% 0%; }
        }

        .profile-preview .short-container {
            position: relative;
            aspect-ratio: 9 / 16;
            background: linear-gradient(160deg, #0a0a0a 0%, #1a1a2e 30%, #16213e 60%, #0f3460 100%);
            background-size: 250% 250%;
            animation: heroGradientShift 14s ease infinite;
            overflow: hidden;
            transition: background-color 0.5s ease;
            will-change: transform;
        }

        /* Video placeholder content */
        .profile-preview .video-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 0;
            background: 
                linear-gradient(135deg, rgba(0,0,0,0.3) 25%, transparent 25%),
                linear-gradient(225deg, rgba(0,0,0,0.3) 25%, transparent 25%),
                linear-gradient(45deg, rgba(255,255,255,0.2) 25%, transparent 25%),
                linear-gradient(315deg, rgba(255,255,255,0.2) 25%, transparent 25%);
            background-size: 40px 40px;
            background-position: 0 0, 20px 0, 20px -20px, 0px 20px;
        }

        .profile-preview .placeholder-pattern {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .profile-preview .placeholder-pattern::before {
            content: 'â–¶';
            font-size: 60px;
            color: rgba(255,255,255,0.4);
        }

        .profile-preview .placeholder-text {
            position: absolute;
            bottom: 30%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            font-weight: 900;
            color: rgba(255,255,255,0.5);
            text-align: center;
            letter-spacing: -1px;
            user-select: none;
            pointer-events: none;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        /* Time-based gradient variants */
        .profile-preview .short-container.morning {
            background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 50%, #06b6d4 100%);
        }

        .profile-preview .short-container.afternoon {
            background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%);
        }

        .profile-preview .short-container.evening {
            background: linear-gradient(135deg, #7c3aed 0%, #ec4899 50%, #f59e0b 100%);
        }

        .profile-preview .short-container.night {
            background: linear-gradient(135deg, #1e1b4b 0%, #4c1d95 50%, #7c3aed 100%);
        }

        .profile-preview .greeting-text {
            font-size: 13px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 4px;
            text-shadow: 0 1px 4px rgba(0,0,0,0.5);
            letter-spacing: 0.2px;
            text-transform: uppercase;
            letter-spacing: 0.06em;
        }

        .profile-preview .short-container::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 72%;
            background: linear-gradient(to top, rgba(0,0,0,0.96) 0%, rgba(0,0,0,0.75) 30%, rgba(0,0,0,0.4) 55%, transparent 100%);
            pointer-events: none;
            z-index: 1;
        }

        .profile-preview .short-badges {
            position: absolute;
            top: 16px;
            left: 16px;
            display: flex;
            gap: 8px;
            z-index: 3;
        }

        .profile-preview .badge {
            padding: 5px 11px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.06em;
        }

        .profile-preview .badge-featured {
            background: rgba(255, 255, 255, 0.15);
            color: rgba(255,255,255,0.85);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .profile-preview .badge-state {
            background: rgba(255, 255, 255, 0.92);
            color: #0a0a0a;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .profile-preview .countdown-banner {
            position: absolute;
            top: 56px;
            left: 16px;
            right: 16px;
            background: rgba(0, 0, 0, 0.55);
            border: 1px solid rgba(255,255,255,0.15);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            padding: 10px 16px;
            border-radius: 14px;
            z-index: 3;
            display: none;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .profile-preview .countdown-banner.visible {
            display: flex;
        }

        .profile-preview .countdown-label {
            font-size: 10px;
            font-weight: 800;
            color: rgba(255,255,255,0.6);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            flex-shrink: 0;
        }

        .profile-preview .countdown-time {
            font-size: 19px;
            font-weight: 900;
            color: white;
            font-variant-numeric: tabular-nums;
            letter-spacing: -0.3px;
        }

        .profile-preview .play-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -55%);
            width: 52px;
            height: 52px;
            background: rgba(255, 255, 255, 0.18);
            border: 2px solid rgba(255,255,255,0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.25s ease;
            z-index: 2;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }

        .profile-preview .play-button:hover {
            transform: translate(-50%, -55%) scale(1.08);
            background: rgba(255,255,255,0.3);
        }

        .profile-preview .short-container:hover {
            box-shadow: inset 0 0 60px rgba(8, 145, 178, 0.15);
        }

        .profile-preview .play-icon {
            width: 0;
            height: 0;
            border-left: 15px solid rgba(255,255,255,0.9);
            border-top: 9px solid transparent;
            border-bottom: 9px solid transparent;
            margin-left: 3px;
        }

        .profile-preview .short-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 16px 72px 22px 16px;
            z-index: 2;
            color: white;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .profile-preview .short-actions-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 10px;
        }

        .profile-preview .short-engagement {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .profile-preview .engagement-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .profile-preview .engagement-btn:hover {
            transform: scale(1.1);
        }

        .profile-preview .engagement-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .profile-preview .engagement-count {
            font-size: 11px;
            font-weight: 700;
            color: rgba(255,255,255,0.9);
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
        }

        /* Engagement buttons â€” right rail, TikTok-style */
        .profile-preview .short-engagement {
            position: absolute;
            right: 12px;
            bottom: 90px;
            z-index: 3;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 18px;
        }

        .profile-preview .engagement-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            transition: transform 0.2s ease;
            -webkit-tap-highlight-color: transparent;
        }

        .profile-preview .engagement-btn:hover {
            transform: scale(1.12);
        }

        .profile-preview .engagement-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.15);
            border: 1.5px solid rgba(255,255,255,0.25);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 17px;
        }

        /* Artist row inside the reel overlay */
        .profile-preview .short-artist-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .profile-preview .short-avatar-sm {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent) 0%, #06b6d4 100%);
            border: 2px solid rgba(255,255,255,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 900;
            color: white;
            flex-shrink: 0;
            overflow: hidden;
        }

        .profile-preview .short-artist-name-sm {
            font-size: 14px;
            font-weight: 700;
            color: white;
            text-shadow: 0 1px 4px rgba(0,0,0,0.5);
        }

        .profile-preview .short-follow-pill {
            margin-left: auto;
            padding: 5px 13px;
            background: rgba(255,255,255,0.15);
            border: 1.5px solid rgba(255,255,255,0.4);
            border-radius: 20px;
            color: white;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .profile-preview .short-follow-pill:hover {
            background: rgba(255,255,255,0.28);
            border-color: rgba(255,255,255,0.6);
        }

        .profile-preview .short-metadata {
            flex: 1;
            padding-right: 16px;
        }

        .profile-preview .short-title {
            font-size: 26px;
            font-weight: 900;
            margin-bottom: 0;
            line-height: 1.1;
            color: white;
            letter-spacing: -0.5px;
            text-shadow: 0 2px 12px rgba(0,0,0,0.6);
        }

        .profile-preview .short-channel {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 4px;
        }

        .profile-preview .channel-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 900;
            color: var(--accent);
        }

        .profile-preview .channel-name {
            font-size: 13px;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.95);
        }

        .profile-preview .verify-check {
            width: 14px;
            height: 14px;
            fill: white;
        }

        .profile-preview .short-stats {
            font-size: 12px;
            opacity: 0.9;
        }

        .profile-preview .hero-content {
            background: var(--bg-primary);
            padding: 20px 18px 24px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 8px;
            animation: hero-content-fade-in 0.5s cubic-bezier(0.22, 1, 0.36, 1) both;
        }

        @keyframes hero-content-fade-in {
            from {
                opacity: 0;
                transform: translateY(16px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .profile-preview .artist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .profile-preview .artist-name {
            font-size: 24px;
            font-weight: 900;
            letter-spacing: -0.6px;
            margin-bottom: 2px;
            line-height: 1.1;
        }

        .profile-preview .artist-handle {
            font-size: 14px;
            color: var(--text-tertiary);
            font-weight: 500;
        }

        .profile-preview .share-button {
            width: 46px;
            height: 46px;
            border: 1px solid var(--border);
            border-radius: 50%;
            background: var(--bg-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
        }

        .profile-preview .share-button:hover {
            background: var(--bg-tertiary);
            transform: scale(1.08);
            border-color: var(--accent);
        }

        .profile-preview .share-button:active {
            transform: scale(0.95);
        }

        .profile-preview .share-button.success {
            background: var(--accent);
            border-color: var(--accent);
            animation: share-success 0.6s ease;
        }

        @keyframes share-success {
        0%,
        100% {
            transform: scale(1); }
        50% {
            transform: scale(1.15); }
        }

        .profile-preview .cta-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* CTA cap: hero never shows more than 2 action buttons */
        .profile-preview .cta-group > *:nth-child(n+3) {
            display: none;
        }

        .profile-preview .btn {
            padding: 16px 26px;
            border: none;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
            font-family: inherit;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            letter-spacing: 0.01em;
        }

        .profile-preview .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .profile-preview .btn-primary {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-hover) 100%);
            color: white;
            position: relative;
            overflow: hidden;
            letter-spacing: 0.02em;
            font-feature-settings: 'kern' 1;
            font-size: 17px;
            box-shadow: 0 4px 20px rgba(8, 145, 178, 0.4), 0 1px 3px rgba(0,0,0,0.1);
        }

        .profile-preview .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .profile-preview .btn-primary:hover:not(:disabled)::before {
            left: 100%;
        }

        .profile-preview .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--accent-hover) 0%, var(--accent) 100%);
            transform: translateY(-2px) scale(1.01);
            box-shadow: 
                0 6px 16px rgba(8, 145, 178, 0.2),
                0 2px 4px rgba(8, 145, 178, 0.1);
        }

        .profile-preview .btn-primary:active:not(:disabled) {
            transform: translateY(2px) scale(0.97);
            box-shadow:
                0 1px 4px rgba(8, 145, 178, 0.2),
                0 1px 2px rgba(0, 0, 0, 0.08);
            transition: transform 0.08s ease, box-shadow 0.08s ease;
        }

        .profile-preview .btn-secondary {
            background: rgba(8, 145, 178, 0.07);
            color: var(--accent);
            border: 1.5px solid rgba(8, 145, 178, 0.25);
        }

        .profile-preview .btn-secondary:hover:not(:disabled) {
            background: var(--accent-soft);
        }

        .profile-preview .btn-secondary:active:not(:disabled) {
            transform: translateY(2px) scale(0.97);
            transition: transform 0.08s ease, box-shadow 0.08s ease;
        }



        /* â”€â”€ Section header with action button â”€â”€ */
        .profile-preview .section-header-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .profile-preview .section-header-row .section-title {
            margin-bottom: 0;
        }

        /* â”€â”€ Section actions container (holds 1â€“2 buttons per section header) â”€â”€ */
        .profile-preview .section-actions {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: var(--space-xs);
        }

        .profile-preview .section-action-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: var(--space-sm) var(--space-lg);
            background: var(--accent);
            color: white;
            border: 1px solid transparent;
            border-radius: var(--radius-full);
            font-size: 13px;
            font-weight: var(--weight-bold);
            cursor: pointer;
            text-decoration: none;
            transition:
                opacity var(--transition-fast) var(--ease-smooth),
                transform var(--transition-fast) var(--ease-smooth);
            white-space: nowrap;
            min-height: 36px;
            -webkit-tap-highlight-color: transparent;
        }

        .profile-preview .section-action-btn:hover {
            opacity: 0.88;
            transform: translateY(-1px);
        }

        .profile-preview .section-action-btn:active {
            opacity: 1;
            transform: translateY(0);
        }

        /* Glassmorphism / image-mode override */
        body.glassmorphism-enabled .profile-preview .section-action-btn {
            background: rgba(255, 255, 255, 0.20);
            backdrop-filter: blur(var(--card-glass-blur));
            -webkit-backdrop-filter: blur(var(--card-glass-blur));
            border-color: var(--card-glass-border);
            color: white;
        }

        [data-theme="dark"].glassmorphism-enabled .profile-preview .section-action-btn {
            background: rgba(255, 255, 255, 0.14);
            border-color: rgba(255, 255, 255, 0.12);
        }

        /* â”€â”€ Image mode: hero scrim + auto-readability frosted cards â”€â”€ */
        /* Transparent hero area so background image shows through */
        .profile-preview.has-background-image .hero-content {
            background: transparent !important;
            position: relative;
        }
        /* Bottom-weighted gradient scrim â€” keeps text readable on any image */
        .profile-preview.has-background-image .hero-content::after {
            content: '';
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 0;
            background: linear-gradient(
                to bottom,
                rgba(0,0,0,0) 0%,
                rgba(0,0,0,var(--img-scrim,0.4)) 100%
            );
        }
        /* Lift all child elements above the scrim overlay */
        .profile-preview.has-background-image .hero-content > * {
            position: relative;
            z-index: 1;
        }
        /* Quick-link pills: always glass in image mode */
        .profile-preview.has-background-image .quick-link-pill {
            background: var(--card-glass-bg) !important;
            backdrop-filter: blur(var(--card-glass-blur, 12px));
            -webkit-backdrop-filter: blur(var(--card-glass-blur, 12px));
            border-color: var(--card-glass-border) !important;
        }
        /* Auto-readability: frosted glass on cards and action buttons */
        .profile-preview.has-background-image.img-auto-readability .able-card,
        .profile-preview.has-background-image.img-auto-readability .section-action-btn {
            background: var(--card-glass-bg) !important;
            backdrop-filter: blur(var(--card-glass-blur, 12px)) !important;
            -webkit-backdrop-filter: blur(var(--card-glass-blur, 12px)) !important;
            border-color: var(--card-glass-border) !important;
        }

        /* Image mode: subtle text-shadow for legibility over background photos */
        .profile-preview.has-background-image .artist-name,
        .profile-preview.has-background-image .artist-handle {
            text-shadow: 0 1px 4px rgba(0,0,0,0.55), 0 2px 8px rgba(0,0,0,0.25);
        }
        .profile-preview.has-background-image .section-title {
            text-shadow: 0 1px 3px rgba(0,0,0,0.4);
        }

        /* â”€â”€ Quick Links Strip â”€â”€ */
        .profile-preview .quick-links-strip {
            display: flex;
            flex-wrap: nowrap;
            gap: 8px;
            padding: 14px 0 10px;
            overflow-x: auto;
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
            mask-image: linear-gradient(to right, transparent, #000 8%, #000 92%, transparent);
            -webkit-mask-image: linear-gradient(to right, transparent, #000 8%, #000 92%, transparent);
        }

        .profile-preview .quick-links-strip::-webkit-scrollbar {
            display: none;
        }

        .profile-preview .quick-links-strip:empty {
            display: none;
        }

        .profile-preview .quick-link-pill {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: var(--space-sm) var(--space-lg);   /* 8px 16px â€” tap-safe, token-aligned */
            background: var(--bg-secondary);
            border: 1px solid var(--token-border);
            border-radius: var(--radius-full);           /* pill shape */
            font-size: 13px;                             /* between --font-tiny(12) & --font-small(14) */
            font-weight: var(--weight-semibold);         /* 600 â€” utility, not heading weight */
            color: var(--text-primary);
            cursor: pointer;
            text-decoration: none;
            transition:
                background var(--transition-fast) var(--ease-smooth),
                transform  var(--transition-fast) var(--ease-smooth),
                border-color var(--transition-fast) var(--ease-smooth),
                box-shadow var(--transition-fast) var(--ease-smooth);
            -webkit-tap-highlight-color: transparent;
            min-height: 40px;                            /* tap target â€” raised from 36px */
        }

        .profile-preview .quick-link-pill:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent);
            transform: translateY(-1px);
            box-shadow: var(--elevation-1);
        }

        .profile-preview .quick-link-pill:active {
            transform: scale(0.95);
            transition: transform 0.08s ease;
            box-shadow: none;
        }

        .profile-preview .quick-link-pill .pill-emoji {
            font-size: 14px;
            line-height: 1;
            flex-shrink: 0;
        }

        /* Label span â€” clamps long text to one line with ellipsis */
        .profile-preview .quick-link-pill .pill-label {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 140px;
        }

        /* Dark / contrast: tokens already resolve correctly via .profile-preview[data-theme] scope */
        .profile-preview[data-theme="dark"] .quick-link-pill,
        .profile-preview[data-theme="contrast"] .quick-link-pill {
            background: var(--bg-secondary);
            border-color: var(--token-border);
        }

        /* â”€â”€ Image mode: pills need readable surface on photo backgrounds â”€â”€ */
        body.glassmorphism-enabled .profile-preview .quick-link-pill {
            background: var(--card-glass-bg);
            backdrop-filter: blur(var(--card-glass-blur));
            -webkit-backdrop-filter: blur(var(--card-glass-blur));
            border-color: var(--card-glass-border);
            color: var(--text-primary);
        }

        /* In dark glassmorphism, --card-glass-bg resolves to the dark variant via cascade */

        /* â”€â”€ Overflow / "More" state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

        /* Pills beyond the cap are hidden by default */
        .profile-preview .quick-link-pill.pill-overflow {
            display: none;
        }

        /* "More" control â€” same shape as a pill, distinct chrome */
        .profile-preview .quick-link-more-btn {
            border-style: dashed;
            color: var(--text-secondary);
            background: transparent;
            font-family: inherit;
        }

        .profile-preview .quick-link-more-btn:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent);
            color: var(--text-primary);
        }

        /* When strip is "open": reveal overflow pills + wrap rows */
        .profile-preview .quick-links-strip.ql-more-open {
            flex-wrap: wrap;
            overflow-x: visible;
            mask-image: none;
            -webkit-mask-image: none;
        }

        .profile-preview .quick-links-strip.ql-more-open .pill-overflow {
            display: inline-flex;
        }


        /* â”€â”€ Social Strip â”€â”€ */
        .profile-preview .social-strip {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 14px;
        }

        .profile-preview .social-strip:empty {
            display: none;
        }

        .profile-preview .social-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 7px 13px;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            text-decoration: none;
            cursor: pointer;
            transition: color 0.15s ease, border-color 0.15s ease, background 0.15s ease;
            -webkit-tap-highlight-color: transparent;
            white-space: nowrap;
        }

        .profile-preview .social-pill:hover {
            color: var(--text-primary);
            border-color: var(--accent);
            background: var(--bg-secondary);
        }

        .profile-preview .social-pill .social-icon {
            font-size: 14px;
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           APPEARANCE BRIDGE â€” driven by able_appearance_settings
           and able_tier1_settings from the dashboard
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        /* Button styles */
        .profile-preview .btn-style-rounded .btn,
        .profile-preview .btn-style-rounded button {
            border-radius: 12px !important; }

        .profile-preview .btn-style-sharp .btn,
        .profile-preview .btn-style-sharp button {
            border-radius: 4px !important; }

        .profile-preview .btn-style-pill .btn,
        .profile-preview .btn-style-pill button {
            border-radius: 100px !important; }

        /* Aesthetic presets */
        .profile-preview[data-aesthetic="y2k"] {
            --accent: #ff00ff;
            --bg-primary: #000033;
            --bg-secondary: #1a0033;
            --text-primary: #00ffff;
        }
        .profile-preview[data-aesthetic="vhs"] {
            --accent: #ff6b35;
            filter: contrast(1.1) saturate(1.2);
        }
        .profile-preview[data-aesthetic="brutalist"] {
            --accent: #000000;
            --border: #000000;
        }
        .profile-preview[data-aesthetic="glass"] {
            --card-bg: rgba(255,255,255,0.1);
            backdrop-filter: blur(20px);
        }
        .profile-preview[data-aesthetic="film"] {
            --accent: #d4a574;
            filter: sepia(0.15) contrast(1.05);
        }
        .profile-preview[data-aesthetic="vaporwave"] {
            --accent: #ff71ce;
            --bg-primary: #01cdfe;
            --bg-secondary: #b967ff;
        }
        .profile-preview[data-aesthetic="gothic"] {
            --accent: #8b0000;
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --text-primary: #e8e8e8;
        }
        .profile-preview[data-aesthetic="summer"] {
            --accent: #ffd60a;
            --bg-primary: #ffe8d6;
            --bg-secondary: #fff5e1;
        }
        .profile-preview[data-aesthetic="punk"] {
            --accent: #ff006e;
            transform: rotate(-0.5deg);
        }
        .profile-preview[data-aesthetic="luxury"] {
            --accent: #d4af37;
            letter-spacing: 0.02em;
        }

        /* Animation styles */
        .profile-preview .anim-smooth * {
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1) !important;
            transition-duration: 0.3s !important;
        }
        .profile-preview .anim-bouncy * {
            transition-timing-function: cubic-bezier(0.68, -0.55, 0.265, 1.55) !important;
            transition-duration: 0.4s !important;
        }
        .profile-preview .anim-snappy * {
            transition-timing-function: cubic-bezier(0.4, 0, 1, 1) !important;
            transition-duration: 0.15s !important;
        }
        .profile-preview .anim-glitchy * {
            transition-timing-function: steps(3, jump-none) !important;
            transition-duration: 0.2s !important;
        }
        .profile-preview .anim-none * {
            transition: none !important;
            animation: none !important;
        }

        /* Card styles â€” profile card class names */
        .profile-preview .cards-elevated .bio-card,
        .profile-preview .cards-elevated .tour-card,
        .profile-preview .cards-elevated .support-card,
        .profile-preview .cards-elevated .subscribe-card,
        .profile-preview .cards-elevated .qr-card,
        .profile-preview .cards-elevated .artist-card {
            box-shadow: 0 4px 12px rgba(0,0,0,0.08) !important;
        }
        .profile-preview .cards-flat .bio-card,
        .profile-preview .cards-flat .tour-card,
        .profile-preview .cards-flat .support-card,
        .profile-preview .cards-flat .subscribe-card,
        .profile-preview .cards-flat .qr-card,
        .profile-preview .cards-flat .artist-card {
            box-shadow: none !important;
        }
        .profile-preview .cards-outlined .bio-card,
        .profile-preview .cards-outlined .tour-card,
        .profile-preview .cards-outlined .support-card,
        .profile-preview .cards-outlined .subscribe-card,
        .profile-preview .cards-outlined .qr-card,
        .profile-preview .cards-outlined .artist-card {
            box-shadow: none !important;
            border: 3px solid var(--border) !important;
            background: transparent !important;
        }
        .profile-preview .cards-neumorphic .bio-card,
        .profile-preview .cards-neumorphic .tour-card,
        .profile-preview .cards-neumorphic .support-card,
        .profile-preview .cards-neumorphic .subscribe-card,
        .profile-preview .cards-neumorphic .qr-card,
        .profile-preview .cards-neumorphic .artist-card {
            box-shadow: 8px 8px 16px rgba(0,0,0,0.1), -8px -8px 16px rgba(255,255,255,0.7) !important;
            border: 1px solid rgba(255,255,255,0.5) !important;
        }
        .profile-preview .cards-neon .bio-card,
        .profile-preview .cards-neon .tour-card,
        .profile-preview .cards-neon .support-card,
        .profile-preview .cards-neon .subscribe-card,
        .profile-preview .cards-neon .qr-card,
        .profile-preview .cards-neon .artist-card {
            box-shadow: 0 0 20px var(--accent), 0 0 40px var(--accent) !important;
            border: 2px solid var(--accent) !important;
            background: rgba(0,0,0,0.3) !important;
        }
        .profile-preview .cards-handdrawn .bio-card,
        .profile-preview .cards-handdrawn .tour-card,
        .profile-preview .cards-handdrawn .support-card,
        .profile-preview .cards-handdrawn .subscribe-card,
        .profile-preview .cards-handdrawn .qr-card,
        .profile-preview .cards-handdrawn .artist-card {
            border: 3px solid var(--text-primary) !important;
            border-radius: 255px 25px 225px 25px/25px 225px 25px 255px !important;
            box-shadow: none !important;
        }

        /* Corner styles */
        .profile-preview .corners-rounded .bio-card,
        .profile-preview .corners-rounded .tour-card,
        .profile-preview .corners-rounded .support-card,
        .profile-preview .corners-rounded .btn,
        .profile-preview .corners-rounded button:not(.track-menu) {
            border-radius: 12px !important; }

        .profile-preview .corners-extra-rounded .bio-card,
        .profile-preview .corners-extra-rounded .tour-card,
        .profile-preview .corners-extra-rounded .support-card,
        .profile-preview .corners-extra-rounded .btn,
        .profile-preview .corners-extra-rounded button:not(.track-menu) {
            border-radius: 24px !important; }

        .profile-preview .corners-sharp .bio-card,
        .profile-preview .corners-sharp .tour-card,
        .profile-preview .corners-sharp .support-card,
        .profile-preview .corners-sharp .btn,
        .profile-preview .corners-sharp button:not(.track-menu) {
            border-radius: 0 !important; }

        .profile-preview .corners-mixed .bio-card,
        .profile-preview .corners-mixed .tour-card,
        .profile-preview .corners-mixed .support-card {
            border-radius: 4px !important; }
        .profile-preview .corners-mixed .btn,
        .profile-preview .corners-mixed button:not(.track-menu) {
            border-radius: 16px !important; }

        .profile-preview .corners-organic .bio-card,
        .profile-preview .corners-organic .tour-card,
        .profile-preview .corners-organic .support-card,
        .profile-preview .corners-organic .btn,
        .profile-preview .corners-organic button:not(.track-menu) {
            border-radius: 25px 8px 25px 8px !important; }

        .profile-preview .btn-loading {
            color: transparent;
            pointer-events: none;
        }

        .profile-preview .btn-loading::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            top: 50%;
            left: 50%;
            margin-left: -8px;
            margin-top: -8px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
        to {
            transform: rotate(360deg); }
        }

        @keyframes confetti-fall {
        0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
        100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .profile-preview .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: var(--accent);
            z-index: 9999;
            animation: confetti-fall 3s linear forwards;
            pointer-events: none;
        }

        .profile-preview .section {
            margin-bottom: 36px;
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
            position: relative;
            padding: 24px 0;
        }

        /* Subtle divider between consecutive sections */
        .profile-preview .section + .section {
            border-top: 1px solid var(--token-border);
        }

        /* Subtle layered paper effect - like stacked show posters/flyers */
        .profile-preview .section::before {
            content: '';
            position: absolute;
            top: -2px;
            left: 4px;
            right: 4px;
            height: 100%;
            background: var(--bg-primary);
            opacity: 0.25;
            z-index: -1;
            border-radius: 6px;
            filter: blur(3px);
        }

        .profile-preview .section::after {
            content: '';
            position: absolute;
            top: -4px;
            left: 8px;
            right: 8px;
            height: 100%;
            background: var(--bg-primary);
            opacity: 0.12;
            z-index: -2;
            border-radius: 6px;
            filter: blur(5px);
        }

        /* Slightly more visible in dark modes for better depth perception */
        .profile-preview[data-theme="dark"] .section::before,
        .profile-preview[data-theme="contrast"] .section::before {
            opacity: 0.35;
        }

        .profile-preview[data-theme="dark"] .section::after,
        .profile-preview[data-theme="contrast"] .section::after {
            opacity: 0.18;
        }

        /* Compress lower priority sections */
        .profile-preview #calendar,
        .profile-preview #bio,
        .profile-preview #artists,
        .profile-preview #support,
        .profile-preview #subscribe {
            margin-bottom: 24px;
        }

        .profile-preview .section.animate-in {
            opacity: 1;
            transform: translateY(0);
        }

        /* Stagger animations for child elements */
        .profile-preview .streaming-btn,
        .profile-preview .tour-card,
        .profile-preview .merch-card,
        .profile-preview .artist-card {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }

        .profile-preview .section.animate-in .streaming-btn,
        .profile-preview .section.animate-in .tour-card,
        .profile-preview .section.animate-in .merch-card,
        .profile-preview .section.animate-in .artist-card {
            opacity: 1;
            transform: translateY(0);
        }

        /* Stagger delay for sequential items - refined timing */
        .profile-preview .section.animate-in .streaming-btn:nth-child(1) {
            transition-delay: 0.05s; }
        .profile-preview .section.animate-in .streaming-btn:nth-child(2) {
            transition-delay: 0.10s; }
        .profile-preview .section.animate-in .streaming-btn:nth-child(3) {
            transition-delay: 0.15s; }
        .profile-preview .section.animate-in .streaming-btn:nth-child(4) {
            transition-delay: 0.20s; }
        
        .profile-preview .section.animate-in .tour-card:nth-child(1) {
            transition-delay: 0.05s; }
        .profile-preview .section.animate-in .tour-card:nth-child(2) {
            transition-delay: 0.10s; }
        .profile-preview .section.animate-in .tour-card:nth-child(3) {
            transition-delay: 0.15s; }
        .profile-preview .section.animate-in .tour-card:nth-child(4) {
            transition-delay: 0.20s; }
        
        .profile-preview .section.animate-in .merch-card:nth-child(1) {
            transition-delay: 0.05s; }
        .profile-preview .section.animate-in .merch-card:nth-child(2) {
            transition-delay: 0.10s; }
        .profile-preview .section.animate-in .merch-card:nth-child(3) {
            transition-delay: 0.15s; }
        .profile-preview .section.animate-in .merch-card:nth-child(4) {
            transition-delay: 0.20s; }

        .profile-preview .section.highlight {
            animation: pulse 1.2s ease-out;
        }

        @keyframes pulse {
        0%,
        100% {
            background: transparent; }
        50% {
                background: var(--accent-soft);
                border-radius: 16px;
                padding: 14px;
            }
        }

        .profile-preview .section-title {
            font-size: 22px;
            font-weight: 900;
            letter-spacing: -0.5px;
            margin-bottom: 16px;
            color: var(--text-primary);
            font-variant-numeric: proportional-nums;
            font-feature-settings: 'kern' 1, 'liga' 1, 'calt' 1, 'ss01' 1;
            line-height: var(--token-leading-tight); /* 1.2 â€” was 1.1; slightly more breathing room */
        }

        /* Music section title gets maximum prominence */
        .profile-preview #streaming .section-title {
            font-size: 24px;
            font-weight: 900;
            margin-bottom: 18px;
            letter-spacing: -0.6px;
        }

        .profile-preview[data-theme="dark"] .section-title {
            color: #e0f2fe !important;
            text-shadow: 0 0 20px rgba(8, 145, 178, 0.4), 0 2px 8px rgba(0, 0, 0, 0.3) !important;
            font-weight: 900 !important;
        }

        .profile-preview[data-theme="contrast"] .section-title {
            color: #ffffff !important;
            text-shadow: 0 0 32px rgba(8, 145, 178, 0.8), 0 0 16px rgba(8, 145, 178, 0.6), 0 2px 12px rgba(0, 0, 0, 0.5) !important;
            font-weight: 900 !important;
            letter-spacing: -0.5px !important;
        }

        /* Tracklist & Credits */
        .profile-preview .tracklist-card {
            background: var(--bg-secondary);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .profile-preview .tracklist-header {
            padding: 18px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .profile-preview .tracklist-meta {
            display: flex;
            gap: 16px;
            font-size: 13px;
            color: var(--text-tertiary);
            font-weight: 600;
        }

        .profile-preview .tracklist-meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .profile-preview .track-item {
            display: flex;
            align-items: center;
            padding: 14px 18px;
            gap: 14px;
            border-bottom: 1px solid var(--border);
            transition: background 0.2s ease;
            cursor: pointer;
        }

        .profile-preview .track-item:last-child {
            border-bottom: none;
        }

        .profile-preview .track-item:hover {
            background: var(--bg-tertiary);
        }

        .profile-preview .track-item.playing {
            background: var(--accent-soft);
        }

        .profile-preview .track-number {
            width: 28px;
            height: 28px;
            font-size: 13px;
            font-weight: 800;
            color: var(--text-secondary);
            background: var(--bg-tertiary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .profile-preview .track-item.playing .track-number {
            background: var(--accent);
            color: white;
        }

        .profile-preview .track-play-indicator {
            display: none;
            width: 24px;
            height: 24px;
            align-items: center;
            justify-content: center;
        }

        .profile-preview .track-item.playing .track-number span {
            display: none;
        }

        .profile-preview .track-item.playing .track-play-indicator {
            display: flex;
        }

        .profile-preview .playing-bars {
            display: flex;
            align-items: flex-end;
            gap: 2px;
            height: 14px;
        }

        .profile-preview .playing-bar {
            width: 3px;
            background: var(--accent);
            border-radius: 1px;
            animation: playing-bars 0.8s ease-in-out infinite;
        }

        .profile-preview .playing-bar:nth-child(1) {
            height: 60%; animation-delay: 0s; }
        .profile-preview .playing-bar:nth-child(2) {
            height: 100%; animation-delay: 0.2s; }
        .profile-preview .playing-bar:nth-child(3) {
            height: 40%; animation-delay: 0.4s; }

        @keyframes playing-bars {
        0%,
        100% {
            transform: scaleY(1); }
        50% {
            transform: scaleY(0.5); }
        }

        .profile-preview .track-info {
            flex: 1;
            min-width: 0;
        }

        .profile-preview .track-title {
            font-size: 15px;
            font-weight: 700;
            margin-bottom: 2px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .profile-preview .track-explicit {
            background: var(--text-tertiary);
            color: var(--bg-primary);
            font-size: 9px;
            font-weight: 800;
            padding: 2px 4px;
            border-radius: 3px;
            letter-spacing: 0.5px;
        }

        .profile-preview .track-featuring {
            font-size: 13px;
            color: var(--text-tertiary);
        }

        .profile-preview .track-featuring a {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
        }

        .profile-preview .track-featuring a:hover {
            color: var(--accent);
        }

        .profile-preview .track-duration {
            font-size: 13px;
            color: var(--text-tertiary);
            font-weight: 600;
            font-variant-numeric: tabular-nums;
            flex-shrink: 0;
        }

        .profile-preview .track-preview-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .profile-preview .track-item:hover .track-preview-btn {
            opacity: 1;
        }

        .profile-preview .track-preview-btn:hover {
            background: var(--accent);
            color: white;
        }

        /* Track Waveform Visualization */
        .profile-preview .track-waveform {
            display: flex;
            align-items: center;
            gap: 1px;
            height: 24px;
            margin-top: 4px;
            opacity: 0.5;
        }

        .profile-preview .track-waveform::before {
            content: '';
            width: 100%;
            max-width: 120px;
            height: 100%;
            background: linear-gradient(
                to right,
                transparent 0%,
                var(--accent) 2%, transparent 2%,
                transparent 4%,
                var(--accent) 6%, transparent 6%,
                transparent 8%,
                var(--accent) 10%, transparent 10%,
                transparent 12%,
                var(--accent) 14%, transparent 14%,
                transparent 16%,
                var(--accent) 18%, transparent 18%,
                transparent 20%,
                var(--accent) 22%, transparent 22%,
                transparent 24%,
                var(--accent) 26%, transparent 26%,
                transparent 28%,
                var(--accent) 30%, transparent 30%
            );
            background-size: 3% 40%, 3% 80%, 3% 60%, 3% 90%, 3% 50%, 3% 70%, 3% 85%, 3% 55%, 3% 75%, 3% 95%;
            background-repeat: no-repeat;
            background-position: 0% center, 6% center, 12% center, 18% center, 24% center, 30% center, 36% center, 42% center, 48% center, 54% center;
            border-radius: 2px;
        }

        .profile-preview .track-item:hover .track-waveform {
            opacity: 0.7;
        }

        .profile-preview .track-item.playing .track-waveform::before {
            background: linear-gradient(
                to right,
                transparent 0%,
                var(--accent) 2%, transparent 2%,
                transparent 4%,
                var(--accent) 6%, transparent 6%,
                transparent 8%,
                var(--accent) 10%, transparent 10%,
                transparent 12%,
                var(--accent) 14%, transparent 14%,
                transparent 16%,
                var(--accent) 18%, transparent 18%,
                transparent 20%,
                var(--accent) 22%, transparent 22%,
                transparent 24%,
                var(--accent) 26%, transparent 26%,
                transparent 28%,
                var(--accent) 30%, transparent 30%
            );
            opacity: 1;
        }

        /* Platform Icons */
        .profile-preview .track-platforms {
            display: flex;
            gap: 6px;
            align-items: center;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .profile-preview .track-item:hover .track-platforms {
            opacity: 1;
        }

        .profile-preview .platform-icon {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            text-decoration: none;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .profile-preview .platform-icon.spotify {
            background: #1DB954;
            color: white;
        }

        .profile-preview .platform-icon.soundcloud {
            background: #FF5500;
            color: white;
        }

        .profile-preview .platform-icon.apple {
            background: #FA2D48;
            color: white;
        }

        .profile-preview .platform-icon:hover {
            transform: scale(1.15);
        }

        .profile-preview .credits-section {
            padding: 18px;
            border-top: 1px solid var(--border);
            background: var(--bg-tertiary);
        }

        .profile-preview .credits-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            font-size: 14px;
            font-weight: 700;
            color: var(--text-secondary);
        }

        .profile-preview .credits-toggle-icon {
            transition: transform 0.2s ease;
        }

        .profile-preview .credits-section.expanded .credits-toggle-icon {
            transform: rotate(180deg);
        }

        .profile-preview .credits-content {
            display: none;
            margin-top: 16px;
        }

        .profile-preview .credits-section.expanded .credits-content {
            display: block;
        }

        .profile-preview .credits-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 14px;
        }

        @media (max-width: 400px) {
        .profile-preview .credits-grid {
                grid-template-columns: 1fr;
            }
        }

        .profile-preview .credit-item {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .profile-preview .credit-role {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-tertiary);
        }

        .profile-preview .credit-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Profile Credits Section â€” aggregated collaborator rows */
        .profile-preview .credit-row {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid var(--token-border);
            cursor: pointer;
        }
        .profile-preview .credit-row:last-of-type { border-bottom: none; }
        .profile-preview .credit-row-badge {
            min-width: 22px;
            height: 22px;
            border-radius: 50%;
            background: var(--accent);
            color: #fff;
            font-size: 10px;
            font-weight: 800;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        .profile-preview .credit-row-main {
            flex: 1;
            min-width: 0;
        }
        .profile-preview .credit-row-name {
            font-size: 13px;
            font-weight: 700;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .profile-preview .credit-row-roles {
            font-size: 11px;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .profile-preview .credit-row-detail {
            display: none;
            font-size: 11px;
            color: var(--text-tertiary);
            padding: 4px 0 0 0;
            line-height: 1.5;
        }
        .profile-preview .credit-row.detail-open .credit-row-detail {
            display: block;
        }

        /* Refined Square Calendar - Compact */
        .profile-preview .calendar-container {
            background: var(--bg-secondary);
            border-radius: 16px;
            border: 1px solid var(--border);
            overflow: hidden;
            max-width: 380px;
            margin: 0 auto;
        }

        .profile-preview .calendar-header {
            padding: 16px 20px 12px;
            background: var(--bg-secondary);
        }

        .profile-preview .calendar-month-year {
            font-size: 14px;
            font-weight: 800;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--text-tertiary);
            text-align: center;
            margin-bottom: 14px;
        }

        .profile-preview .calendar-nav {
            position: absolute;
            top: 24px;
            right: 24px;
            display: flex;
            gap: 4px;
        }

        .profile-preview .calendar-nav-btn {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            background: transparent;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.15s ease;
            font-size: 12px;
            color: var(--text-tertiary);
            font-weight: 700;
        }

        .profile-preview .calendar-nav-btn:hover {
            background: var(--bg-tertiary);
            border-color: var(--text-tertiary);
            color: var(--text-primary);
        }

        .profile-preview .calendar-grid {
            padding: 0 24px 24px;
        }

        .profile-preview .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            margin-bottom: 8px;
        }

        .profile-preview .calendar-weekday {
            text-align: center;
            font-size: 10px;
            font-weight: 700;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 8px 0;
            opacity: 0.6;
        }

        .profile-preview .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            background: var(--border);
            padding: 2px;
            border-radius: 12px;
            overflow: hidden;
        }

        .profile-preview .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            cursor: default;
            transition: all 0.2s ease;
            position: relative;
            background: var(--bg-secondary);
            color: var(--text-primary);
            min-height: 44px;
        }

        @media (max-width: 480px) {
        .profile-preview .calendar-day {
                font-size: 13px;
                min-height: 40px;
            }
        }

        .profile-preview .calendar-day.other-month {
            color: var(--text-tertiary);
            opacity: 0.3;
        }

        .profile-preview .calendar-day.today {
            background: var(--accent);
            color: white;
            font-weight: 900;
        }

        .profile-preview .calendar-day.has-event {
            background: var(--accent);
            color: white;
            font-weight: 800;
            cursor: pointer;
        }

        .profile-preview .calendar-day.has-event.event-release {
            background: #06b6d4;
        }

        .profile-preview .calendar-day.has-event.event-tour {
            background: #a855f7;
        }

        .profile-preview .calendar-day.has-event.event-merch {
            background: #ec4899;
        }

        .profile-preview .calendar-day.has-event.event-other {
            background: #f59e0b;
        }

        .profile-preview .calendar-day.has-event:hover {
            transform: scale(1.15);
            z-index: 10;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }

        .profile-preview .calendar-day.today.has-event {
            box-shadow: 0 0 0 2px var(--bg-secondary), 0 0 0 4px var(--accent);
        }

        /* Elegant Tooltip */
        .profile-preview .event-tooltip {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(10px);
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            width: calc(100% - 48px);
            max-width: 360px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            opacity: 0;
            pointer-events: none;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
        }

        .profile-preview .calendar-day:hover .event-tooltip {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .profile-preview .tooltip-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 12px;
        }

        .profile-preview .tooltip-title {
            font-size: 16px;
            font-weight: 900;
            letter-spacing: -0.3px;
            line-height: 1.3;
            flex: 1;
        }

        .profile-preview .tooltip-badge {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 9px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .profile-preview .badge-release {
            background: #06b6d4; color: white; }
        .profile-preview .badge-tour {
            background: #a855f7; color: white; }
        .profile-preview .badge-merch {
            background: #ec4899; color: white; }
        .profile-preview .badge-other {
            background: #f59e0b; color: white; }

        .profile-preview .tooltip-description {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .profile-preview .tooltip-location {
            font-size: 13px;
            color: var(--text-tertiary);
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 10px;
        }

        .profile-preview .tooltip-countdown {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: var(--accent-soft);
            border-radius: 8px;
            font-size: 12px;
            font-weight: 700;
            color: var(--accent);
        }

        .profile-preview .calendar-legend {
            padding: 16px 24px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .profile-preview .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            font-weight: 700;
            color: var(--text-tertiary);
        }

        .profile-preview .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        .profile-preview .color-release {
            background: #06b6d4; }
        .profile-preview .color-tour {
            background: #a855f7; }
        .profile-preview .color-merch {
            background: #ec4899; }
        .profile-preview .color-other {
            background: #f59e0b; }

        .profile-preview .credit-name a {
            color: var(--text-primary);
            text-decoration: none;
        }

        .profile-preview .credit-name a:hover {
            color: var(--accent);
        }

        .profile-preview .bio-card,
        .profile-preview .support-card,
        .profile-preview .subscribe-card,
        .profile-preview .qr-card {
            background: var(--bg-secondary);
            padding: 28px 18px;
            border-radius: 16px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border);
        }

        .profile-preview[data-theme="contrast"] .bio-card,
        .profile-preview[data-theme="contrast"] .support-card,
        .profile-preview[data-theme="contrast"] .subscribe-card,
        .profile-preview[data-theme="contrast"] .qr-card {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
        }

        .profile-preview .bio-card {
            display: flex;
            gap: 18px;
            align-items: flex-start;
        }

        .profile-preview .bio-avatar {
            width: 72px;
            height: 72px;
            border-radius: 50%;
            background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: 900;
            color: white;
            box-shadow: 0 4px 12px rgba(8, 145, 178, 0.25);
        }

        .profile-preview .bio-content {
            flex: 1;
            min-width: 0;
        }

        .profile-preview .bio-text {
            font-size: 16px;
            line-height: 1.7;
            color: var(--text-secondary);
            margin-bottom: 18px;
        }

        .profile-preview .bio-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .profile-preview .tag {
            padding: 7px 16px;
            background: var(--bg-tertiary);
            border-radius: 18px;
            font-size: 13px;
            font-weight: 700;
            color: var(--text-secondary);
        }

        .profile-preview .support-card {
            background: var(--bg-secondary);
            position: relative;
            overflow: hidden;
            padding: 22px 18px;
        }

        .profile-preview .support-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 14px;
        }

        .profile-preview .support-title {
            font-size: 18px;
            font-weight: 800;
            margin-bottom: 2px;
        }

        .profile-preview .support-price {
            font-size: 28px;
            font-weight: 900;
            color: var(--accent);
        }

        .profile-preview .support-price span {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-tertiary);
        }

        .profile-preview .support-desc {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 16px;
        }

        .profile-preview .scarcity-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 5px 10px;
            background: rgba(245, 158, 11, 0.12);
            color: var(--warning);
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
        }

        .profile-preview .support-list {
            list-style: none;
            margin: 0 0 16px 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .profile-preview .support-item {
            padding: 0;
            border-bottom: none;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
        }

        .profile-preview .support-item::before {
            content: "âœ“";
            color: var(--success);
            font-weight: 800;
            font-size: 12px;
            width: 18px;
            height: 18px;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .profile-preview .music-list {
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .profile-preview .music-card {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 14px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border);
            transition: all 0.2s ease;
            display: flex;
            gap: 14px;
            overflow: hidden; /* clip rounded corners against child content */
        }

        .profile-preview .music-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.06);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           Able Card â€” unified profile content card shell
           All embed / tracklist / content cards in the profile preview
           should carry these classes going forward (Prompt 1 stub).
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        .profile-preview .able-card {
            background: var(--bg-secondary);
            border: 1px solid var(--token-border);
            border-radius: var(--token-radius-lg);  /* 12px â€” tokenised */
            overflow: hidden;                        /* clips embed corners */
            box-shadow: var(--elevation-1);
            max-width: 100%;
            box-sizing: border-box;
            overflow-wrap: anywhere;                 /* long titles / URLs wrap cleanly */
            transition:
                box-shadow var(--transition-base) var(--ease-smooth),
                transform  var(--transition-base) var(--ease-smooth);
        }

        .profile-preview .able-card:hover {
            transform: translateY(-1px);
            box-shadow: var(--elevation-3);
        }

        /* In dark / contrast modes: lift card off dark background */
        .profile-preview[data-theme="dark"] .able-card,
        .profile-preview[data-theme="contrast"] .able-card {
            box-shadow: var(--elevation-2), inset 0 1px 0 rgba(255, 255, 255, 0.06);
        }

        /* â”€â”€ Focus-visible ring â€” keyboard navigation (non-radical) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .profile-preview a:focus-visible,
        .profile-preview button:focus-visible {
            outline: var(--focus-ring-width) solid var(--token-focus-ring);
            outline-offset: 2px;
            border-radius: var(--token-radius-sm);
        }
        .profile-preview .able-card:focus-visible {
            outline: var(--focus-ring-width) solid var(--token-focus-ring);
            outline-offset: 2px;
        }

        /* Card anatomy slots */
        .profile-preview .able-card__header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-md) var(--space-lg);
            border-bottom: 1px solid var(--token-border);
        }

        .profile-preview .able-card__body {
            overflow: hidden;   /* clips iframe corners */
            position: relative;
        }

        .profile-preview .able-card__body iframe {
            display: block;
            width: 100%;
            max-width: 100%;
            border: 0;
        }

        .profile-preview .able-card__footer {
            padding: var(--space-md) var(--space-lg);
            border-top: 1px solid var(--token-border);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        /* â”€â”€ Standalone embed wrapper (used outside a full able-card) â”€â”€ */
        /* Mirrors the inline style used in JS-generated embeds today.   */
        /* Wire JS to use class="able-card-embed-wrap" in a future prompt */
        .profile-preview .able-card-embed-wrap {
            border-radius: var(--card-embed-radius);
            overflow: hidden;
            background: var(--bg-secondary);
            border: 1px solid var(--token-border);
            position: relative;
        }

        .profile-preview .able-card-embed-wrap iframe {
            display: block;
            width: 100%;
            max-width: 100%;
            border: 0;
        }

        /* Inside a full able-card the embed needs no extra radius/border */
        .profile-preview .able-card .able-card-embed-wrap {
            border-radius: 0;
            border: 0;
        }

        /* Image-mode / glassmorphism: frosted surface */
        body.glassmorphism-enabled .profile-preview .able-card {
            background: var(--card-glass-bg);
            backdrop-filter: blur(var(--card-glass-blur));
            -webkit-backdrop-filter: blur(var(--card-glass-blur));
            border-color: var(--card-glass-border);
        }

        .profile-preview .music-cover {
            width: 76px;
            height: 76px;
            border-radius: 8px;
            background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%);
            flex-shrink: 0;
        }

        .profile-preview .music-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .profile-preview .music-title {
            font-size: 16px;
            font-weight: 800;
            margin-bottom: 4px;
        }

        .profile-preview .btn-small {
            padding: 9px 18px;
            font-size: 14px;
            font-weight: 700;
        }

        /* Behind The Scenes Polaroids - Small & Tasteful */
        .profile-preview .polaroid-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            max-width: 400px;
            margin: 0 auto;
        }

        @media (min-width: 768px) {
        .profile-preview .polaroid-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 18px;
                max-width: 100%;
            }
        }

        .profile-preview .polaroid {
            background: white;
            padding: 10px;
            padding-bottom: 35px;
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.1),
                0 8px 16px rgba(0, 0, 0, 0.08);
            transform: rotate(var(--rotation, 0deg));
            transition: all 0.4s var(--ease-spring);
            cursor: pointer;
            position: relative;
        }

        .profile-preview .polaroid:hover {
            transform: rotate(0deg) translateY(-8px) scale(1.05);
            box-shadow: 
                0 12px 24px rgba(0, 0, 0, 0.15),
                0 4px 8px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }

        .profile-preview .polaroid-photo {
            aspect-ratio: 1;
            background: linear-gradient(135deg, #f5f5f4 0%, #e7e5e4 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            margin-bottom: 8px;
        }

        .profile-preview .polaroid-caption {
            text-align: center;
            font-size: 11px;
            font-weight: 600;
            color: #57534e;
            font-family: 'Courier New', monospace;
            letter-spacing: 0.3px;
        }

        /* Dark mode polaroids stay white (like real polaroids) */
        .profile-preview[data-theme="dark"] .polaroid,
        .profile-preview[data-theme="contrast"] .polaroid {
            background: white;
        }

        .profile-preview[data-theme="dark"] .polaroid-caption,
        .profile-preview[data-theme="contrast"] .polaroid-caption {
            color: #57534e;
        }

        /* Apple Music Compact Tracklist */
        .profile-preview .tracklist-compact {
            background: var(--bg-secondary);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .profile-preview .track-row {
            display: grid;
            grid-template-columns: 32px 1fr auto 40px;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .profile-preview .track-row:last-of-type {
            border-bottom: none;
        }

        .profile-preview .track-row:hover {
            background: var(--bg-tertiary);
        }

        .profile-preview .track-row:active {
            background: var(--accent-soft);
        }

        .profile-preview .track-num {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-secondary);
            text-align: center;
            font-variant-numeric: tabular-nums;
        }

        .profile-preview .track-info {
            min-width: 0;
        }

        .profile-preview .track-name {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .profile-preview .track-feat {
            font-weight: 400;
            color: var(--text-secondary);
        }

        .profile-preview .explicit-badge {
            display: inline-block;
            background: var(--text-tertiary);
            color: var(--bg-primary);
            font-size: 9px;
            font-weight: 800;
            padding: 2px 4px;
            border-radius: 2px;
            vertical-align: middle;
            margin-left: 4px;
        }

        .profile-preview .track-artist {
            font-size: 13px;
            color: var(--text-tertiary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .profile-preview .track-duration {
            font-size: 14px;
            color: var(--text-tertiary);
            font-weight: 500;
            font-variant-numeric: tabular-nums;
        }

        .profile-preview .track-menu {
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-size: 20px;
            cursor: pointer;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: all 0.2s ease;
        }

        .profile-preview .track-row:hover .track-menu {
            opacity: 1;
        }

        .profile-preview .track-menu:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .profile-preview .track-menu:active {
            transform: scale(0.95);
        }

        .profile-preview .tracklist-footer {
            padding: 12px 16px;
            font-size: 13px;
            color: var(--text-tertiary);
            text-align: center;
            background: var(--bg-tertiary);
            font-weight: 500;
        }

        /* Mobile optimization */
        @media (max-width: 640px) {
        .profile-preview .track-row {
                grid-template-columns: 28px 1fr auto 36px;
                gap: 10px;
                padding: 10px 14px;
            }

        .profile-preview .track-num {
                font-size: 14px;
            }

        .profile-preview .track-name {
                font-size: 14px;
            }

        .profile-preview .track-duration {
                font-size: 13px;
            }

        .profile-preview .track-menu {
                opacity: 1;
            }
        }

        /* DIY Textured Video Collage */
        .profile-preview .video-collage {
            display: grid;
            gap: 16px;
        }

        .profile-preview .video-featured {
            text-decoration: none;
            color: inherit;
            display: block;
            transform: rotate(var(--rotation, 0deg));
            transition: all 0.3s var(--ease-spring);
        }

        .profile-preview .video-featured:hover {
            transform: rotate(0deg) translateY(-4px);
        }

        .profile-preview .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 14px;
        }

        @media (max-width: 640px) {
        .profile-preview .video-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
        }

        .profile-preview .video-item {
            text-decoration: none;
            color: inherit;
            display: block;
            transform: rotate(var(--rotation, 0deg));
            transition: all 0.3s var(--ease-spring);
        }

        .profile-preview .video-item:hover {
            transform: rotate(0deg) translateY(-3px);
        }

        .profile-preview .video-thumb {
            position: relative;
            background: var(--bg-secondary);
            border-radius: 8px;
            overflow: hidden;
            aspect-ratio: 16 / 9;
            box-shadow: 
                0 2px 4px rgba(0, 0, 0, 0.1),
                0 4px 8px rgba(0, 0, 0, 0.08);
            border: 2px solid var(--bg-primary);
        }

        .profile-preview .video-placeholder-thumb {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
            position: relative;
        }

        .profile-preview .thumb-pattern {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                repeating-linear-gradient(45deg, rgba(255,255,255,0.1) 0px, rgba(255,255,255,0.1) 2px, transparent 2px, transparent 12px),
                repeating-linear-gradient(-45deg, rgba(0,0,0,0.1) 0px, rgba(0,0,0,0.1) 2px, transparent 2px, transparent 12px);
        }

        .profile-preview .video-thumb-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .profile-preview .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s ease;
        }

        .profile-preview .video-featured:hover .video-overlay,
        .profile-preview .video-item:hover .video-overlay {
            background: rgba(0, 0, 0, 0.3);
        }

        .profile-preview .video-play-btn {
            width: 56px;
            height: 56px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #000;
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.3s ease;
        }

        .profile-preview .video-item .video-play-btn {
            width: 48px;
            height: 48px;
            font-size: 18px;
        }

        .profile-preview .video-featured:hover .video-play-btn,
        .profile-preview .video-item:hover .video-play-btn {
            opacity: 1;
            transform: scale(1);
        }

        .profile-preview .video-time {
            position: absolute;
            bottom: 6px;
            right: 6px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 3px 6px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 700;
            font-variant-numeric: tabular-nums;
        }

        .profile-preview .video-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transform: rotate(-2deg);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .profile-preview .video-badge.new {
            background: linear-gradient(135deg, #ec4899 0%, #f43f5e 100%);
            color: white;
        }

        .profile-preview .video-badge.live {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .profile-preview .video-info {
            margin-top: 8px;
        }

        .profile-preview .video-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.4;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .profile-preview .video-stats {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-top: 4px;
            font-weight: 500;
        }

        /* Add film grain texture to video thumbs */
        .profile-preview .video-thumb::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' /%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.05'/%3E%3C/svg%3E");
            pointer-events: none;
            mix-blend-mode: overlay;
        }

        .profile-preview .subscribe-card {
            text-align: center;
            padding: 22px 18px;
        }

        .profile-preview .subscribe-form {
            display: flex;
            gap: 8px;
        }

        .profile-preview .subscribe-input {
            flex: 1;
            padding: 12px 14px;
            border: 1px solid var(--border);
            border-radius: 10px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
        }

        .profile-preview .subscribe-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .profile-preview .subscribe-success {
            display: none;
            padding: 14px;
            background: var(--success);
            color: white;
            border-radius: 10px;
            font-weight: 700;
            font-size: 14px;
        }

        .profile-preview .subscribe-success.visible {
            display: block;
        }

        .profile-preview .qr-card {
            text-align: center;
            padding: 22px 18px;
        }

        .profile-preview .qr-label {
            font-size: 11px;
            font-weight: 700;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .profile-preview #qrCanvas {
            margin: 0 auto 14px;
            border: 1px solid var(--border);
            border-radius: 10px;
            display: block;
            width: 140px;
            height: 140px;
        }

        .profile-preview .qr-url {
            font-size: 14px;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 4px;
        }

        .profile-preview .qr-info {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-bottom: 14px;
        }

        /* Footer */
        .profile-preview .page-footer {
            background: var(--bg-secondary);
            border-top: 1px solid var(--border);
            padding: 24px 18px;
            text-align: center;
            margin-top: 20px;
        }

        .profile-preview .footer-release {
            font-size: 15px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .profile-preview .footer-date {
            font-size: 13px;
            color: var(--text-tertiary);
            margin-bottom: 16px;
        }

        .profile-preview .footer-cta {
            margin-bottom: 20px;
        }

        .profile-preview .footer-brand {
            font-size: 12px;
            color: var(--text-tertiary);
            font-weight: 600;
        }

        .profile-preview .footer-brand a {
            color: var(--accent);
            text-decoration: none;
        }

        .profile-preview .theme-toggle {
            position: absolute;
            bottom: 28px;
            right: 28px;
            width: 52px;
            height: 52px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 50%;
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.08);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 99;
            font-size: 22px;
            transition: transform 0.2s ease;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            color: var(--text-primary);
        }

        .profile-preview .theme-toggle:hover {
            transform: scale(1.06);
        }

        .profile-preview .sections-container {
            display: flex;
            flex-direction: column;
        }

        .profile-preview .hidden {
            display: none !important;
        }

        /* Streaming Pills - Horizontal scrollable badges */
        .profile-preview .streaming-pills-container {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            overflow-y: hidden;
            padding: 4px 0 8px 0;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .profile-preview .streaming-pills-container::-webkit-scrollbar {
            display: none;
        }

        .profile-preview .streaming-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 16px;
            background: var(--bg-secondary);
            border: 1.5px solid rgba(0, 0, 0, 0.1);
            border-radius: 20px;
            text-decoration: none;
            white-space: nowrap;
            transition: all 0.2s ease;
            cursor: pointer;
            flex-shrink: 0;
            box-shadow: 1px 2px 6px rgba(0, 0, 0, 0.04);
            will-change: transform;
            backface-visibility: hidden;
            -webkit-font-smoothing: antialiased;
        }

        .profile-preview .pill-icon {
            font-size: 10px;
            transition: color 0.2s ease;
        }

        .profile-preview .pill-text {
            font-size: 13px;
            font-weight: 700;
            color: var(--text-primary);
            transition: color 0.2s ease;
        }

        /* Platform-specific colors */
        .profile-preview .streaming-pill.spotify .pill-icon {
            color: #1DB954;
        }

        .profile-preview .streaming-pill.spotify:hover {
            background: #1DB954;
            border-color: #1DB954;
            transform: translateY(-1px);
        }

        .profile-preview .streaming-pill.spotify:hover .pill-icon,
        .profile-preview .streaming-pill.spotify:hover .pill-text {
            color: white;
        }

        .profile-preview .streaming-pill.apple .pill-icon {
            color: #FA243C;
        }

        .profile-preview .streaming-pill.apple:hover {
            background: #FA243C;
            border-color: #FA243C;
            transform: translateY(-1px);
        }

        .profile-preview .streaming-pill.apple:hover .pill-icon,
        .profile-preview .streaming-pill.apple:hover .pill-text {
            color: white;
        }

        .profile-preview .streaming-pill.youtube .pill-icon {
            color: #FF0000;
        }

        .profile-preview .streaming-pill.youtube:hover {
            background: #FF0000;
            border-color: #FF0000;
            transform: translateY(-1px);
        }

        .profile-preview .streaming-pill.youtube:hover .pill-icon,
        .profile-preview .streaming-pill.youtube:hover .pill-text {
            color: white;
        }

        .profile-preview .streaming-pill.soundcloud .pill-icon {
            color: #FF5500;
        }

        .profile-preview .streaming-pill.soundcloud:hover {
            background: #FF5500;
            border-color: #FF5500;
            transform: translateY(-1px);
        }

        .profile-preview .streaming-pill.soundcloud:hover .pill-icon,
        .profile-preview .streaming-pill.soundcloud:hover .pill-text {
            color: white;
        }

        .profile-preview .streaming-pill.amazon .pill-icon {
            color: #00A8E1;
        }

        .profile-preview .streaming-pill.amazon:hover {
            background: #00A8E1;
            border-color: #00A8E1;
            transform: translateY(-1px);
        }

        .profile-preview .streaming-pill.amazon:hover .pill-icon,
        .profile-preview .streaming-pill.amazon:hover .pill-text {
            color: white;
        }

        .profile-preview .streaming-pill.tidal .pill-icon {
            color: #000;
        }

        .profile-preview .streaming-pill.tidal:hover {
            background: #000;
            border-color: #000;
            transform: translateY(-1px);
        }

        .profile-preview .streaming-pill.tidal:hover .pill-icon,
        .profile-preview .streaming-pill.tidal:hover .pill-text {
            color: white;
        }

        .profile-preview .streaming-pill.bandcamp .pill-icon {
            color: #629AA9;
        }

        .profile-preview .streaming-pill.bandcamp:hover {
            background: #629AA9;
            border-color: #629AA9;
            transform: translateY(-1px);
        }

        .profile-preview .streaming-pill.bandcamp:hover .pill-icon,
        .profile-preview .streaming-pill.bandcamp:hover .pill-text {
            color: white;
        }

        .profile-preview .streaming-pill.deezer .pill-icon {
            color: #FF0092;
        }

        .profile-preview .streaming-pill.deezer:hover {
            background: #FF0092;
            border-color: #FF0092;
            transform: translateY(-1px);
        }

        .profile-preview .streaming-pill.deezer:hover .pill-icon,
        .profile-preview .streaming-pill.deezer:hover .pill-text {
            color: white;
        }

        .profile-preview .streaming-pill:active {
            transform: translateY(0) scale(0.97);
            transition: all 0.1s ease;
        }


        .profile-preview .streaming-btn.amazon:hover {
            border-color: #00A8E1;
        }

        .profile-preview .streaming-btn.amazon:hover .streaming-icon {
            background: #00A8E1;
        }

        /* Bento Box Calendar */
        .profile-preview .bento-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            grid-auto-rows: 90px;
        }

        @media (min-width: 768px) {
        .profile-preview .bento-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 10px;
                grid-auto-rows: 110px;
            }
        }

        .profile-preview .bento-tile {
            background: var(--token-surface-1);
            border-radius: 16px;
            padding: 12px;
            border: 1px solid rgba(0, 0, 0, 0.06);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.4s var(--ease-spring);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: 
                1px 2px 6px rgba(0, 0, 0, 0.05);
            filter: drop-shadow(0 0 0.5px rgba(0, 0, 0, 0.03));
        }

        /* Size variants - priority based */
        .profile-preview .bento-tile.size-large {
            grid-column: span 2;
            grid-row: span 2;
        }

        .profile-preview .bento-tile.size-medium {
            grid-column: span 2;
            grid-row: span 1;
        }

        .profile-preview .bento-tile.size-small {
            grid-column: span 1;
            grid-row: span 1;
        }

        /* Event type gradients */
        .profile-preview .bento-tile.type-release {
            background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
            color: white;
        }

        .profile-preview .bento-tile.type-tour {
            background: var(--bg-secondary);
        }

        .profile-preview .bento-tile.type-merch {
            background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);
            color: white;
        }

        .profile-preview .bento-tile.type-other {
            background: var(--bg-secondary);
        }

        /* Subtle organic rotation */
        .profile-preview .bento-tile:nth-child(odd) {
            transform: rotate(-0.2deg); }
        .profile-preview .bento-tile:nth-child(even) {
            transform: rotate(0.3deg); }

        .profile-preview .bento-tile:hover {
            transform: translateY(-4px) scale(1.01) rotate(0deg) !important;
            box-shadow: 
                2px 10px 28px rgba(0, 0, 0, 0.16),
                4px 14px 36px rgba(0, 0, 0, 0.12);
            z-index: 10;
        }

        .profile-preview .bento-tile:active {
            transform: translateY(-2px) scale(1.01) !important;
        }

        .profile-preview .bento-date {
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            opacity: 0.9;
            margin-bottom: 4px;
        }

        .profile-preview .bento-title {
            font-size: 13px;
            font-weight: 900;
            line-height: 1.2;
            margin-bottom: 4px;
        }

        .profile-preview .bento-tile.size-large .bento-title {
            font-size: 17px;
            margin-bottom: 6px;
            line-height: 1.2;
        }

        .profile-preview .bento-tile.size-medium .bento-title {
            font-size: 14px;
        }

        .profile-preview .bento-description {
            font-size: 11px;
            opacity: 0.85;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .profile-preview .bento-tile.size-large .bento-description {
            font-size: 12px;
            -webkit-line-clamp: 2;
        }

        .profile-preview .bento-tile.size-large .bento-description {
            font-size: 14px;
            -webkit-line-clamp: 3;
        }

        .profile-preview .bento-tile.size-small .bento-description {
            display: none;
        }

        .profile-preview .bento-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            padding: 4px 10px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(8px);
            border-radius: 12px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .profile-preview .bento-tile.type-tour .bento-badge,
        .profile-preview .bento-tile.type-other .bento-badge {
            background: var(--accent);
            color: white;
        }

        .profile-preview .bento-cta {
            margin-top: auto;
            padding-top: 10px;
            font-size: 12px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 6px;
            opacity: 0.9;
        }

        .profile-preview .bento-tile.size-small .bento-cta {
            font-size: 11px;
        }

        /* â”€â”€ Bento CTA pill â€” ticket + merch buy buttons inside bento tiles â”€â”€ */
        .profile-preview .bento-cta-pill {
            display: inline-block;
            margin-top: 6px;
            padding: 4px 10px;
            background: var(--accent);
            color: #fff;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 700;
            text-decoration: none;
            letter-spacing: 0.02em;
            transition: opacity var(--transition-fast) var(--ease-smooth),
                        transform var(--transition-fast) var(--ease-smooth);
            -webkit-tap-highlight-color: transparent;
        }
        .profile-preview .bento-cta-pill:hover  { opacity: 0.85; transform: translateY(-1px); }
        .profile-preview .bento-cta-pill:active  { opacity: 1;    transform: translateY(0); }

        /* Contrast mode adjustments */
        .profile-preview[data-theme="contrast"] .bento-tile.type-tour,
        .profile-preview[data-theme="contrast"] .bento-tile.type-other {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
        }

        .profile-preview .tour-card {
            background: var(--bg-secondary);
            border-radius: 14px;
            padding: 12px;
            border: 1px solid rgba(0, 0, 0, 0.06);
            transition: all 0.3s var(--ease-spring);
            margin-bottom: 8px;
            position: relative;
            overflow: hidden;
            box-shadow: 
                1px 2px 6px rgba(0, 0, 0, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            filter: drop-shadow(0 0 0.5px rgba(0, 0, 0, 0.03));
        }

        /* Subtle organic rotation for tour cards - barely perceptible */
        .profile-preview .tour-card:nth-child(odd) {
            transform: rotate(-0.08deg); }
        .profile-preview .tour-card:nth-child(even) {
            transform: rotate(0.1deg); }

        .profile-preview[data-theme="contrast"] .tour-card {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
        }

        .profile-preview .tour-card:hover {
            transform: translateY(-2px) scale(1.003);
            box-shadow: 
                2px 6px 14px rgba(0, 0, 0, 0.11),
                3px 8px 20px rgba(0, 0, 0, 0.07);
            border-color: var(--accent);
        }

        .profile-preview .tour-card:active {
            transform: translateY(-1px) scale(1.002);
            transition: all 0.1s var(--ease-smooth);
        }

        /* Ripple effect */
        .profile-preview .ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(8, 145, 178, 0.3);
            transform: scale(0);
            animation: ripple-animation 0.6s ease-out;
            pointer-events: none;
        }

        @keyframes ripple-animation {
        to {
                transform: scale(4);
                opacity: 0;
            }
        }

        .profile-preview .tour-card.urgent {
            border-color: var(--warning);
            background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(245, 158, 11, 0.05) 100%);
        }

        .profile-preview .tour-card.urgent .date-box {
            background: var(--warning);
            animation: pulse-urgent 2s ease-in-out infinite;
        }

        @keyframes pulse-urgent {
        0%,
        100% {
            box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.4); }
        50% {
            box-shadow: 0 0 0 6px rgba(245, 158, 11, 0); }
        }

        .profile-preview .tour-card.soldout {
            opacity: 0.6;
        }

        .profile-preview .tour-card.soldout .date-box {
            background: var(--text-tertiary);
        }

        .profile-preview .tour-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .profile-preview .tour-date-block {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .profile-preview .date-box {
            width: 44px;
            height: 44px;
            background: var(--accent);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .profile-preview .date-month {
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
            color: rgba(255,255,255,0.8);
            letter-spacing: 0.5px;
        }

        .profile-preview .date-day {
            font-size: 20px;
            font-weight: 900;
            color: white;
            line-height: 1;
        }

        .profile-preview .tour-info {
            flex: 1;
        }

        .profile-preview .tour-city {
            font-size: 16px;
            font-weight: 800;
            margin-bottom: 2px;
            letter-spacing: -0.3px;
        }

        .profile-preview .tour-venue {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 2px;
        }

        .profile-preview .tour-time {
            font-size: 11px;
            color: var(--text-tertiary);
            font-weight: 600;
        }

        .profile-preview .tour-status {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 6px;
        }

        .profile-preview .status-badge {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .profile-preview .badge-onsale {
            background: var(--success);
            color: white;
        }

        .profile-preview .badge-soldout {
            background: var(--error);
            color: white;
        }

        .profile-preview .badge-upcoming {
            background: var(--warning);
            color: white;
        }

        .profile-preview .badge-limited {
            background: var(--warning);
            color: white;
        }

        .profile-preview .tour-actions {
            display: flex;
            gap: 10px;
            margin-top: 14px;
        }

        .profile-preview .tour-notify-banner {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-hover) 100%);
            border-radius: 12px;
            padding: 18px;
            text-align: center;
            color: white;
            margin-bottom: 18px;
        }

        .profile-preview .notify-title {
            font-size: 16px;
            font-weight: 800;
            margin-bottom: 6px;
        }

        .profile-preview .notify-desc {
            font-size: 13px;
            opacity: 0.9;
            margin-bottom: 12px;
        }

        .profile-preview .past-shows-toggle {
            text-align: center;
            padding: 14px;
            margin-top: 18px;
            cursor: pointer;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 700;
            transition: color 0.2s ease;
        }

        .profile-preview .past-shows-toggle:hover {
            color: var(--accent);
        }

        .profile-preview .past-shows {
            display: none;
            margin-top: 14px;
            padding-top: 14px;
            border-top: 1px solid var(--border);
        }

        .profile-preview .past-shows.visible {
            display: block;
        }

        .profile-preview .past-show {
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .profile-preview .past-show:last-child {
            border-bottom: none;
        }

        .profile-preview .past-show-info {
            flex: 1;
        }

        .profile-preview .past-show-city {
            font-size: 15px;
            font-weight: 700;
            margin-bottom: 2px;
        }

        .profile-preview .past-show-date {
            font-size: 12px;
            color: var(--text-tertiary);
        }

        .profile-preview .calendar-container {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border);
            margin-bottom: 24px;
        }

        .profile-preview[data-theme="contrast"] .calendar-container {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
        }

        .profile-preview .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
        }

        .profile-preview .calendar-month {
            font-size: 18px;
            font-weight: 800;
        }

        .profile-preview .calendar-nav {
            display: flex;
            gap: 8px;
        }

        .profile-preview .calendar-nav-btn {
            width: 32px;
            height: 32px;
            border: 1px solid var(--border);
            background: var(--bg-primary);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            transition: all 0.2s ease;
        }

        .profile-preview .calendar-nav-btn:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .profile-preview .calendar-legend {
            display: flex;
            gap: 14px;
            margin-bottom: 14px;
            font-size: 11px;
            font-weight: 700;
        }

        .profile-preview .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .profile-preview .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .profile-preview .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .profile-preview .calendar-day-header {
            text-align: center;
            font-size: 11px;
            font-weight: 800;
            color: var(--text-tertiary);
            padding: 8px 4px;
            text-transform: uppercase;
        }

        .profile-preview .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            position: relative;
            cursor: pointer;
            transition: all 0.2s ease;
            background: var(--bg-primary);
        }

        .profile-preview .calendar-day:hover {
            background: var(--bg-tertiary);
        }

        .profile-preview .calendar-day.other-month {
            color: var(--text-tertiary);
            opacity: 0.4;
        }

        .profile-preview .calendar-day.today {
            background: var(--accent-soft);
            color: var(--accent);
            font-weight: 800;
        }

        .profile-preview .calendar-day.has-event {
            background: var(--accent);
            color: white;
            font-weight: 800;
        }

        .profile-preview .calendar-day.has-event:hover {
            background: var(--accent-hover);
            transform: scale(1.05);
        }

        .profile-preview .calendar-day.has-release {
            background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
            color: white;
            font-weight: 800;
        }

        .profile-preview .calendar-day.has-release:hover {
            transform: scale(1.05);
        }

        .profile-preview .calendar-day.has-content {
            background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);
            color: white;
            font-weight: 800;
        }

        .profile-preview .calendar-day.has-content:hover {
            transform: scale(1.05);
        }

        .profile-preview .event-indicator {
            position: absolute;
            bottom: 2px;
            display: flex;
            gap: 2px;
        }

        .profile-preview .event-dot {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: currentColor;
            opacity: 0.6;
        }

        .profile-preview .calendar-day.has-event .event-dot {
            background: white;
        }

        .profile-preview .event-popup {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border);
            z-index: 1000;
            max-width: 340px;
            width: 90%;
            display: none;
        }

        .profile-preview .event-popup.visible {
            display: block;
            animation: popupIn 0.3s ease;
        }

        @keyframes popupIn {
        from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.9);
            }
        to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .profile-preview .popup-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }

        .profile-preview .popup-overlay.visible {
            display: block;
        }

        .profile-preview .popup-close {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 28px;
            height: 28px;
            border: none;
            background: var(--bg-tertiary);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: var(--text-secondary);
        }

        .profile-preview .popup-date {
            font-size: 13px;
            color: var(--text-tertiary);
            font-weight: 600;
            margin-bottom: 12px;
        }

        .profile-preview .popup-events {
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .profile-preview .popup-event {
            padding: 14px;
            background: var(--bg-primary);
            border-radius: 12px;
            border-left: 4px solid var(--accent);
        }

        .profile-preview .popup-event.release {
            border-left-color: #8b5cf6;
        }

        .profile-preview .popup-event.content {
            border-left-color: #f59e0b;
        }

        .profile-preview .popup-event-title {
            font-size: 16px;
            font-weight: 800;
            margin-bottom: 4px;
        }

        .profile-preview .popup-event-desc {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .profile-preview .popup-event-time {
            font-size: 12px;
            color: var(--text-tertiary);
            font-weight: 600;
        }

        .profile-preview .merch-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
        }

        .profile-preview .merch-filters {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 4px;
            scrollbar-width: none;
        }

        .profile-preview .merch-filters::-webkit-scrollbar {
            display: none;
        }

        .profile-preview .filter-btn {
            padding: 8px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 13px;
            font-weight: 700;
            color: var(--text-secondary);
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s ease;
        }

        .profile-preview .filter-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        /* Merch Bento Grid */
        .profile-preview .merch-bento-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            grid-auto-rows: 100px;
        }

        @media (max-width: 768px) {
        .profile-preview .merch-bento-grid {
                grid-template-columns: repeat(2, 1fr);
                grid-auto-rows: 120px;
            }
        }

        .profile-preview .merch-bento-tile {
            background: var(--token-surface-1);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(0, 0, 0, 0.06);
            cursor: pointer;
            transition: all 0.3s var(--ease-spring);
            position: relative;
            display: flex;
            flex-direction: column;
            box-shadow: 1px 2px 6px rgba(0, 0, 0, 0.04);
        }

        .profile-preview .merch-bento-tile.size-large {
            grid-column: span 2;
            grid-row: span 2;
        }

        .profile-preview .merch-bento-tile.size-medium {
            grid-column: span 2;
            grid-row: span 1;
        }

        .profile-preview .merch-bento-tile.size-small {
            grid-column: span 1;
            grid-row: span 1;
        }

        .profile-preview .merch-bento-tile:hover {
            transform: translateY(-2px) scale(1.01);
            box-shadow: 
                2px 6px 16px rgba(0, 0, 0, 0.1),
                3px 8px 20px rgba(0, 0, 0, 0.06);
        }

        .profile-preview .merch-bento-image {
            flex: 1;
            background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%);
            position: relative;
            min-height: 60px;
        }

        .profile-preview .merch-bento-info {
            padding: 10px 12px;
            background: var(--bg-secondary);
        }

        .profile-preview .merch-bento-name {
            font-size: 13px;
            font-weight: 800;
            margin-bottom: 2px;
            line-height: 1.2;
            letter-spacing: -0.2px;
            color: var(--text-primary);
        }

        .profile-preview .merch-bento-tile.size-large .merch-bento-name {
            font-size: 15px;
            margin-bottom: 4px;
        }

        .profile-preview .merch-bento-desc {
            font-size: 10px;
            color: var(--text-tertiary);
            margin-bottom: 4px;
            line-height: 1.3;
        }

        .profile-preview .merch-bento-tile.size-large .merch-bento-desc {
            font-size: 11px;
        }

        .profile-preview .merch-bento-price {
            font-size: 14px;
            font-weight: 900;
            color: var(--accent);
        }

        .profile-preview .merch-bento-tile.size-large .merch-bento-price {
            font-size: 16px;
        }

        .profile-preview .merch-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .profile-preview .badge-new {
            background: #10b981;
            color: white;
        }

        .profile-preview .badge-limited {
            background: #f59e0b;
            color: white;
        }

        .profile-preview .badge-sale {
            background: #ef4444;
            color: white;
        }

        /* Gear Section - Compact List */
        .profile-preview .gear-disclaimer {
            font-size: 11px;
            color: var(--text-tertiary);
            margin-bottom: 16px;
            font-weight: 600;
            font-style: italic;
        }

        .profile-preview .gear-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .profile-preview .gear-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-secondary);
            border: 1px solid rgba(0, 0, 0, 0.06);
            border-radius: 12px;
            text-decoration: none;
            transition: all 0.2s ease;
            cursor: pointer;
            box-shadow: 1px 2px 6px rgba(0, 0, 0, 0.04);
        }

        .profile-preview .gear-item:hover {
            transform: translateX(4px);
            border-color: var(--accent);
            box-shadow: 2px 4px 12px rgba(0, 0, 0, 0.08);
        }

        .profile-preview .gear-image-container {
            flex-shrink: 0;
        }

        .profile-preview .gear-image {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            background: linear-gradient(135deg, #374151 0%, #1f2937 100%);
        }

        .profile-preview .gear-info {
            flex: 1;
            min-width: 0;
        }

        .profile-preview .gear-name {
            font-size: 14px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 2px;
            line-height: 1.3;
        }

        .profile-preview .gear-desc {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.3;
        }

        .profile-preview .gear-price-arrow {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }

        .profile-preview .gear-price {
            font-size: 16px;
            font-weight: 900;
            color: var(--text-primary);
        }

        .profile-preview .gear-arrow {
            font-size: 18px;
            color: var(--text-tertiary);
            transition: transform 0.2s ease;
        }

        .profile-preview .gear-item:hover .gear-arrow {
            transform: translateX(4px);
            color: var(--accent);
        }

        /* Fan Activity Feed */
        .profile-preview .activity-feed {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 16px;
        }

        .profile-preview .activity-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            background: var(--bg-secondary);
            border: 1px solid rgba(0, 0, 0, 0.06);
            border-radius: 12px;
            animation: fadeIn 0.5s ease-out;
            box-shadow: 1px 2px 6px rgba(0, 0, 0, 0.04);
        }

        @keyframes fadeIn {
        from {
                opacity: 0;
                transform: translateY(10px);
            }
        to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .profile-preview .activity-icon {
            font-size: 18px;
            flex-shrink: 0;
        }

        .profile-preview .activity-text {
            flex: 1;
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .profile-preview .activity-user {
            font-weight: 700;
            color: var(--text-primary);
        }

        .profile-preview .activity-time {
            font-size: 11px;
            color: var(--text-tertiary);
            font-weight: 600;
            flex-shrink: 0;
        }

        .profile-preview .activity-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 16px;
        }

        .profile-preview .stat-item {
            background: var(--bg-secondary);
            border: 1px solid rgba(0, 0, 0, 0.06);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            box-shadow: 1px 2px 6px rgba(0, 0, 0, 0.04);
        }

        .profile-preview .stat-number {
            font-size: 20px;
            font-weight: 900;
            color: var(--accent);
            margin-bottom: 4px;
        }

        .profile-preview .stat-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .profile-preview .merch-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 28px;
        }

        @media (min-width: 768px) {
        .profile-preview .merch-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .profile-preview .merch-card {
            background: rgba(253, 252, 251, 0.95);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 14px;
            overflow: hidden;
            border: 1px solid rgba(0, 0, 0, 0.06);
            transition: all 0.4s var(--ease-spring);
            cursor: pointer;
            box-shadow: 
                1px 3px 10px rgba(0, 0, 0, 0.07), 
                2px 6px 16px rgba(0, 0, 0, 0.05);
        }

        /* Subtle organic rotation - whisper-level tilt */
        .profile-preview .merch-card:nth-child(1) {
            transform: rotate(-0.1deg); background: rgba(253, 252, 251, 0.95); }
        .profile-preview .merch-card:nth-child(2) {
            transform: rotate(0.12deg); background: rgba(252, 253, 252, 0.95); }
        .profile-preview .merch-card:nth-child(3) {
            transform: rotate(-0.08deg); background: rgba(252, 252, 253, 0.95); }

        /* Keep cards white in ALL themes */
        .profile-preview[data-theme="dark"] .merch-card,
        .profile-preview[data-theme="contrast"] .merch-card {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(0, 0, 0, 0.15);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .profile-preview .merch-card:hover {
            transform: translateY(-4px) scale(1.006);
            background: rgba(255, 255, 255, 1);
            box-shadow: 
                2px 10px 24px rgba(0, 0, 0, 0.14),
                4px 16px 32px rgba(0, 0, 0, 0.1);
            border-color: rgba(8, 145, 178, 0.25);
        }

        .profile-preview .merch-card:active {
            transform: translateY(-2px) scale(1.005);
            transition: all 0.15s var(--ease-smooth);
        }

        .profile-preview[data-theme="dark"] .merch-card:hover,
        .profile-preview[data-theme="contrast"] .merch-card:hover {
            background: rgba(255, 255, 255, 1);
            border-color: rgba(8, 145, 178, 0.4);
            box-shadow: 
                0 12px 24px rgba(8, 145, 178, 0.2),
                0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .profile-preview .merch-image {
            width: 100%;
            aspect-ratio: 3 / 1;
            background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%);
            position: relative;
            overflow: hidden;
        }

        .profile-preview .merch-image::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
        0% {
            left: -100%; }
        100% {
            left: 100%; }
        }

        .profile-preview .merch-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .profile-preview .badge-new {
            background: var(--success);
            color: white;
        }

        .profile-preview .badge-limited {
            background: var(--warning);
            color: white;
        }

        .profile-preview .badge-sale {
            background: var(--error);
            color: white;
        }

        .profile-preview .badge-affiliate {
            background: #8b5cf6;
            color: white;
        }

        .profile-preview .affiliate-notice {
            font-size: 11px;
            color: var(--text-tertiary);
            margin-top: 6px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .profile-preview .affiliate-icon {
            font-size: 10px;
        }

        .profile-preview .stock-indicator {
            position: absolute;
            bottom: 8px;
            left: 8px;
            right: 8px;
            padding: 6px 10px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            border-radius: 6px;
            font-size: 11px;
            font-weight: 800;
            color: white;
            text-align: center;
        }

        .profile-preview .merch-info {
            padding: 6px 10px 8px 10px;
        }

        .profile-preview .merch-name {
            font-size: 12px;
            font-weight: 800;
            margin-bottom: 2px;
            line-height: 1.3;
            letter-spacing: -0.2px;
        }

        .profile-preview .merch-desc {
            font-size: 10px;
            color: var(--text-tertiary);
            margin-bottom: 4px;
        }

        .profile-preview .merch-price-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .profile-preview .merch-price {
            font-size: 20px;
            font-weight: 900;
            color: var(--accent);
        }

        .profile-preview .merch-price-old {
            font-size: 14px;
            color: var(--text-tertiary);
            text-decoration: line-through;
            margin-left: 6px;
        }

        .profile-preview .merch-size-selector {
            display: flex;
            gap: 6px;
            margin-bottom: 10px;
        }

        .profile-preview .size-btn {
            flex: 1;
            padding: 6px;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .profile-preview .size-btn:hover {
            border-color: var(--accent);
        }

        .profile-preview .size-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .profile-preview .size-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .profile-preview .add-to-cart-btn {
            width: 100%;
            padding: 11px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .profile-preview .add-to-cart-btn:hover {
            background: var(--accent-hover);
            transform: scale(1.02);
        }

        .profile-preview .add-to-cart-btn.added {
            background: var(--success);
        }

        .profile-preview .cart-button {
            position: absolute;
            bottom: 28px;
            left: 28px;
            width: 56px;
            height: 56px;
            background: var(--accent);
            border: none;
            border-radius: 50%;
            box-shadow: 0 12px 24px rgba(8, 145, 178, 0.3);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 98;
            font-size: 24px;
            transition: all 0.3s ease;
            color: white;
            border: 2px solid var(--bg-primary);
        }

        .profile-preview .cart-button:hover {
            transform: scale(1.1);
            box-shadow: 0 16px 32px rgba(8, 145, 178, 0.4);
        }

        .profile-preview .cart-button::before {
            content: 'ðŸ›’';
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
        }

        .profile-preview .cart-count {
            position: absolute;
            top: -4px;
            right: -4px;
            width: 24px;
            height: 24px;
            background: var(--error);
            color: white;
            border-radius: 50%;
            font-size: 12px;
            font-weight: 900;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--bg-primary);
        }

        .profile-preview .cart-panel {
            position: absolute;
            top: 0;
            right: -100%;
            width: 100%;
            max-width: 400px;
            height: 100vh;
            background: var(--bg-secondary);
            box-shadow: -4px 0 20px rgba(0, 0, 0, 0.1);
            z-index: 1001;
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .profile-preview .cart-panel.open {
            right: 0;
        }

        .profile-preview .cart-header {
            padding: 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .profile-preview .cart-title {
            font-size: 22px;
            font-weight: 900;
        }

        .profile-preview .cart-close {
            width: 36px;
            height: 36px;
            background: var(--bg-tertiary);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-weight: 700;
        }

        .profile-preview .cart-items {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .profile-preview .cart-item {
            display: flex;
            gap: 14px;
            padding: 16px;
            background: var(--bg-primary);
            border-radius: 12px;
            margin-bottom: 12px;
        }

        .profile-preview .cart-item-image {
            width: 70px;
            height: 70px;
            border-radius: 8px;
            background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%);
            flex-shrink: 0;
        }

        .profile-preview .cart-item-info {
            flex: 1;
        }

        .profile-preview .cart-item-name {
            font-size: 15px;
            font-weight: 800;
            margin-bottom: 4px;
        }

        .profile-preview .cart-item-size {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-bottom: 6px;
        }

        .profile-preview .cart-item-price {
            font-size: 16px;
            font-weight: 800;
            color: var(--accent);
        }

        .profile-preview .cart-item-remove {
            background: none;
            border: none;
            color: var(--text-tertiary);
            cursor: pointer;
            font-size: 18px;
            padding: 4px;
        }

        .profile-preview .cart-empty {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-tertiary);
        }

        .profile-preview .cart-empty-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .profile-preview .cart-footer {
            padding: 24px;
            border-top: 1px solid var(--border);
            background: var(--bg-primary);
        }

        .profile-preview .cart-total {
            display: flex;
            justify-content: space-between;
            margin-bottom: 16px;
            font-size: 20px;
            font-weight: 900;
        }

        .profile-preview .cart-checkout {
            width: 100%;
            padding: 16px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 900;
            cursor: pointer;
        }

        .profile-preview .community-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        @media (max-width: 500px) {
        .profile-preview .community-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .profile-preview .stat-card {
            background: var(--bg-secondary);
            padding: 16px 12px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid var(--border);
        }

        .profile-preview .stat-number {
            font-size: 22px;
            font-weight: 900;
            color: var(--text-primary);
            margin-bottom: 2px;
            letter-spacing: -0.5px;
        }

        .profile-preview .stat-label {
            font-size: 11px;
            color: var(--text-tertiary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .profile-preview .social-links {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 16px;
        }

        .profile-preview .social-link {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            text-decoration: none;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .profile-preview .social-link:hover {
            transform: translateY(-2px);
            border-color: var(--accent);
            background: var(--accent-soft);
        }

        .profile-preview .artists-grid {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            overflow-y: hidden;
            padding-bottom: 12px;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
            scrollbar-color: var(--border) transparent;
        }

        .profile-preview .artists-grid::-webkit-scrollbar {
            height: 6px;
        }

        .profile-preview .artists-grid::-webkit-scrollbar-track {
            background: transparent;
        }

        .profile-preview .artists-grid::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        .profile-preview .artists-grid::-webkit-scrollbar-thumb:hover {
            background: var(--text-tertiary);
        }

        .profile-preview .artist-card {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--border);
            transition: all 0.35s var(--ease-spring);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            min-width: 160px;
            max-width: 160px;
            scroll-snap-align: start;
            flex-shrink: 0;
        }

        .profile-preview[data-theme="contrast"] .artist-card {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
        }

        .profile-preview .artist-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.1),
                0 2px 4px rgba(0, 0, 0, 0.06);
            border-color: var(--accent);
        }

        .profile-preview .artist-card:active {
            transform: translateY(-2px) scale(1.01);
            transition: all 0.1s var(--ease-smooth);
        }

        .profile-preview .artist-avatar {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            background: linear-gradient(135deg, #06b6d4 0%, #8b5cf6 100%);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: 900;
            color: white;
            margin-bottom: 12px;
        }

        .profile-preview .artist-info {
            flex: 1;
            min-width: 0;
            width: 100%;
        }

        .profile-preview .artist-card-name {
            font-size: 14px;
            font-weight: 800;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            line-height: 1.3;
        }

        .profile-preview .artist-card-name svg {
            flex-shrink: 0;
        }

        .profile-preview .artist-genre {
            font-size: 11px;
            color: var(--text-tertiary);
            margin-bottom: 12px;
            line-height: 1.3;
        }

        .profile-preview .artist-listeners {
            display: none;
        }

        .profile-preview .artist-follow-btn {
            padding: 8px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-primary);
            white-space: nowrap;
            width: 100%;
        }

        .profile-preview .artist-follow-btn:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        /* Progress Bar */
        .profile-preview .progress-bar {
            position: absolute;
            top: 0;
            left: 0;
            width: 0%;
            height: 3px;
            background: linear-gradient(90deg, var(--accent) 0%, #06b6d4 50%, var(--accent) 100%);
            background-size: 200% 100%;
            z-index: 101;
            opacity: 0;
            transition: opacity 0.3s ease, width 0.1s ease-out;
            animation: shimmer 2s linear infinite;
        }

        .profile-preview .progress-bar.visible {
            opacity: 1;
        }

        @keyframes shimmer {
        0% {
            background-position: 200% 0; }
        100% {
            background-position: -200% 0; }
        }

        /* Quick Action Buttons */
        .profile-preview .quick-actions {
            position: absolute;
            bottom: 100px;
            right: 28px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 97;
        }

        .profile-preview .quick-action-btn {
            width: 52px;
            height: 52px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.2s ease;
            position: relative;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .profile-preview .quick-action-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
            background: var(--bg-tertiary);
        }

        .profile-preview .quick-action-btn.pulse {
            animation: pulse-attention 2s ease-in-out infinite;
        }

        @keyframes pulse-attention {
        0%,
        100% {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); }
        50% {
            box-shadow: 0 4px 20px rgba(8, 145, 178, 0.4); }
        }

        .profile-preview .quick-action-btn .tooltip {
            position: absolute;
            right: 64px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease, transform 0.2s ease;
            transform: translateX(10px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border);
        }

        .profile-preview .quick-action-btn:hover .tooltip {
            opacity: 1;
            transform: translateX(0);
        }

        .profile-preview .quick-action-btn.saved {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }

        /* Section Navigation Dots */
        .profile-preview .section-nav {
            position: absolute;
            right: 28px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 16px;
            z-index: 96;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .profile-preview .section-nav.visible {
            opacity: 1;
        }

        @media (max-width: 767px) {
        .profile-preview .section-nav {
                display: none;
            }
        }

        .profile-preview .section-dot {
            width: 12px;
            height: 12px;
            background: var(--border);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .profile-preview .section-dot:hover {
            transform: scale(1.3);
            background: var(--text-tertiary);
        }

        .profile-preview .section-dot.active {
            background: var(--accent);
            transform: scale(1.2);
        }

        .profile-preview .section-dot .dot-label {
            position: absolute;
            right: 24px;
            top: 50%;
            transform: translateY(-50%) translateX(10px);
            background: var(--bg-secondary);
            color: var(--text-primary);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 700;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease, transform 0.2s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border);
        }

        .profile-preview .section-dot:hover .dot-label {
            opacity: 1;
            transform: translateY(-50%) translateX(0);
        }

        /* Sticky Audio Preview Player */
        .profile-preview .audio-player {
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 100;
            transform: scale(0);
            transition: transform 0.4s var(--ease-spring);
        }

        .profile-preview .audio-player.visible {
            transform: scale(1);
        }

        .profile-preview .audio-player-orb {
            width: 64px;
            height: 64px;
            background: var(--bg-secondary);
            border-radius: 50%;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15), 0 0 0 0 rgba(8, 145, 178, 0.4);
            border: 2px solid var(--border);
            cursor: pointer;
            transition: all 0.3s var(--ease-spring);
            position: relative;
            overflow: hidden;
        }

        .profile-preview .audio-player.playing .audio-player-orb {
            animation: orb-pulse 2s ease-in-out infinite;
        }

        @keyframes orb-pulse {
        0%,
        100% {
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15), 0 0 0 0 rgba(8, 145, 178, 0.4); }
        50% {
            box-shadow: 0 4px 32px rgba(8, 145, 178, 0.3), 0 0 0 8px rgba(8, 145, 178, 0.1); }
        }

        .profile-preview .audio-player-orb:hover {
            transform: scale(1.05);
        }

        .profile-preview .audio-player.expanded .audio-player-orb {
            width: 280px;
            height: auto;
            border-radius: 16px;
        }

        .profile-preview .audio-player-orb-inner {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px;
        }

        /* Collapsed state - just the cover */
        .profile-preview .audio-cover-mini {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .profile-preview .audio-player.expanded .audio-cover-mini {
            display: none;
        }

        /* Expanded state - full controls */
        .profile-preview .audio-player-expanded {
            display: none;
            width: 100%;
        }

        .profile-preview .audio-player.expanded .audio-player-expanded {
            display: block;
        }

        .profile-preview .audio-player-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .profile-preview .audio-cover {
            width: 44px;
            height: 44px;
            border-radius: 8px;
            background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .profile-preview .audio-cover-pulse {
            position: absolute;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            animation: cover-pulse 1.5s ease-in-out infinite;
            opacity: 0;
            pointer-events: none;
        }

        .profile-preview .audio-player.playing .audio-cover-pulse,
        .profile-preview .audio-player.playing .audio-cover-mini .audio-cover-pulse {
            opacity: 1;
        }

        @keyframes cover-pulse {
        0%,
        100% {
            transform: scale(0.8); opacity: 0; }
        50% {
            transform: scale(1.3); opacity: 0.6; }
        }

        .profile-preview .audio-cover-icon {
            font-size: 18px;
            z-index: 1;
        }

        .profile-preview .audio-info {
            flex: 1;
            min-width: 0;
        }

        .profile-preview .audio-track-name {
            font-size: 13px;
            font-weight: 800;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .profile-preview .audio-artist-name {
            font-size: 11px;
            color: var(--text-tertiary);
            font-weight: 600;
        }

        .profile-preview .audio-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }

        .profile-preview .audio-play-btn {
            width: 36px;
            height: 36px;
            background: var(--accent);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .profile-preview .audio-play-btn:hover {
            transform: scale(1.08);
            background: var(--accent-hover);
        }

        .profile-preview .audio-play-btn svg {
            fill: white;
            width: 14px;
            height: 14px;
        }

        .profile-preview .audio-play-btn .pause-icon {
            display: none;
        }

        .profile-preview .audio-player.playing .audio-play-btn .play-icon {
            display: none;
        }

        .profile-preview .audio-player.playing .audio-play-btn .pause-icon {
            display: block;
        }

        .profile-preview .audio-waveform-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .profile-preview .audio-waveform {
            height: 28px;
            display: flex;
            align-items: center;
            gap: 2px;
            cursor: pointer;
            position: relative;
        }

        .profile-preview .waveform-bar {
            flex: 1;
            background: var(--border);
            border-radius: 2px;
            transition: background 0.1s ease;
            min-width: 2px;
        }

        .profile-preview .waveform-bar.active {
            background: var(--accent);
        }

        .profile-preview .waveform-bar.current {
            background: var(--accent);
            box-shadow: 0 0 8px rgba(8, 145, 178, 0.5);
        }

        .profile-preview .audio-time {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: var(--text-tertiary);
            font-weight: 700;
            font-variant-numeric: tabular-nums;
        }

        .profile-preview .audio-close {
            width: 24px;
            height: 24px;
            background: var(--bg-tertiary);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: var(--text-tertiary);
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .profile-preview .audio-close:hover {
            background: var(--border);
            color: var(--text-primary);
            transform: scale(1.1);
        }

        .profile-preview .audio-preview-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--warning);
            color: white;
            font-size: 8px;
            font-weight: 900;
            padding: 2px 5px;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Adjust other fixed elements when player is visible */
        .profile-preview .audio-visible .cart-button {
            bottom: 100px;
        }

        .profile-preview .audio-visible .theme-toggle {
            bottom: 100px;
        }

        .profile-preview .audio-visible .quick-actions {
            bottom: 172px;
        }

        /* Hide on very small screens, show simplified */
        @media (max-width: 400px) {
        .profile-preview .audio-waveform-container {
                display: none;
            }
        }

        /* â”€â”€ CTA Dashboard Tab Improvements â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .cta-info-strip {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            padding: 10px 14px;
            background: rgba(8,145,178,0.06);
            border: 1px solid rgba(8,145,178,0.15);
            border-radius: 10px;
            font-size: 12.5px;
            color: var(--text-secondary);
            margin-bottom: 14px;
            line-height: 1.5;
        }
        .cta-mode-bar {
            display: flex;
            gap: 6px;
            margin-bottom: 14px;
            flex-wrap: wrap;
            align-items: center;
        }
        .cta-mode-btn {
            padding: 5px 13px;
            border-radius: 20px;
            border: 1.5px solid var(--border);
            background: transparent;
            color: var(--text-secondary);
            font-size: 11.5px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.18s ease;
            letter-spacing: 0.01em;
        }
        .cta-mode-btn.active {
            border-color: var(--accent);
            background: var(--accent-soft);
            color: var(--accent);
        }
        .cta-mode-btn:hover:not(.active) {
            border-color: var(--text-tertiary);
            color: var(--text-primary);
        }
        .cta-drag-hint {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-bottom: 12px;
            font-style: italic;
        }
        .cta-position-pill {
            font-size: 9px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            padding: 2px 7px;
            border-radius: 5px;
            display: inline-block;
        }
        .cta-position-pill.primary {
            background: rgba(8,145,178,0.15);
            color: var(--accent);
        }
        .cta-position-pill.secondary {
            background: rgba(8,145,178,0.07);
            color: var(--text-secondary);
        }
        .cta-position-pill.quicklink {
            background: var(--bg-tertiary);
            color: var(--text-tertiary);
        }
        .cta-url-dot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
            display: inline-block;
            flex-shrink: 0;
        }
        .cta-url-dot.has-url { background: #22c55e; }
        .cta-url-dot.no-url { background: #f59e0b; }
        .cta-icon-thumb {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 19px;
            flex-shrink: 0;
        }
        .cta-icon-thumb.primary-thumb {
            background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%);
        }
        .cta-icon-thumb.inactive-thumb {
            background: var(--bg-tertiary);
            filter: grayscale(1);
            opacity: 0.55;
        }
        .cta-icon-thumb.default-thumb {
            background: var(--bg-tertiary);
        }
        .cta-category-header {
            font-size: 11px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: var(--text-tertiary);
            margin-bottom: 10px;
            padding-bottom: 7px;
            border-bottom: 1px solid var(--border);
        }
        .cta-lib-btn {
            font-size: 12.5px;
            padding: 8px 13px;
            border-radius: 8px;
            border: 1.5px solid var(--border);
            background: var(--bg-secondary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.18s ease;
            font-weight: 600;
        }
        .cta-lib-btn:hover {
            border-color: var(--accent);
            background: var(--accent-soft);
            color: var(--accent);
        }
        .cta-lib-btn.added {
            border-color: #22c55e;
            background: rgba(34,197,94,0.08);
            color: #22c55e;
            pointer-events: none;
        }

        /* â”€â”€ Action Links tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        /* Profile diagram */
        .al-diagram {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .al-diagram-title {
            font-size: 11px; font-weight: 800; text-transform: uppercase;
            letter-spacing: 0.07em; color: var(--text-tertiary);
            margin-bottom: 14px; text-align: center;
        }
        .al-diagram-phone {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 16px 14px 14px;
            max-width: 280px;
            margin: 0 auto;
        }
        .al-diagram-name {
            font-size: 15px; font-weight: 900; margin-bottom: 12px;
            color: var(--text-primary); text-align: center;
        }
        .al-diagram-slot {
            position: relative;
            margin-bottom: 8px;
        }
        .al-diagram-mock-btn {
            width: 100%; padding: 11px 16px; border-radius: 10px;
            font-size: 13px; font-weight: 800; text-align: center;
            pointer-events: none; border: none;
        }
        .al-diagram-mock-btn.primary {
            background: var(--accent);
            color: #fff;
        }
        .al-diagram-mock-btn.secondary {
            background: transparent;
            border: 2px solid var(--border) !important;
            color: var(--text-primary);
        }
        .al-diagram-badge {
            position: absolute;
            right: -10px; top: 50%; transform: translateY(-50%);
            background: var(--accent); color: #fff;
            font-size: 9px; font-weight: 900;
            padding: 2px 6px; border-radius: 20px;
            letter-spacing: 0.05em; white-space: nowrap;
        }
        .al-diagram-pills-row {
            display: flex; gap: 5px; flex-wrap: wrap; margin-top: 10px;
            padding-top: 10px; border-top: 1px solid var(--border);
            position: relative;
        }
        .al-diagram-pills-badge {
            position: absolute; right: -10px; top: 50%; transform: translateY(-50%);
            background: #22c55e; color: #fff;
            font-size: 9px; font-weight: 900;
            padding: 2px 6px; border-radius: 20px;
            letter-spacing: 0.05em; white-space: nowrap;
        }
        .quick-link-pill-demo {
            display: inline-flex; align-items: center; gap: 5px;
            padding: 5px 10px;
            background: var(--bg-secondary); border: 1.5px solid var(--border);
            border-radius: 20px; font-size: 12px; font-weight: 700;
            color: var(--text-primary); white-space: nowrap;
        }
        /* Hero buttons inline form */
        .al-mode-tabs {
            display: flex; gap: 4px; margin-bottom: 16px; flex-wrap: wrap;
        }
        .al-mode-tab {
            padding: 6px 12px; border-radius: 8px; border: 1.5px solid var(--border);
            background: transparent; font-size: 12px; font-weight: 700;
            cursor: pointer; transition: all 0.15s; color: var(--text-secondary);
        }
        .al-mode-tab.active {
            border-color: var(--accent); background: var(--accent-soft);
            color: var(--accent);
        }
        .al-hero-slot {
            margin-bottom: 16px;
            padding: 14px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
        }
        .al-hero-slot-label {
            font-size: 10px; font-weight: 800; text-transform: uppercase;
            letter-spacing: 0.07em; margin-bottom: 10px;
            display: flex; align-items: center; gap: 7px;
        }
        .al-slot-badge {
            display: inline-block; padding: 2px 7px; border-radius: 20px;
            font-size: 9px; font-weight: 900;
        }
        .al-slot-badge.primary { background: var(--accent); color: #fff; }
        .al-slot-badge.secondary { background: var(--bg-tertiary); color: var(--text-secondary); border: 1px solid var(--border); }
        .al-hero-slot-preview {
            display: block; width: 100%; padding: 10px 14px;
            border-radius: 9px; font-size: 14px; font-weight: 800;
            text-align: center; margin-bottom: 10px; pointer-events: none;
            border: none;
        }
        .al-hero-slot-preview.primary-preview { background: var(--accent); color: #fff; }
        .al-hero-slot-preview.secondary-preview {
            background: transparent; border: 2px solid var(--border) !important;
            color: var(--text-primary);
        }
        /* Add button at bottom of action links list */
        .ql-add-btn {
            display: block; width: 100%; padding: 13px; margin-top: 14px;
            border: 2px dashed var(--border); border-radius: 10px;
            background: transparent; color: var(--accent);
            font-size: 14px; font-weight: 700; cursor: pointer;
            transition: all 0.15s; text-align: center;
        }
        .ql-add-btn:hover { border-color: var(--accent); background: var(--accent-soft); }
        /* Pill-style list item */
        .ql-item-pill {
            display: inline-flex; align-items: center; gap: 5px;
            padding: 5px 12px; background: var(--bg-tertiary);
            border: 1.5px solid var(--border); border-radius: 20px;
            font-size: 13px; font-weight: 700; color: var(--text-primary);
            max-width: 240px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
        }
        .ql-item-pill.no-url-pill { border-color: #f59e0b; }
        .ql-item-url-status {
            font-size: 11px; margin-top: 4px;
            display: flex; align-items: center; gap: 5px;
        }
        /* URL status lines */
        .al-url-ok {
            font-size: 11px; color: var(--text-tertiary);
            display: flex; align-items: center; gap: 4px;
            overflow: hidden; white-space: nowrap; text-overflow: ellipsis; max-width: 200px;
        }
        .al-url-missing {
            font-size: 11px; color: #f59e0b;
            display: flex; align-items: center; gap: 4px; font-weight: 600;
        }
        /* Action Links search/filter */
        .al-search-wrap { position: relative; margin-bottom: 12px; }
        .al-search-icon {
            position: absolute; left: 10px; top: 50%; transform: translateY(-50%);
            color: var(--text-tertiary); font-size: 13px; pointer-events: none; line-height: 1;
        }
        .al-search-input {
            width: 100%; padding: 9px 12px 9px 32px;
            background: var(--bg-secondary); border: 1.5px solid var(--border);
            border-radius: var(--radius-lg); font-size: 13px; font-family: inherit;
            color: var(--text-primary); transition: border-color 0.15s; box-sizing: border-box;
        }
        .al-search-input:focus { outline: none; border-color: var(--accent); }
        .al-search-input::placeholder { color: var(--text-tertiary); }
        .al-search-input::-webkit-search-cancel-button { cursor: pointer; }
        /* Add Link Modal */
        .add-link-modal-content {
            background: var(--bg-primary); border-radius: 20px;
            padding: 24px; width: 100%; max-width: 500px;
            max-height: 90vh; overflow-y: auto;
        }
        .ql-modal-preview {
            display: flex; align-items: center; gap: 12px;
            padding: 12px 16px; background: var(--bg-secondary);
            border-radius: 10px; margin-bottom: 20px;
        }
        .ql-preview-label {
            font-size: 11px; font-weight: 700; text-transform: uppercase;
            letter-spacing: 0.05em; color: var(--text-tertiary); white-space: nowrap;
        }
        .ql-popular-label {
            font-size: 11px; font-weight: 700; text-transform: uppercase;
            letter-spacing: 0.06em; color: var(--text-tertiary); margin-bottom: 10px;
        }
        .ql-popular-grid {
            display: grid; grid-template-columns: repeat(4, 1fr);
            gap: 7px; margin-bottom: 4px;
        }
        .ql-popular-tile {
            display: flex; flex-direction: column; align-items: center;
            gap: 4px; padding: 10px 4px; border: 1.5px solid var(--border);
            border-radius: 10px; background: var(--bg-secondary);
            cursor: pointer; transition: all 0.15s;
        }
        .ql-popular-tile:hover { border-color: var(--accent); background: var(--accent-soft); transform: translateY(-1px); }
        .ql-popular-tile.selected { border-color: var(--accent); background: var(--accent-soft); box-shadow: 0 0 0 3px var(--accent-soft); }
        .ql-tile-emoji { font-size: 22px; line-height: 1; }
        .ql-tile-label { font-size: 10px; font-weight: 700; color: var(--text-secondary); text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%; }
        .ql-show-more-btn {
            width: 100%; padding: 8px; margin: 8px 0 4px;
            background: transparent; border: 1px solid var(--border);
            border-radius: 8px; font-size: 12px; font-weight: 700;
            color: var(--text-tertiary); cursor: pointer; transition: all 0.15s;
        }
        .ql-show-more-btn:hover { border-color: var(--accent); color: var(--accent); }
        .ql-more-grid { display: none; margin-top: 8px; }
        .ql-more-grid.visible { display: block; }
        .ql-more-category { font-size: 10px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.06em; color: var(--text-tertiary); margin: 12px 0 6px; }
        .ql-more-chips { display: flex; flex-wrap: wrap; gap: 6px; }
        .ql-more-chip {
            padding: 6px 12px; border-radius: 20px; border: 1.5px solid var(--border);
            background: var(--bg-secondary); font-size: 12px; font-weight: 600;
            cursor: pointer; transition: all 0.15s; color: var(--text-primary);
        }
        .ql-more-chip:hover { border-color: var(--accent); background: var(--accent-soft); color: var(--accent); }
        .ql-divider {
            display: flex; align-items: center; gap: 10px;
            font-size: 12px; font-weight: 600; color: var(--text-tertiary); margin: 16px 0;
        }
        .ql-divider::before, .ql-divider::after { content: ''; flex: 1; height: 1px; background: var(--border); }
        .ql-form-row { display: flex; gap: 10px; align-items: flex-start; }

        /* â”€â”€ Streaming Player Widget â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .profile-preview .stream-player-widget {
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--bg-secondary);
            border-radius: 14px;
            padding: 12px 14px;
            margin-bottom: 14px;
            border: 1px solid var(--border);
            box-shadow: 0 2px 10px rgba(0,0,0,0.06);
            transition: box-shadow 0.2s ease;
        }
        .profile-preview .stream-player-widget:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }
        .profile-preview .stream-player-art {
            position: relative;
            flex-shrink: 0;
            width: 52px;
            height: 52px;
            border-radius: 9px;
            overflow: hidden;
        }
        .profile-preview .stream-art-bg {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
        }
        .profile-preview .stream-play-btn {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.4);
            border: none;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        .profile-preview .stream-player-widget:hover .stream-play-btn {
            opacity: 1;
        }
        .profile-preview .stream-player-info {
            flex: 1;
            min-width: 0;
        }
        .profile-preview .stream-track-name {
            font-size: 14px;
            font-weight: 800;
            letter-spacing: -0.2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 2px;
        }
        .profile-preview .stream-track-sub {
            font-size: 11.5px;
            color: var(--text-tertiary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 7px;
        }
        .profile-preview .stream-progress-bar {
            height: 3px;
            background: var(--border);
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 4px;
        }
        .profile-preview .stream-progress-fill {
            height: 100%;
            background: var(--accent);
            border-radius: 2px;
            width: 58%;
        }
        .profile-preview .stream-progress-times {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: var(--text-tertiary);
            font-weight: 600;
        }
        .profile-preview .stream-open-link {
            font-size: 11px;
            font-weight: 700;
            color: #1DB954;
            text-decoration: none;
            white-space: nowrap;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
            flex-shrink: 0;
            padding: 4px 6px;
            border-radius: 8px;
            transition: background 0.18s ease;
        }
        .profile-preview .stream-open-link:hover {
            background: rgba(29,185,84,0.1);
        }
        .profile-preview .stream-platforms-label {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: var(--text-tertiary);
            margin-bottom: 10px;
        }

        /* â”€â”€ Tour Section Improvements â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .profile-preview .tour-notify-chip {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            background: rgba(8,145,178,0.06);
            border: 1px solid rgba(8,145,178,0.15);
            border-radius: 10px;
            margin-bottom: 14px;
            font-size: 13px;
            color: var(--text-secondary);
        }
        .profile-preview .tour-notify-chip-text {
            flex: 1;
            font-weight: 600;
            font-size: 12.5px;
        }
        .profile-preview .tour-notify-chip-btn {
            font-size: 11.5px;
            padding: 5px 12px;
            border-radius: 8px;
            background: var(--accent);
            color: white;
            border: none;
            font-weight: 700;
            cursor: pointer;
            flex-shrink: 0;
            transition: opacity 0.18s;
        }
        .profile-preview .tour-notify-chip-btn:hover { opacity: 0.85; }
        .profile-preview .tour-card-accent {
            position: absolute;
            left: 0; top: 0; bottom: 0;
            width: 3px;
            border-radius: 14px 0 0 14px;
        }
        .profile-preview .tour-card-accent.accent-green { background: #22c55e; }
        .profile-preview .tour-card-accent.accent-orange { background: #f59e0b; }
        .profile-preview .tour-card-accent.accent-grey { background: var(--text-tertiary); opacity: 0.4; }
        .profile-preview .seat-bar {
            margin-top: 5px;
            height: 3px;
            background: rgba(245,158,11,0.2);
            border-radius: 2px;
            overflow: hidden;
        }
        .profile-preview .seat-bar-fill {
            height: 100%;
            background: #f59e0b;
            border-radius: 2px;
        }
        .profile-preview .tour-time-capacity {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Auto-State tab redesign */
        .as-status-bar { display:flex; align-items:center; justify-content:space-between; gap:12px; }
        .as-status-left { display:flex; align-items:center; gap:12px; }
        .as-mode-indicator { font-size:26px; line-height:1; }
        .as-mode-name { font-size:15px; font-weight:800; color:var(--text-primary); }
        .as-mode-sub { font-size:12px; color:var(--text-tertiary); margin-top:2px; }
        .as-countdown-chip { font-size:17px; font-weight:800; color:var(--accent); font-variant-numeric:tabular-nums; letter-spacing:-0.5px; }
        .as-date-input { font-size:16px !important; padding:16px !important; text-align:center; font-weight:600 !important; width:100%; }
        .as-date-helper { margin-top:8px; font-size:13px; color:var(--text-tertiary); text-align:center; }
        .as-how-it-works { background:var(--bg-tertiary); padding:12px 14px; border-radius:10px; display:grid; gap:7px; margin-top:12px; }
        .as-how-row { display:flex; align-items:center; gap:8px; font-size:12.5px; color:var(--text-secondary); line-height:1.4; }
        .as-how-dot { width:8px; height:8px; border-radius:50%; flex-shrink:0; }
        .as-how-dot.pre { background:#a78bfa; }
        .as-how-dot.live { background:#22c55e; }
        .as-how-dot.ever { background:#60a5fa; }
        .as-how-dot.gig { background:#f59e0b; }
        .as-mode-switcher { display:grid; grid-template-columns:1fr 1fr; gap:8px; }
        .as-mode-pill { display:flex; flex-direction:column; align-items:center; gap:5px; padding:12px 8px; border-radius:12px; border:1.5px solid var(--border); background:var(--bg-secondary); cursor:pointer; transition:all 0.15s; }
        .as-mode-pill:hover { border-color:var(--accent); background:var(--accent-soft); }
        .as-mode-pill.active { border-color:var(--accent); background:var(--accent-soft); }
        .as-pill-icon { font-size:22px; line-height:1; }
        .as-pill-label { font-size:11.5px; font-weight:700; color:var(--text-secondary); }
        .as-mode-pill.active .as-pill-label { color:var(--accent); }
        .as-timeline-card { display:flex; align-items:flex-start; gap:12px; padding:12px 14px; background:var(--bg-secondary); border-radius:12px; border:1.5px solid var(--border); transition:border-color 0.2s; }
        .as-timeline-card.current { border-color:var(--accent); background:var(--accent-soft); }
        .as-tc-icon { font-size:20px; flex-shrink:0; margin-top:1px; }
        .as-tc-body { flex:1; min-width:0; }
        .as-tc-title { font-size:14px; font-weight:700; color:var(--text-primary); }
        .as-tc-timing { font-size:11.5px; color:var(--accent); font-weight:600; margin:2px 0 4px; }
        .as-tc-desc { font-size:12px; color:var(--text-tertiary); line-height:1.4; }
        .as-tc-badge { display:inline-block; font-size:10px; font-weight:700; padding:2px 7px; border-radius:20px; background:var(--accent); color:#fff; margin-left:6px; vertical-align:middle; }

        /* â”€â”€ Analytics tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .analytics-range-bar { display:flex; gap:8px; margin-bottom:20px; flex-wrap:wrap; }
        .analytics-range-btn { font-size:13px; padding:8px 16px; }
        .analytics-metrics-grid { display:grid; grid-template-columns:repeat(2,1fr); gap:16px; margin-top:16px; }
        .analytics-metric-card { padding:16px; background:var(--bg-tertiary); border-radius:10px; }
        .analytics-metric-value { font-size:28px; font-weight:900; }
        .analytics-metric-label { font-size:13px; color:var(--text-tertiary); margin-top:4px; }
        .analytics-metric-trend { font-size:12px; margin-top:4px; }
        .analytics-metric-trend--up   { color:var(--success); }
        .analytics-metric-trend--flat { color:var(--text-tertiary); }
        .analytics-chart-wrap { padding:20px 0; }
        .analytics-legend { display:flex; flex-direction:column; gap:12px; }
        .analytics-legend-row { display:flex; justify-content:space-between; align-items:center; }
        .analytics-legend-left { display:flex; align-items:center; gap:8px; }
        .analytics-legend-dot { width:12px; height:12px; border-radius:2px; flex-shrink:0; }
        .analytics-legend-name { font-size:14px; font-weight:600; }
        .analytics-legend-right { display:flex; align-items:center; gap:8px; }
        .analytics-legend-pct { font-size:14px; font-weight:700; color:var(--text-secondary); }
        .analytics-legend-visits { font-size:13px; color:var(--text-tertiary); }
        .analytics-traffic-grid { display:grid; grid-template-columns:1fr 1fr; gap:24px; align-items:center; }
        .analytics-header-title { display:flex; align-items:center; gap:12px; }
        .analytics-demo-badge { background:rgba(8,145,178,0.15); color:var(--accent); padding:4px 10px; border-radius:6px; font-size:14px; font-weight:700; }
        .analytics-subtitle { font-size:14px; color:var(--text-secondary); margin-bottom:16px; }

        /* â”€â”€ Share tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .share-url-row { display:flex; gap:8px; }
        .share-url-row .form-input { flex:1; }
        .share-direct-links { display:flex; flex-direction:column; gap:8px; }
        .share-qr-section { display:flex; flex-direction:column; align-items:center; padding:24px; }
        .share-qr-placeholder { width:200px; height:200px; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); border-radius:12px; margin-bottom:16px; }
        .share-qr-actions { display:flex; gap:8px; }
        .share-social-grid { display:grid; grid-template-columns:repeat(2,1fr); gap:8px; }
        .share-advanced { display:flex; flex-direction:column; gap:8px; }

        /* â”€â”€ Supporters tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .supporters-metrics { display:grid; grid-template-columns:repeat(2,1fr); gap:16px; margin-top:16px; }
        .supporters-metric-value { font-size:24px; font-weight:900; }
        .supporters-metric-label { font-size:12px; color:var(--text-tertiary); display:flex; align-items:center; gap:4px; }
        .supporters-demo-tag { background:rgba(16,185,129,0.15); color:var(--success); padding:2px 6px; border-radius:4px; font-size:10px; font-weight:700; }
        .supporters-demo-tag--accent { background:rgba(8,145,178,0.15); color:var(--accent); }
        .tip-amount { font-size:16px; font-weight:900; color:var(--success); }
        .supporter-avatar { width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center; color:white; font-weight:900; font-size:14px; flex-shrink:0; }
        .tier-icon { width:48px; height:48px; border-radius:8px; display:flex; align-items:center; justify-content:center; color:white; font-size:20px; flex-shrink:0; }

        /* â”€â”€ Settings tab â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .card--danger { border:2px solid rgba(239,68,68,0.3); background:rgba(239,68,68,0.03); }
        .card-title--danger { color:var(--error); display:flex; align-items:center; gap:8px; }
        .settings-plan-price { font-size:14px; color:var(--text-secondary); margin-bottom:12px; margin-top:16px; }
        .settings-plan-actions { display:flex; gap:8px; }
        .danger-zone-desc { font-size:12px; color:var(--text-secondary); margin-bottom:16px; margin-top:8px; padding:8px 12px; background:rgba(239,68,68,0.05); border-radius:6px; }
        .timeline-cta-arrow { opacity:0.7; font-size:18px; }
        .checklist-list { display:grid; gap:8px; }

        /* â”€â”€ Modal streaming input rows â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .stream-input-row { position:relative; }
        .stream-prefix { position:absolute; left:14px; top:50%; transform:translateY(-50%); font-size:12px; font-weight:800; z-index:1; pointer-events:none; letter-spacing:-0.5px; }
        .stream-input-row .form-input { padding-left:42px; }
        .stream-links-stack { display:flex; flex-direction:column; gap:8px; }
        .release-title-row { display:grid; grid-template-columns:1fr auto; gap:12px; margin-bottom:16px; }
        .release-type-select { width:auto; min-width:100px; cursor:pointer; }
        .display-mode-grid { display:grid; grid-template-columns:1fr 1fr; gap:8px; }
        .display-mode-icon { font-size:20px; margin-bottom:4px; }
        .display-mode-label { font-weight:700; font-size:13px; }
        .display-mode-sub { font-size:11px; color:var(--text-tertiary); margin-top:2px; }
        .form-label-row { display:flex; align-items:center; justify-content:space-between; margin-bottom:10px; }
        .btn-small { padding:6px 12px; font-size:12px; min-height:0; }
        .form-help { font-size:12px; color:var(--text-tertiary); margin-top:6px; }
        .tracks-list { display:flex; flex-direction:column; gap:6px; }
        .profile-form-actions { display:flex; gap:12px; margin-top:32px; }
        .profile-form-actions .btn-primary { flex:1; }
        .upload-label { font-size:14px; font-weight:600; margin-top:8px; }
        .upload-hint { font-size:12px; color:var(--text-tertiary); margin-top:4px; }
        .card--mt { margin-top:32px; }
        .press-kit-desc { font-size:14px; color:var(--text-secondary); margin-bottom:16px; line-height:1.6; }
        .cta-mode-label { font-size:10px; font-weight:800; text-transform:uppercase; letter-spacing:0.06em; color:var(--text-tertiary); align-self:center; }
        .mode-map-desc { font-size:13px; color:var(--text-tertiary); margin-bottom:14px; }
        .cta-search-wrap { margin-bottom:20px; }
        .cta-search-inner { position:relative; }
        .cta-search-inner .form-input { padding-right:80px; }
        .cta-search-clear { position:absolute; right:12px; top:50%; transform:translateY(-50%); background:transparent; border:none; color:var(--text-tertiary); cursor:pointer; font-size:18px; display:none; padding:4px 8px; }
        .cta-search-results { margin-top:8px; font-size:13px; color:var(--text-secondary); font-weight:600; }

        /* CTA Editor Modal */
        .cta-editor-content { background:var(--bg-secondary); border-radius:16px; padding:32px; max-width:500px; width:90%; box-shadow:0 20px 60px rgba(0,0,0,0.3); animation:slideUp 0.3s ease; }
        .cta-editor-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:24px; }
        .cta-editor-title { font-size:22px; font-weight:900; letter-spacing:-0.02em; }
        .modal-close-btn { width:36px; height:36px; border:none; background:var(--bg-tertiary); border-radius:8px; cursor:pointer; font-size:18px; transition:all 0.2s ease; }
        .cta-editor-actions { display:flex; gap:12px; margin-top:32px; }
        .cta-editor-actions .btn-primary { flex:1; }
        /* Confirm Modal */
        .confirm-modal-content { background:var(--bg-primary); border-radius:16px; max-width:420px; margin:20px; box-shadow:0 20px 60px rgba(0,0,0,0.3); animation:slideUp 0.3s ease; }
        .confirm-modal-body { padding:24px 24px 16px; }
        .confirm-modal-icon { font-size:48px; text-align:center; margin-bottom:16px; }
        .confirm-modal-title { font-size:18px; font-weight:700; text-align:center; margin-bottom:8px; color:var(--text-primary); }
        .confirm-modal-message { font-size:14px; color:var(--text-secondary); text-align:center; line-height:1.5; }
        .confirm-modal-footer { display:flex; gap:12px; padding:16px 24px 24px; border-top:1px solid var(--border); margin-top:16px; }
        .confirm-modal-footer .btn { flex:1; }
        .confirm-modal-footer .btn-danger { width:auto; }

    </style>
    <script>
        // In-memory localStorage polyfill for sandbox environments
        (function() {
            var store = {};
            var polyfill = {
                getItem: function(key) { return store.hasOwnProperty(key) ? store[key] : null; },
                setItem: function(key, value) { store[key] = String(value); },
                removeItem: function(key) { delete store[key]; },
                clear: function() { store = {}; },
                key: function(index) { return Object.keys(store)[index] || null; },
                get length() { return Object.keys(store).length; }
            };
            try {
                localStorage.setItem('__able_test__', '1');
                localStorage.removeItem('__able_test__');
            } catch(e) {
                Object.defineProperty(window, 'localStorage', { value: polyfill, writable: false });
            }
        })();
    </script>
</head>
<body>
    <div class="dashboard-container">
        <!-- Left Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo-lockup">
                    <div class="logo-mark">
                        <svg width="15" height="18" viewBox="0 0 15 18" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                            <defs>
                                <linearGradient id="ableSigGrad" x1="0" y1="0" x2="0" y2="18" gradientUnits="userSpaceOnUse">
                                    <stop offset="0%" stop-color="#06b6d4"/>
                                    <stop offset="100%" stop-color="#0891b2"/>
                                </linearGradient>
                            </defs>
                            <rect x="0"  y="10" width="3.5" height="8"  rx="1.75" fill="url(#ableSigGrad)" opacity="0.65"/>
                            <rect x="5.75" y="5"  width="3.5" height="13" rx="1.75" fill="url(#ableSigGrad)" opacity="0.82"/>
                            <rect x="11.5" y="0"  width="3.5" height="18" rx="1.75" fill="url(#ableSigGrad)"/>
                        </svg>
                    </div>
                    <div class="logo">able</div>
                </div>
                <div class="logo-tagline">artist before label</div>
                <div class="artist-name" id="sidebarArtistHandle">@mayarivers</div>
            </div>

            <nav class="nav-tabs">
                <div class="nav-tab active" data-tab="overview">
                    <span class="nav-tab-icon">ðŸ </span><span>Overview</span>
                </div>
                <div class="nav-tab" data-tab="profile">
                    <span class="nav-tab-icon">ðŸ‘¤</span><span>Profile</span>
                </div>
                <div class="nav-tab" data-tab="appearance">
                    <span class="nav-tab-icon">ðŸŽ¨</span><span>Appearance</span>
                </div>
                <div class="nav-tab" data-tab="platforms">
                    <span class="nav-tab-icon">ðŸ”—</span><span>Platforms</span>
                </div>
                <div class="nav-tab" data-tab="auto-state">
                    <span class="nav-tab-icon">âš¡</span><span>Auto-State</span>
                </div>
                <div class="nav-tab" data-tab="ctas">
                    <span class="nav-tab-icon">ðŸŽ¯</span><span>Action Links</span>
                </div>
                <div class="nav-tab" data-tab="music">
                    <span class="nav-tab-icon">ðŸŽµ</span><span>Music</span>
                </div>
                <div class="nav-tab" data-tab="videos">
                    <span class="nav-tab-icon">ðŸŽ¬</span><span>Videos</span>
                </div>
                <div class="nav-tab" data-tab="events">
                    <span class="nav-tab-icon">ðŸ“…</span><span>Events</span>
                </div>
                <div class="nav-tab" data-tab="merch">
                    <span class="nav-tab-icon">ðŸ›ï¸</span><span>Merch</span>
                </div>
                <div class="nav-tab" data-tab="supporters">
                    <span class="nav-tab-icon">ðŸ’</span><span>Supporters</span>
                </div>
                <div class="nav-tab" data-tab="analytics">
                    <span class="nav-tab-icon">ðŸ“ˆ</span><span>Analytics</span>
                </div>
                <div class="nav-tab" data-tab="share">
                    <span class="nav-tab-icon">ðŸ“¤</span><span>Share</span>
                </div>
                <div class="nav-tab" data-tab="feed">
                    <span class="nav-tab-icon">ðŸ“¢</span><span>Feed</span>
                </div>
                <div class="nav-tab" data-tab="settings">
                    <span class="nav-tab-icon">âš™ï¸</span><span>Settings</span>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="theme-toggle-group">
                    <button class="theme-toggle-btn active" onclick="setTheme('light')" id="theme-light">
                        â˜€ï¸ Light
                    </button>
                    <button class="theme-toggle-btn" onclick="setTheme('contrast')" id="theme-contrast">
                        ðŸŒ— Contrast
                    </button>
                    <button class="theme-toggle-btn" onclick="setTheme('dark')" id="theme-dark">
                        ðŸŒ™ Dark
                    </button>
                </div>
                <button class="view-site-btn" onclick="showToast('ðŸš€ Your page: able.to/maya-rivers (demo)')">
                    <span>ðŸ‘ï¸</span>
                    <span>View Live Site</span>
                </button>
                <button class="publish-btn" onclick="showToast('Page published successfully!')">
                    ðŸš€ Publish Page
                </button>
            </div>
        </aside>

        <!-- Editor Panel -->
        <main class="editor-panel">
            <!-- Overview Tab -->
            <div class="tab-content active" data-content="overview">
                <div class="editor-header">
                    <div class="overview-greeting" id="overviewGreeting">Good morning â˜€ï¸</div>
                    <h1 class="editor-title">Overview</h1>
                    <p class="editor-subtitle">Your page at a glance</p>
                </div>

                <!-- AUTO-STATE TIMELINE BANNER -->
                <div class="timeline-banner" id="timelineBanner">
                    <div class="timeline-banner-header">
                        <div class="timeline-banner-title">ðŸŽ¯ Your Profile Timeline</div>
                        <div class="timeline-banner-subtitle" id="timelineSubtitle">Able automatically adapts your profile based on your release schedule</div>
                    </div>
                    
                    <div class="timeline-steps" id="timelineSteps">
                        <!-- Dynamic timeline will be inserted here -->
                    </div>
                    
                    <button class="timeline-cta" onclick="switchTab('auto-state')">
                        <span>âš™ï¸ Configure Auto-State</span>
                        <span class="timeline-cta-arrow">â†’</span>
                    </button>
                </div>

                <div class="auto-banner">
                    <div class="auto-banner-title">ðŸš€ Speed up your setup</div>
                    <div class="auto-banner-text">Connect your platforms and let Able auto-build your page in seconds</div>
                    <div class="auto-banner-actions">
                        <button class="auto-banner-btn" onclick="switchTab('platforms')">Connect Platforms</button>
                        <button class="auto-banner-btn auto-banner-btn--soon" disabled>
                            Import from Linktree
                            <span class="soon-badge">SOON</span>
                        </button>
                    </div>
                </div>

                <!-- Getting Started Checklist -->
                <div class="card" id="gettingStartedCard">
                    <div class="card-header">
                        <span class="card-title"><span class="card-title-icon">ðŸš€</span> Getting Started</span>
                        <span class="badge badge-info" id="checklistBadge">0 of 5</span>
                    </div>
                    <div class="setup-progress-wrap">
                        <div class="setup-progress-header">
                            <span class="setup-progress-label">Setup progress</span>
                            <span class="setup-progress-pct" id="setupProgressPct">0%</span>
                        </div>
                        <div class="setup-progress-track">
                            <div class="setup-progress-fill" id="setupProgressFill"></div>
                        </div>
                    </div>
                    <div class="checklist-list" id="checklistContainer">

                        <div class="checklist-item" data-task="enabledCTA" onclick="switchTab('ctas')">
                            <div class="checklist-icon">1</div>
                            <div class="checklist-text">
                                <div class="checklist-title">Enable your first CTA</div>
                                <div class="checklist-sub">Turn on "Listen Now" or any button</div>
                            </div>
                            <span class="checklist-arrow">â€º</span>
                        </div>

                        <div class="checklist-item" data-task="addedCTA" onclick="switchTab('ctas')">
                            <div class="checklist-icon">2</div>
                            <div class="checklist-text">
                                <div class="checklist-title">Add a CTA from library</div>
                                <div class="checklist-sub">Choose from 37 pre-made buttons</div>
                            </div>
                            <span class="checklist-arrow">â€º</span>
                        </div>

                        <div class="checklist-item" data-task="setReleaseDate" onclick="switchTab('auto-state')">
                            <div class="checklist-icon">3</div>
                            <div class="checklist-text">
                                <div class="checklist-title">Set your release date</div>
                                <div class="checklist-sub">Enable automatic mode switching</div>
                            </div>
                            <span class="checklist-arrow">â€º</span>
                        </div>

                        <div class="checklist-item" data-task="choseTheme" onclick="switchTab('appearance')">
                            <div class="checklist-icon">4</div>
                            <div class="checklist-text">
                                <div class="checklist-title">Choose your theme</div>
                                <div class="checklist-sub">Pick colours, fonts and layout style</div>
                            </div>
                            <span class="checklist-arrow">â€º</span>
                        </div>

                        <div class="checklist-item" data-task="previewedPage" onclick="openMobilePreview(); markTaskComplete('previewedPage')">
                            <div class="checklist-icon">5</div>
                            <div class="checklist-text">
                                <div class="checklist-title">Preview your page</div>
                                <div class="checklist-sub">See how it looks to fans</div>
                            </div>
                            <span class="checklist-arrow">â€º</span>
                        </div>

                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title"><span class="card-title-icon">ðŸ“Š</span> Page Status</span>
                        <span class="badge badge-success">
                            <span>â—</span>
                            <span>Published</span>
                        </span>
                    </div>
                    <div class="stat-grid">
                        <div class="stat-tile">
                            <div class="stat-tile-tag teal">DEMO</div>
                            <div class="stat-tile-value" style="color: var(--accent);">1,247</div>
                            <div class="stat-tile-label">Views<br>This Week</div>
                        </div>
                        <div class="stat-tile">
                            <div class="stat-tile-tag green">DEMO</div>
                            <div class="stat-tile-value" style="color: var(--success);">87%</div>
                            <div class="stat-tile-label">Fan<br>Click Rate</div>
                        </div>
                        <div class="stat-tile">
                            <div class="stat-tile-tag teal">LIVE</div>
                            <div class="stat-tile-value" style="color: var(--text-primary);" id="activeLinkCount">â€”</div>
                            <div class="stat-tile-label">Active<br>Links</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title"><span class="card-title-icon">âš¡</span> Quick Actions</span>
                    </div>
                    <div class="quick-action-grid">
                        <button class="quick-action-tile" onclick="switchTab('music')">
                            <div class="quick-action-icon">ðŸŽµ</div>
                            <div class="quick-action-label">Add Track</div>
                        </button>
                        <button class="quick-action-tile" onclick="switchTab('events')">
                            <div class="quick-action-icon">ðŸŽ«</div>
                            <div class="quick-action-label">Add Event</div>
                        </button>
                        <button class="quick-action-tile" onclick="switchTab('share')">
                            <div class="quick-action-icon">ðŸ“±</div>
                            <div class="quick-action-label">Share Page</div>
                        </button>
                        <button class="quick-action-tile" onclick="switchTab('ctas')">
                            <div class="quick-action-icon">ðŸ”—</div>
                            <div class="quick-action-label">Edit CTAs</div>
                        </button>
                        <button class="quick-action-tile" onclick="switchTab('platforms')">
                            <div class="quick-action-icon">ðŸŽ§</div>
                            <div class="quick-action-label">Platforms</div>
                        </button>
                        <button class="quick-action-tile" onclick="switchTab('appearance')">
                            <div class="quick-action-icon">ðŸŽ¨</div>
                            <div class="quick-action-label">Appearance</div>
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title"><span class="card-title-icon">ðŸŽ¯</span> Current Mode</span>
                        <button class="card-action" onclick="switchTab('auto-state')">Configure</button>
                    </div>
                    <div class="mode-status-row">
                        <div class="mode-pulse-dot"></div>
                        <div class="mode-status-name" id="overviewModeName">âœ¨ Live Release</div>
                        <div class="mode-status-detail" id="overviewModeDetail">Auto</div>
                    </div>
                    <p style="font-size: 12px; color: var(--text-tertiary); line-height: 1.6;" id="overviewModeDesc">
                        Your page is live. Switches automatically based on your release schedule.
                    </p>
                </div>
            </div>

            <!-- Profile Tab -->
            <div class="tab-content" data-content="profile">
                <div class="editor-header">
                    <h1 class="editor-title">Profile</h1>
                    <p class="editor-subtitle">Edit your basic information</p>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <span>Artist Name</span>
                    </label>
                    <input 
                        type="text" 
                        class="form-input" 
                        id="artistName"
                        placeholder="Your artist name"
                        maxlength="50"
                        value="Maya Rivers"
                        oninput="updatePreviewArtistName(this.value); updateCharCounter('artistName', 50)"
                        onblur="validateProfileField(this, 'artistName')"
                    >
                    <div class="char-counter" id="artistNameCounter">11 / 50</div>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <span>Handle</span>
                        <span class="form-hint">able.to/</span>
                    </label>
                    <input 
                        type="text" 
                        class="form-input" 
                        id="handle"
                        placeholder="yourhandle"
                        maxlength="30"
                        value="maya"
                        onblur="validateProfileField(this, 'handle')"
                        style="text-transform: lowercase;"
                    >
                    <div class="char-counter" id="handleCounter">4 / 30</div>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <span>Profile Image</span>
                        <button class="card-action" onclick="document.getElementById('profileImageInput').click()">
                            Upload Image
                        </button>
                    </label>
                    <input type="file" id="profileImageInput" accept="image/*" style="display: none;" onchange="handleProfileImageUpload(this)">
                    <div class="image-upload" id="profileImagePreview" onclick="document.getElementById('profileImageInput').click()" style="cursor: pointer;">
                        <div class="upload-icon">ðŸ“·</div>
                        <div class="upload-label">Click to upload</div>
                        <div class="upload-hint">Recommended: 400x400px</div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <span>Bio</span>
                        <span class="form-hint" id="bioCounter">31 / 200</span>
                    </label>
                    <textarea 
                        class="form-textarea" 
                        id="bio"
                        placeholder="Tell your story..."
                        maxlength="200"
                        rows="4"
                        oninput="updatePreviewBio(this.value); updateCharCounter('bio', 200)"
                    >Indie soul artist â€¢ Los Angeles</textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input 
                        type="text" 
                        class="form-input" 
                        id="location"
                        placeholder="City, Country"
                        maxlength="50"
                    >
                </div>

                <div class="form-group">
                    <label class="form-label">Genres</label>
                    <input 
                        type="text" 
                        class="form-input" 
                        id="genres"
                        placeholder="Separate with commas (e.g., Indie Soul, Alternative R&B)"
                        maxlength="100"
                    >
                </div>

                <div class="profile-form-actions">
                    <button class="btn btn-primary" onclick="saveProfile()">Save Changes</button>
                    <button class="btn btn-secondary" onclick="resetProfile()">Reset</button>
                </div>

                <!-- Press Kit Generator -->
                <div class="card card--mt">
                    <div class="card-header">
                        <span class="card-title">ðŸ“„ Press Kit</span>
                    </div>
                    <p class="press-kit-desc">
                        Generate a professional press kit PDF with your bio, photos, stats, and contact info. Perfect for sending to media, venues, and promoters.
                    </p>
                    <button class="btn btn-primary btn-full" onclick="openPressKitModal()">
                        <span>ðŸ“¥</span>
                        <span>Generate Press Kit</span>
                    </button>
                </div>
            </div>

            <!-- Appearance Tab -->
            <div class="tab-content" data-content="appearance">
                <div class="editor-header">
                    <h1 class="editor-title">Appearance</h1>
                    <p class="editor-subtitle">Customize your profile's look and feel</p>
                </div>

                <!-- Sticky Section Navigation -->
                <div class="appearance-nav" id="appearanceNav">
                    <div class="appearance-nav-inner">
                        <a href="#section-colors" class="appearance-nav-link active" onclick="scrollToSection('section-colors', event)">
                            <span class="nav-icon">ðŸŽ¨</span>
                            <span>Colors</span>
                        </a>
                        <a href="#section-theme" class="appearance-nav-link" onclick="scrollToSection('section-theme', event)">
                            <span class="nav-icon">â˜€ï¸</span>
                            <span>Theme</span>
                        </a>
                        <a href="#section-typography" class="appearance-nav-link" onclick="scrollToSection('section-typography', event)">
                            <span class="nav-icon">Aa</span>
                            <span>Type</span>
                        </a>
                        <a href="#section-background" class="appearance-nav-link" onclick="scrollToSection('section-background', event)">
                            <span class="nav-icon">ðŸ“¸</span>
                            <span>Background</span>
                        </a>
                        <a href="#section-aesthetic" class="appearance-nav-link" onclick="scrollToSection('section-aesthetic', event)">
                            <span class="nav-icon">âœ¨</span>
                            <span>Aesthetic</span>
                        </a>
                        <a href="#section-effects" class="appearance-nav-link" onclick="scrollToSection('section-effects', event)">
                            <span class="nav-icon">ðŸŽ¬</span>
                            <span>Effects</span>
                        </a>
                    </div>
                    <button class="btn-reset-all" onclick="resetAllAppearance()">
                        <span>â†º</span>
                        <span>Reset All</span>
                    </button>
                </div>

                <!-- Section: Colors -->
                <div id="section-colors" class="appearance-section">

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">
                            <span class="card-title-icon">ðŸŽ¨</span>
                            Brand Colors
                        </span>
                    </div>
                    <p style="font-size: 14px; color: var(--text-tertiary); margin-bottom: 16px; line-height: 1.6;">
                        Choose a palette or pick a single color.
                    </p>
                    
                    <!-- Compact Palette Grid -->
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 16px;">
                        <!-- Ocean -->
                        <div class="palette-card active" data-palette="ocean" onclick="applyPalette('ocean', '#0891b2', '#06b6d4', '#67e8f9', this)" title="Ocean - Teal â€¢ Navy â€¢ Aqua">
                            <div class="palette-colors">
                                <div class="palette-dot" style="background: #0891b2; width: 20px; height: 20px;"></div>
                                <div class="palette-dot" style="background: #06b6d4; width: 20px; height: 20px;"></div>
                                <div class="palette-dot" style="background: #67e8f9; width: 20px; height: 20px;"></div>
                            </div>
                            <div class="palette-name" style="font-size: 11px;">Ocean</div>
                        </div>

                        <!-- Indie -->
                        <div class="palette-card" data-palette="indie-soul" onclick="applyPalette('indie-soul', '#d97706', '#f5e6d3', '#166534', this)" title="Indie Soul - Rust â€¢ Cream â€¢ Forest">
                            <div class="palette-colors">
                                <div class="palette-dot" style="background: #d97706; width: 20px; height: 20px;"></div>
                                <div class="palette-dot" style="background: #f5e6d3; width: 20px; height: 20px;"></div>
                                <div class="palette-dot" style="background: #166534; width: 20px; height: 20px;"></div>
                            </div>
                            <div class="palette-name" style="font-size: 11px;">Indie</div>
                        </div>

                        <!-- Hip-Hop -->
                        <div class="palette-card" data-palette="hiphop" onclick="applyPalette('hiphop', '#d4af37', '#1a1a1a', '#dc2626', this)" title="Hip-Hop - Gold â€¢ Black â€¢ Red">
                            <div class="palette-colors">
                                <div class="palette-dot" style="background: #d4af37; width: 20px; height: 20px;"></div>
                                <div class="palette-dot" style="background: #1a1a1a; width: 20px; height: 20px;"></div>
                                <div class="palette-dot" style="background: #dc2626; width: 20px; height: 20px;"></div>
                            </div>
                            <div class="palette-name" style="font-size: 11px;">Hip-Hop</div>
                        </div>

                        <!-- Neon -->
                        <div class="palette-card" data-palette="neon" onclick="applyPalette('neon', '#00ffff', '#ff00ff', '#ffff00', this)" title="Neon - Cyan â€¢ Magenta â€¢ Yellow">
                            <div class="palette-colors">
                                <div class="palette-dot" style="background: #00ffff; width: 20px; height: 20px;"></div>
                                <div class="palette-dot" style="background: #ff00ff; width: 20px; height: 20px;"></div>
                                <div class="palette-dot" style="background: #ffff00; width: 20px; height: 20px;"></div>
                            </div>
                            <div class="palette-name" style="font-size: 11px;">Neon</div>
                        </div>

                        <!-- Pop -->
                        <div class="palette-card" data-palette="pop" onclick="applyPalette('pop', '#ec4899', '#a855f7', '#f97316', this)" title="Pop - Pink â€¢ Purple â€¢ Orange">
                            <div class="palette-colors">
                                <div class="palette-dot" style="background: #ec4899; width: 20px; height: 20px;"></div>
                                <div class="palette-dot" style="background: #a855f7; width: 20px; height: 20px;"></div>
                                <div class="palette-dot" style="background: #f97316; width: 20px; height: 20px;"></div>
                            </div>
                            <div class="palette-name" style="font-size: 11px;">Pop</div>
                        </div>

                        <!-- Rock -->
                        <div class="palette-card" data-palette="rock" onclick="applyPalette('rock', '#ef4444', '#262626', '#f5f5f5', this)" title="Rock - Red â€¢ Charcoal â€¢ White">
                            <div class="palette-colors">
                                <div class="palette-dot" style="background: #ef4444; width: 20px; height: 20px;"></div>
                                <div class="palette-dot" style="background: #262626; width: 20px; height: 20px;"></div>
                                <div class="palette-dot" style="background: #f5f5f5; width: 20px; height: 20px;"></div>
                            </div>
                            <div class="palette-name" style="font-size: 11px;">Rock</div>
                        </div>

                        <!-- Jazz -->
                        <div class="palette-card" data-palette="jazz" onclick="applyPalette('jazz', '#1e3a8a', '#d4af37', '#991b1b', this)" title="Jazz - Navy â€¢ Gold â€¢ Burgundy">
                            <div class="palette-colors">
                                <div class="palette-dot" style="background: #1e3a8a; width: 20px; height: 20px;"></div>
                                <div class="palette-dot" style="background: #d4af37; width: 20px; height: 20px;"></div>
                                <div class="palette-dot" style="background: #991b1b; width: 20px; height: 20px;"></div>
                            </div>
                            <div class="palette-name" style="font-size: 11px;">Jazz</div>
                        </div>

                        <!-- R&B -->
                        <div class="palette-card" data-palette="rnb" onclick="applyPalette('rnb', '#7c3aed', '#e879f9', '#2563eb', this)" title="R&B - Purple â€¢ Rose â€¢ Blue">
                            <div class="palette-colors">
                                <div class="palette-dot" style="background: #7c3aed; width: 20px; height: 20px;"></div>
                                <div class="palette-dot" style="background: #e879f9; width: 20px; height: 20px;"></div>
                                <div class="palette-dot" style="background: #2563eb; width: 20px; height: 20px;"></div>
                            </div>
                            <div class="palette-name" style="font-size: 11px;">R&B</div>
                        </div>
                    </div>

                    <!-- Single Color Picker -->
                    <div style="border-top: 1px solid var(--border); padding-top: 16px;">
                        <div style="font-size: 12px; font-weight: 600; color: var(--text-secondary); margin-bottom: 8px;">Or pick a single color:</div>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <button class="color-preset" data-color="#0891b2" style="background: #0891b2;" onclick="setSingleColor('#0891b2', this)"></button>
                            <button class="color-preset" data-color="#8b5cf6" style="background: #8b5cf6;" onclick="setSingleColor('#8b5cf6', this)"></button>
                            <button class="color-preset" data-color="#ec4899" style="background: #ec4899;" onclick="setSingleColor('#ec4899', this)"></button>
                            <button class="color-preset" data-color="#f59e0b" style="background: #f59e0b;" onclick="setSingleColor('#f59e0b', this)"></button>
                            <button class="color-preset" data-color="#10b981" style="background: #10b981;" onclick="setSingleColor('#10b981', this)"></button>
                            <button class="color-preset" data-color="#ef4444" style="background: #ef4444;" onclick="setSingleColor('#ef4444', this)"></button>
                            <button class="color-preset custom" onclick="document.getElementById('customSingleColorPicker').click()" title="Custom color">+</button>
                        </div>
                        <input type="color" id="customSingleColorPicker" class="color-picker-input" value="#0891b2" onchange="setSingleColor(this.value)">
                    </div>
                </div>
                </div><!-- End Section: Colors -->

                <!-- Section: Theme -->
                <div id="section-theme" class="appearance-section">

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">
                            <span class="card-title-icon">â˜€ï¸</span>
                            Theme
                        </span>
                    </div>
                    <p style="font-size: 14px; color: var(--text-tertiary); margin-bottom: 20px; line-height: 1.6;">
                        Choose how you want the dashboard to appear. Your fans can switch between light and dark on your public profile.
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                        <button class="theme-option" onclick="setTheme('light'); updateThemeButtons('light')" data-theme="light">
                            <div class="theme-preview" style="background: linear-gradient(135deg, #f7f7f6 0%, #ffffff 100%);">
                                <div style="width: 20px; height: 20px; background: #0891b2; border-radius: 4px; margin: 8px;"></div>
                            </div>
                            <div class="theme-label">â˜€ï¸ Light</div>
                        </button>
                        <button class="theme-option active" onclick="setTheme('contrast'); updateThemeButtons('contrast')" data-theme="contrast">
                            <div class="theme-preview" style="background: linear-gradient(135deg, #2d2d2d 0%, #f7f7f6 100%);">
                                <div style="width: 20px; height: 20px; background: #0891b2; border-radius: 4px; margin: 8px;"></div>
                            </div>
                            <div class="theme-label">ðŸŒ— Contrast</div>
                        </button>
                        <button class="theme-option" onclick="setTheme('dark'); updateThemeButtons('dark')" data-theme="dark">
                            <div class="theme-preview" style="background: linear-gradient(135deg, #1a1918 0%, #2a2928 100%);">
                                <div style="width: 20px; height: 20px; background: #0891b2; border-radius: 4px; margin: 8px;"></div>
                            </div>
                            <div class="theme-label">ðŸŒ™ Dark</div>
                        </button>
                    </div>
                </div>
                </div><!-- End Section: Theme -->

                <!-- Section: Typography -->
                <div id="section-typography" class="appearance-section">

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">
                            <span class="card-title-icon">âšª</span>
                            Button Style
                        </span>
                    </div>
                    <p style="font-size: 14px; color: var(--text-tertiary); margin-bottom: 20px; line-height: 1.6;">
                        Choose the shape of your action buttons throughout your profile.
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                        <div class="button-style-option active" data-style="rounded" onclick="setButtonStyle('rounded', this)">
                            <div class="button-style-preview" style="border-radius: 12px;">Button</div>
                            <div class="button-style-label">Rounded</div>
                        </div>
                        <div class="button-style-option" data-style="sharp" onclick="setButtonStyle('sharp', this)">
                            <div class="button-style-preview" style="border-radius: 4px;">Button</div>
                            <div class="button-style-label">Sharp</div>
                        </div>
                        <div class="button-style-option" data-style="pill" onclick="setButtonStyle('pill', this)">
                            <div class="button-style-preview" style="border-radius: 100px;">Button</div>
                            <div class="button-style-label">Pill</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">
                            <span class="card-title-icon">Aa</span>
                            Typography
                        </span>
                    </div>
                    <p style="font-size: 14px; color: var(--text-tertiary); margin-bottom: 20px; line-height: 1.6;">
                        Choose the font style that matches your brand identity.
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                        <div class="font-option active" data-font="system-sans" onclick="setFontStyle('system-sans', this)">
                            <div class="font-preview" style="font-family: -apple-system, BlinkMacSystemFont, sans-serif;">Aa</div>
                            <div class="font-label">System Sans</div>
                            <div style="font-size: 11px; color: var(--text-tertiary); margin-top: 4px;">Modern & Clean</div>
                        </div>
                        <div class="font-option" data-font="rounded-sans" onclick="setFontStyle('rounded-sans', this)">
                            <div class="font-preview" style="font-family: ui-rounded, 'SF Pro Rounded', system-ui, sans-serif;">Aa</div>
                            <div class="font-label">Rounded Sans</div>
                            <div style="font-size: 11px; color: var(--text-tertiary); margin-top: 4px;">Friendly & Warm</div>
                        </div>
                        <div class="font-option" data-font="condensed-sans" onclick="setFontStyle('condensed-sans', this)">
                            <div class="font-preview" style="font-family: 'Arial Narrow', 'Helvetica Condensed', sans-serif; font-weight: 700;">Aa</div>
                            <div class="font-label">Condensed</div>
                            <div style="font-size: 11px; color: var(--text-tertiary); margin-top: 4px;">Bold & Compact</div>
                        </div>
                        <div class="font-option" data-font="classic-serif" onclick="setFontStyle('classic-serif', this)">
                            <div class="font-preview" style="font-family: Georgia, 'Times New Roman', serif;">Aa</div>
                            <div class="font-label">Classic Serif</div>
                            <div style="font-size: 11px; color: var(--text-tertiary); margin-top: 4px;">Elegant & Traditional</div>
                        </div>
                        <div class="font-option" data-font="modern-serif" onclick="setFontStyle('modern-serif', this)">
                            <div class="font-preview" style="font-family: 'Iowan Old Style', 'Palatino Linotype', serif;">Aa</div>
                            <div class="font-label">Modern Serif</div>
                            <div style="font-size: 11px; color: var(--text-tertiary); margin-top: 4px;">Sophisticated</div>
                        </div>
                        <div class="font-option" data-font="monospace" onclick="setFontStyle('monospace', this)">
                            <div class="font-preview" style="font-family: 'SF Mono', Monaco, 'Courier New', monospace;">Aa</div>
                            <div class="font-label">Monospace</div>
                            <div style="font-size: 11px; color: var(--text-tertiary); margin-top: 4px;">Technical & Edgy</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">
                            <span class="card-title-icon">ðŸ“¸</span>
                            Background
                        </span>
                    </div>
                    <p style="font-size: 14px; color: var(--text-tertiary); margin-bottom: 20px; line-height: 1.6;">
                        Choose a pattern or upload your own background image.
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px;">
                        <div class="background-option active" data-background="grain" onclick="setBackgroundPattern('grain', this)">
                            <div class="background-preview grain"></div>
                            <div class="background-label">Grain</div>
                        </div>
                        <div class="background-option" data-background="solid" onclick="setBackgroundPattern('solid', this)">
                            <div class="background-preview solid"></div>
                            <div class="background-label">Solid</div>
                        </div>
                        <div class="background-option" data-background="gradient" onclick="setBackgroundPattern('gradient', this)">
                            <div class="background-preview gradient"></div>
                            <div class="background-label">Gradient</div>
                        </div>
                        <div class="background-option" data-background="image" onclick="document.getElementById('backgroundImageUpload').click()">
                            <div class="background-preview" style="background: linear-gradient(135deg, rgba(0,0,0,0.7), rgba(0,0,0,0.3)), url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\"><text x=\"50%\" y=\"50%\" dominant-baseline=\"middle\" text-anchor=\"middle\" font-size=\"14\">ðŸ“·</text></svg>') center/cover;">
                            </div>
                            <div class="background-label">Image</div>
                        </div>
                    </div>
                    <input type="file" id="backgroundImageUpload" accept="image/*" style="display: none;" onchange="handleBackgroundImageUpload(event)">
                    
                    <!-- Advanced Background Controls (shown when image is active) -->
                    <div id="backgroundImageControls" style="display: none; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                            <h4 style="font-size: 14px; font-weight: 700; color: var(--text-primary);">ðŸ“¸ Background Image Settings</h4>
                            <button onclick="removeBackgroundImage()" style="padding: 6px 12px; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 6px; font-size: 11px; font-weight: 600; color: var(--error); cursor: pointer;">
                                Remove
                            </button>
                        </div>

                        <!-- Quick Presets -->
                        <div style="margin-bottom: 20px;">
                            <label style="font-size: 12px; font-weight: 600; color: var(--text-secondary); margin-bottom: 8px; display: block;">âš¡ Quick Presets</label>
                            <div class="preset-grid">
                                <button class="preset-btn" onclick="applyBackgroundPreset('subtle')" title="25% opacity, no effects - Clean and professional">
                                    <span class="preset-icon">ðŸŒ«ï¸</span>
                                    <span>Subtle</span>
                                </button>
                                <button class="preset-btn" onclick="applyBackgroundPreset('glass')" title="70% opacity + 10px blur + frosted cards - Modern glassmorphism">
                                    <span class="preset-icon">âœ¨</span>
                                    <span>Glass</span>
                                </button>
                                <button class="preset-btn" onclick="applyBackgroundPreset('bold')" title="90% opacity + saturated - Statement-making visual">
                                    <span class="preset-icon">ðŸŽ¨</span>
                                    <span>Bold</span>
                                </button>
                                <button class="preset-btn" onclick="applyBackgroundPreset('mono')" title="Grayscale + 5px blur - Sophisticated black & white">
                                    <span class="preset-icon">âš«</span>
                                    <span>Mono</span>
                                </button>
                            </div>
                        </div>

                        <!-- Opacity Slider -->
                        <div style="margin-bottom: 16px;">
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                                <label style="font-size: 12px; font-weight: 600; color: var(--text-secondary);">Opacity</label>
                                <span id="opacityValue" style="font-size: 12px; font-weight: 700; color: var(--accent);">50%</span>
                            </div>
                            <input type="range" id="backgroundOpacitySlider" min="0" max="100" value="50" 
                                   oninput="updateBackgroundControl('opacity', this.value)"
                                   class="bg-slider">
                            <div style="display: flex; justify-content: space-between; margin-top: 2px;">
                                <span style="font-size: 10px; color: var(--text-tertiary);">Transparent</span>
                                <span style="font-size: 10px; color: var(--text-tertiary);">Opaque</span>
                            </div>
                        </div>

                        <!-- Blur Slider -->
                        <div style="margin-bottom: 16px;">
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                                <label style="font-size: 12px; font-weight: 600; color: var(--text-secondary);">Blur</label>
                                <span id="blurValue" style="font-size: 12px; font-weight: 700; color: var(--accent);">0px</span>
                            </div>
                            <input type="range" id="backgroundBlurSlider" min="0" max="20" value="0" 
                                   oninput="updateBackgroundControl('blur', this.value)"
                                   class="bg-slider">
                            <div style="display: flex; justify-content: space-between; margin-top: 2px;">
                                <span style="font-size: 10px; color: var(--text-tertiary);">Sharp</span>
                                <span style="font-size: 10px; color: var(--text-tertiary);">Blurred</span>
                            </div>
                        </div>

                        <!-- Brightness Slider -->
                        <div style="margin-bottom: 16px;">
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                                <label style="font-size: 12px; font-weight: 600; color: var(--text-secondary);">Brightness</label>
                                <span id="brightnessValue" style="font-size: 12px; font-weight: 700; color: var(--accent);">100%</span>
                            </div>
                            <input type="range" id="backgroundBrightnessSlider" min="50" max="150" value="100" 
                                   oninput="updateBackgroundControl('brightness', this.value)"
                                   class="bg-slider">
                            <div style="display: flex; justify-content: space-between; margin-top: 2px;">
                                <span style="font-size: 10px; color: var(--text-tertiary);">Darker</span>
                                <span style="font-size: 10px; color: var(--text-tertiary);">Brighter</span>
                            </div>
                        </div>

                        <!-- Saturation Slider -->
                        <div style="margin-bottom: 16px;">
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                                <label style="font-size: 12px; font-weight: 600; color: var(--text-secondary);">Saturation</label>
                                <span id="saturationValue" style="font-size: 12px; font-weight: 700; color: var(--accent);">100%</span>
                            </div>
                            <input type="range" id="backgroundSaturationSlider" min="0" max="200" value="100" 
                                   oninput="updateBackgroundControl('saturation', this.value)"
                                   class="bg-slider">
                            <div style="display: flex; justify-content: space-between; margin-top: 2px;">
                                <span style="font-size: 10px; color: var(--text-tertiary);">Grayscale</span>
                                <span style="font-size: 10px; color: var(--text-tertiary);">Vibrant</span>
                            </div>
                        </div>

                        <!-- Position & Size -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                            <div>
                                <label style="font-size: 12px; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px; display: block;">Position</label>
                                <select id="backgroundPosition" onchange="updateBackgroundControl('position', this.value)" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-secondary); font-size: 12px; cursor: pointer;">
                                    <option value="center">Center</option>
                                    <option value="top">Top</option>
                                    <option value="bottom">Bottom</option>
                                    <option value="left">Left</option>
                                    <option value="right">Right</option>
                                </select>
                            </div>
                            <div>
                                <label style="font-size: 12px; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px; display: block;">Size</label>
                                <select id="backgroundSize" onchange="updateBackgroundControl('size', this.value)" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-secondary); font-size: 12px; cursor: pointer;">
                                    <option value="cover">Cover</option>
                                    <option value="contain">Contain</option>
                                    <option value="auto">Auto</option>
                                </select>
                            </div>
                        </div>

                        <!-- Glassmorphism Toggle -->
                        <div style="background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 8px; padding: 12px; margin-bottom: 12px;">
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <div>
                                    <div style="font-size: 13px; font-weight: 600; color: var(--text-primary); margin-bottom: 2px;">âœ¨ Glassmorphism Cards</div>
                                    <div style="font-size: 11px; color: var(--text-tertiary);">Frosted glass effect on cards</div>
                                </div>
                                <label class="switch" style="cursor: pointer;">
                                    <input type="checkbox" id="glassmorphismToggle" onchange="toggleGlassmorphism(this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>

                        <!-- Auto Readability Controls -->
                        <div style="background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 8px; padding: 12px; margin-bottom: 12px;">
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
                                <div>
                                    <div style="font-size: 13px; font-weight: 600; color: var(--text-primary); margin-bottom: 2px;">ðŸŽ¯ Auto Readability</div>
                                    <div style="font-size: 11px; color: var(--text-tertiary);">Hero scrim + frosted cards for legibility</div>
                                </div>
                                <label class="switch" style="cursor: pointer;">
                                    <input type="checkbox" id="autoReadabilityToggle" checked onchange="updateBackgroundControl('autoReadability', this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div id="readabilitySliders">
                                <div style="margin-bottom: 10px;">
                                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 6px;">
                                        <label style="font-size: 12px; font-weight: 600; color: var(--text-secondary);">Hero Scrim</label>
                                        <span id="overlayStrengthValue" style="font-size: 12px; font-weight: 700; color: var(--accent);">45%</span>
                                    </div>
                                    <input type="range" id="overlayStrengthSlider" min="0" max="80" value="45"
                                           oninput="updateBackgroundControl('overlayStrength', this.value)"
                                           class="bg-slider">
                                    <div style="display: flex; justify-content: space-between; margin-top: 2px;">
                                        <span style="font-size: 10px; color: var(--text-tertiary);">None</span>
                                        <span style="font-size: 10px; color: var(--text-tertiary);">Strong</span>
                                    </div>
                                </div>
                                <div>
                                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 6px;">
                                        <label style="font-size: 12px; font-weight: 600; color: var(--text-secondary);">Card Blur</label>
                                        <span id="overlayBlurValue" style="font-size: 12px; font-weight: 700; color: var(--accent);">12px</span>
                                    </div>
                                    <input type="range" id="overlayBlurSlider" min="0" max="16" value="12"
                                           oninput="updateBackgroundControl('overlayBlur', this.value)"
                                           class="bg-slider">
                                    <div style="display: flex; justify-content: space-between; margin-top: 2px;">
                                        <span style="font-size: 10px; color: var(--text-tertiary);">Sharp</span>
                                        <span style="font-size: 10px; color: var(--text-tertiary);">Blurred</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">
                            <span class="card-title-icon">âœ¨</span>
                            Profile Aesthetic
                        </span>
                    </div>
                    <p style="font-size: 14px; color: var(--text-tertiary); margin-bottom: 20px; line-height: 1.6;">
                        Choose a complete visual vibe that matches your music genre and personality.
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                        <div class="style-option active" data-aesthetic="default" onclick="setAesthetic('default', this)">
                            <div class="style-preview" style="background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%);"></div>
                            <div class="style-label">Default</div>
                            <div class="style-description">Clean & Modern</div>
                        </div>
                        <div class="style-option" data-aesthetic="vhs" onclick="setAesthetic('vhs', this)">
                            <div class="style-preview" style="background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%); position: relative;">
                                <div style="position: absolute; width: 100%; height: 2px; background: rgba(0,0,0,0.3); top: 20%; animation: scanline 2s linear infinite;"></div>
                            </div>
                            <div class="style-label">ðŸ“¼ VHS Retro</div>
                            <div class="style-description">80s Nostalgia</div>
                        </div>
                        <div class="style-option" data-aesthetic="brutalist" onclick="setAesthetic('brutalist', this)">
                            <div class="style-preview" style="background: #000; border: 3px solid #fff;"></div>
                            <div class="style-label">ðŸ“° Brutalist</div>
                            <div class="style-description">Bold & Stark</div>
                        </div>
                        <div class="style-option" data-aesthetic="glass" onclick="setAesthetic('glass', this)">
                            <div class="style-preview" style="background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.2) 100%); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.3);"></div>
                            <div class="style-label">âœ¨ Glassmorphism</div>
                            <div class="style-description">Frosted Glass</div>
                        </div>
                        <div class="style-option" data-aesthetic="film" onclick="setAesthetic('film', this)">
                            <div class="style-preview" style="background: linear-gradient(135deg, #d4a574 0%, #c09858 100%); filter: sepia(0.3);"></div>
                            <div class="style-label">ðŸŽžï¸ Film Grain</div>
                            <div class="style-description">Vintage Photo</div>
                        </div>
                        <div class="style-option" data-aesthetic="vaporwave" onclick="setAesthetic('vaporwave', this)">
                            <div class="style-preview" style="background: linear-gradient(135deg, #ff71ce 0%, #01cdfe 50%, #b967ff 100%);"></div>
                            <div class="style-label">ðŸŒˆ Vaporwave</div>
                            <div class="style-description">90s Internet</div>
                        </div>
                        <div class="style-option" data-aesthetic="punk" onclick="setAesthetic('punk', this)">
                            <div class="style-preview" style="background: #ff006e; transform: rotate(-2deg); border: 2px solid #000;"></div>
                            <div class="style-label">ðŸŽ¸ Punk/DIY</div>
                            <div class="style-description">Raw & Edgy</div>
                        </div>
                        <div class="style-option" data-aesthetic="luxury" onclick="setAesthetic('luxury', this)">
                            <div class="style-preview" style="background: linear-gradient(135deg, #d4af37 0%, #f4e4c1 100%);"></div>
                            <div class="style-label">ðŸ’Ž Luxury</div>
                            <div class="style-description">Minimal & Refined</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">
                            <span class="card-title-icon">ðŸŽ¬</span>
                            Animation Style
                        </span>
                    </div>
                    <p style="font-size: 14px; color: var(--text-tertiary); margin-bottom: 20px; line-height: 1.6;">
                        Control how elements move and transition on your profile.
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                        <div class="style-option active" data-animation="smooth" onclick="setAnimation('smooth', this)">
                            <div class="style-preview" style="background: var(--accent);"></div>
                            <div class="style-label">Smooth</div>
                            <div class="style-description">Gentle & Elegant</div>
                        </div>
                        <div class="style-option" data-animation="bouncy" onclick="setAnimation('bouncy', this)">
                            <div class="style-preview" style="background: var(--accent);"></div>
                            <div class="style-label">Bouncy</div>
                            <div class="style-description">Playful Spring</div>
                        </div>
                        <div class="style-option" data-animation="snappy" onclick="setAnimation('snappy', this)">
                            <div class="style-preview" style="background: var(--accent);"></div>
                            <div class="style-label">Snappy</div>
                            <div class="style-description">Quick & Direct</div>
                        </div>
                        <div class="style-option" data-animation="glitchy" onclick="setAnimation('glitchy', this)">
                            <div class="style-preview" style="background: var(--accent);"></div>
                            <div class="style-label">Glitchy</div>
                            <div class="style-description">Digital Stutter</div>
                        </div>
                        <div class="style-option" data-animation="none" onclick="setAnimation('none', this)">
                            <div class="style-preview" style="background: var(--text-tertiary);"></div>
                            <div class="style-label">None</div>
                            <div class="style-description">Instant & Fast</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">
                            <span class="card-title-icon">ðŸŽ´</span>
                            Card Style
                        </span>
                    </div>
                    <p style="font-size: 14px; color: var(--text-tertiary); margin-bottom: 20px; line-height: 1.6;">
                        Change how cards and action buttons are displayed.
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                        <div class="style-option active" data-cards="elevated" onclick="setCardStyle('elevated', this)">
                            <div class="style-preview" style="background: var(--bg-secondary); box-shadow: 0 4px 12px rgba(0,0,0,0.1);"></div>
                            <div class="style-label">Elevated</div>
                            <div class="style-description">Drop Shadow</div>
                        </div>
                        <div class="style-option" data-cards="flat" onclick="setCardStyle('flat', this)">
                            <div class="style-preview" style="background: var(--bg-secondary);"></div>
                            <div class="style-label">Flat</div>
                            <div class="style-description">Minimal</div>
                        </div>
                        <div class="style-option" data-cards="outlined" onclick="setCardStyle('outlined', this)">
                            <div class="style-preview" style="background: transparent; border: 2px solid var(--border);"></div>
                            <div class="style-label">Outlined</div>
                            <div class="style-description">Border Only</div>
                        </div>
                        <div class="style-option" data-cards="neumorphic" onclick="setCardStyle('neumorphic', this)">
                            <div class="style-preview" style="background: var(--bg-secondary); box-shadow: 4px 4px 8px rgba(0,0,0,0.1), -4px -4px 8px rgba(255,255,255,0.7);"></div>
                            <div class="style-label">Neumorphic</div>
                            <div class="style-description">Soft 3D</div>
                        </div>
                        <div class="style-option" data-cards="neon" onclick="setCardStyle('neon', this)">
                            <div class="style-preview" style="background: var(--bg-secondary); box-shadow: 0 0 20px var(--accent); border: 2px solid var(--accent);"></div>
                            <div class="style-label">Neon</div>
                            <div class="style-description">Glowing</div>
                        </div>
                        <div class="style-option" data-cards="handdrawn" onclick="setCardStyle('handdrawn', this)">
                            <div class="style-preview" style="background: var(--bg-secondary); border: 2px solid var(--text-primary); border-radius: 15px 5px 15px 5px;"></div>
                            <div class="style-label">Handdrawn</div>
                            <div class="style-description">Sketchy</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">
                            <span class="card-title-icon">â¬œ</span>
                            Corner Style
                        </span>
                    </div>
                    <p style="font-size: 14px; color: var(--text-tertiary); margin-bottom: 20px; line-height: 1.6;">
                        Adjust the roundness of corners throughout your profile.
                    </p>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                        <div class="style-option active" data-corners="rounded" onclick="setCornerStyle('rounded', this)">
                            <div class="style-preview" style="background: var(--accent); border-radius: 12px;"></div>
                            <div class="style-label">Rounded</div>
                            <div class="style-description">12px Radius</div>
                        </div>
                        <div class="style-option" data-corners="extra-rounded" onclick="setCornerStyle('extra-rounded', this)">
                            <div class="style-preview" style="background: var(--accent); border-radius: 24px;"></div>
                            <div class="style-label">Extra Rounded</div>
                            <div class="style-description">24px Radius</div>
                        </div>
                        <div class="style-option" data-corners="sharp" onclick="setCornerStyle('sharp', this)">
                            <div class="style-preview" style="background: var(--accent); border-radius: 0;"></div>
                            <div class="style-label">Sharp</div>
                            <div class="style-description">No Radius</div>
                        </div>
                        <div class="style-option" data-corners="mixed" onclick="setCornerStyle('mixed', this)">
                            <div class="style-preview" style="background: var(--accent); border-radius: 4px;"><div style="width: 30px; height: 15px; background: rgba(0,0,0,0.2); border-radius: 10px; margin: auto;"></div></div>
                            <div class="style-label">Mixed</div>
                            <div class="style-description">Asymmetric</div>
                        </div>
                        <div class="style-option" data-corners="organic" onclick="setCornerStyle('organic', this)">
                            <div class="style-preview" style="background: var(--accent); border-radius: 20px 5px 20px 5px;"></div>
                            <div class="style-label">Organic</div>
                            <div class="style-description">Playful</div>
                        </div>
                    </div>
                </div>

                <div class="card" style="background: var(--bg-tertiary); border: 2px dashed var(--border);">
                    <div class="card-header">
                        <span class="card-title">Custom CSS</span>
                        <span class="badge badge-warning">Pro</span>
                    </div>
                    <p style="font-size: 14px; color: var(--text-tertiary); margin-bottom: 0; line-height: 1.6;">
                        Add custom CSS for advanced styling control. Available on Pro plan.
                    </p>
                </div>
            </div>
            </div>

            <!-- Platforms Tab -->
            <div class="tab-content" data-content="platforms">
                <div class="editor-header">
                    <h1 class="editor-title">Platforms</h1>
                    <p class="editor-subtitle">Add your profile URLs â€” they'll appear as streaming pills and social links on your profile</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Music & Streaming</span>
                    </div>
                    <div class="platform-list" id="platformMusicList">
                        <!-- rendered by JS -->
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Social</span>
                    </div>
                    <div class="platform-list" id="platformSocialList">
                        <!-- rendered by JS -->
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Commerce & Ticketing</span>
                    </div>
                    <div class="platform-list" id="platformCommerceList">
                        <!-- rendered by JS -->
                    </div>
                </div>
            </div>

            <!-- Auto-State Tab -->
            <div class="tab-content" data-content="auto-state">
                <div class="editor-header">
                    <h1 class="editor-title">Auto-State</h1>
                    <p class="editor-subtitle">Your page adapts automatically to your release cycle</p>
                </div>

                <!-- Live status bar -->
                <div class="card as-status-bar">
                    <div class="as-status-left">
                        <div class="as-mode-indicator" id="asModeIndicator">â–¶ï¸</div>
                        <div>
                            <div class="as-mode-name" id="asModeLabel">Live Release</div>
                            <div class="as-mode-sub" id="autoStatus">Auto-State active</div>
                        </div>
                    </div>
                    <div style="text-align:right; flex-shrink:0;">
                        <div class="as-countdown-chip" id="countdownTime">â€”</div>
                        <div style="font-size:10px; color:var(--text-tertiary); margin-top:2px; white-space:nowrap;">until release</div>
                    </div>
                </div>

                <!-- Master toggle -->
                <div class="card">
                    <div class="switch-group" onclick="toggleAutoMode(this)">
                        <div class="switch-info">
                            <div class="switch-label">Auto-update my page</div>
                            <div class="switch-help">Page switches modes based on your release date</div>
                        </div>
                        <div class="switch active"></div>
                    </div>
                </div>

                <!-- Release date -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Release Date</span>
                    </div>
                    <input
                        type="date"
                        class="form-input as-date-input"
                        id="releaseDate"
                        onchange="setReleaseDate(this.value)"
                        required
                    >
                    <div id="releaseDateHelper" class="as-date-helper">Select your release date to activate Auto-State</div>
                    <div class="as-how-it-works">
                        <div class="as-how-row"><span class="as-how-dot pre"></span><span>Before date â†’ <strong>Pre-Release</strong> (pre-save, countdown)</span></div>
                        <div class="as-how-row"><span class="as-how-dot live"></span><span>Release day + 7 â†’ <strong>Live</strong> (Listen Now)</span></div>
                        <div class="as-how-row"><span class="as-how-dot ever"></span><span>8+ days after â†’ <strong>Evergreen</strong> (standard profile)</span></div>
                        <div class="as-how-row"><span class="as-how-dot gig"></span><span>Manual â†’ <strong>Gig Night</strong> (venue + merch focus)</span></div>
                    </div>
                </div>

                <!-- Mode Preview Switcher -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Preview Modes</span>
                    </div>
                    <p style="font-size:13px; color:var(--text-tertiary); margin-bottom:12px;">Click to see what fans see in the right panel â†’</p>
                    <div class="as-mode-switcher">
                        <button class="as-mode-pill" data-as-mode="pre-release" onclick="switchPreviewMode('pre-release')">
                            <span class="as-pill-icon">ðŸ’¿</span>
                            <span class="as-pill-label">Pre-Release</span>
                        </button>
                        <button class="as-mode-pill active" data-as-mode="live" onclick="switchPreviewMode('live')">
                            <span class="as-pill-icon">â–¶ï¸</span>
                            <span class="as-pill-label">Live</span>
                        </button>
                        <button class="as-mode-pill" data-as-mode="evergreen" onclick="switchPreviewMode('evergreen')">
                            <span class="as-pill-icon">ðŸŒŸ</span>
                            <span class="as-pill-label">Evergreen</span>
                        </button>
                        <button class="as-mode-pill" data-as-mode="gig" onclick="switchPreviewMode('gig')">
                            <span class="as-pill-icon">ðŸŽ¤</span>
                            <span class="as-pill-label">Gig Night</span>
                        </button>
                    </div>
                </div>

                <!-- Timeline + Mode Cards (collapsible) -->
                <div class="card" style="background: var(--bg-secondary); border: 1px solid var(--border);">
                    <div style="display: flex; align-items: center; justify-content: space-between; cursor: pointer;" onclick="toggleTimeline()">
                        <div>
                            <div style="font-size: 14px; font-weight: 700; margin-bottom: 4px;">ðŸ“Š Mode Timeline</div>
                            <div style="font-size: 13px; color: var(--text-tertiary);">See exactly when your page switches</div>
                        </div>
                        <div id="timelineToggleIcon" style="font-size: 20px; transition: transform 0.3s ease;">â–¼</div>
                    </div>

                    <div id="timelineContent" style="display: none; margin-top: 24px; padding-top: 20px; border-top: 1px solid var(--border);">
                        <div id="autoStateTimeline"></div>

                        <div id="modeCards" style="margin-top: 20px; display: grid; gap: 10px;">
                            <div class="as-timeline-card" id="modeCard-pre-release">
                                <div class="as-tc-icon">ðŸ’¿</div>
                                <div class="as-tc-body">
                                    <div class="as-tc-title">Pre-Release</div>
                                    <div class="as-tc-timing">Before release date</div>
                                    <div class="as-tc-desc">Build hype with countdown and pre-save buttons</div>
                                </div>
                            </div>
                            <div class="as-timeline-card" id="modeCard-live">
                                <div class="as-tc-icon">â–¶ï¸</div>
                                <div class="as-tc-body">
                                    <div class="as-tc-title">Live Release</div>
                                    <div class="as-tc-timing">Release day â†’ +7 days</div>
                                    <div class="as-tc-desc">Celebrate the drop with Listen Now buttons everywhere</div>
                                </div>
                            </div>
                            <div class="as-timeline-card" id="modeCard-evergreen">
                                <div class="as-tc-icon">ðŸŒŸ</div>
                                <div class="as-tc-body">
                                    <div class="as-tc-title">Evergreen Profile</div>
                                    <div class="as-tc-timing">8+ days after release</div>
                                    <div class="as-tc-desc">Your standard profile â€” all music, tour dates, links</div>
                                </div>
                            </div>
                            <div class="as-timeline-card" id="modeCard-gig">
                                <div class="as-tc-icon">ðŸŽ¤</div>
                                <div class="as-tc-body">
                                    <div class="as-tc-title">Gig Night</div>
                                    <div class="as-tc-timing">Manual â€” activate on show nights</div>
                                    <div class="as-tc-desc">Venue info, setlist, and merch front and centre for live audiences</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mode Buttons Card -->
                <div class="card" id="modeButtonsCard">
                    <div class="card-header">
                        <span class="card-title">Mode Buttons</span>
                    </div>
                    <p style="font-size:13px; color:var(--text-tertiary); margin-bottom:16px;">Set the hero buttons fans see in each mode</p>

                    <!-- Pre-Release -->
                    <div style="margin-bottom:20px; padding-bottom:20px; border-bottom:1px solid var(--border);">
                        <div style="font-size:13px;font-weight:700;margin-bottom:10px;">ðŸ’¿ Pre-Release</div>
                        <div style="font-size:11px;text-transform:uppercase;font-weight:700;color:var(--text-tertiary);margin-bottom:6px;">Primary</div>
                        <div style="display:flex;gap:6px;margin-bottom:10px;">
                            <input type="text" class="form-input" style="width:56px;flex-shrink:0;" placeholder="ðŸ’¿" id="modeCTA_prerelease_primary_icon" maxlength="4" oninput="saveModeCTA('pre-release','primary','icon',this.value)">
                            <input type="text" class="form-input" style="flex:1;" placeholder="Pre-save on Spotify" id="modeCTA_prerelease_primary_text" oninput="saveModeCTA('pre-release','primary','text',this.value)">
                            <input type="url" class="form-input" style="flex:1;" placeholder="URL" id="modeCTA_prerelease_primary_url" oninput="saveModeCTA('pre-release','primary','url',this.value)">
                        </div>
                        <div style="font-size:11px;text-transform:uppercase;font-weight:700;color:var(--text-tertiary);margin-bottom:6px;">Secondary</div>
                        <div style="display:flex;gap:6px;">
                            <input type="text" class="form-input" style="width:56px;flex-shrink:0;" placeholder="ðŸ””" id="modeCTA_prerelease_secondary_icon" maxlength="4" oninput="saveModeCTA('pre-release','secondary','icon',this.value)">
                            <input type="text" class="form-input" style="flex:1;" placeholder="Get Notified" id="modeCTA_prerelease_secondary_text" oninput="saveModeCTA('pre-release','secondary','text',this.value)">
                            <input type="url" class="form-input" style="flex:1;" placeholder="URL" id="modeCTA_prerelease_secondary_url" oninput="saveModeCTA('pre-release','secondary','url',this.value)">
                        </div>
                    </div>

                    <!-- Live -->
                    <div style="margin-bottom:20px; padding-bottom:20px; border-bottom:1px solid var(--border);">
                        <div style="font-size:13px;font-weight:700;margin-bottom:10px;">â–¶ï¸ Live Release</div>
                        <div style="font-size:11px;text-transform:uppercase;font-weight:700;color:var(--text-tertiary);margin-bottom:6px;">Primary</div>
                        <div style="display:flex;gap:6px;margin-bottom:10px;">
                            <input type="text" class="form-input" style="width:56px;flex-shrink:0;" placeholder="â–¶ï¸" id="modeCTA_live_primary_icon" maxlength="4" oninput="saveModeCTA('live','primary','icon',this.value)">
                            <input type="text" class="form-input" style="flex:1;" placeholder="Listen Now" id="modeCTA_live_primary_text" oninput="saveModeCTA('live','primary','text',this.value)">
                            <input type="url" class="form-input" style="flex:1;" placeholder="URL" id="modeCTA_live_primary_url" oninput="saveModeCTA('live','primary','url',this.value)">
                        </div>
                        <div style="font-size:11px;text-transform:uppercase;font-weight:700;color:var(--text-tertiary);margin-bottom:6px;">Secondary</div>
                        <div style="display:flex;gap:6px;">
                            <input type="text" class="form-input" style="width:56px;flex-shrink:0;" placeholder="ðŸŽ«" id="modeCTA_live_secondary_icon" maxlength="4" oninput="saveModeCTA('live','secondary','icon',this.value)">
                            <input type="text" class="form-input" style="flex:1;" placeholder="Get Tickets" id="modeCTA_live_secondary_text" oninput="saveModeCTA('live','secondary','text',this.value)">
                            <input type="url" class="form-input" style="flex:1;" placeholder="URL" id="modeCTA_live_secondary_url" oninput="saveModeCTA('live','secondary','url',this.value)">
                        </div>
                    </div>

                    <!-- Evergreen -->
                    <div style="margin-bottom:20px; padding-bottom:20px; border-bottom:1px solid var(--border);">
                        <div style="font-size:13px;font-weight:700;margin-bottom:10px;">ðŸŒŸ Evergreen</div>
                        <div style="font-size:11px;text-transform:uppercase;font-weight:700;color:var(--text-tertiary);margin-bottom:6px;">Primary</div>
                        <div style="display:flex;gap:6px;margin-bottom:10px;">
                            <input type="text" class="form-input" style="width:56px;flex-shrink:0;" placeholder="ðŸŽµ" id="modeCTA_evergreen_primary_icon" maxlength="4" oninput="saveModeCTA('evergreen','primary','icon',this.value)">
                            <input type="text" class="form-input" style="flex:1;" placeholder="Listen on Spotify" id="modeCTA_evergreen_primary_text" oninput="saveModeCTA('evergreen','primary','text',this.value)">
                            <input type="url" class="form-input" style="flex:1;" placeholder="URL" id="modeCTA_evergreen_primary_url" oninput="saveModeCTA('evergreen','primary','url',this.value)">
                        </div>
                        <div style="font-size:11px;text-transform:uppercase;font-weight:700;color:var(--text-tertiary);margin-bottom:6px;">Secondary</div>
                        <div style="display:flex;gap:6px;">
                            <input type="text" class="form-input" style="width:56px;flex-shrink:0;" placeholder="ðŸ“…" id="modeCTA_evergreen_secondary_icon" maxlength="4" oninput="saveModeCTA('evergreen','secondary','icon',this.value)">
                            <input type="text" class="form-input" style="flex:1;" placeholder="Book a Show" id="modeCTA_evergreen_secondary_text" oninput="saveModeCTA('evergreen','secondary','text',this.value)">
                            <input type="url" class="form-input" style="flex:1;" placeholder="URL" id="modeCTA_evergreen_secondary_url" oninput="saveModeCTA('evergreen','secondary','url',this.value)">
                        </div>
                    </div>

                    <!-- Gig -->
                    <div>
                        <div style="font-size:13px;font-weight:700;margin-bottom:10px;">ðŸŽ¤ Gig Night</div>
                        <div style="font-size:11px;text-transform:uppercase;font-weight:700;color:var(--text-tertiary);margin-bottom:6px;">Primary</div>
                        <div style="display:flex;gap:6px;margin-bottom:10px;">
                            <input type="text" class="form-input" style="width:56px;flex-shrink:0;" placeholder="ðŸŽ«" id="modeCTA_gig_primary_icon" maxlength="4" oninput="saveModeCTA('gig','primary','icon',this.value)">
                            <input type="text" class="form-input" style="flex:1;" placeholder="Get Tickets" id="modeCTA_gig_primary_text" oninput="saveModeCTA('gig','primary','text',this.value)">
                            <input type="url" class="form-input" style="flex:1;" placeholder="URL" id="modeCTA_gig_primary_url" oninput="saveModeCTA('gig','primary','url',this.value)">
                        </div>
                        <div style="font-size:11px;text-transform:uppercase;font-weight:700;color:var(--text-tertiary);margin-bottom:6px;">Secondary</div>
                        <div style="display:flex;gap:6px;">
                            <input type="text" class="form-input" style="width:56px;flex-shrink:0;" placeholder="â–¶ï¸" id="modeCTA_gig_secondary_icon" maxlength="4" oninput="saveModeCTA('gig','secondary','icon',this.value)">
                            <input type="text" class="form-input" style="flex:1;" placeholder="Listen Now" id="modeCTA_gig_secondary_text" oninput="saveModeCTA('gig','secondary','text',this.value)">
                            <input type="url" class="form-input" style="flex:1;" placeholder="URL" id="modeCTA_gig_secondary_url" oninput="saveModeCTA('gig','secondary','url',this.value)">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Links Tab -->
            <div class="tab-content" data-content="ctas">
                <div class="editor-header">
                    <h1 class="editor-title">Action Links</h1>
                    <p class="editor-subtitle">Every button fans can tap on your profile</p>
                </div>

                <!-- Profile diagram â€” visual map of where each button lives -->
                <div class="al-diagram">
                    <div class="al-diagram-title">Your profile â€” tap a section to edit it</div>
                    <div class="al-diagram-phone">
                        <div class="al-diagram-name" id="diagramArtistName">Maya Rivers</div>
                        <div class="al-diagram-slot">
                            <button class="al-diagram-mock-btn primary" id="diagramPrimaryBtn" onclick="document.getElementById('heroButtonsCard').scrollIntoView({behavior:'smooth'})">â–¶ï¸ Listen Now</button>
                            <span class="al-diagram-badge">â‘  Primary CTA</span>
                        </div>
                        <div class="al-diagram-slot" style="margin-bottom:10px;">
                            <button class="al-diagram-mock-btn secondary" id="diagramSecondaryBtn" onclick="document.getElementById('heroButtonsCard').scrollIntoView({behavior:'smooth'})">ðŸŽ« Get Tickets</button>
                            <span class="al-diagram-badge" style="background:var(--text-secondary);">â‘¡ Secondary CTA</span>
                        </div>
                        <div class="al-diagram-pills-row" id="diagramPillsRow" onclick="document.getElementById('actionLinksCard').scrollIntoView({behavior:'smooth'})" style="cursor:pointer;">
                            <span class="quick-link-pill-demo">ðŸŸ¢ Spotify</span>
                            <span class="quick-link-pill-demo">ðŸ›’ Shop</span>
                            <span class="quick-link-pill-demo" style="color:var(--text-tertiary);">+ more</span>
                            <span class="al-diagram-pills-badge">â‘¢ Action Links</span>
                        </div>
                    </div>
                </div>

                <!-- â‘  Hero Buttons -->
                <div class="card" id="heroButtonsCard">
                    <div class="card-header">
                        <span class="card-title">â‘  Hero Buttons</span>
                    </div>
                    <p style="font-size:13px; color:var(--text-tertiary); margin-bottom:14px;">These 2 buttons sit at the top of your profile. Each mode (Pre-Release, Live, Gig, Evergreen) can have its own label and URL â€” fans always see the right one.</p>

                    <!-- Mode tabs -->
                    <div class="al-mode-tabs" id="heroModeTabs">
                        <button class="al-mode-tab" data-hero-mode="pre-release" onclick="switchHeroMode('pre-release')">ðŸ’¿ Pre-Release</button>
                        <button class="al-mode-tab active" data-hero-mode="live" onclick="switchHeroMode('live')">â–¶ï¸ Live</button>
                        <button class="al-mode-tab" data-hero-mode="evergreen" onclick="switchHeroMode('evergreen')">ðŸŒŸ Evergreen</button>
                        <button class="al-mode-tab" data-hero-mode="gig" onclick="switchHeroMode('gig')">ðŸŽ¤ Gig</button>
                    </div>

                    <!-- Primary slot -->
                    <div class="al-hero-slot">
                        <div class="al-hero-slot-label">
                            <span class="al-slot-badge primary">â‘  PRIMARY</span>
                            <span style="color:var(--text-secondary);">Main button â€” make it count</span>
                        </div>
                        <button class="al-hero-slot-preview primary-preview" id="heroSlotPrimaryPreview">â–¶ï¸ Listen Now</button>
                        <div class="ql-form-row">
                            <div class="form-group" style="width:68px;flex-shrink:0;margin-bottom:0;">
                                <label class="form-label">Icon</label>
                                <input type="text" id="heroSlotPrimaryIcon" class="form-input" style="text-align:center;font-size:18px;" maxlength="4" oninput="updateHeroSlotPreview('primary'); saveModeCTA(currentHeroMode,'primary','icon',this.value)">
                            </div>
                            <div class="form-group" style="flex:1;margin-bottom:0;">
                                <label class="form-label">Label</label>
                                <input type="text" id="heroSlotPrimaryText" class="form-input" placeholder="e.g. Listen Now" oninput="updateHeroSlotPreview('primary'); saveModeCTA(currentHeroMode,'primary','text',this.value)">
                            </div>
                        </div>
                        <div class="form-group" style="margin-top:8px;margin-bottom:0;">
                            <label class="form-label">URL <span style="font-weight:400;color:var(--text-tertiary);">â€” where it takes fans</span></label>
                            <input type="url" id="heroSlotPrimaryUrl" class="form-input" placeholder="https://..." oninput="saveModeCTA(currentHeroMode,'primary','url',this.value)">
                        </div>
                    </div>

                    <!-- Secondary slot -->
                    <div class="al-hero-slot" style="margin-bottom:0;">
                        <div class="al-hero-slot-label">
                            <span class="al-slot-badge secondary">â‘¡ SECONDARY</span>
                            <span style="color:var(--text-secondary);">Second option â€” upsell or alternative</span>
                        </div>
                        <button class="al-hero-slot-preview secondary-preview" id="heroSlotSecondaryPreview">ðŸŽ« Get Tickets</button>
                        <div class="ql-form-row">
                            <div class="form-group" style="width:68px;flex-shrink:0;margin-bottom:0;">
                                <label class="form-label">Icon</label>
                                <input type="text" id="heroSlotSecondaryIcon" class="form-input" style="text-align:center;font-size:18px;" maxlength="4" oninput="updateHeroSlotPreview('secondary'); saveModeCTA(currentHeroMode,'secondary','icon',this.value)">
                            </div>
                            <div class="form-group" style="flex:1;margin-bottom:0;">
                                <label class="form-label">Label</label>
                                <input type="text" id="heroSlotSecondaryText" class="form-input" placeholder="e.g. Get Tickets" oninput="updateHeroSlotPreview('secondary'); saveModeCTA(currentHeroMode,'secondary','text',this.value)">
                            </div>
                        </div>
                        <div class="form-group" style="margin-top:8px;margin-bottom:0;">
                            <label class="form-label">URL <span style="font-weight:400;color:var(--text-tertiary);">â€” where it takes fans</span></label>
                            <input type="url" id="heroSlotSecondaryUrl" class="form-input" placeholder="https://..." oninput="saveModeCTA(currentHeroMode,'secondary','url',this.value)">
                        </div>
                    </div>
                </div>

                <!-- â‘¢ Action Links (pills) -->
                <div class="card" id="actionLinksCard">
                    <div class="card-header">
                        <span class="card-title">â‘¢ Action Links</span>
                        <span class="badge badge-success" id="activeCTABadge">0 Active</span>
                    </div>
                    <p style="font-size:13px; color:var(--text-tertiary); margin-bottom:8px;">Extra buttons shown below the hero CTAs on every page view. Add a URL to each one, toggle it on, and drag to reorder.</p>

                    <!-- Search/filter â€” client-side only, does not affect saved data -->
                    <div class="al-search-wrap" id="ctaSearchWrap" style="display:none;">
                        <span class="al-search-icon">ðŸ”</span>
                        <input type="search" class="al-search-input" id="ctaSearchInput"
                               placeholder="Filter by labelâ€¦" autocomplete="off"
                               oninput="filterCTAList(this.value)">
                        <p id="ctaSearchNoResults" style="display:none;font-size:12px;color:var(--text-tertiary);margin:8px 0 0;text-align:center;">No links match that search.</p>
                    </div>

                    <!-- Empty state -->
                    <div id="ctaEmptyState" style="text-align:center; padding:20px 16px 4px;">
                        <div style="font-size:36px; margin-bottom:8px; line-height:1;">ðŸ’Š</div>
                        <div style="font-size:14px; font-weight:700; margin-bottom:6px;">No action links yet</div>
                        <div style="font-size:13px; color:var(--text-tertiary); margin-bottom:18px; max-width:260px; margin-left:auto; margin-right:auto;">Add Spotify, tickets, your shop, TikTok â€” anything fans click</div>
                        <button class="btn btn-primary" style="padding:11px 24px; font-size:14px;" onclick="openAddLinkModal()">+ Add Your First Link</button>
                    </div>

                    <!-- Populated list -->
                    <div id="ctaList"></div>

                    <!-- Add button -->
                    <button class="ql-add-btn" id="ctaAddBtn" style="display:none;" onclick="openAddLinkModal()">+ Add Action Link</button>

                    <!-- Utility row: reset defaults + undo (shown only after reset) -->
                    <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap;">
                        <button class="btn btn-secondary btn-small" onclick="resetActionLinksToDefaults()" title="Restore built-in links and default order â€” keeps your custom URLs">â†º Reset to defaults</button>
                        <button id="ctaUndoResetBtn" class="btn btn-secondary btn-small" style="display:none;" onclick="undoResetActionLinks()">â†© Undo reset</button>
                    </div>
                </div>
            </div>

            <!-- Music Tab -->
            <div class="tab-content" data-content="music">
                <div class="editor-header">
                    <h1 class="editor-title">Music</h1>
                    <p class="editor-subtitle">Manage your releases and streaming links</p>
                </div>

                <!-- Inline error banner â€” shown by render error handlers -->
                <div id="musicTabErrorBanner" style="display:none;margin-bottom:12px;padding:8px 12px;background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.3);border-radius:8px;color:#ef4444;font-size:12px;align-items:center;gap:8px;" role="alert">
                    <span id="musicTabErrorMsg" style="flex:1;min-width:0;"></span>
                    <button type="button" onclick="resetMusicUI()" style="flex-shrink:0;padding:3px 10px;border-radius:6px;border:1px solid #ef4444;background:transparent;color:#ef4444;font-size:11px;font-weight:600;cursor:pointer;white-space:nowrap;">Reset</button>
                </div>

                <!-- Releases list (populated by JS) -->
                <div id="musicReleaseList"></div>

                <!-- Music empty state (shown when no releases; hidden by JS when releases exist) -->
                <div class="card" id="musicEmptyState">
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸŽµ</div>
                        <div class="empty-state-title">No releases yet</div>
                        <div class="empty-state-text">Add your singles, EPs or albums. They'll appear on your profile with streaming links.</div>
                        <div class="empty-state-actions">
                            <button class="btn btn-primary" onclick="openAddReleaseModal(); document.getElementById('musicEmptyState').style.display='none'">
                                Add Your First Release
                            </button>
                            <span class="empty-state-divider">or</span>
                            <button class="btn btn-secondary" onclick="switchTab('platforms')">
                                Import from Spotify
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Add Release button (shown when releases exist) -->
                <button class="btn btn-outline" style="width: 100%; margin-bottom: 16px; display:none;" id="musicAddBtn" onclick="openAddReleaseModal()">
                    <span>+</span>
                    <span>Add Release</span>
                </button>

                <!-- Display settings -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Display Settings</span>
                    </div>
                    <div class="switch-group" onclick="toggleSwitch(this)">
                        <div class="switch-info">
                            <div class="switch-label">Show music section on profile</div>
                            <div class="switch-help">Toggle the entire music section visibility</div>
                        </div>
                        <div class="switch active"></div>
                    </div>
                    <div class="switch-group" onclick="toggleSwitch(this)">
                        <div class="switch-info">
                            <div class="switch-label">Show streaming pill links</div>
                            <div class="switch-help">Display platform icons beneath each release</div>
                        </div>
                        <div class="switch active"></div>
                    </div>
                    <div style="display:flex;align-items:center;gap:12px;padding:12px 0 4px;">
                        <div style="flex:1;">
                            <div class="switch-label">Profile display mode</div>
                            <div class="switch-help">Tracklist is fastest. Embeds look richer. Both shows all (tracklist capped at 6, embeds at 3).</div>
                        </div>
                        <select id="musicProfileDisplayMode" class="form-input" style="width:auto;font-size:13px;padding:6px 10px;" onchange="setMusicDisplayMode(this.value)">
                            <option value="both">Both</option>
                            <option value="tracklist">Tracklist only</option>
                            <option value="embeds">Embeds only</option>
                        </select>
                        <button class="btn btn-secondary btn-small" onclick="previewMusicNow()" style="font-size:12px;padding:5px 9px;white-space:nowrap;flex-shrink:0;" title="Refresh preview">â†» Preview</button>
                    </div>
                </div>

                <!-- Section action -->
                <div class="card" style="margin-top:16px;">
                    <div class="card-header">
                        <span class="card-title">Section action</span>
                    </div>
                    <p class="form-help" style="margin:0 0 10px;">Shown on your profile at the top of the Music section. Keep it to 1â€“2 for best results.</p>
                    <div id="musicSectionActionsList"></div>
                    <div style="display:flex;gap:8px;margin-top:10px;">
                        <select id="musicSectionActionsSelect" class="form-input" style="flex:1;font-size:13px;">
                            <option value="">â€” Pick an action link â€”</option>
                        </select>
                        <button type="button" class="btn btn-primary btn-small" onclick="addSectionAction('music')">Add</button>
                    </div>
                    <div id="musicSectionActionsHint" class="form-help" style="margin-top:4px;color:var(--warning,#f59e0b);display:none;"></div>
                </div>
            </div>

            <!-- Videos Tab -->
            <div class="tab-content" data-content="videos">
                <div class="editor-header">
                    <h1 class="editor-title">Videos</h1>
                    <p class="editor-subtitle">Showcase your visual content</p>
                </div>

                <div class="auto-banner">
                    <div class="auto-banner-title">â–¶ï¸ Connect a platform</div>
                    <div class="auto-banner-text">Link YouTube or TikTok to auto-fill your videos, thumbnails, and view counts.</div>
                    <div class="auto-banner-actions">
                        <button class="auto-banner-btn" onclick="switchTab('platforms')">
                            Connect YouTube
                        </button>
                        <button class="auto-banner-btn" onclick="switchTab('platforms')">
                            Connect TikTok
                        </button>
                    </div>
                </div>

                <!-- Video list + empty state -->
                <div class="card" id="videoEmptyState">
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸŽ¬</div>
                        <div class="empty-state-title">No videos added yet</div>
                        <div class="empty-state-text">
                            Add YouTube, Vimeo, or TikTok links. They'll appear in your profile's Videos section.
                        </div>
                        <div class="empty-state-actions">
                            <button class="btn btn-primary" onclick="switchTab('platforms')">
                                Connect YouTube
                            </button>
                            <span class="empty-state-divider">or</span>
                            <button class="btn btn-secondary" onclick="openAddVideoModal()">
                                Add Video
                            </button>
                        </div>
                    </div>
                </div>
                <div class="card" style="display:none;" id="videoListCard">
                    <div class="card-header" style="display:flex;align-items:center;justify-content:space-between;">
                        <span class="card-title">Your Videos</span>
                        <button class="btn btn-primary btn-small" onclick="openAddVideoModal()">+ Add Video</button>
                    </div>
                    <div id="videoList"></div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Video Settings</span>
                    </div>
                    <div class="switch-group" onclick="toggleSwitch(this)">
                        <div class="switch-info">
                            <div class="switch-label">Show featured video</div>
                            <div class="switch-help">Display your latest video at the top of your profile</div>
                        </div>
                        <div class="switch active"></div>
                    </div>
                    <div class="switch-group" onclick="toggleSwitch(this)">
                        <div class="switch-info">
                            <div class="switch-label">Auto-play videos</div>
                            <div class="switch-help">Videos play automatically when fans visit</div>
                        </div>
                        <div class="switch"></div>
                    </div>
                </div>

                <!-- Section action -->
                <div class="card" style="margin-top:16px;">
                    <div class="card-header">
                        <span class="card-title">Section action</span>
                    </div>
                    <p class="form-help" style="margin:0 0 10px;">Shown on your profile at the top of the Videos section. Keep it to 1â€“2 for best results.</p>
                    <div id="videosSectionActionsList"></div>
                    <div style="display:flex;gap:8px;margin-top:10px;">
                        <select id="videosSectionActionsSelect" class="form-input" style="flex:1;font-size:13px;">
                            <option value="">â€” Pick an action link â€”</option>
                        </select>
                        <button type="button" class="btn btn-primary btn-small" onclick="addSectionAction('videos')">Add</button>
                    </div>
                    <div id="videosSectionActionsHint" class="form-help" style="margin-top:4px;color:var(--warning,#f59e0b);display:none;"></div>
                </div>
            </div>

            <!-- Events Tab -->
            <div class="tab-content" data-content="events">
                <div class="editor-header">
                    <h1 class="editor-title">Events</h1>
                    <p class="editor-subtitle">Manage your tour dates and shows</p>
                </div>

                <div class="auto-banner">
                    <div class="auto-banner-title">ðŸŽ« Connect a platform</div>
                    <div class="auto-banner-text">Link Eventbrite or Bands in Town to sync your tour dates automatically.</div>
                    <div class="auto-banner-actions">
                        <button class="auto-banner-btn" onclick="switchTab('platforms')">
                            Connect Eventbrite
                        </button>
                        <button class="auto-banner-btn" onclick="openAddEventModal()">
                            Add Manually
                        </button>
                    </div>
                </div>

                <!-- Event list + empty state -->
                <div class="card" id="eventEmptyState">
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸŽ«</div>
                        <div class="empty-state-title">No upcoming shows</div>
                        <div class="empty-state-text">
                            Add tour dates and they'll appear in your profile's Events section.
                        </div>
                        <div class="empty-state-actions">
                            <button class="btn btn-primary" onclick="openAddEventModal()">
                                Add Your First Event
                            </button>
                            <span class="empty-state-divider">or</span>
                            <button class="btn btn-secondary" onclick="switchTab('platforms')">
                                Import from Eventbrite
                            </button>
                        </div>
                    </div>
                </div>
                <div id="eventsTabErrorBanner" style="display:none;margin-bottom:12px;padding:10px 14px;background:var(--error-soft,#fee2e2);color:var(--error,#dc2626);border-radius:8px;font-size:12px;font-weight:600;">
                    âš ï¸ Could not load events. Your data is safe â€” please refresh or try again.
                </div>
                <div class="card" style="display:none;" id="eventListCard">
                    <div class="card-header" style="display:flex;align-items:center;justify-content:space-between;">
                        <span class="card-title">Upcoming Shows</span>
                        <button class="btn btn-primary btn-small" onclick="openAddEventModal()">+ Add Show</button>
                    </div>
                    <div id="eventList"></div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Event Settings</span>
                    </div>
                    <div class="switch-group" onclick="toggleSwitch(this)">
                        <div class="switch-info">
                            <div class="switch-label">Enable Gig Mode</div>
                            <div class="switch-help">Automatically switch to tour-focused layout when shows are near</div>
                        </div>
                        <div class="switch active"></div>
                    </div>
                    <div class="switch-group" onclick="toggleSwitch(this)">
                        <div class="switch-info">
                            <div class="switch-label">Show past events</div>
                            <div class="switch-help">Display your performance history on your profile</div>
                        </div>
                        <div class="switch"></div>
                    </div>
                    <div class="switch-group" onclick="toggleSwitch(this)">
                        <div class="switch-info">
                            <div class="switch-label">Add to calendar button</div>
                            <div class="switch-help">Let fans save your shows to their calendars</div>
                        </div>
                        <div class="switch active"></div>
                    </div>
                </div>

                <!-- Section action -->
                <div class="card" style="margin-top:16px;">
                    <div class="card-header">
                        <span class="card-title">Section action</span>
                    </div>
                    <p class="form-help" style="margin:0 0 10px;">Shown on your profile at the top of the Events section. Keep it to 1â€“2 for best results.</p>
                    <div id="eventsSectionActionsList"></div>
                    <div style="display:flex;gap:8px;margin-top:10px;">
                        <select id="eventsSectionActionsSelect" class="form-input" style="flex:1;font-size:13px;">
                            <option value="">â€” Pick an action link â€”</option>
                        </select>
                        <button type="button" class="btn btn-primary btn-small" onclick="addSectionAction('events')">Add</button>
                    </div>
                    <div id="eventsSectionActionsHint" class="form-help" style="margin-top:4px;color:var(--warning,#f59e0b);display:none;"></div>
                </div>
            </div>

            <!-- Merch Tab -->
            <div class="tab-content" data-content="merch">
                <div class="editor-header">
                    <h1 class="editor-title">Merch</h1>
                    <p class="editor-subtitle">Manage your products and inventory</p>
                </div>

                <div class="auto-banner">
                    <div class="auto-banner-title">ðŸ›ï¸ Connect a store</div>
                    <div class="auto-banner-text">Link Shopify or add products manually â€” they'll appear in your profile.</div>
                    <div class="auto-banner-actions">
                        <button class="auto-banner-btn" onclick="switchTab('platforms')">
                            Connect Shopify
                        </button>
                        <button class="auto-banner-btn" onclick="openAddProductModal()">
                            Add Manually
                        </button>
                    </div>
                </div>

                <!-- Merch list + empty state -->
                <div class="card" id="merchEmptyState">
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸ›ï¸</div>
                        <div class="empty-state-title">No products yet</div>
                        <div class="empty-state-text">
                            Add products and they'll appear in your profile's Merch section.
                        </div>
                        <div class="empty-state-actions">
                            <button class="btn btn-primary" onclick="openAddProductModal()">
                                Add Your First Product
                            </button>
                            <span class="empty-state-divider">or</span>
                            <button class="btn btn-secondary" onclick="switchTab('platforms')">
                                Connect Shopify
                            </button>
                        </div>
                    </div>
                </div>
                <div id="merchTabErrorBanner" style="display:none;margin-bottom:12px;padding:10px 14px;background:var(--error-soft,#fee2e2);color:var(--error,#dc2626);border-radius:8px;font-size:12px;font-weight:600;">
                    âš ï¸ Could not load products. Your data is safe â€” please refresh or try again.
                </div>
                <div class="card" style="display:none;" id="merchListCard">
                    <div class="card-header" style="display:flex;align-items:center;justify-content:space-between;">
                        <span class="card-title">Your Products</span>
                        <button class="btn btn-primary btn-small" onclick="openAddProductModal()">+ Add Product</button>
                    </div>
                    <div id="merchList"></div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Settings</span>
                    </div>
                    <div class="form-group" style="margin-bottom:16px;">
                        <label class="form-label">Store URL</label>
                        <input type="url" class="form-input" id="merchShopUrl"
                            placeholder="e.g. yourname.bandcamp.com or shop.yourname.com"
                            oninput="saveMerchShopUrl(this.value)">
                        <div class="form-help">Powers the "Shop" button on your profile's Merch section</div>
                    </div>
                    <div class="switch-group" onclick="toggleSwitch(this)">
                        <div class="switch-info">
                            <div class="switch-label">Show inventory counts</div>
                            <div class="switch-help">Display "Limited" badges when stock is low</div>
                        </div>
                        <div class="switch active"></div>
                    </div>
                    <div class="switch-group" onclick="toggleSwitch(this)">
                        <div class="switch-info">
                            <div class="switch-label">Enable bundle deals</div>
                            <div class="switch-help">Create discount bundles automatically</div>
                        </div>
                        <div class="switch"></div>
                    </div>
                    <div class="switch-group" onclick="toggleSwitch(this)">
                        <div class="switch-info">
                            <div class="switch-label">Show "Sold Out" items</div>
                            <div class="switch-help">Keep sold-out products visible to build anticipation</div>
                        </div>
                        <div class="switch active"></div>
                    </div>
                </div>

                <!-- Section action -->
                <div class="card" style="margin-top:16px;">
                    <div class="card-header">
                        <span class="card-title">Section action</span>
                    </div>
                    <p class="form-help" style="margin:0 0 10px;">Shown on your profile at the top of the Merch section. Keep it to 1â€“2 for best results.</p>
                    <div id="merchSectionActionsList"></div>
                    <div style="display:flex;gap:8px;margin-top:10px;">
                        <select id="merchSectionActionsSelect" class="form-input" style="flex:1;font-size:13px;">
                            <option value="">â€” Pick an action link â€”</option>
                        </select>
                        <button type="button" class="btn btn-primary btn-small" onclick="addSectionAction('merch')">Add</button>
                    </div>
                    <div id="merchSectionActionsHint" class="form-help" style="margin-top:4px;color:var(--warning,#f59e0b);display:none;"></div>
                </div>
            </div>

            <!-- Supporters Tab -->
            <div class="tab-content" data-content="supporters">
                <div class="editor-header">
                    <h1 class="editor-title">Supporters</h1>
                    <p class="editor-subtitle">Manage your inner circle and memberships</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Inner Circle</span>
                        <span class="badge badge-success">47 Members</span>
                    </div>
                    <div class="supporters-metrics">
                        <div>
                            <div class="supporters-metric-value" style="color:var(--success);">$1,410</div>
                            <div class="supporters-metric-label">
                                <span class="supporters-demo-tag">DEMO</span>
                                <span>Monthly Revenue</span>
                            </div>
                        </div>
                        <div>
                            <div class="supporters-metric-value" style="color:var(--accent);">92%</div>
                            <div class="supporters-metric-label">
                                <span class="supporters-demo-tag supporters-demo-tag--accent">DEMO</span>
                                <span>Retention Rate</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Membership Tiers</span>
                        <button class="card-action primary">Add Tier</button>
                    </div>

                    <div class="list-item" style="cursor: default;">
                        <div class="tier-icon" style="background:linear-gradient(135deg,#ffd89b 0%,#19547b 100%);">â­</div>
                        <div class="list-item-content">
                            <div class="list-item-title">Inner Circle</div>
                            <div class="list-item-meta">$30/month â€¢ Early access + exclusive tracks</div>
                        </div>
                        <div style="font-size: 14px; font-weight: 700; color: var(--text-secondary);">47 members</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Recent Tips</span>
                    </div>

                    <div class="list-item" style="cursor: default;">
                        <div class="supporter-avatar" style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);">JD</div>
                        <div class="list-item-content">
                            <div class="list-item-title">John D.</div>
                            <div class="list-item-meta">2 hours ago</div>
                        </div>
                        <div class="tip-amount">$10</div>
                    </div>

                    <div class="list-item" style="cursor: default;">
                        <div class="supporter-avatar" style="background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%);">SM</div>
                        <div class="list-item-content">
                            <div class="list-item-title">Sarah M.</div>
                            <div class="list-item-meta">1 day ago</div>
                        </div>
                        <div class="tip-amount">$25</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Settings</span>
                    </div>
                    <div class="switch-group" onclick="toggleSwitch(this)">
                        <div class="switch-info">
                            <div class="switch-label">Accept tips</div>
                            <div class="switch-help">Allow fans to send one-time support</div>
                        </div>
                        <div class="switch active"></div>
                    </div>
                    <div class="switch-group" onclick="toggleSwitch(this)">
                        <div class="switch-info">
                            <div class="switch-label">Show supporter count</div>
                            <div class="switch-help">Display number of active supporters publicly</div>
                        </div>
                        <div class="switch active"></div>
                    </div>
                </div>

                <!-- Section action -->
                <div class="card" style="margin-top:16px;">
                    <div class="card-header">
                        <span class="card-title">Section action</span>
                    </div>
                    <p class="form-help" style="margin:0 0 10px;">Shown on your profile at the top of the Support section. Keep it to 1â€“2 for best results.</p>
                    <div id="supportSectionActionsList"></div>
                    <div style="display:flex;gap:8px;margin-top:10px;">
                        <select id="supportSectionActionsSelect" class="form-input" style="flex:1;font-size:13px;">
                            <option value="">â€” Pick an action link â€”</option>
                        </select>
                        <button type="button" class="btn btn-primary btn-small" onclick="addSectionAction('support')">Add</button>
                    </div>
                    <div id="supportSectionActionsHint" class="form-help" style="margin-top:4px;color:var(--warning,#f59e0b);display:none;"></div>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div class="tab-content" data-content="analytics">
                <div class="editor-header">
                    <h1 class="editor-title analytics-header-title">
                        <span>Analytics</span>
                        <span class="analytics-demo-badge">DEMO DATA</span>
                    </h1>
                    <p class="editor-subtitle">Track your performance and insights</p>
                </div>

                <!-- Time Range Selector -->
                <div class="analytics-range-bar" id="analyticsRangeBar">
                    <button class="btn btn-primary analytics-range-btn" data-range="7" onclick="setAnalyticsRange(this)">Last 7 days</button>
                    <button class="btn btn-secondary analytics-range-btn" data-range="30" onclick="setAnalyticsRange(this)">Last 30 days</button>
                    <button class="btn btn-secondary analytics-range-btn" data-range="90" onclick="setAnalyticsRange(this)">Last 90 days</button>
                    <button class="btn btn-secondary analytics-range-btn" data-range="all" onclick="setAnalyticsRange(this)">All time</button>
                </div>

                <!-- Key Metrics -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Last 7 Days</span>
                        <button class="card-action">Export Data</button>
                    </div>
                    <div class="analytics-metrics-grid">
                        <div class="analytics-metric-card">
                            <div class="analytics-metric-value" style="color:var(--accent);">1,247</div>
                            <div class="analytics-metric-label">Page Views</div>
                            <div class="analytics-metric-trend analytics-metric-trend--up">â†‘ 23% from last week</div>
                        </div>
                        <div class="analytics-metric-card">
                            <div class="analytics-metric-value" style="color:var(--success);">1,086</div>
                            <div class="analytics-metric-label">Total Clicks</div>
                            <div class="analytics-metric-trend analytics-metric-trend--up">â†‘ 18% from last week</div>
                        </div>
                        <div class="analytics-metric-card">
                            <div class="analytics-metric-value" style="color:var(--text-primary);">87%</div>
                            <div class="analytics-metric-label">Click Rate</div>
                            <div class="analytics-metric-trend analytics-metric-trend--up">â†‘ 5% from last week</div>
                        </div>
                        <div class="analytics-metric-card">
                            <div class="analytics-metric-value" style="color:var(--warning);">3:12</div>
                            <div class="analytics-metric-label">Avg. Time</div>
                            <div class="analytics-metric-trend analytics-metric-trend--flat">Same as last week</div>
                        </div>
                    </div>
                </div>

                <!-- Page Views Over Time Chart -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Page Views Over Time</span>
                    </div>
                    <div class="analytics-chart-wrap">
                        <canvas id="pageViewsChart" style="max-height: 280px;"></canvas>
                    </div>
                </div>

                <!-- Top Performing Links Chart -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Top Performing Links</span>
                    </div>
                    <div class="analytics-chart-wrap">
                        <canvas id="topLinksChart" style="max-height: 280px;"></canvas>
                    </div>
                </div>

                <!-- Traffic Sources Chart -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Traffic Sources</span>
                    </div>
                    <div class="analytics-traffic-grid">
                        <div class="analytics-chart-wrap">
                            <canvas id="trafficSourcesChart" style="max-height: 240px;"></canvas>
                        </div>
                        <div class="analytics-legend">
                            <div class="analytics-legend-row">
                                <div class="analytics-legend-left">
                                    <div class="analytics-legend-dot" style="background:#0891b2;"></div>
                                    <span class="analytics-legend-name">Instagram</span>
                                </div>
                                <div class="analytics-legend-right">
                                    <span class="analytics-legend-pct">65%</span>
                                    <span class="analytics-legend-visits">811 visits</span>
                                </div>
                            </div>
                            <div class="analytics-legend-row">
                                <div class="analytics-legend-left">
                                    <div class="analytics-legend-dot" style="background:#10b981;"></div>
                                    <span class="analytics-legend-name">TikTok</span>
                                </div>
                                <div class="analytics-legend-right">
                                    <span class="analytics-legend-pct">22%</span>
                                    <span class="analytics-legend-visits">274 visits</span>
                                </div>
                            </div>
                            <div class="analytics-legend-row">
                                <div class="analytics-legend-left">
                                    <div class="analytics-legend-dot" style="background:#f59e0b;"></div>
                                    <span class="analytics-legend-name">Direct</span>
                                </div>
                                <div class="analytics-legend-right">
                                    <span class="analytics-legend-pct">13%</span>
                                    <span class="analytics-legend-visits">162 visits</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Fan Locations -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Fan Locations</span>
                    </div>
                    <div class="analytics-subtitle">Top cities where fans are discovering your music</div>
                    <div>
                        <canvas id="fanLocationsChart" style="max-height: 300px;"></canvas>
                    </div>
                </div>
            </div>

            <!-- Share Tab -->
            <div class="tab-content" data-content="share">
                <div class="editor-header">
                    <h1 class="editor-title">Share</h1>
                    <p class="editor-subtitle">Get your page link and QR code</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Your Public Link</span>
                    </div>
                    <div class="share-url-row">
                        <input type="text" class="form-input" value="able.to/mayarivers" readonly id="shareUrlMain">
                        <button class="btn btn-primary" id="shareUrlMainBtn" onclick="copyShareLink('shareUrlMain', this)">Copy</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Direct Links</span>
                    </div>
                    <div class="share-direct-links">
                        <div class="share-url-row">
                            <input type="text" class="form-input" value="able.to/mayarivers/music" readonly id="shareUrlMusic">
                            <button class="btn btn-secondary" onclick="copyShareLink('shareUrlMusic', this)">Copy</button>
                        </div>
                        <div class="share-url-row">
                            <input type="text" class="form-input" value="able.to/mayarivers/events" readonly id="shareUrlEvents">
                            <button class="btn btn-secondary" onclick="copyShareLink('shareUrlEvents', this)">Copy</button>
                        </div>
                        <div class="share-url-row">
                            <input type="text" class="form-input" value="able.to/mayarivers/merch" readonly id="shareUrlMerch">
                            <button class="btn btn-secondary" onclick="copyShareLink('shareUrlMerch', this)">Copy</button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">QR Code</span>
                    </div>
                    <div class="share-qr-section">
                        <div class="share-qr-placeholder"></div>
                        <div class="share-qr-actions">
                            <button class="btn btn-secondary">Download PNG</button>
                            <button class="btn btn-secondary">Download SVG</button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Share to Social</span>
                    </div>
                    <div class="share-social-grid">
                        <button class="btn btn-outline btn-full">
                            <span>ðŸ“¸</span>
                            <span>Instagram Story</span>
                        </button>
                        <button class="btn btn-outline btn-full">
                            <span>ðŸŽ¬</span>
                            <span>TikTok</span>
                        </button>
                        <button class="btn btn-outline btn-full">
                            <span>ðŸ¦</span>
                            <span>Twitter</span>
                        </button>
                        <button class="btn btn-outline btn-full">
                            <span>ðŸ’¬</span>
                            <span>WhatsApp</span>
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Advanced</span>
                    </div>
                    <div class="share-advanced">
                        <button class="btn btn-secondary btn-full">
                            ðŸ“± Add to Apple Wallet
                        </button>
                        <button class="btn btn-secondary btn-full">
                            ðŸ”— Generate NFC Card
                        </button>
                        <button class="btn btn-secondary btn-full">
                            ðŸŒ Embed on Website
                        </button>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div class="tab-content" data-content="settings">
                <div class="editor-header">
                    <h1 class="editor-title">Settings</h1>
                    <p class="editor-subtitle">Manage your account and preferences</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Account</span>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" value="maya@mayarivers.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <button class="btn btn-secondary btn-full">Change Password</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Current Plan</span>
                        <span class="badge badge-info">Pro</span>
                    </div>
                    <div class="settings-plan-price">$29/month â€¢ Billed annually</div>
                    <div class="settings-plan-actions">
                        <button class="btn btn-primary">Upgrade to Enterprise</button>
                        <button class="btn btn-secondary">Manage Billing</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Page Settings</span>
                    </div>
                    <div class="switch-group" onclick="toggleSwitch(this)">
                        <div class="switch-info">
                            <div class="switch-label">Analytics tracking</div>
                            <div class="switch-help">Track page views and clicks</div>
                        </div>
                        <div class="switch active"></div>
                    </div>
                    <div class="switch-group" onclick="toggleSwitch(this)">
                        <div class="switch-info">
                            <div class="switch-label">SEO optimization</div>
                            <div class="switch-help">Index your page for search engines</div>
                        </div>
                        <div class="switch active"></div>
                    </div>
                    <div class="switch-group" onclick="toggleSwitch(this)">
                        <div class="switch-info">
                            <div class="switch-label">Custom domain</div>
                            <div class="switch-help">Use your own domain name</div>
                        </div>
                        <div class="switch"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">Privacy</span>
                    </div>
                    <div class="switch-group" onclick="toggleSwitch(this)">
                        <div class="switch-info">
                            <div class="switch-label">Page published</div>
                            <div class="switch-help">Make your page publicly accessible</div>
                        </div>
                        <div class="switch active"></div>
                    </div>
                    <div class="switch-group" onclick="toggleSwitch(this)">
                        <div class="switch-info">
                            <div class="switch-label">Show supporter names</div>
                            <div class="switch-help">Display recent supporter activity</div>
                        </div>
                        <div class="switch active"></div>
                    </div>
                </div>

                <div class="card card--danger">
                    <div class="card-header">
                        <span class="card-title card-title--danger">
                            <span>âš ï¸</span>
                            <span>Danger Zone</span>
                        </span>
                    </div>
                    <button class="btn btn-danger-ghost btn-full" onclick="clearDashboardData()">
                        Clear Dashboard Data
                    </button>
                    <div class="danger-zone-desc">
                        âš ï¸ Reset all CTAs and settings to default. This cannot be undone.
                    </div>
                    <button class="btn btn-danger btn-full" onclick="confirmDeleteAccount()">
                        Delete Account
                    </button>
                </div>

                <!-- â”€â”€ Test Mode â”€â”€ -->
                <div class="card" id="testModeCard" style="border:1px dashed rgba(8,145,178,0.4);margin-top:8px;">
                    <div class="card-header" style="cursor:pointer;user-select:none;" onclick="toggleTestMode()">
                        <span class="card-title" style="color:var(--accent,#0891b2);">ðŸ”¬ Test Mode</span>
                        <span id="testModeChevron" style="font-size:11px;color:var(--text-tertiary);">â–¼ expand</span>
                    </div>
                    <div id="testModeBody" style="display:none;padding-top:4px;">
                        <p class="form-help" style="margin-bottom:12px;">Developer tools â€” seed data, run smoke checks, export a debug snapshot.</p>
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px;">
                            <button class="btn btn-secondary btn-small" onclick="seedDemoData()">ðŸŒ± Seed demo data</button>
                            <button class="btn btn-secondary btn-small" onclick="clearAbleLocalData()">ðŸ—‘ Clear local data</button>
                            <button class="btn btn-secondary btn-small" onclick="runSmokeChecks()">âœ… Smoke checks</button>
                            <button class="btn btn-secondary btn-small" onclick="copyDebugSnapshot()">ðŸ“‹ Print state summary</button>
                        </div>
                        <pre id="smokeCheckOutput" style="display:none;font-size:11px;line-height:1.6;background:var(--bg-tertiary);border:1px solid var(--border);border-radius:8px;padding:10px;max-height:220px;overflow-y:auto;white-space:pre-wrap;margin:0;"></pre>
                    </div>
                </div>
            </div>

            <!-- â”€â”€ Feed Tab â”€â”€ -->
            <div class="tab-content" data-content="feed">
                <div class="editor-header">
                    <h1 class="editor-title">Profile Feed</h1>
                    <p class="editor-subtitle">Post updates that appear on your profile</p>
                </div>

                <!-- Post form -->
                <div class="card">
                    <div class="card-header"><span class="card-title">New post</span></div>
                    <div class="form-group">
                        <label class="form-label">Type</label>
                        <select id="postType" class="form-input" style="font-size:13px;">
                            <option value="update">ðŸ“£ Update</option>
                            <option value="release">ðŸŽµ Release</option>
                            <option value="event">ðŸŽŸ Event</option>
                            <option value="merch">ðŸ› Merch</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <div class="form-field">
                            <input type="text" id="postTitle" class="form-input" placeholder=" " maxlength="80">
                            <label class="floating-label">Title *</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Body</label>
                        <textarea id="postBody" class="form-input" rows="3" placeholder="What's new?" style="resize:vertical;min-height:72px;font-family:inherit;"></textarea>
                    </div>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;" class="form-group">
                        <div class="form-field">
                            <input type="text" id="postAttachLabel" class="form-input" placeholder=" " maxlength="40">
                            <label class="floating-label">Button label (optional)</label>
                        </div>
                        <div class="form-field">
                            <input type="url" id="postAttachUrl" class="form-input" placeholder=" ">
                            <label class="floating-label">URL (optional)</label>
                        </div>
                    </div>
                    <button class="btn btn-primary btn-full" onclick="submitProfilePost()">Post update</button>
                </div>

                <!-- Existing posts -->
                <div class="card">
                    <div class="card-header"><span class="card-title">Posted updates</span></div>
                    <div id="feedAdminList">
                        <div class="empty-state" style="padding:24px 0;">
                            <div class="empty-state-icon">ðŸ“¢</div>
                            <div class="empty-state-title">No posts yet</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Preview Panel -->
        <aside class="preview-panel">
            <!-- Preview Panel Header -->
            <div class="preview-panel-header">
                <div class="preview-url-bar">
                    <span class="preview-url-lock">ðŸ”’</span>
                    <div class="preview-url-text">able.to/<span id="previewUrlHandle">mayarivers</span></div>
                    <div class="preview-url-actions">
                        <button class="preview-url-btn" onclick="copyProfileUrl()" title="Copy link">
                            <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                            Copy
                        </button>
                        <button class="preview-url-btn primary" onclick="openFullPage()">
                            <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"/></svg>
                            Open
                        </button>
                    </div>
                </div>
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 0 2px;">
                    <div class="preview-live-badge">
                        <div class="preview-live-dot"></div>
                        <span>Live Preview</span>
                    </div>
                    <div style="font-size: 10px; color: var(--text-tertiary); font-weight: 600; letter-spacing: 0.04em; text-transform: uppercase;">Updates instantly</div>
                </div>
            </div>

            <!-- Mode switcher - full width -->
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; margin-bottom: 10px;">
                <button class="mode-btn" data-mode="pre-release" onclick="switchPreviewMode('pre-release')">
                    <span>ðŸ’¿</span>
                    <span>Pre-Release</span>
                </button>
                <button class="mode-btn active" data-mode="live" onclick="switchPreviewMode('live')">
                    <span>â–¶ï¸</span>
                    <span>Live</span>
                </button>
                <button class="mode-btn" data-mode="evergreen" onclick="switchPreviewMode('evergreen')">
                    <span>ðŸŒŸ</span>
                    <span>Evergreen</span>
                </button>
                <button class="mode-btn" data-mode="gig" onclick="switchPreviewMode('gig')">
                    <span>ðŸŽ¸</span>
                    <span>Gig</span>
                </button>
            </div>

            <!-- Device switcher - full width -->
            <div style="display: flex; gap: 6px; margin-bottom: 16px;">
                <button class="preview-tab active" data-device="mobile" onclick="switchPreviewDevice('mobile')">
                    <span>ðŸ“±</span>
                    <span>Mobile</span>
                </button>
                <button class="preview-tab" data-device="desktop" onclick="switchPreviewDevice('desktop')">
                    <span>ðŸ’»</span>
                    <span>Desktop</span>
                </button>
            </div>
            
            <!-- Real profile embedded -->
            <div id="profilePreviewFrame" style="width:390px;max-height:680px;overflow-y:auto;overflow-x:hidden;border-radius:16px;position:relative;isolation:isolate;box-shadow:0 8px 40px rgba(0,0,0,0.18);background:var(--bg-primary);">
                <div class="profile-preview" id="profilePreviewRoot">

    <!-- Audio Preview Player -->
    <div class="audio-player" id="audioPlayer">
        <div class="audio-player-orb" id="audioPlayerOrb">
            <div class="audio-player-orb-inner">
                <!-- Collapsed: Just the cover art -->
                <div class="audio-cover-mini">
                    <div class="audio-cover-pulse"></div>
                    <span class="audio-cover-icon">ðŸŽµ</span>
                </div>
                
                <!-- Expanded: Full player -->
                <div class="audio-player-expanded">
                    <div class="audio-player-header">
                        <div class="audio-cover">
                            <div class="audio-cover-pulse"></div>
                            <span class="audio-cover-icon">ðŸŽµ</span>
                        </div>
                        <div class="audio-info">
                            <div class="audio-track-name">Midnight Drive</div>
                            <div class="audio-artist-name">Maya Rivers</div>
                        </div>
                        <button class="audio-close" id="audioClose">âœ•</button>
                    </div>
                    <div class="audio-controls">
                        <button class="audio-play-btn" id="audioPlayBtn">
                            <svg class="play-icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                            <svg class="pause-icon" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                        </button>
                        <div class="audio-waveform-container">
                            <div class="audio-waveform" id="audioWaveform">
                                <!-- Waveform bars will be generated by JS -->
                            </div>
                            <div class="audio-time">
                                <span id="audioCurrentTime">0:00</span>
                                <span id="audioDuration">0:30</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scroll Progress Bar -->
    <div class="scroll-progress" id="scrollProgress"></div>

    <!-- Section Navigation Dots -->
    <nav class="section-nav" id="sectionNav">
        <div class="section-dot" data-section="hero">
            <span class="dot-label">Hero</span>
        </div>
        <div class="section-dot" data-section="streaming">
            <span class="dot-label">Music</span>
        </div>
        <div class="section-dot" data-section="tour">
            <span class="dot-label">Tour</span>
        </div>
        <div class="section-dot" data-section="merch">
            <span class="dot-label">Shop</span>
        </div>
        <div class="section-dot" data-section="artists">
            <span class="dot-label">Artists</span>
        </div>
    </nav>

    <!-- Quick Action Buttons -->
    <div class="quick-actions">
        <button class="quick-action-btn pulse" id="backToTop">
            <span>â†‘</span>
            <span class="tooltip">Back to Top</span>
        </button>
        <button class="quick-action-btn" id="sharePage">
            <span>ðŸ“¤</span>
            <span class="tooltip">Share Page</span>
        </button>
        <button class="quick-action-btn" id="saveForLater">
            <span class="save-icon">ðŸ”–</span>
            <span class="tooltip">Save for Later</span>
        </button>
    </div>

    <div class="container">
        <!-- Header Controls -->
        <header class="page-header" id="pageHeader" style="display:none;">
            <div class="header-row">
                <div>
                    <div class="header-title">Able Demo</div>
                    <div class="header-subtitle">Maya Rivers Â· Pre-Release</div>
                </div>
                <button class="settings-toggle" id="settingsToggle">âš™ï¸</button>
            </div>
            <div class="controls-card" id="controlsCard" style="display:none;">
                <div class="control-section">
                    <div class="control-label">Accent Color</div>
                    <div class="color-presets" id="colorPresets">
                        <button class="color-preset active" data-color="#0891b2" style="background: #0891b2;" title="Ocean"></button>
                        <button class="color-preset" data-color="#8b5cf6" style="background: #8b5cf6;" title="Purple"></button>
                        <button class="color-preset" data-color="#ec4899" style="background: #ec4899;" title="Pink"></button>
                        <button class="color-preset" data-color="#f59e0b" style="background: #f59e0b;" title="Amber"></button>
                        <button class="color-preset" data-color="#10b981" style="background: #10b981;" title="Green"></button>
                        <button class="color-preset" data-color="#ef4444" style="background: #ef4444;" title="Red"></button>
                        <button class="color-preset custom" id="customColorBtn" title="Custom">
                            <span style="font-size: 16px;">+</span>
                        </button>
                    </div>
                    <input type="color" id="customColorPicker" value="#0891b2" style="display: none;">
                </div>
                <div class="control-section">
                    <div class="control-label">Page State</div>
                    <div class="segmented-control" id="stateControl">
                        <button class="active" data-state="pre-release">Pre-Release</button>
                        <button data-state="live">Live</button>
                        <button data-state="profile">Profile</button>
                    </div>
                </div>
                <div class="control-section">
                    <div class="auto-row" id="autoToggle">
                        <div class="auto-info">
                            <div class="auto-title">Auto Mode</div>
                            <div class="auto-help">Switches state based on release date</div>
                        </div>
                        <div class="switch active" id="autoSwitch">
                            <div class="switch-knob"></div>
                        </div>
                    </div>
                    <div class="release-settings visible" id="releaseSettings">
                        <div class="settings-title">Release Settings</div>
                        <div class="setting-group">
                            <label class="setting-label">Release Date & Time</label>
                            <input type="datetime-local" class="setting-input" id="releaseProfileDate"
                                   onchange="syncReleaseDateFromProfile(this.value)">
                        </div>
                        <div class="auto-status" id="autoStatus">
                            Currently: Pre-Release â†’ Live in 29 days
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Hero Section â€” full-bleed reel style -->
        <div class="hero-card">
            <div class="short-container" id="previewShortContainer">
                <!-- Video / artwork area -->
                <div class="video-placeholder">
                    <div class="placeholder-pattern"></div>
                </div>

                <!-- Top: state pill -->
                <div class="short-badges">
                    <span class="badge badge-state" id="stateBadge">Pre-Release</span>
                </div>

                <!-- Countdown â€” shown in pre-release -->
                <div class="countdown-banner" id="countdownBanner">
                    <div class="countdown-label">Drops In</div>
                    <div class="countdown-time" id="heroCountdownTime">â€”</div>
                </div>

                <!-- Centre: subtle play indicator -->
                <div class="play-button">
                    <div class="play-icon"></div>
                </div>

                <!-- Right rail: engagement actions -->
                <div class="short-engagement">
                    <button class="engagement-btn">
                        <div class="engagement-icon">â™¥</div>
                        <span class="engagement-count">12K</span>
                    </button>
                    <button class="engagement-btn">
                        <div class="engagement-icon">ðŸ’¬</div>
                        <span class="engagement-count">483</span>
                    </button>
                    <button class="engagement-btn">
                        <div class="engagement-icon">ðŸ“¤</div>
                        <span class="engagement-count">Share</span>
                    </button>
                </div>

                <!-- Bottom overlay: artist + release info -->
                <div class="short-info">
                    <div class="short-artist-row">
                        <div class="short-avatar-sm" id="heroAvatarSm">MR</div>
                        <span class="short-artist-name-sm">Maya Rivers</span>
                        <button class="short-follow-pill">Follow</button>
                    </div>
                    <div class="short-metadata">
                        <div class="greeting-text" id="greetingText">OUT NOW Â· DROPPING SOON</div>
                        <h1 class="short-title" id="heroShortTitle">Midnight Drive EP</h1>
                    </div>
                </div>
            </div>

            <!-- CTA zone below the reel -->
            <div class="hero-content">
                <div class="artist-header">
                    <div>
                        <h2 class="artist-name">Maya Rivers</h2>
                        <p class="artist-handle">@mayarivers</p>
                    </div>
                    <button class="share-button">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/>
                            <polyline points="16 6 12 2 8 6"/>
                            <line x1="12" y1="2" x2="12" y2="15"/>
                        </svg>
                    </button>
                </div>

                <div class="cta-group" id="ctaGroup">
                    <button class="btn btn-primary" id="mainCta">â° Pre-save on Spotify</button>
                    <button class="btn btn-secondary" id="secondaryCta">ðŸ”” Get Notified</button>
                </div>

                <!-- Quick links strip â€” mode-aware, populated by bridge -->
                <div class="quick-links-strip" id="quickLinksStrip">
                    <!-- populated by applyDashboardData() -->
                </div>
            </div>
        </div>

        <!-- Sections Container -->
        <div class="sections-container" id="sectionsContainer">
            
            <!-- Streaming Section -->
            <section class="section" id="streaming">
                <div class="section-header-row">
                    <h2 class="section-title">Listen Now</h2>
                    <div id="streamingSectionActions" class="section-actions"></div>
                </div>

                <!-- Spotify-widget style featured player -->
                <div class="stream-player-widget">
                    <div class="stream-player-art">
                        <div class="stream-art-bg"></div>
                        <button class="stream-play-btn">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="white"><path d="M3 2l10 6-10 6V2z"/></svg>
                        </button>
                    </div>
                    <div class="stream-player-info">
                        <div class="stream-track-name">Midnight Drive</div>
                        <div class="stream-track-sub">Maya Rivers Â· Midnight Drive EP</div>
                        <div class="stream-progress-bar">
                            <div class="stream-progress-fill"></div>
                        </div>
                        <div class="stream-progress-times">
                            <span>2:34</span>
                            <span>4:12</span>
                        </div>
                    </div>
                    <a href="#" target="_blank" class="stream-open-link">
                        <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="#1DB954" stroke-width="2.5"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6M15 3h6v6M10 14L21 3"/></svg>
                        Open
                    </a>
                </div>

                <!-- All streaming platforms -->
                <div class="stream-platforms-label">Stream everywhere</div>
                <div class="streaming-pills-container">
                    <a href="#" class="streaming-pill spotify">
                        <span class="pill-icon">â—</span>
                        <span class="pill-text">Spotify</span>
                    </a>
                    <a href="#" class="streaming-pill apple">
                        <span class="pill-icon">â—</span>
                        <span class="pill-text">Apple Music</span>
                    </a>
                    <a href="#" class="streaming-pill youtube">
                        <span class="pill-icon">â—</span>
                        <span class="pill-text">YouTube Music</span>
                    </a>
                    <a href="#" class="streaming-pill soundcloud">
                        <span class="pill-icon">â—</span>
                        <span class="pill-text">SoundCloud</span>
                    </a>
                    <a href="#" class="streaming-pill amazon">
                        <span class="pill-icon">â—</span>
                        <span class="pill-text">Amazon Music</span>
                    </a>
                    <a href="#" class="streaming-pill tidal">
                        <span class="pill-icon">â—</span>
                        <span class="pill-text">Tidal</span>
                    </a>
                    <a href="#" class="streaming-pill bandcamp">
                        <span class="pill-icon">â—</span>
                        <span class="pill-text">Bandcamp</span>
                    </a>
                    <a href="#" class="streaming-pill deezer">
                        <span class="pill-icon">â—</span>
                        <span class="pill-text">Deezer</span>
                    </a>
                </div>
            </section>

            <!-- Tracklist Section - Apple Music Style -->
            <section class="section" id="tracklist">
                <h2 class="section-title">Tracklist</h2>
                <div class="tracklist-compact">
                    <div class="track-row" data-spotify="https://open.spotify.com/track/abc123">
                        <div class="track-num">1</div>
                        <div class="track-info">
                            <div class="track-name">Midnight Drive</div>
                            <div class="track-artist">Maya Rivers</div>
                        </div>
                        <div class="track-duration">4:12</div>
                        <button class="track-menu">â‹®</button>
                    </div>

                    <div class="track-row" data-spotify="https://open.spotify.com/track/def456">
                        <div class="track-num">2</div>
                        <div class="track-info">
                            <div class="track-name">Neon Lights <span class="track-feat">â€¢ feat. Nova Vex</span> <span class="explicit-badge">E</span></div>
                            <div class="track-artist">Maya Rivers</div>
                        </div>
                        <div class="track-duration">3:45</div>
                        <button class="track-menu">â‹®</button>
                    </div>

                    <div class="track-row" data-spotify="https://open.spotify.com/track/ghi789">
                        <div class="track-num">3</div>
                        <div class="track-info">
                            <div class="track-name">Lost in the City</div>
                            <div class="track-artist">Maya Rivers</div>
                        </div>
                        <div class="track-duration">5:02</div>
                        <button class="track-menu">â‹®</button>
                    </div>

                    <div class="track-row" data-spotify="https://open.spotify.com/track/jkl012">
                        <div class="track-num">4</div>
                        <div class="track-info">
                            <div class="track-name">Fading Out</div>
                            <div class="track-artist">Maya Rivers</div>
                        </div>
                        <div class="track-duration">3:28</div>
                        <button class="track-menu">â‹®</button>
                    </div>

                    <div class="track-row" data-spotify="https://open.spotify.com/track/mno345">
                        <div class="track-num">5</div>
                        <div class="track-info">
                            <div class="track-name">Electric Heart <span class="track-feat">â€¢ feat. Crystal Lake</span></div>
                            <div class="track-artist">Maya Rivers</div>
                        </div>
                        <div class="track-duration">4:18</div>
                        <button class="track-menu">â‹®</button>
                    </div>

                    <div class="track-row" data-spotify="https://open.spotify.com/track/pqr678">
                        <div class="track-num">6</div>
                        <div class="track-info">
                            <div class="track-name">Dawn (Outro)</div>
                            <div class="track-artist">Maya Rivers</div>
                        </div>
                        <div class="track-duration">2:33</div>
                        <button class="track-menu">â‹®</button>
                    </div>

                    <div class="tracklist-footer">
                        6 tracks â€¢ 24 min
                    </div>
                </div>
            </section>

            <!-- Music Releases â€” dynamically populated by updatePreviewMusic() -->
            <section class="section" id="previewMusicSection" style="display:none;">
                <div class="section-header-row">
                    <h2 class="section-title">Releases</h2>
                </div>
                <div id="previewMusicCards" class="able-stack-3"></div>
            </section>

            <!-- Profile Feed â€” dynamically populated by renderProfileFeed() -->
            <section class="section" id="profileFeedSection" style="display:none;">
                <div id="profileFeedNewBanner" style="display:none;margin-bottom:10px;padding:6px 10px;background:var(--accent-soft);border-radius:8px;font-size:12px;font-weight:700;color:var(--accent);"></div>
                <div class="section-header-row">
                    <h2 class="section-title">Updates</h2>
                </div>
                <div id="profileFeedCards" style="display:flex;flex-direction:column;gap:10px;"></div>
                <button id="profileFeedToggle" onclick="toggleFeedExpand()" style="display:none;width:100%;margin-top:10px;background:none;border:1px solid var(--border);border-radius:8px;padding:8px;font-size:12px;color:var(--text-secondary);cursor:pointer;font-family:inherit;"></button>
            </section>

            <!-- Credits Section -->
            <section class="section" id="credits" style="display:none;">
                <div class="section-header-row">
                    <h2 class="section-title">Credits</h2>
                    <div id="creditsSectionActions" class="section-actions"></div>
                </div>
                <div id="profileCreditsList"></div>
            </section>

            <!-- Videos Section - DIY Textured Grid -->
            <section class="section" id="videos">
                <div class="section-header-row">
                    <h2 class="section-title">Videos</h2>
                    <div id="videosSectionActions" class="section-actions"></div>
                </div>
                
                <div class="video-collage">
                    <!-- Main Featured Video -->
                    <a href="https://youtube.com/watch?v=example1" target="_blank" class="video-featured" style="--rotation: -0.5deg;">
                        <div class="video-thumb">
                            <div class="video-placeholder-thumb" style="background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);">
                                <div class="thumb-pattern"></div>
                            </div>
                            <div class="video-overlay">
                                <div class="video-play-btn">â–¶</div>
                            </div>
                            <span class="video-badge new">NEW</span>
                            <span class="video-time">4:32</span>
                        </div>
                        <div class="video-info">
                            <div class="video-title">Midnight Drive - Official Music Video</div>
                            <div class="video-stats">128K views</div>
                        </div>
                    </a>

                    <!-- Smaller Videos Grid -->
                    <div class="video-grid">
                        <a href="https://youtube.com/watch?v=example2" target="_blank" class="video-item" style="--rotation: 0.3deg;">
                            <div class="video-thumb">
                                <div class="video-placeholder-thumb" style="background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%);">
                                    <div class="thumb-pattern"></div>
                                </div>
                                <div class="video-overlay">
                                    <div class="video-play-btn">â–¶</div>
                                </div>
                                <span class="video-time">3:24</span>
                            </div>
                            <div class="video-info">
                                <div class="video-title">Studio Session Vol. 1</div>
                            </div>
                        </a>

                        <a href="https://youtube.com/watch?v=example3" target="_blank" class="video-item" style="--rotation: -0.2deg;">
                            <div class="video-thumb">
                                <div class="video-placeholder-thumb" style="background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);">
                                    <div class="thumb-pattern"></div>
                                </div>
                                <div class="video-overlay">
                                    <div class="video-play-btn">â–¶</div>
                                </div>
                                <span class="video-badge live">LIVE</span>
                                <span class="video-time">5:42</span>
                            </div>
                            <div class="video-info">
                                <div class="video-title">Live at The Echo</div>
                            </div>
                        </a>

                        <a href="https://youtube.com/watch?v=example4" target="_blank" class="video-item" style="--rotation: 0.4deg;">
                            <div class="video-thumb">
                                <div class="video-placeholder-thumb" style="background: linear-gradient(135deg, #7c3aed 0%, #ec4899 100%);">
                                    <div class="thumb-pattern"></div>
                                </div>
                                <div class="video-overlay">
                                    <div class="video-play-btn">â–¶</div>
                                </div>
                                <span class="video-time">4:12</span>
                            </div>
                            <div class="video-info">
                                <div class="video-title">Neon Lights (Lyric Video)</div>
                            </div>
                        </a>

                        <a href="https://youtube.com/watch?v=example5" target="_blank" class="video-item" style="--rotation: -0.3deg;">
                            <div class="video-thumb">
                                <img src="https://i.ytimg.com/vi/dQw4w9WgXcQ/hqdefault.jpg" alt="Video" class="video-thumb-img" loading="lazy">
                                <div class="video-overlay">
                                    <div class="video-play-btn">â–¶</div>
                                </div>
                                <span class="video-time">2:48</span>
                            </div>
                            <div class="video-info">
                                <div class="video-title">Behind The Scenes</div>
                            </div>
                        </a>
                    </div>
                </div>
            </section>


            <!-- Calendar Section -->
            <!-- Bio Section -->
            <!-- Bio Section -->
            <section class="section" id="bio">
                <h2 class="section-title">About</h2>
                <div class="bio-card">
                    <div class="bio-avatar">MR</div>
                    <div class="bio-content">
                        <p class="bio-text">
                            Electronic producer and vocalist blending ambient textures with driving beats. Based in LA, creating immersive soundscapes that bridge underground club culture and cinematic composition.
                        </p>
                        <div class="bio-tags">
                            <span class="tag">Electronic</span>
                            <span class="tag">Ambient</span>
                            <span class="tag">House</span>
                            <span class="tag">LA</span>
                        </div>
                        <!-- Social strip â€” populated by bridge -->
                        <div class="social-strip" id="socialStrip"></div>
                    </div>
                </div>
            </section>

            <!-- Bento Calendar Section -->
            <section class="section" id="events">
                <h2 class="section-title">What's Next</h2>
                <div class="bento-grid" id="bentoGrid">
                    <div class="bento-tile size-small type-date" style="--accent-color: #ec4899;">
                        <div class="bento-date">MAR<br>28</div>
                    </div>
                    <div class="bento-tile size-large type-event">
                        <div class="bento-content">
                            <div class="bento-title">Album Release Show</div>
                            <div class="bento-subtitle">The Roxy, LA</div>
                            <div class="bento-time">ðŸŽ¸ 8:00 PM</div>
                        </div>
                    </div>
                    <div class="bento-tile size-small type-date" style="--accent-color: #0891b2;">
                        <div class="bento-date">APR<br>05</div>
                    </div>
                    <div class="bento-tile size-medium type-event">
                        <div class="bento-content">
                            <div class="bento-title">Live at Coachella</div>
                            <div class="bento-subtitle">Indio, CA</div>
                        </div>
                    </div>
                    <div class="bento-tile size-medium type-tour">
                        <div class="bento-content">
                            <div class="bento-title">West Coast Tour</div>
                            <div class="bento-subtitle">12 cities</div>
                        </div>
                    </div>
                    <div class="bento-tile size-small type-date" style="--accent-color: #8b5cf6;">
                        <div class="bento-date">MAY<br>12</div>
                    </div>
                </div>
            </section>

            <!-- Tour Section -->
            <section class="section" id="tour">
                <div class="section-header-row">
                    <h2 class="section-title">Tour Dates</h2>
                    <div id="tourSectionActions" class="section-actions"></div>
                </div>

                <!-- Compact notify chip (replaces big banner) -->
                <div class="tour-notify-chip">
                    <span style="font-size:16px;">ðŸ””</span>
                    <span class="tour-notify-chip-text">Get presale codes &amp; new date alerts</span>
                    <button class="tour-notify-chip-btn">Notify Me</button>
                </div>

                <!-- On Sale card -->
                <div class="tour-card">
                    <div class="tour-card-accent accent-green"></div>
                    <div class="tour-header">
                        <div class="tour-date-block">
                            <div class="date-box">
                                <span class="date-month">Mar</span>
                                <span class="date-day">22</span>
                            </div>
                            <div class="tour-info">
                                <div class="tour-city">Los Angeles, CA</div>
                                <div class="tour-venue">ðŸ“ The Roxy Theatre</div>
                                <div class="tour-time">Doors 8:00 PM</div>
                            </div>
                        </div>
                        <div class="tour-status">
                            <span class="status-badge badge-onsale">On Sale</span>
                        </div>
                    </div>
                    <div class="tour-actions">
                        <button class="btn btn-primary btn-small" style="flex: 1;">Get Tickets</button>
                        <button class="btn btn-secondary btn-small">RSVP</button>
                    </div>
                </div>

                <!-- Limited / urgent card with scarcity bar -->
                <div class="tour-card urgent">
                    <div class="tour-card-accent accent-orange"></div>
                    <div class="tour-header">
                        <div class="tour-date-block">
                            <div class="date-box">
                                <span class="date-month">Apr</span>
                                <span class="date-day">05</span>
                            </div>
                            <div class="tour-info">
                                <div class="tour-city">San Francisco, CA</div>
                                <div class="tour-venue">ðŸ“ The Independent</div>
                                <div class="tour-time-capacity">
                                    <span class="tour-time">Doors 7:30 PM</span>
                                    <span style="font-size:10px;font-weight:800;color:#f59e0b;">Â· 23 left</span>
                                </div>
                                <div class="seat-bar">
                                    <div class="seat-bar-fill" style="width: 92%;"></div>
                                </div>
                            </div>
                        </div>
                        <div class="tour-status">
                            <span class="status-badge badge-limited">Limited</span>
                        </div>
                    </div>
                    <div class="tour-actions">
                        <button class="btn btn-primary btn-small" style="flex: 1;">Get Tickets</button>
                        <button class="btn btn-secondary btn-small">RSVP</button>
                    </div>
                </div>

                <!-- Coming soon card -->
                <div class="tour-card">
                    <div class="tour-card-accent accent-grey"></div>
                    <div class="tour-header">
                        <div class="tour-date-block">
                            <div class="date-box">
                                <span class="date-month">Apr</span>
                                <span class="date-day">18</span>
                            </div>
                            <div class="tour-info">
                                <div class="tour-city">Seattle, WA</div>
                                <div class="tour-venue">ðŸ“ Neumos</div>
                                <div class="tour-time">Doors 8:00 PM</div>
                            </div>
                        </div>
                        <div class="tour-status">
                            <span class="status-badge badge-upcoming">Coming Soon</span>
                        </div>
                    </div>
                    <div class="tour-actions">
                        <button class="btn btn-secondary btn-small" style="flex: 1;">Get Notified</button>
                    </div>
                </div>

                <div class="past-shows-toggle" id="pastShowsToggle">
                    Show Past Shows â–¼
                </div>
                <div class="past-shows" id="pastShows">
                    <div class="past-show">
                        <div class="past-show-info">
                            <div class="past-show-city">Portland, OR â€” Doug Fir Lounge</div>
                            <div class="past-show-date">January 28, 2025</div>
                        </div>
                        <span class="status-badge badge-soldout">Sold Out</span>
                    </div>
                    <div class="past-show">
                        <div class="past-show-info">
                            <div class="past-show-city">Denver, CO â€” Globe Hall</div>
                            <div class="past-show-date">January 15, 2025</div>
                        </div>
                        <span class="status-badge badge-soldout">Sold Out</span>
                    </div>
                </div>
            </section>

            <!-- Merch Section -->
            <section class="section" id="merch">
                <div class="section-header-row">
                    <h2 class="section-title">Merch</h2>
                    <div id="merchSectionActions" class="section-actions"></div>
                </div>
                <div class="merch-bento-grid">
                    <div class="merch-bento-tile size-large">
                        <div class="merch-bento-image" style="background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%);">
                            <span class="merch-badge badge-new">New</span>
                        </div>
                        <div class="merch-bento-info">
                            <div class="merch-bento-name">Midnight Drive Tee</div>
                            <div class="merch-bento-desc">100% Cotton â€¢ Multiple colors</div>
                            <div class="merch-bento-price">$35</div>
                        </div>
                    </div>
                    
                    <div class="merch-bento-tile size-medium">
                        <div class="merch-bento-image" style="background: linear-gradient(135deg, #1e3a5f 0%, #0d1b2a 100%);">
                            <span class="merch-badge badge-limited">Limited</span>
                        </div>
                        <div class="merch-bento-info">
                            <div class="merch-bento-name">Signed Vinyl LP</div>
                            <div class="merch-bento-desc">180g â€¢ Only 500 copies</div>
                            <div class="merch-bento-price">$45</div>
                        </div>
                    </div>
                    
                    <div class="merch-bento-tile size-small">
                        <div class="merch-bento-image" style="background: linear-gradient(135deg, #374151 0%, #1f2937 100%);">
                            <span class="merch-badge badge-sale">20% Off</span>
                        </div>
                        <div class="merch-bento-info">
                            <div class="merch-bento-name">Tour Hoodie</div>
                            <div class="merch-bento-price">$56</div>
                        </div>
                    </div>
                    
                    <div class="merch-bento-tile size-small">
                        <div class="merch-bento-image" style="background: linear-gradient(135deg, #7c3aed 0%, #4c1d95 100%);">
                        </div>
                        <div class="merch-bento-info">
                            <div class="merch-bento-name">Pin Set</div>
                            <div class="merch-bento-price">$15</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Fan Activity Feed -->
            <section class="section" id="activity">
                <h2 class="section-title">Live Activity</h2>
                <div class="activity-feed">
                    <div class="activity-item">
                        <div class="activity-icon">ðŸ”¥</div>
                        <div class="activity-text">
                            <span class="activity-user">Sarah</span> from Brooklyn pre-saved
                        </div>
                        <div class="activity-time">2m ago</div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">ðŸ’š</div>
                        <div class="activity-text">
                            <span class="activity-user">Jake</span> added to playlist
                        </div>
                        <div class="activity-time">5m ago</div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">ðŸŽ§</div>
                        <div class="activity-text">
                            <span class="activity-user">Emma</span> from LA is listening now
                        </div>
                        <div class="activity-time">8m ago</div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">âš¡</div>
                        <div class="activity-text">
                            <span class="activity-user">Marcus</span> shared on Instagram
                        </div>
                        <div class="activity-time">12m ago</div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">ðŸŽµ</div>
                        <div class="activity-text">
                            <span class="activity-user">Olivia</span> from Seattle pre-saved
                        </div>
                        <div class="activity-time">15m ago</div>
                    </div>
                </div>
                <div class="activity-stats">
                    <div class="stat-item">
                        <div class="stat-number">+247</div>
                        <div class="stat-label">Last Hour</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">1.2K</div>
                        <div class="stat-label">Today</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">12</div>
                        <div class="stat-label">Trending Cities</div>
                    </div>
                </div>
            </section>

            <!-- Related Artists Section -->
            <section class="section" id="artists">
                <h2 class="section-title">Artists I Recommend</h2>
                <div class="artists-grid">
                    <div class="artist-card">
                        <div class="artist-avatar">NV</div>
                        <div class="artist-info">
                            <div class="artist-card-name">
                                Nova Vex
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="var(--accent)"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
                            </div>
                            <div class="artist-genre">Electronic / Synthwave</div>
                        </div>
                        <button class="artist-follow-btn">Follow</button>
                    </div>
                    <div class="artist-card">
                        <div class="artist-avatar" style="background: linear-gradient(135deg, #ec4899 0%, #f59e0b 100%);">CL</div>
                        <div class="artist-info">
                            <div class="artist-card-name">Crystal Lake</div>
                            <div class="artist-genre">Ambient / Downtempo</div>
                        </div>
                        <button class="artist-follow-btn">Follow</button>
                    </div>
                    <div class="artist-card">
                        <div class="artist-avatar" style="background: linear-gradient(135deg, #10b981 0%, #06b6d4 100%);">MF</div>
                        <div class="artist-info">
                            <div class="artist-card-name">Midnight Flux</div>
                            <div class="artist-genre">House / Deep House</div>
                        </div>
                        <button class="artist-follow-btn">Follow</button>
                    </div>
                    <div class="artist-card">
                        <div class="artist-avatar" style="background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);">AE</div>
                        <div class="artist-info">
                            <div class="artist-card-name">Azure Echo</div>
                            <div class="artist-genre">Chillwave / Synth</div>
                        </div>
                        <button class="artist-follow-btn">Follow</button>
                    </div>
                    <div class="artist-card">
                        <div class="artist-avatar" style="background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);">PD</div>
                        <div class="artist-info">
                            <div class="artist-card-name">Pulse Drive</div>
                            <div class="artist-genre">Techno / Minimal</div>
                        </div>
                        <button class="artist-follow-btn">Follow</button>
                    </div>
                </div>
            </section>

            <!-- Support Section -->
            <section class="section" id="support">
                <div class="section-header-row">
                    <h2 class="section-title">Support</h2>
                    <div id="supportSectionActions" class="section-actions"></div>
                </div>
                <div class="support-card">
                    <div class="support-header">
                        <div>
                            <h3 class="support-title">Inner Circle</h3>
                            <span class="scarcity-badge">ðŸ”¥ 23 spots left</span>
                        </div>
                        <div class="support-price">$5<span>/mo</span></div>
                    </div>
                    <p class="support-desc">Exclusive access to unreleased tracks, behind-the-scenes content, and direct connection with Maya.</p>
                    <ul class="support-list">
                        <li class="support-item">Early releases</li>
                        <li class="support-item">Exclusive tracks</li>
                        <li class="support-item">Discord access</li>
                        <li class="support-item">Presale codes</li>
                    </ul>
                    <button class="btn btn-primary" id="innerCircleBtn" style="width: 100%;">Join Inner Circle</button>
                </div>
            </section>

            <!-- Behind The Scenes Polaroids -->
            <section class="section" id="bts">
                <h2 class="section-title">Behind The Scenes</h2>
                <div class="polaroid-grid">
                    <div class="polaroid" style="--rotation: -3deg;">
                        <div class="polaroid-photo">ðŸ“·</div>
                        <div class="polaroid-caption">Studio sessions</div>
                    </div>
                    <div class="polaroid" style="--rotation: 2deg;">
                        <div class="polaroid-photo">ðŸŽ¹</div>
                        <div class="polaroid-caption">New gear day</div>
                    </div>
                    <div class="polaroid" style="--rotation: -1deg;">
                        <div class="polaroid-photo">ðŸŽ¤</div>
                        <div class="polaroid-caption">Recording vocals</div>
                    </div>
                    <div class="polaroid" style="--rotation: 4deg;">
                        <div class="polaroid-photo">ðŸŒƒ</div>
                        <div class="polaroid-caption">Late night vibes</div>
                    </div>
                </div>
            </section>

            <!-- Subscribe Section -->
            <section class="section" id="subscribe">
                <h2 class="section-title">Stay Connected</h2>
                <div class="subscribe-card">
                    <div class="subscribe-form" id="subscribeForm">
                        <input type="email" class="subscribe-input" placeholder="Enter your email">
                        <button class="btn btn-primary">Subscribe</button>
                    </div>
                    <div class="subscribe-success" id="subscribeSuccess">
                        âœ“ You're subscribed! Check your inbox.
                    </div>
                </div>
            </section>

            <!-- QR Section -->
            <section class="section" id="qr">
                <h2 class="section-title">Share</h2>
                <div class="qr-card">
                    <div class="qr-label">Scan to visit</div>
                    <canvas id="qrCanvas" width="160" height="160"></canvas>
                    <div class="qr-url">able.to/mayarivers</div>
                    <div class="qr-info">Smart QR automatically routes to the right content</div>
                    <button class="btn btn-secondary" style="width: 100%;">Download QR Code</button>
                </div>
            </section>

        </div>

        <!-- Footer -->
        <footer class="page-footer">
            <div class="footer-release">Midnight Drive EP</div>
            <div class="footer-date">Drops March 15, 2025</div>
            <div class="footer-cta">
                <button class="btn btn-primary" id="footerCta">Pre-save on Spotify</button>
            </div>
            <div class="footer-brand">Powered by <a href="#">Able</a></div>
        </footer>

        <!-- Cart Button -->
        <button class="cart-button" id="cartButton">
            <span class="cart-count">2</span>
        </button>

        <!-- Back to Dashboard Button -->
        <a href="able-restore.html" target="_blank" class="back-to-dashboard" style="display:none; position: absolute; top: 20px; left: 20px; background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(10px); color: white; border: 1px solid rgba(255, 255, 255, 0.2); padding: 10px 16px; border-radius: 10px; font-weight: 600; font-size: 13px; cursor: pointer; z-index: 9999; display: flex; align-items: center; gap: 8px; transition: all 0.2s ease; text-decoration: none;">
            <span>â†</span>
            <span>Dashboard</span>
        </a>

        <!-- Theme Toggle -->
        <button class="theme-toggle" id="themeToggle">ðŸŒ™</button>

        <!-- Cart Panel -->
        <div class="cart-panel" id="cartPanel">
            <div class="cart-header">
                <h2 class="cart-title">Your Cart</h2>
                <button class="cart-close" id="cartClose">âœ•</button>
            </div>
            <div class="cart-items">
                <div class="cart-item">
                    <div class="cart-item-image"></div>
                    <div class="cart-item-info">
                        <div class="cart-item-name">Midnight Drive Tee</div>
                        <div class="cart-item-size">Size: M</div>
                        <div class="cart-item-price">$35</div>
                    </div>
                    <button class="cart-item-remove">âœ•</button>
                </div>
                <div class="cart-item">
                    <div class="cart-item-image" style="background: linear-gradient(135deg, #1e3a5f 0%, #0d1b2a 100%);"></div>
                    <div class="cart-item-info">
                        <div class="cart-item-name">Signed Vinyl LP</div>
                        <div class="cart-item-size">180g Limited Edition</div>
                        <div class="cart-item-price">$45</div>
                    </div>
                    <button class="cart-item-remove">âœ•</button>
                </div>
            </div>
            <div class="cart-footer">
                <div class="cart-total">
                    <span>Total</span>
                    <span>$80</span>
                </div>
                <button class="cart-checkout">Checkout</button>
            </div>
        </div>

        <!-- Popup Overlay -->
        <div class="popup-overlay" id="popupOverlay"></div>
        
        <!-- Event Popup -->
        <div class="event-popup" id="eventPopup">
            <button class="popup-close" id="popupClose">âœ•</button>
            <div class="popup-date" id="popupDate">March 15, 2025</div>
            <div class="popup-events" id="popupEvents">
                <!-- Events will be inserted here -->
            </div>
        </div>

    </div>

                </div>
            </div>
        </aside>
    </div>

    <!-- Add Quick Link Modal -->
    <div id="addLinkModal" class="modal-overlay">
        <div class="add-link-modal-content">
            <div class="cta-editor-header">
                <h2 class="cta-editor-title">Add a Quick Link</h2>
                <button onclick="closeAddLinkModal()" class="modal-close-btn">âœ•</button>
            </div>

            <!-- Live pill preview -->
            <div class="ql-modal-preview">
                <span class="ql-preview-label">Preview</span>
                <span id="addLinkPreviewPill" class="quick-link-pill-demo">ðŸ”— My Link</span>
            </div>

            <!-- Popular presets -->
            <div class="ql-popular-label">Popular</div>
            <div class="ql-popular-grid">
                <button class="ql-popular-tile" onclick="pickPreset('ðŸŸ¢','Stream on Spotify',event)">
                    <span class="ql-tile-emoji">ðŸŸ¢</span>
                    <span class="ql-tile-label">Spotify</span>
                </button>
                <button class="ql-popular-tile" onclick="pickPreset('ðŸŽµ','Apple Music',event)">
                    <span class="ql-tile-emoji">ðŸŽµ</span>
                    <span class="ql-tile-label">Apple Music</span>
                </button>
                <button class="ql-popular-tile" onclick="pickPreset('â–¶ï¸','Watch on YouTube',event)">
                    <span class="ql-tile-emoji">â–¶ï¸</span>
                    <span class="ql-tile-label">YouTube</span>
                </button>
                <button class="ql-popular-tile" onclick="pickPreset('ðŸŽ«','Get Tickets',event)">
                    <span class="ql-tile-emoji">ðŸŽ«</span>
                    <span class="ql-tile-label">Tickets</span>
                </button>
                <button class="ql-popular-tile" onclick="pickPreset('ðŸ›’','Shop Now',event)">
                    <span class="ql-tile-emoji">ðŸ›’</span>
                    <span class="ql-tile-label">Shop</span>
                </button>
                <button class="ql-popular-tile" onclick="pickPreset('ðŸ“±','Follow on TikTok',event)">
                    <span class="ql-tile-emoji">ðŸ“±</span>
                    <span class="ql-tile-label">TikTok</span>
                </button>
                <button class="ql-popular-tile" onclick="pickPreset('ðŸ’¿','Pre-save Now',event)">
                    <span class="ql-tile-emoji">ðŸ’¿</span>
                    <span class="ql-tile-label">Pre-save</span>
                </button>
                <button class="ql-popular-tile" onclick="pickPreset('ðŸ””','Get Notified',event)">
                    <span class="ql-tile-emoji">ðŸ””</span>
                    <span class="ql-tile-label">Newsletter</span>
                </button>
                <button class="ql-popular-tile" onclick="pickPreset('ðŸ’–','Support Me',event)">
                    <span class="ql-tile-emoji">ðŸ’–</span>
                    <span class="ql-tile-label">Support</span>
                </button>
                <button class="ql-popular-tile" onclick="pickPreset('ðŸ“§','Book This Artist',event)">
                    <span class="ql-tile-emoji">ðŸ“§</span>
                    <span class="ql-tile-label">Booking</span>
                </button>
                <button class="ql-popular-tile" onclick="pickPreset('ðŸŽ¸','Buy on Bandcamp',event)">
                    <span class="ql-tile-emoji">ðŸŽ¸</span>
                    <span class="ql-tile-label">Bandcamp</span>
                </button>
                <button class="ql-popular-tile" onclick="pickPreset('ðŸ¦','Follow on X',event)">
                    <span class="ql-tile-emoji">ðŸ¦</span>
                    <span class="ql-tile-label">Twitter / X</span>
                </button>
            </div>

            <!-- Show all presets toggle -->
            <button class="ql-show-more-btn" id="showMorePresetsBtn" onclick="toggleMorePresets()">+ Show more options</button>
            <div class="ql-more-grid" id="morePresetsGrid">

                <div class="ql-more-category">ðŸŽµ Music & Streaming</div>
                <div class="ql-more-chips">
                    <button class="ql-more-chip" onclick="pickPreset('ðŸŽ§','Listen on SoundCloud',event)">ðŸŽ§ SoundCloud</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸŽµ','Stream on Deezer',event)">ðŸŽµ Deezer</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸŽ¶','Listen on Tidal',event)">ðŸŽ¶ Tidal</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸ“»','Listen on Amazon Music',event)">ðŸ“» Amazon Music</button>
                    <button class="ql-more-chip" onclick="pickPreset('â–¶ï¸','Watch the Video',event)">â–¶ï¸ Music Video</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸŽ™ï¸','Podcast Episode',event)">ðŸŽ™ï¸ Podcast</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸ’½','Buy on Bandcamp',event)">ðŸ’½ Bandcamp</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸŽ¼','Sheet Music',event)">ðŸŽ¼ Sheet Music</button>
                </div>

                <div class="ql-more-category">ðŸŽ« Events & Tours</div>
                <div class="ql-more-chips">
                    <button class="ql-more-chip" onclick="pickPreset('ðŸŽ«','Buy Tickets',event)">ðŸŽ« Buy Tickets</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸ—“ï¸','See All Dates',event)">ðŸ—“ï¸ Tour Dates</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸŽŸï¸','VIP Experience',event)">ðŸŽŸï¸ VIP</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸŸï¸','Venue Info',event)">ðŸŸï¸ Venue</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸ“','Show Near Me',event)">ðŸ“ Shows Near Me</button>
                </div>

                <div class="ql-more-category">ðŸ›ï¸ Merch & Shop</div>
                <div class="ql-more-chips">
                    <button class="ql-more-chip" onclick="pickPreset('ðŸ›’','Shop Merch',event)">ðŸ›’ Merch</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸ‘•','Limited Drops',event)">ðŸ‘• Drops</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸ“¦','Fan Bundle',event)">ðŸ“¦ Bundle</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸŽ','Gift Cards',event)">ðŸŽ Gift Cards</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸ“€','Physical Album',event)">ðŸ“€ Buy Album</button>
                </div>

                <div class="ql-more-category">ðŸ“± Social Media</div>
                <div class="ql-more-chips">
                    <button class="ql-more-chip" onclick="pickPreset('ðŸ“¸','Follow on Instagram',event)">ðŸ“¸ Instagram</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸ“˜','Facebook Page',event)">ðŸ“˜ Facebook</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸ’¬','Join Discord',event)">ðŸ’¬ Discord</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸ“²','Snapchat',event)">ðŸ“² Snapchat</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸ’¼','LinkedIn',event)">ðŸ’¼ LinkedIn</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸŽ®','Twitch',event)">ðŸŽ® Twitch</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸ“º','Subscribe on YouTube',event)">ðŸ“º YouTube Channel</button>
                </div>

                <div class="ql-more-category">ðŸ’Œ Fan Engagement</div>
                <div class="ql-more-chips">
                    <button class="ql-more-chip" onclick="pickPreset('ðŸ“§','Join My Mailing List',event)">ðŸ“§ Mailing List</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸ””','Enable Notifications',event)">ðŸ”” Notifications</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸ’Œ','Send a Message',event)">ðŸ’Œ Message Me</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸ—³ï¸','Vote / Poll',event)">ðŸ—³ï¸ Vote</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸŽ¤','Fan Submissions',event)">ðŸŽ¤ Submit</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸ’–','Become a Patron',event)">ðŸ’– Patreon</button>
                    <button class="ql-more-chip" onclick="pickPreset('â˜•','Buy Me a Coffee',event)">â˜• Buy Me a Coffee</button>
                </div>

                <div class="ql-more-category">ðŸ“‹ About & Press</div>
                <div class="ql-more-chips">
                    <button class="ql-more-chip" onclick="pickPreset('ðŸ“„','Download Press Kit',event)">ðŸ“„ Press Kit</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸ“§','Booking Enquiries',event)">ðŸ“§ Booking</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸ¤','Collaboration',event)">ðŸ¤ Collab</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸ”—','My Website',event)">ðŸ”— Website</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸŽ“','Lessons',event)">ðŸŽ“ Lessons</button>
                    <button class="ql-more-chip" onclick="pickPreset('ðŸŽ¬','Behind The Scenes',event)">ðŸŽ¬ BTS</button>
                </div>

            </div>

            <div class="ql-divider">or create your own</div>

            <!-- Custom form -->
            <div class="ql-form-row" style="margin-bottom:14px;">
                <div class="form-group" style="width:72px; flex-shrink:0; margin-bottom:0;">
                    <label class="form-label">Icon</label>
                    <input type="text" id="addLinkIcon" class="form-input" style="text-align:center;font-size:20px;" placeholder="ðŸ”—" maxlength="4" oninput="updateAddLinkPreview()">
                </div>
                <div class="form-group" style="flex:1; margin-bottom:0;">
                    <label class="form-label">Label</label>
                    <input type="text" id="addLinkText" class="form-input" placeholder="e.g. Stream on Spotify" oninput="updateAddLinkPreview()">
                </div>
            </div>
            <div class="form-group" style="margin-bottom:20px;">
                <label class="form-label">URL <span style="font-weight:400; color:var(--text-tertiary);">â€” paste your link here</span></label>
                <input type="url" id="addLinkUrl" class="form-input" placeholder="https://...">
            </div>

            <button class="btn btn-primary" style="width:100%; padding:14px; font-size:15px; font-weight:800;" onclick="saveNewLink()">Add to Profile â†’</button>
        </div>
    </div>

    <!-- Edit Quick Link Modal -->
    <div id="ctaEditorModal" class="modal-overlay">
        <div class="cta-editor-content">
            <div class="cta-editor-header">
                <h2 class="cta-editor-title">Edit Quick Link</h2>
                <button onclick="closeCTAEditor()" class="modal-close-btn">âœ•</button>
            </div>

            <!-- Live pill preview -->
            <div class="ql-modal-preview" style="margin-bottom:16px;">
                <span class="ql-preview-label">Preview</span>
                <span id="editLinkPreviewPill" class="quick-link-pill-demo">ðŸ”— My Link</span>
            </div>

            <input type="hidden" id="editCTAId">

            <div class="ql-form-row" style="margin-bottom:14px;">
                <div class="form-group" style="width:72px; flex-shrink:0; margin-bottom:0;">
                    <label class="form-label">Icon</label>
                    <input type="text" id="editCTAIcon" class="form-input" style="text-align:center;font-size:20px;" placeholder="â–¶ï¸" maxlength="4" oninput="updateEditLinkPreview()">
                </div>
                <div class="form-group" style="flex:1; margin-bottom:0;">
                    <label class="form-label">Label</label>
                    <input type="text" id="editCTAText" class="form-input" placeholder="e.g., Listen Now" oninput="updateEditLinkPreview()">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">URL <span style="font-weight:400; color:var(--text-tertiary);">â€” paste your link here</span></label>
                <input type="url" id="editCTAUrl" class="form-input" placeholder="https://...">
            </div>

            <div class="cta-editor-actions" style="display:flex;gap:10px;margin-top:4px;">
                <button class="btn btn-primary" style="flex:1; padding:13px;" onclick="saveCTAEdit()">Save</button>
                <button class="btn btn-secondary" style="padding:13px 18px;" onclick="deleteCTAFromEditor()">ðŸ—‘</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast">
        <span id="toast-icon">âœ“</span>
        <span id="toast-message">Changes saved!</span>
    </div>

    <!-- Floating Preview Button (Mobile Only) -->
    <button id="mobilePreviewBtn" class="mobile-preview-btn" onclick="openMobilePreview()">
        <span>ðŸ‘ï¸</span>
        <span>Preview</span>
    </button>

    <!-- Mobile Preview Overlay -->
    <div id="mobilePreviewOverlay" class="mobile-preview-overlay" onclick="closeMobilePreview()">
        <div class="mobile-preview-container" onclick="event.stopPropagation()">
            <div class="mobile-preview-header">
                <div>
                    <div style="font-size: 16px; font-weight: 700;">Live Preview</div>
                    <div style="font-size: 12px; color: var(--text-tertiary); margin-top: 2px;">Updates in real-time</div>
                </div>
                <button onclick="closeMobilePreview()" class="mobile-preview-close">âœ•</button>
            </div>
            <div class="mobile-preview-body">
                <!-- Preview will be cloned here -->
                <div id="mobilePreviewContent"></div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal (Better than browser alert) -->
    <div id="confirmModal" class="modal-overlay">
        <div class="confirm-modal-content">
            <div class="confirm-modal-body">
                <div id="confirmIcon" class="confirm-modal-icon">âš ï¸</div>
                <div id="confirmTitle" class="confirm-modal-title">Are you sure?</div>
                <div id="confirmMessage" class="confirm-modal-message"></div>
            </div>
            <div class="confirm-modal-footer">
                <button id="confirmCancel" class="btn btn-secondary">Cancel</button>
                <button id="confirmOk" class="btn btn-danger">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Onboarding Step 2 mode-card styles -->
    <style>
        .ob-mode-card { display:flex;flex-direction:column;align-items:center;gap:6px;padding:14px 8px;border-radius:12px;border:2px solid var(--border);background:var(--bg-secondary);cursor:pointer;transition:border-color 0.15s,background 0.15s;font-family:inherit;width:100%; }
        .ob-mode-card:hover { border-color:#0891b2; }
        .ob-mode-card.selected { border-color:#0891b2;background:rgba(8,145,178,.1); }
    </style>

    <!-- Magic Moment Onboarding Modal -->
    <div id="onboardingModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="onboardingTitle">
        <div style="max-width:520px;width:90%;padding:28px 28px 24px;border-radius:16px;background:var(--bg-primary);position:relative;box-shadow:0 8px 32px rgba(0,0,0,.18);border:1px solid var(--border);">
            <h2 id="onboardingTitle" style="font-size:1.4rem;font-weight:700;margin:0 0 6px;color:var(--text-primary);">Set up your Able page</h2>
            <p style="color:var(--text-secondary);margin:0 0 16px;font-size:14px;line-height:1.5;">Paste your links below â€” Spotify, Apple Music, YouTube, Instagram and more. Able will auto-detect and add them as action buttons in seconds.</p>
            <textarea id="onboardingLinksInput" rows="7" placeholder="Paste your links here, one per line:
https://open.spotify.com/artist/...
https://instagram.com/yourhandle
https://youtube.com/yourchannel
https://ko-fi.com/yourname" style="width:100%;box-sizing:border-box;padding:12px 14px;border-radius:10px;border:1px solid var(--border);background:var(--bg-secondary);color:var(--text-primary);font-size:13px;font-family:inherit;resize:vertical;min-height:150px;display:block;"></textarea>
            <div id="onboardingWarn" style="display:none;margin-top:8px;padding:8px 12px;border-radius:8px;background:rgba(239,68,68,.08);color:#ef4444;font-size:13px;font-weight:500;"></div>
            <div style="display:flex;gap:10px;margin-top:18px;justify-content:flex-end;flex-wrap:wrap;">
                <button type="button" onclick="skipOnboarding()" style="padding:10px 18px;border-radius:9999px;border:1px solid var(--border);background:transparent;color:var(--text-secondary);font-size:14px;font-weight:500;cursor:pointer;line-height:1;">Skip for now</button>
                <button type="button" onclick="importOnboardingLinks()" style="padding:10px 22px;border-radius:9999px;border:none;background:#0891b2;color:#fff;font-size:14px;font-weight:600;cursor:pointer;line-height:1;">Import links</button>
            </div>
        </div>
    </div>

    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // REAL-TIME PREVIEW SYSTEM
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        // CTA State Management - Single Source of Truth
        let ctaState = {};
        
        // LocalStorage key
        const STORAGE_KEY = 'able_dashboard_ctas';

        // Music State â€” hoisted so DOMContentLoaded can safely call loadMusicState()
        const MUSIC_KEY = 'able_music_releases';
        const MUSIC_DISPLAY_MODE_KEY = 'able_music_display_mode';
        let musicState = { releases: [] };
        let musicDisplayMode = 'both'; // 'tracklist' | 'embeds' | 'both'

        // Profile Feed
        const PROFILE_POSTS_KEY = 'able_profile_posts_v1';
        const LAST_VISIT_KEY    = 'able_last_visit_ts';
        let profilePosts = { posts: [] };
        const AUTO_STATE_KEY = 'able_dashboard_autostate';

        // Section Actions â€” explicit per-section CTA assignments (able_section_actions_v1)
        const SECTION_ACTIONS_KEY = 'able_section_actions_v1';
        let sectionActionsState = {};

        // Load CTA state from localStorage
        function loadCTAState() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    ctaState = JSON.parse(saved);
                    return true;
                }
            } catch (error) {
                console.error('Failed to load CTA state:', error);
            }
            
            // Default state if nothing saved
            ctaState = {
                'listen-now': { active: true, text: 'Listen Now', icon: 'â–¶ï¸', order: 1, url: '' },
                'get-tickets': { active: true, text: 'Get Tickets', icon: 'ðŸŽ«', order: 2, url: '' },
                'shop-merch': { active: true, text: 'Shop Merch', icon: 'ðŸ›ï¸', order: 3, url: '' },
                'inner-circle': { active: true, text: 'Join Inner Circle', icon: 'ðŸ’', order: 4, url: '' },
                'instagram': { active: true, text: 'Follow on Instagram', icon: 'ðŸ“±', order: 5, url: '' },
                'presave': { active: false, text: 'Pre-save on Spotify', icon: 'ðŸ’¿', order: 6, url: '' }
            };
            return false;
        }
        
        // Save CTA state to localStorage
        function saveCTAState() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(ctaState));
            } catch (error) {
                console.error('Failed to save CTA state:', error);
            }
        }
        
        // Auto-save wrapper - call this after any state change
        function updateStateAndSave(updateFn) {
            updateFn();
            saveCTAState();
        }

        // Update preview when CTA is toggled â€” updates quick-links strip only
        // (Hero buttons are now driven by autoStateConfig.modes via updatePageState)
        // â”€â”€ Quick Links cap + "More" helper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // â”€â”€ CTA Dedupe helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // To see dedupe decisions in console: window._ableDedupeDebug = true
        window._ableDedupeDebug = false;

        // Normalise a URL for deduplication comparison only (does NOT mutate stored data):
        //   trim â†’ ensure https:// scheme â†’ lowercase hostname+path â†’ strip trailing slash
        function _normUrl(url) {
            if (!url) return '';
            url = url.trim();
            if (!/^https?:\/\//i.test(url)) url = 'https://' + url;
            try {
                const _u = new URL(url);
                return (_u.hostname + _u.pathname).toLowerCase().replace(/\/$/, '');
            } catch(e) {
                return url.toLowerCase().replace(/\/$/, '');
            }
        }

        // Return a Set of normalised hero button URLs for the current (or given) mode.
        // Reads directly from in-memory autoStateConfig â€” always matches the live preview state.
        function _getHeroUrlSet(mode) {
            const _m = mode || (typeof autoStateConfig !== 'undefined' && autoStateConfig.currentMode) || 'live';
            const _cfg = (typeof autoStateConfig !== 'undefined' && autoStateConfig.modes && autoStateConfig.modes[_m]) || {};
            const _urls = new Set();
            if (_cfg.primary   && _cfg.primary.url)  _urls.add(_normUrl(_cfg.primary.url));
            if (_cfg.secondary && _cfg.secondary.url) _urls.add(_normUrl(_cfg.secondary.url));
            _urls.delete(''); // empty string is not a real URL
            return _urls;
        }

        // sorted: array of [id, {active,text,icon,order,url}] already filtered + sorted
        // Returns inner HTML string for #quickLinksStrip.
        // sorted: [[id, {active,text,icon,order,url}], ...]  already filtered + sorted
        // stripEl: the actual DOM strip element â€” used to read its rendered width for the cap
        function buildQuickLinksPillsHtml(sorted, stripEl) {
            if (sorted.length === 0) return '';

            // Cap based on strip's RENDERED width (preview-frame width), not window width.
            // Falls back to 9999 (= show all) when the element hasn't been laid out yet.
            const w   = stripEl?.getBoundingClientRect?.().width || 9999;
            const cap = w < 768 ? 4 : 6;

            const visible  = sorted.slice(0, cap);
            const overflow = sorted.slice(cap);

            const pillHtml = ([, d], extraClass) =>
                `<a href="${escapeAttr(d.url || '#')}" target="_blank" ` +
                `class="quick-link-pill${extraClass}" rel="noopener" title="${escapeAttr(d.text || '')}">` +
                `<span class="pill-emoji">${d.icon}</span>` +
                `<span class="pill-label">${escapeHtml(d.text)}</span>` +
                `</a>`;

            let html = visible.map(e => pillHtml(e, '')).join('');

            if (overflow.length > 0) {
                // Overflow pills â€” hidden until "More" is clicked
                html += overflow.map(e => pillHtml(e, ' pill-overflow')).join('');
                // "More" control â€” type="button" prevents accidental form submission
                html +=
                    `<button type="button" class="quick-link-pill quick-link-more-btn" ` +
                    `onclick="toggleQuickLinksMore(this)" ` +
                    `aria-expanded="false" ` +
                    `data-count="${overflow.length}">` +
                    `+${overflow.length} more` +
                    `</button>`;
            }

            return html;
        }

        // Toggle the overflow panel open/closed
        function toggleQuickLinksMore(btn) {
            const strip = btn.closest('.quick-links-strip');
            if (!strip) return;
            const isOpen = strip.classList.toggle('ql-more-open');
            btn.setAttribute('aria-expanded', String(isOpen));
            btn.textContent = isOpen
                ? 'Less âœ•'
                : `+${btn.dataset.count} more`;
        }

        // â”€â”€ Quick Links re-render + ResizeObserver â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // Single source-of-truth for sorting + rendering the strip.
        // Also wires a ResizeObserver on first call so cap adjusts if the
        // preview panel is resized (e.g. window resize on desktop admin).
        let _qlObserver  = null;
        let _qlTimer     = null;
        let _qlRenderReq = null; // RAF handle for debounced sync renders
        let _ctaStateSnapshot = null; // snapshot for single-step undo after "Reset to defaults"

        function rerenderQuickLinksStrip() {
            const strip = document.getElementById('quickLinksStrip');
            if (!strip) return;

            // Wire ResizeObserver exactly once â€” fires whenever the strip's
            // container width changes (admin window resize, panel collapse, etc.)
            if (!_qlObserver && typeof ResizeObserver !== 'undefined') {
                _qlObserver = new ResizeObserver(() => {
                    // Debounce: wait for layout to settle before re-reading width
                    clearTimeout(_qlTimer);
                    _qlTimer = setTimeout(() => {
                        const s = document.getElementById('quickLinksStrip');
                        if (!s) return;
                        const _hU1 = _getHeroUrlSet();
                        const sortedNow = Object.entries(ctaState)
                            .filter(([, d]) => d.active && d.url && d.url.trim())
                            .filter(([, d]) => {
                                if (_hU1.has(_normUrl(d.url))) {
                                    if (window._ableDedupeDebug) console.log('DEDUPE: removed Quick Action \'' + d.text + '\' (matches Hero)');
                                    return false;
                                }
                                return true;
                            })
                            .sort(([, a], [, b]) => a.order - b.order);
                        s.classList.remove('ql-more-open');
                        s.innerHTML = buildQuickLinksPillsHtml(sortedNow, s);
                    }, 80);
                });
                _qlObserver.observe(strip);
            }

            // Coalesce multiple synchronous calls in the same event loop tick
            // (e.g. DOMContentLoaded triggers renderPreviewCTAStack AND updatePreviewCTA).
            if (_qlRenderReq) cancelAnimationFrame(_qlRenderReq);
            _qlRenderReq = requestAnimationFrame(() => {
                _qlRenderReq = null;
                const s = document.getElementById('quickLinksStrip');
                if (!s) return;
                const _hU2 = _getHeroUrlSet();
                const sorted = Object.entries(ctaState)
                    .filter(([, d]) => d.active && d.url && d.url.trim())
                    .filter(([, d]) => {
                        if (_hU2.has(_normUrl(d.url))) {
                            if (window._ableDedupeDebug) console.log('DEDUPE: removed Quick Action \'' + d.text + '\' (matches Hero)');
                            return false;
                        }
                        return true;
                    })
                    .sort(([, a], [, b]) => a.order - b.order);
                s.classList.remove('ql-more-open');
                s.innerHTML = buildQuickLinksPillsHtml(sorted, s);
            });
        }

        // Update the live preview strip (called after every admin toggle/edit).
        // Delegates sort + render to rerenderQuickLinksStrip() which also owns
        // the ResizeObserver â€” this avoids duplicating the cap logic.
        function updatePreviewCTA(ctaId, isActive) {
            rerenderQuickLinksStrip();

            // Flash feedback on the preview frame
            const frame = document.querySelector('.preview-frame');
            if (frame) {
                frame.classList.add('preview-updating');
                setTimeout(() => frame.classList.remove('preview-updating'), 1200);
            }
        }

        // Wire per-section action buttons â€” explicit assignments first, auto-detect fallback
        // for sections that have data sources (music/events/merch).
        function updateSectionActionBtns() {
            // Build combined URL exclusion set: hero URLs âˆª active quick-action URLs.
            // Section actions are lowest priority â€” no URL should appear in multiple zones.
            const _saHero = (typeof _getHeroUrlSet === 'function') ? _getHeroUrlSet() : new Set();
            const _saQuick = new Set(
                Object.values(typeof ctaState !== 'undefined' ? ctaState : {})
                    .filter(function(d) { return d.active && d.url && d.url.trim(); })
                    .map(function(d) { return _normUrl(d.url); })
            );
            const _saExclude = new Set([..._saHero, ..._saQuick]);
            _saExclude.delete('');

            // Helper: build one section-action-btn anchor
            function _btn(url, icon, text) {
                return '<a class="section-action-btn" href="' + escapeAttr(url || '#') + '" target="_blank" rel="noopener">'
                    + (icon ? icon + ' ' : '') + escapeHtml(text) + '</a>';
            }

            // Helper: populate a container with explicit actions OR auto-detected fallback
            function _render(containerId, sectionKey, autoFn) {
                const container = document.getElementById(containerId);
                if (!container) return;
                const explicit = (sectionActionsState[sectionKey] || []).filter(function(a) {
                    return a.enabled !== false;
                });
                if (explicit.length > 0) {
                    container.innerHTML = explicit
                        .filter(function(a) {
                            const cta = ctaState[a.id] || {};
                            const n = _normUrl(cta.url);
                            if (n && _saExclude.has(n)) {
                                if (window._ableDedupeDebug) console.log('DEDUPE: removed Section Action \'' + (cta.text || a.id) + '\' (matches Hero or Quick Action)');
                                return false;
                            }
                            return true;
                        })
                        .map(function(a) {
                            const cta = ctaState[a.id] || {};
                            return _btn(cta.url, cta.icon || '', cta.text || a.id);
                        }).join('');
                    return;
                }
                // No explicit actions â€” fall back to auto-detection (music/events/merch only)
                if (typeof autoFn === 'function') {
                    try {
                        const result = autoFn();
                        if (result && _saExclude.has(_normUrl(result.url))) {
                            if (window._ableDedupeDebug) console.log('DEDUPE: removed Section Action (auto) \'' + result.text + '\' (matches Hero or Quick Action)');
                            container.innerHTML = '';
                        } else {
                            container.innerHTML = result ? _btn(result.url, result.icon, result.text) : '';
                        }
                    } catch(e) { container.innerHTML = ''; }
                } else {
                    container.innerHTML = '';
                }
            }

            // â”€â”€ Music / Streaming â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            _render('streamingSectionActions', 'music', function() {
                const releases = JSON.parse(localStorage.getItem('able_music_releases') || '{"releases":[]}').releases || [];
                const first = releases[0];
                if (first && first.platforms) {
                    for (const p of ['spotify', 'apple', 'soundcloud', 'youtube', 'tiktok']) {
                        if (first.platforms[p]) return { url: first.platforms[p], icon: 'â–¶ï¸', text: 'Listen Now' };
                    }
                }
                return null;
            });

            // â”€â”€ Events / Tour â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            _render('tourSectionActions', 'events', function() {
                const events = JSON.parse(localStorage.getItem('able_events') || '[]');
                const today = new Date(); today.setHours(0, 0, 0, 0);
                const upcoming = events
                    .filter(function(e) { return e.ticketUrl && new Date(e.date) >= today; })
                    .sort(function(a, b) { return new Date(a.date) - new Date(b.date); });
                if (upcoming.length) return { url: upcoming[0].ticketUrl, icon: 'ðŸŽ«', text: 'Get Tickets' };
                return null;
            });

            // â”€â”€ Merch â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            _render('merchSectionActions', 'merch', function() {
                const shopUrl = localStorage.getItem('able_merch_shop_url') || '';
                if (shopUrl) return { url: shopUrl, icon: 'ðŸ›ï¸', text: 'Shop Now' };
                const products = JSON.parse(localStorage.getItem('able_merch') || '[]');
                const firstUrl = Array.isArray(products) && products[0] && products[0].url ? products[0].url : '';
                if (firstUrl) return { url: firstUrl, icon: 'ðŸ›ï¸', text: 'Shop Now' };
                return null;
            });

            // â”€â”€ Videos & Support â€” explicit only, no auto-detection â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            _render('videosSectionActions', 'videos', null);
            _render('supportSectionActions', 'support', null);
        }

        // â”€â”€ Section Actions: load / save â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        function loadSectionActionsState() {
            try {
                const saved = localStorage.getItem(SECTION_ACTIONS_KEY);
                if (saved) sectionActionsState = JSON.parse(saved);
            } catch(e) { sectionActionsState = {}; }
        }

        function saveSectionActionsState() {
            try { localStorage.setItem(SECTION_ACTIONS_KEY, JSON.stringify(sectionActionsState)); } catch(e) {}
        }

        // â”€â”€ Section Actions: admin add / remove / toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        function addSectionAction(sectionKey) {
            const sel = document.getElementById(sectionKey + 'SectionActionsSelect');
            if (!sel || !sel.value) return;
            const ctaId = sel.value;
            const list = sectionActionsState[sectionKey] || [];
            const hintEl = document.getElementById(sectionKey + 'SectionActionsHint');

            // Enforce max 2 active actions per section
            if (list.filter(function(a) { return a.enabled !== false; }).length >= 2) {
                if (hintEl) {
                    hintEl.textContent = 'Max 2 actions per section. Remove one to add another.';
                    hintEl.style.display = 'block';
                }
                return;
            }
            if (hintEl) hintEl.style.display = 'none';
            if (list.find(function(a) { return a.id === ctaId; })) return; // already added

            list.push({ id: ctaId, enabled: true });
            sectionActionsState[sectionKey] = list;
            saveSectionActionsState();
            sel.value = '';
            rebuildSectionActionsAdmin(sectionKey);
            populateSectionActionsSelect(sectionKey);
            updateSectionActionBtns();
        }

        function removeSectionAction(sectionKey, ctaId) {
            const list = sectionActionsState[sectionKey] || [];
            sectionActionsState[sectionKey] = list.filter(function(a) { return a.id !== ctaId; });
            saveSectionActionsState();
            rebuildSectionActionsAdmin(sectionKey);
            populateSectionActionsSelect(sectionKey);
            updateSectionActionBtns();
        }

        function toggleSectionAction(sectionKey, ctaId, enabled) {
            const list = sectionActionsState[sectionKey] || [];
            const entry = list.find(function(a) { return a.id === ctaId; });
            if (entry) { entry.enabled = enabled; saveSectionActionsState(); updateSectionActionBtns(); }
        }

        // â”€â”€ Section Actions: admin render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        function rebuildSectionActionsAdmin(sectionKey) {
            const listEl = document.getElementById(sectionKey + 'SectionActionsList');
            if (!listEl) return;
            const list = sectionActionsState[sectionKey] || [];
            if (list.length === 0) {
                listEl.innerHTML = '<p class="form-help" style="margin:0;padding:4px 0;">No actions added yet.</p>';
                return;
            }
            listEl.innerHTML = list.map(function(action) {
                const cta = ctaState[action.id] || {};
                const icon = cta.icon || 'ðŸ”—';
                const label = escapeHtml(cta.text || action.id);
                const isEnabled = action.enabled !== false;
                const sk = escapeAttr(sectionKey);
                const ci = escapeAttr(action.id);
                return '<div class="switch-group" style="padding:8px 0;">'
                    + '<div class="switch-info">'
                    +   '<div class="switch-label">' + icon + ' ' + label + '</div>'
                    +   '<div class="switch-help">Action link</div>'
                    + '</div>'
                    + '<div style="display:flex;gap:8px;align-items:center;">'
                    +   '<div class="switch' + (isEnabled ? ' active' : '') + '" '
                    +       'onclick="toggleSectionAction(\'' + sk + '\',\'' + ci + '\',this.classList.toggle(\'active\'))"></div>'
                    +   '<button type="button" '
                    +       'style="background:none;border:none;cursor:pointer;color:var(--text-secondary);padding:4px;font-size:14px;" '
                    +       'onclick="removeSectionAction(\'' + sk + '\',\'' + ci + '\')" title="Remove">âœ•</button>'
                    + '</div>'
                    + '</div>';
            }).join('');
        }

        function populateSectionActionsSelect(sectionKey) {
            const sel = document.getElementById(sectionKey + 'SectionActionsSelect');
            if (!sel) return;
            const list = sectionActionsState[sectionKey] || [];
            const addedIds = new Set(list.map(function(a) { return a.id; }));
            const options = Object.entries(ctaState)
                .filter(function(pair) { return !addedIds.has(pair[0]); })
                .map(function(pair) {
                    return '<option value="' + escapeAttr(pair[0]) + '">'
                        + pair[1].icon + ' ' + escapeHtml(pair[1].text) + '</option>';
                }).join('');
            sel.innerHTML = '<option value="">â€” Pick an action link â€”</option>' + options;
        }

        // Update preview CTA order â€” delegates to stack renderer
        function updatePreviewOrder() {
            const currentMode = document.querySelector('.mode-btn.active')?.dataset?.mode || 'live';
            updatePreviewCTA(null, null);
        }

        // Initialize preview system on page load
        function initializePreviewSystem() {
            // Load saved CTA state from localStorage
            loadCTAState();

            // Rebuild the UI â€” rebuildUIFromState calls initializeDragAndDropForItem
            // per item, so do NOT call initializeDragAndDrop() separately (double listeners).
            rebuildUIFromState();
        }

        // Rebuild preview from state â€” delegates to new stack renderer
        function rebuildPreviewFromState() {
            renderPreviewCTAStack('live');
            updatePreviewCTA(null, null); // refresh hero buttons too
        }

        // Rebuild the dashboard CTA list UI from saved ctaState
        function rebuildUIFromState() {
            try {
            const listContainer = document.querySelector('[data-content="ctas"] #ctaList');
            if (!listContainer) return;

            listContainer.innerHTML = '';

            const sorted = Object.entries(ctaState).sort((a, b) => a[1].order - b[1].order);

            // Show/hide empty state + add button + search
            const emptyState = document.getElementById('ctaEmptyState');
            const addBtn = document.getElementById('ctaAddBtn');
            const searchWrap = document.getElementById('ctaSearchWrap');
            const searchInput = document.getElementById('ctaSearchInput');
            if (emptyState) emptyState.style.display = sorted.length === 0 ? '' : 'none';
            if (addBtn) addBtn.style.display = sorted.length === 0 ? 'none' : '';
            if (searchWrap) searchWrap.style.display = sorted.length === 0 ? 'none' : '';
            if (searchInput) searchInput.value = ''; // reset filter on rebuild

            sorted.forEach(([ctaId, data]) => {
                const hasUrl = !!(data.url && data.url.trim());
                const pillClass = hasUrl ? '' : ' no-url-pill';
                const urlLine = hasUrl
                    ? `<span class="al-url-ok"><span style="color:#22c55e;font-size:9px;line-height:1;">â—</span>${escapeHtml(data.url)}</span>`
                    : `<span class="al-url-missing">â— URL missing</span>`;

                const item = document.createElement('div');
                item.className = 'list-item';
                item.setAttribute('draggable', 'true');
                item.setAttribute('data-cta-id', ctaId);
                item.style.cssText = `opacity:${data.active ? '1' : '0.45'}; padding:12px 0; border-bottom:1px solid var(--border);`;

                item.innerHTML = `
                    <span class="drag-handle">â ¿</span>
                    <div style="flex:1;min-width:0;">
                        <span class="ql-item-pill${pillClass}">${escapeHtml(data.icon)} ${escapeHtml(data.text)}</span>
                        <div class="ql-item-url-status">${urlLine}</div>
                    </div>
                    <div class="list-item-actions">
                        <button class="icon-btn" onclick="openCTAEditor('${ctaId}')" title="Edit link">âœï¸</button>
                        <div class="switch ${data.active ? 'active' : ''}" onclick="event.stopPropagation(); toggleCTASwitch(this.closest('.list-item'), '${ctaId}')"></div>
                    </div>
                `;

                listContainer.appendChild(item);
                initializeDragAndDropForItem(item);
            });

            updateActiveCTACount();
            // Keep diagram pills in sync
            if (typeof updateDiagramButtons === 'function') updateDiagramButtons();
            } catch(e) { console.warn('[rebuildUIFromState]', e); }
        }

        // Filter Action Links list by label text (client-side only â€” does not touch saved data)
        function filterCTAList(query) {
            const q = (query || '').trim().toLowerCase();
            const items = document.querySelectorAll('[data-content="ctas"] #ctaList .list-item');
            let visibleCount = 0;
            items.forEach(function(item) {
                if (!q) { item.style.display = ''; visibleCount++; return; }
                const pill = item.querySelector('.ql-item-pill');
                const label = pill ? pill.textContent.toLowerCase() : '';
                const show = label.includes(q);
                item.style.display = show ? '' : 'none';
                if (show) visibleCount++;
            });
            const noResults = document.getElementById('ctaSearchNoResults');
            if (noResults) noResults.style.display = (q && visibleCount === 0) ? '' : 'none';
        }

        // Render the Mode Map grid (kept for compatibility but no longer called from rebuildUIFromState)
        function renderStateModeMap() {
            const grid = document.getElementById('stateModeMapGrid');
            if (!grid) return;

            const modes = [
                { key: 'pre-release', label: 'Preâ€‘Release' },
                { key: 'live',        label: 'Live' },
                { key: 'profile',     label: 'Profile' },
                { key: 'gig',         label: 'Gig' }
            ];

            const active = Object.entries(ctaState)
                .filter(([, d]) => d.active)
                .sort(([, a], [, b]) => a.order - b.order);

            if (active.length === 0) {
                grid.innerHTML = '<div style="padding:20px;text-align:center;color:var(--text-tertiary);font-size:13px;">No active CTAs yet</div>';
                return;
            }

            const cols = `1.6fr repeat(${modes.length}, 1fr)`;
            let html = `<div style="display:grid;grid-template-columns:${cols};gap:1px;background:var(--border);border-radius:10px;overflow:hidden;font-size:12px;">`;

            // Header row
            html += `<div style="background:var(--bg-tertiary);padding:8px 10px;font-size:10px;font-weight:800;text-transform:uppercase;letter-spacing:0.05em;color:var(--text-tertiary);">Action Link</div>`;
            modes.forEach(m => {
                html += `<div style="background:var(--bg-tertiary);padding:8px;text-align:center;font-size:10px;font-weight:800;text-transform:uppercase;letter-spacing:0.04em;color:var(--text-tertiary);">${m.label}</div>`;
            });

            // Data rows
            active.forEach(([ctaId, data], idx) => {
                const posLabel = idx === 0 ? 'P1' : idx === 1 ? 'P2' : `Pill`;
                const posColor = idx === 0 ? 'var(--accent)' : idx === 1 ? 'var(--text-secondary)' : 'var(--text-tertiary)';
                const rowBg = idx % 2 === 0 ? 'var(--bg-secondary)' : 'var(--bg-primary, var(--bg-secondary))';

                html += `<div style="background:${rowBg};padding:10px;font-size:12.5px;font-weight:600;color:var(--text-primary);display:flex;align-items:center;gap:6px;overflow:hidden;">${data.icon} <span style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${escapeHtml(data.text)}</span></div>`;
                modes.forEach(() => {
                    html += `<div style="background:${rowBg};padding:10px;text-align:center;display:flex;align-items:center;justify-content:center;"><span style="font-size:10px;font-weight:800;text-transform:uppercase;letter-spacing:0.05em;color:${posColor};">${posLabel}</span></div>`;
                });
            });

            html += '</div>';
            grid.innerHTML = html;
        }

        // Preview a mode in the right panel from the CTAs tab
        function previewCTAMode(mode, btn) {
            document.querySelectorAll('.cta-mode-btn').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');
            updatePageState(mode);
            setActiveState(mode);
            showToast(`Preview: ${mode.replace('-', ' ').replace(/\b\w/g, c => c.toUpperCase())} mode`);
        }

        // Live preview of the custom CTA button as you type
        function updateCustomCTAPreview() {
            const text = document.getElementById('customCTAText')?.value || 'My Custom Link';
            const icon = document.getElementById('customCTAIcon')?.value || 'ðŸ“§';
            const btn  = document.getElementById('customCTAPreviewBtn');
            if (btn) btn.textContent = `${icon || 'ðŸ“§'} ${text || 'My Custom Link'}`;
        }

        // Create and add a custom CTA
        function createCustomCTA() {
            const text = document.getElementById('customCTAText')?.value?.trim();
            const icon = document.getElementById('customCTAIcon')?.value?.trim() || 'ðŸ”—';
            const url  = document.getElementById('customCTAUrl')?.value?.trim() || '';

            if (!text) { showToast('âš ï¸ Enter a button label first'); return; }

            const ctaId   = 'custom-' + Date.now();
            const maxOrder = Math.max(...Object.values(ctaState).map(d => d.order), 0);
            ctaState[ctaId] = { active: true, text, icon, order: maxOrder + 1, url };
            saveCTAState();
            rebuildUIFromState();
            updatePreviewCTA(null, null);

            // Clear form
            ['customCTAText', 'customCTAIcon', 'customCTAUrl'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.value = '';
            });
            updateCustomCTAPreview();
            showToast(`"${text}" added to your page!`);
        }

        // Scroll to the custom CTA panel
        function openCustomCTAPanel() {
            const panel = document.getElementById('customCTAPanel');
            if (panel) panel.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

                // Initialize drag and drop functionality
        function initializeDragAndDrop() {
            const ctaListItems = document.querySelectorAll('[data-content="ctas"] .list-item');
            
            ctaListItems.forEach(item => {
                // Make items draggable
                item.setAttribute('draggable', 'true');
                
                // Drag start
                item.addEventListener('dragstart', function(e) {
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/html', this.innerHTML);
                    this.classList.add('dragging');
                    this.style.opacity = '0.5';
                });
                
                // Drag end
                item.addEventListener('dragend', function(e) {
                    this.classList.remove('dragging');
                    this.style.opacity = '1';
                    
                    // Update order in state and preview
                    updateCTAOrder();
                });
                
                // Drag over
                item.addEventListener('dragover', function(e) {
                    if (e.preventDefault) {
                        e.preventDefault();
                    }
                    e.dataTransfer.dropEffect = 'move';
                    
                    const draggingItem = document.querySelector('.dragging');
                    if (draggingItem && draggingItem !== this) {
                        const allItems = [...this.parentNode.querySelectorAll('.list-item')];
                        const currentIndex = allItems.indexOf(this);
                        const draggingIndex = allItems.indexOf(draggingItem);
                        
                        if (currentIndex > draggingIndex) {
                            this.parentNode.insertBefore(draggingItem, this.nextSibling);
                        } else {
                            this.parentNode.insertBefore(draggingItem, this);
                        }
                    }
                    return false;
                });
            });
        }

        // Update CTA order after drag and drop
        function updateCTAOrder() {
            const ctaListItems = document.querySelectorAll('[data-content="ctas"] .list-item');

            // Update order in state
            ctaListItems.forEach((item, index) => {
                const ctaId = getCTAIdFromElement(item);
                if (ctaId && ctaState[ctaId]) {
                    ctaState[ctaId].order = index + 1;
                }
            });

            // Save state
            saveCTAState();

            // Update the profile preview CTAs
            updatePreviewOrder();

            // Rebuild list UI so position pills (PRIMARY/SECONDARY/PILL) reflect new order
            rebuildUIFromState();

            showToast('CTAs reordered');
        }

        // Helper: Get CTA ID from list item element
        function getCTAIdFromElement(element) {
            // Prefer the explicit data attribute set on each item
            const dataId = element.getAttribute('data-cta-id');
            if (dataId) return dataId;

            // Fallback: match by title text (for statically-rendered items)
            const titleElement = element.querySelector('.list-item-title');
            if (!titleElement) return null;
            const title = titleElement.textContent.trim();
            const ctaMap = {
                'Listen Now': 'listen-now',
                'Get Tickets': 'get-tickets',
                'Shop Merch': 'shop-merch',
                'Join Inner Circle': 'inner-circle',
                'Follow on Instagram': 'instagram',
                'Pre-save on Spotify': 'presave'
            };
            return ctaMap[title] || null;
        }

        // Phase 3: Text editing with live preview updates
        let editDebounceTimer = null;

        // Open CTA editor modal
        function openCTAEditor(ctaId) {
            const modal = document.getElementById('ctaEditorModal');
            const ctaData = ctaState[ctaId];
            if (!modal || !ctaData) return;

            document.getElementById('editCTAText').value = ctaData.text;
            document.getElementById('editCTAIcon').value = ctaData.icon;
            document.getElementById('editCTAId').value = ctaId;
            document.getElementById('editCTAUrl').value = ctaData.url || '';
            updateEditLinkPreview();

            modal.classList.add('active');
            setTimeout(() => {
                document.getElementById(ctaData.url ? 'editCTAText' : 'editCTAUrl').focus();
            }, 100);
        }

        function updateEditLinkPreview() {
            const icon = document.getElementById('editCTAIcon').value || 'ðŸ”—';
            const text = document.getElementById('editCTAText').value || 'My Link';
            const pill = document.getElementById('editLinkPreviewPill');
            if (pill) pill.textContent = icon + ' ' + text;
        }

        function deleteCTAFromEditor() {
            const ctaId = document.getElementById('editCTAId').value;
            if (!ctaId || !ctaState[ctaId]) return;
            const name = ctaState[ctaId].text;
            delete ctaState[ctaId];
            saveCTAState();
            rebuildUIFromState();
            updatePreviewCTA(null, null);
            closeCTAEditor();
            showToast(`"${name}" removed`);
        }

        // Close CTA editor modal
        function closeCTAEditor() {
            const modal = document.getElementById('ctaEditorModal');
            if (modal) {
                modal.classList.remove('active');
            }
        }

        // Update CTA text in real-time (debounced)
        function updateCTATextLive(ctaId, newText) {
            // Clear existing timer
            if (editDebounceTimer) {
                clearTimeout(editDebounceTimer);
            }
            
            // Debounce to avoid excessive updates
            editDebounceTimer = setTimeout(() => {
                // Update state
                if (ctaState[ctaId]) {
                    ctaState[ctaId].text = newText;
                }
                
                // Update preview
                const previewCTA = document.querySelector(`[data-preview-cta="${ctaId}"]`);
                if (previewCTA) {
                    const textSpan = previewCTA.querySelector('span');
                    if (textSpan) {
                        // Smooth transition
                        textSpan.style.transition = 'opacity 0.2s ease';
                        textSpan.style.opacity = '0';
                        
                        setTimeout(() => {
                            textSpan.textContent = newText;
                            textSpan.style.opacity = '1';
                            
                            // Sync mobile preview after update
                            setTimeout(() => syncMobilePreview(), 250);
                        }, 200);
                    }
                    
                    // Add update indicator
                    const previewFrame = document.querySelector('.preview-frame');
                    if (previewFrame) {
                        previewFrame.classList.add('preview-updating');
                        setTimeout(() => {
                            previewFrame.classList.remove('preview-updating');
                        }, 1500);
                    }
                }
                
                // Update dashboard list
                const listItems = document.querySelectorAll('[data-content="ctas"] .list-item');
                listItems.forEach(item => {
                    const itemId = getCTAIdFromElement(item);
                    if (itemId === ctaId) {
                        const titleEl = item.querySelector('.list-item-title');
                        if (titleEl) {
                            titleEl.textContent = newText;
                        }
                    }
                });
            }, 300); // 300ms debounce
        }

        // Update CTA icon in real-time
        function updateCTAIconLive(ctaId, newIcon) {
            if (ctaState[ctaId]) ctaState[ctaId].icon = newIcon;
            // Re-render the whole stack so hero buttons + cards stay in sync
            updatePreviewCTA(ctaId, ctaState[ctaId]?.active);
        }

        // Save CTA edits
        function saveCTAEdit() {
            const ctaId = document.getElementById('editCTAId').value;
            const newText = document.getElementById('editCTAText').value.trim();
            const newIcon = document.getElementById('editCTAIcon').value.trim() || 'ðŸ”—';
            const newUrl  = document.getElementById('editCTAUrl').value.trim();

            if (!newText) { showToast('âš ï¸ Label can\'t be empty'); return; }

            if (ctaState[ctaId]) {
                ctaState[ctaId].text = newText;
                ctaState[ctaId].icon = newIcon;
                ctaState[ctaId].url  = newUrl;
            }

            saveCTAState();
            rebuildUIFromState();
            updatePreviewCTA(null, null);
            closeCTAEditor();
            showToast('âœ“ Link saved');
        }

        // Phase 4: Add CTA from library with instant preview
        // Legacy: now just pre-fills and opens the unified Add Link modal
        function addCTAFromLibrary(ctaText, ctaIcon) {
            document.getElementById('addLinkIcon').value = ctaIcon || 'ðŸ”—';
            document.getElementById('addLinkText').value = ctaText || '';
            document.getElementById('addLinkUrl').value = '';
            updateAddLinkPreview();
            document.querySelectorAll('.ql-popular-tile.selected').forEach(t => t.classList.remove('selected'));
            openAddLinkModal();
        }

        // Open the Add Quick Link modal
        function openAddLinkModal(presetIcon, presetText) {
            document.getElementById('addLinkIcon').value = presetIcon || '';
            document.getElementById('addLinkText').value = presetText || '';
            document.getElementById('addLinkUrl').value = '';
            updateAddLinkPreview();
            document.querySelectorAll('.ql-popular-tile.selected').forEach(t => t.classList.remove('selected'));
            document.getElementById('addLinkModal').classList.add('active');
            // Focus URL if preset selected, otherwise icon
            setTimeout(() => {
                document.getElementById(presetIcon ? 'addLinkUrl' : 'addLinkIcon').focus();
            }, 120);
        }

        function closeAddLinkModal() {
            // Reset show-more grid on close
            const grid = document.getElementById('morePresetsGrid');
            const btn  = document.getElementById('showMorePresetsBtn');
            if (grid) grid.classList.remove('visible');
            if (btn)  btn.textContent = '+ Show more options';
            document.getElementById('addLinkModal').classList.remove('active');
        }

        function toggleMorePresets() {
            const grid = document.getElementById('morePresetsGrid');
            const btn  = document.getElementById('showMorePresetsBtn');
            if (!grid) return;
            const isOpen = grid.classList.toggle('visible');
            if (btn) btn.textContent = isOpen ? 'âˆ’ Hide options' : '+ Show more options';
        }

        // User taps a preset tile
        function pickPreset(icon, text, evt) {
            document.getElementById('addLinkIcon').value = icon;
            document.getElementById('addLinkText').value = text;
            updateAddLinkPreview();
            document.querySelectorAll('.ql-popular-tile.selected').forEach(t => t.classList.remove('selected'));
            if (evt && evt.currentTarget) evt.currentTarget.classList.add('selected');
            setTimeout(() => document.getElementById('addLinkUrl').focus(), 60);
        }

        // Update the preview pill in the Add modal
        function updateAddLinkPreview() {
            const icon = document.getElementById('addLinkIcon').value || 'ðŸ”—';
            const text = document.getElementById('addLinkText').value || 'My Link';
            const pill = document.getElementById('addLinkPreviewPill');
            if (pill) pill.textContent = icon + ' ' + text;
        }

        // Save the new link from the modal
        function saveNewLink() {
            const icon = document.getElementById('addLinkIcon').value.trim() || 'ðŸ”—';
            const text = document.getElementById('addLinkText').value.trim();
            const url  = document.getElementById('addLinkUrl').value.trim();

            if (!text) {
                document.getElementById('addLinkText').focus();
                showToast('âš ï¸ Add a label for the link');
                return;
            }

            const ctaId = 'ql-' + Date.now();
            const maxOrder = Object.values(ctaState).length > 0
                ? Math.max(...Object.values(ctaState).map(d => d.order || 0))
                : 0;
            ctaState[ctaId] = { active: true, text, icon, order: maxOrder + 1, url };
            saveCTAState();
            rebuildUIFromState();
            updatePreviewCTA(null, null);
            closeAddLinkModal();
            showToast(`âœ“ "${text}" added to your profile`);
            updateChecklist();
        }

        // Add CTA to dashboard list
        function addCTAToList(ctaId, text, icon) {
            const listContainer = document.querySelector('[data-content="ctas"] .card .list-item').parentNode;
            if (!listContainer) return;
            
            // Create new list item
            const newItem = document.createElement('div');
            newItem.className = 'list-item';
            newItem.setAttribute('draggable', 'true');
            newItem.style.animation = 'slideUp 0.3s ease';
            
            newItem.innerHTML = `
                <span class="drag-handle">â‹®â‹®</span>
                <div style="width: 40px; height: 40px; background: var(--bg-tertiary); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 20px;">${icon}</div>
                <div class="list-item-content">
                    <div class="list-item-title">${text}</div>
                    <div class="list-item-meta">Just added â€¢ 0 clicks</div>
                </div>
                <div class="list-item-actions">
                    <button class="icon-btn" onclick="openCTAEditor('${ctaId}')">âš™ï¸</button>
                    <div class="switch active" style="margin: 0 8px;" onclick="event.stopPropagation(); toggleCTASwitch(this.closest('.list-item'), '${ctaId}')"></div>
                </div>
            `;
            
            // Add before the last item (pre-save is always last)
            const lastItem = listContainer.querySelector('.list-item:last-child');
            if (lastItem) {
                listContainer.insertBefore(newItem, lastItem);
            } else {
                listContainer.appendChild(newItem);
            }
            
            // Re-initialize drag and drop for new item
            initializeDragAndDropForItem(newItem);
        }

        // Add CTA to preview â€” delegates to stack renderer
        function addCTAToPreview(ctaId, text, icon) {
            renderPreviewCTAStack(
                document.querySelector('.mode-btn.active')?.dataset?.mode || 'live'
            );
            updatePreviewCTA(ctaId, true);

            const previewFrame = document.querySelector('.preview-frame');
            if (previewFrame) {
                previewFrame.classList.add('preview-updating');
                setTimeout(() => previewFrame.classList.remove('preview-updating'), 1200);
            }
        }

        // Initialize drag and drop for a single item
        function initializeDragAndDropForItem(item) {
            // Guard: mark node so neither this function nor initCTADragAndDrop
            // can register duplicate listeners on the same element.
            if (item.dataset.dndInit) return;
            item.dataset.dndInit = '1';

            // Drag start
            item.addEventListener('dragstart', function(e) {
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/html', this.innerHTML);
                this.classList.add('dragging');
                this.style.opacity = '0.5';
            });
            
            // Drag end
            item.addEventListener('dragend', function(e) {
                this.classList.remove('dragging');
                updateCTAOrder(); // internally calls rebuildUIFromState()
            });
            
            // Drag over
            item.addEventListener('dragover', function(e) {
                if (e.preventDefault) {
                    e.preventDefault();
                }
                e.dataTransfer.dropEffect = 'move';
                
                const draggingItem = document.querySelector('.dragging');
                if (draggingItem && draggingItem !== this) {
                    const allItems = [...this.parentNode.querySelectorAll('.list-item')];
                    const currentIndex = allItems.indexOf(this);
                    const draggingIndex = allItems.indexOf(draggingItem);
                    
                    if (currentIndex > draggingIndex) {
                        this.parentNode.insertBefore(draggingItem, this.nextSibling);
                    } else {
                        this.parentNode.insertBefore(draggingItem, this);
                    }
                }
                return false;
            });
        }

        // Update active CTA count badge
        function updateActiveCTACount() {
            const activeCount = Object.values(ctaState).filter(c => c.active).length;
            // Update both possible badge selectors
            const badge1 = document.getElementById('activeCTABadge');
            const badge2 = document.querySelector('[data-content="ctas"] .badge-success');
            [badge1, badge2].forEach(b => { if (b) b.textContent = `${activeCount} Active`; });
        }

        // â”€â”€ Reset Action Links to defaults â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // Restores built-in order/active state; preserves user-entered URLs and any
        // custom links the artist added. Single-step undo via the Undo button.
        const _CTA_DEFAULTS = {
            'listen-now':   { text: 'Listen Now',          icon: 'â–¶ï¸', order: 1, active: true  },
            'get-tickets':  { text: 'Get Tickets',         icon: 'ðŸŽ«', order: 2, active: true  },
            'shop-merch':   { text: 'Shop Merch',          icon: 'ðŸ›ï¸', order: 3, active: true  },
            'inner-circle': { text: 'Join Inner Circle',   icon: 'ðŸ’', order: 4, active: true  },
            'instagram':    { text: 'Follow on Instagram', icon: 'ðŸ“±', order: 5, active: true  },
            'presave':      { text: 'Pre-save on Spotify', icon: 'ðŸ’¿', order: 6, active: false },
        };

        function resetActionLinksToDefaults() {
            if (!confirm(
                'Restore default Action Links?\n\n' +
                'This will:\n' +
                '  â€¢ Restore built-in links (Listen Now, Get Tickets, Shopâ€¦)\n' +
                '  â€¢ Reset their order\n' +
                '  â€¢ Keep all your custom URLs\n' +
                '  â€¢ Keep any links you added yourself\n\n' +
                'You can undo this immediately after.'
            )) return;

            // Snapshot for undo
            _ctaStateSnapshot = JSON.parse(JSON.stringify(ctaState));
            const undoBtn = document.getElementById('ctaUndoResetBtn');
            if (undoBtn) undoBtn.style.display = '';

            // Apply defaults â€” preserve existing URL; reset order, text, icon, active
            Object.entries(_CTA_DEFAULTS).forEach(([key, def]) => {
                const existing = ctaState[key] || {};
                ctaState[key] = { url: existing.url || '', order: def.order,
                                  text: def.text, icon: def.icon, active: def.active };
            });

            // Push user-added (non-built-in) keys to the end
            let nextOrder = Object.keys(_CTA_DEFAULTS).length + 1;
            Object.entries(ctaState).forEach(([key, data]) => {
                if (!_CTA_DEFAULTS[key]) data.order = nextOrder++;
            });

            saveCTAState();
            safeRender(rebuildUIFromState);
            safeRender(rerenderQuickLinksStrip);
            showToast('â†º Action Links reset â€” click Undo to reverse');
        }

        function undoResetActionLinks() {
            if (!_ctaStateSnapshot) return;
            ctaState = _ctaStateSnapshot;
            _ctaStateSnapshot = null;
            const undoBtn = document.getElementById('ctaUndoResetBtn');
            if (undoBtn) undoBtn.style.display = 'none';
            saveCTAState();
            safeRender(rebuildUIFromState);
            safeRender(rerenderQuickLinksStrip);
            showToast('â†© Undo complete');
        }

        // Enhanced toggle switch with preview update
        function toggleCTASwitch(element, ctaId) {
            const switchEl = element.querySelector('.switch');
            const listItem = element.closest('.list-item');
            const isCurrentlyActive = switchEl.classList.contains('active');
            const willBeActive = !isCurrentlyActive;
            
            // If disabling a primary CTA, confirm
            if (isCurrentlyActive && ctaId === 'listen-now') {
                const confirmed = confirm(
                    'âš ï¸ Hide "Listen Now"?\n\n' +
                    'This is your primary CTA. Fans won\'t be able to stream your music from your page.\n\n' +
                    'Are you sure?'
                );
                if (!confirmed) {
                    return; // Cancel the toggle
                }
            }
            
            // Toggle active state
            switchEl.classList.toggle('active');
            const isActive = switchEl.classList.contains('active');
            
            // Update state and save
            if (ctaState[ctaId]) {
                ctaState[ctaId].active = isActive;
                saveCTAState(); // Auto-save
            }
            
            // Update visual feedback on list item
            if (isActive) {
                listItem.style.opacity = '1';
            } else {
                listItem.style.opacity = '0.5';
            }
            
            // Capture name before rebuild removes the element
            const ctaName = (ctaState[ctaId] && ctaState[ctaId].text) || 'Link';

            // Update preview in real-time
            updatePreviewCTA(ctaId, isActive);

            // Rebuild list to reflect new state
            rebuildUIFromState();

            // Show toast notification
            showToast(isActive ? `${ctaName} enabled` : `${ctaName} disabled`);

            // Update checklist progress
            updateChecklist();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MOBILE PREVIEW OVERLAY
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function openMobilePreview() {
            const overlay = document.getElementById('mobilePreviewOverlay');
            const mobileContent = document.getElementById('mobilePreviewContent');
            const desktopPreview = document.getElementById('profilePreviewFrame');

            if (!overlay || !mobileContent || !desktopPreview) return;
            
            // Clone the preview frame
            const clonedPreview = desktopPreview.cloneNode(true);
            
            // Clear and append
            mobileContent.innerHTML = '';
            mobileContent.appendChild(clonedPreview);
            
            // Show overlay
            overlay.classList.add('active');
            
            // Prevent body scroll
            document.body.style.overflow = 'hidden';
        }
        
        function closeMobilePreview() {
            const overlay = document.getElementById('mobilePreviewOverlay');
            
            if (!overlay) return;
            
            // Hide overlay
            overlay.classList.remove('active');
            
            // Restore body scroll only if no modal or overlay is still blocking
            if (!document.querySelector('.modal-overlay.active, #fullPageOverlay.active')) {
                document.body.style.overflow = '';
            }
        }

        // Update mobile preview when it's open (sync with desktop preview)
        function syncMobilePreview() {
            const overlay = document.getElementById('mobilePreviewOverlay');

            // Only sync if mobile preview is open
            if (!overlay || !overlay.classList.contains('active')) return;

            const mobileContent = document.getElementById('mobilePreviewContent');
            const desktopPreview = document.getElementById('profilePreviewFrame');

            if (!mobileContent || !desktopPreview) return;
            
            // Re-clone to get latest state
            const clonedPreview = desktopPreview.cloneNode(true);
            mobileContent.innerHTML = '';
            mobileContent.appendChild(clonedPreview);
        }
        
        // Close on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeMobilePreview();
                closeConfirmModal();
                closeMobileMenu();
                // Close any open overlay modals
                document.querySelectorAll('.modal-overlay.active').forEach(m => closeModal(m.id));
            }
        });

        // Mobile menu functions
        function toggleMobileMenu() {
            const sidebar = document.querySelector('.sidebar');
            const backdrop = document.querySelector('.mobile-menu-backdrop');
            
            if (sidebar && backdrop) {
                sidebar.classList.toggle('mobile-open');
                backdrop.classList.toggle('active');
            }
        }

        function closeMobileMenu() {
            const sidebar = document.querySelector('.sidebar');
            const backdrop = document.querySelector('.mobile-menu-backdrop');
            
            if (sidebar && backdrop) {
                sidebar.classList.remove('mobile-open');
                backdrop.classList.remove('active');
            }
        }

        // Custom confirmation modal (better UX than browser confirm)
        let _confirmResolve = null;
        function showConfirm(title, message, icon = 'âš ï¸') {
            return new Promise((resolve) => {
                _confirmResolve = resolve;
                const modal = document.getElementById('confirmModal');
                const titleEl = document.getElementById('confirmTitle');
                const messageEl = document.getElementById('confirmMessage');
                const iconEl = document.getElementById('confirmIcon');
                const okBtn = document.getElementById('confirmOk');
                const cancelBtn = document.getElementById('confirmCancel');

                // Set content
                titleEl.textContent = title;
                messageEl.textContent = message;
                iconEl.textContent = icon;

                // Show modal
                modal.classList.add('active');

                // Handle clicks
                const handleOk = () => {
                    cleanup();
                    resolve(true);
                };

                const handleCancel = () => {
                    cleanup();
                    resolve(false);
                };

                const cleanup = () => {
                    modal.classList.remove('active');
                    _confirmResolve = null;
                    okBtn.removeEventListener('click', handleOk);
                    cancelBtn.removeEventListener('click', handleCancel);
                };

                okBtn.addEventListener('click', handleOk);
                cancelBtn.addEventListener('click', handleCancel);
            });
        }

        function closeConfirmModal() {
            const modal = document.getElementById('confirmModal');
            if (modal) modal.classList.remove('active');
            if (_confirmResolve) { _confirmResolve(false); _confirmResolve = null; }
        }

        // Clear all dashboard data (reset to defaults)
        function clearDashboardData() {
            // Custom confirmation with consequences
            const confirmed = confirm(
                'âš ï¸ Reset Dashboard?\n\n' +
                'This will:\n' +
                'â€¢ Delete all your CTAs\n' +
                'â€¢ Reset Auto-State settings\n' +
                'â€¢ Clear your customizations\n\n' +
                'This CANNOT be undone.\n\n' +
                'Are you sure you want to continue?'
            );
            
            if (!confirmed) {
                return;
            }
            
            // Double confirmation for safety
            const doubleCheck = confirm(
                'Last chance!\n\n' +
                'Your CTAs and settings will be permanently deleted.\n\n' +
                'Click OK to reset, or Cancel to keep your data.'
            );
            
            if (!doubleCheck) {
                showToast('Reset cancelled - your data is safe');
                return;
            }
            
            // Clear localStorage
            localStorage.removeItem(STORAGE_KEY);
            localStorage.removeItem(AUTO_STATE_KEY);
            
            // Show toast
            showToast('Dashboard reset to defaults');
            
            // Reload page to reset
            setTimeout(() => {
                window.location.reload();
            }, 1000);
        }

        function confirmDeleteAccount() {
            const confirmed = confirm(
                'âš ï¸ Delete Account?\n\n' +
                'This will permanently delete your artist page and all data.\n\n' +
                'This action CANNOT be undone.\n\n' +
                'Are you absolutely sure?'
            );
            if (!confirmed) return;
            const handle = document.getElementById('handle')?.value || 'your account';
            const typed = prompt(`Type "${handle}" to confirm deletion:`);
            if (typed && typed.trim() === handle.trim()) {
                showToast('Account deletion requested â€” you would be logged out here');
            } else {
                showToast('Deletion cancelled â€” text did not match');
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PREVIEW MODE SWITCHING
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        let currentPreviewMode = 'live';
        let currentHeroMode = 'live'; // tracks which mode tab is selected in the Hero Buttons card

        function switchPreviewMode(mode) {
            currentPreviewMode = mode;

            // Update active button state (profile header buttons + CTA tab mode bar + auto-state pills)
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.mode === mode);
            });
            document.querySelectorAll('.cta-mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.ctaMode === mode);
            });
            document.querySelectorAll('.as-mode-pill').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.asMode === mode);
            });

            // Update preview content based on mode
            updatePreviewForMode(mode);

            // Wire to embedded profile state system
            const previewModeMap = {'pre-release':'pre-release','live':'live','evergreen':'profile','gig':'gig'};
            const profileMode = previewModeMap[mode] || 'live';
            if (typeof updatePageState === 'function') {
                updatePageState(profileMode);
                setActiveState(profileMode);
            }

            // Persist the manually-selected mode so it survives refresh
            if (typeof autoStateConfig !== 'undefined') {
                autoStateConfig.currentMode = mode;
                if (typeof saveAutoStateConfig === 'function') saveAutoStateConfig();
            }

            const pf = document.getElementById('profilePreviewFrame');
            if (pf) pf.scrollTop = 0;
            setTimeout(() => syncMobilePreview(), 100);
            // Keep the Action Links diagram in sync with the active preview mode
            if (typeof updateDiagramButtons === 'function') updateDiagramButtons();
        }

        // Switch between mobile and desktop preview
        function switchPreviewDevice(device) {
            const previewFrame = document.querySelector('.preview-frame');
            if (!previewFrame) return;

            // Update button states via CSS class only (no inline style overrides)
            document.querySelectorAll('.preview-tab').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.device === device);
                // Clear any legacy inline styles
                btn.style.background = '';
                btn.style.color = '';
                btn.style.boxShadow = '';
            });

            // Switch preview frame class
            previewFrame.classList.toggle('desktop', device === 'desktop');
            previewFrame.classList.toggle('mobile',  device === 'mobile');
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // PREVIEW: mode config drives hero + CTA stack
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const previewModeConfig = {
            'pre-release': {
                stateBadge:    'Pre-Release',
                greeting:      'Dropping soon',
                showCountdown: true,
                gradient:      'linear-gradient(135deg,#1e1b4b 0%,#4c1d95 50%,#7c3aed 100%)',
                primaryCta:    { icon: 'â°', text: 'Pre-save Now' },
                secondaryCta:  { icon: 'ðŸ””', text: 'Get Notified' },
            },
            'live': {
                stateBadge:    'Out Now',
                greeting:      'Out now Â· Stream it',
                showCountdown: false,
                gradient:      'linear-gradient(135deg,#0891b2 0%,#06b6d4 100%)',
                primaryCta:    { icon: 'â–¶', text: 'Listen Now' },
                secondaryCta:  { icon: 'ðŸŽ«', text: 'Get Tickets' },
            },
            'evergreen': {
                stateBadge:    'Artist',
                greeting:      'Latest release',
                showCountdown: false,
                gradient:      'linear-gradient(135deg,#065f46 0%,#059669 100%)',
                primaryCta:    { icon: 'â–¶', text: 'Stream Now' },
                secondaryCta:  { icon: 'ðŸ“±', text: 'Follow on Instagram' },
            },
            'gig': {
                stateBadge:    'For Hire',
                greeting:      'Available for bookings',
                showCountdown: false,
                gradient:      'linear-gradient(135deg,#92400e 0%,#d97706 100%)',
                primaryCta:    { icon: 'ðŸŽ¸', text: 'Book This Artist' },
                secondaryCta:  { icon: 'ðŸ“„', text: 'Download Press Kit' },
            },
        };

        function updatePreviewForMode(mode) {
            const config = previewModeConfig[mode];
            if (!config) return;

            // Update gradient
            const sc = document.getElementById('previewShortContainer');
            if (sc) sc.style.background = config.gradient;

            // Update badges + greeting
            const badge = document.getElementById('previewStateBadge');
            if (badge) badge.textContent = config.stateBadge;

            const greeting = document.getElementById('previewGreeting');
            if (greeting) greeting.textContent = config.greeting;

            // Countdown visibility
            const countdown = document.getElementById('previewCountdown');
            if (countdown) countdown.style.display = config.showCountdown ? 'block' : 'none';

            // Hero buttons â€” driven by mode config
            const mainBtn = document.getElementById('previewMainCta');
            if (mainBtn) mainBtn.textContent = config.primaryCta.icon + ' ' + config.primaryCta.text;

            const secBtn = document.getElementById('previewSecondaryCta');
            if (secBtn) secBtn.textContent = config.secondaryCta.icon + ' ' + config.secondaryCta.text;

            // Re-render the CTA card stack (CTAs 3+)
            renderPreviewCTAStack(mode);

            // Flash transition
            const frame = document.querySelector('.preview-frame');
            if (frame) {
                frame.style.opacity = '0.6';
                frame.style.transform = 'scale(0.985)';
                setTimeout(() => {
                    frame.style.opacity = '1';
                    frame.style.transform = 'scale(1)';
                }, 140);
            }
        }

        function renderPreviewCTAStack(mode) {
            try {
            // Delegate to the unified updatePreviewCTA which handles the embedded profile
            updatePreviewCTA(null, null);
            } catch(e) { console.warn('[renderPreviewCTAStack]', e); }
        }

        // Legacy stub â€” kept so old callers don't break
        function updatePreviewHero(heroData) {
            // New preview doesn't use the old hero card â€” no-op
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // AUTO-STATE CONFIGURATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        let autoStateConfig = {
            enabled: true,
            releaseDate: null,
            releaseTitle: 'Midnight Drive',
            currentMode: 'live',
            autoSwitchDays: 7, // Days to stay in live mode before switching to evergreen
            modes: {
                'pre-release': { primary: {icon:'ðŸ’¿', text:'Pre-save on Spotify', url:''}, secondary: {icon:'ðŸ””', text:'Get Notified', url:''} },
                'live':        { primary: {icon:'â–¶ï¸', text:'Listen Now', url:''},          secondary: {icon:'ðŸŽ«', text:'Get Tickets', url:''} },
                'evergreen':   { primary: {icon:'ðŸŽµ', text:'Listen on Spotify', url:''},   secondary: {icon:'ðŸ“…', text:'Book a Show', url:''} },
                'gig':         { primary: {icon:'ðŸŽ«', text:'Get Tickets', url:''},          secondary: {icon:'â–¶ï¸', text:'Listen Now', url:''} }
            }
        };

        // Load auto-state config from localStorage
        function loadAutoStateConfig() {
            try {
                const saved = localStorage.getItem(AUTO_STATE_KEY);
                if (saved) {
                    const defaultModes = autoStateConfig.modes;
                    const parsed = JSON.parse(saved);
                    autoStateConfig = { ...autoStateConfig, ...parsed };
                    // Ensure modes defaults are present (for old saved data without modes field)
                    if (!autoStateConfig.modes) {
                        autoStateConfig.modes = defaultModes;
                    }
                }
            } catch (error) {
                console.error('Failed to load auto-state config:', error);
            }
        }

        // Save auto-state config to localStorage
        function saveAutoStateConfig() {
            try {
                localStorage.setItem(AUTO_STATE_KEY, JSON.stringify(autoStateConfig));
            } catch (error) {
                console.error('Failed to save auto-state config:', error);
            }
        }

        // Save a single mode CTA field and refresh preview if the mode is active
        function saveModeCTA(mode, slot, field, value) {
            if (!autoStateConfig.modes) autoStateConfig.modes = {};
            if (!autoStateConfig.modes[mode]) autoStateConfig.modes[mode] = {};
            if (!autoStateConfig.modes[mode][slot]) autoStateConfig.modes[mode][slot] = {};
            autoStateConfig.modes[mode][slot][field] = value;
            saveAutoStateConfig();
            // Refresh preview if this mode is currently active
            const modeToState = {'pre-release':'pre-release','live':'live','evergreen':'profile','gig':'gig'};
            if (currentPreviewMode === mode || (mode === 'evergreen' && currentPreviewMode === 'profile')) {
                if (typeof updatePageState === 'function') updatePageState(modeToState[mode] || mode);
            }
            // Keep diagram in sync
            if (typeof updateDiagramButtons === 'function') updateDiagramButtons();
        }

        // Populate Mode Buttons form fields from saved autoStateConfig.modes
        function populateModeCTAFields() {
            const modeKeys = [
                ['pre-release', 'prerelease'],
                ['live', 'live'],
                ['evergreen', 'evergreen'],
                ['gig', 'gig']
            ];
            modeKeys.forEach(([modeKey, idKey]) => {
                ['primary', 'secondary'].forEach(slot => {
                    const data = autoStateConfig?.modes?.[modeKey]?.[slot] || {};
                    const iconEl = document.getElementById(`modeCTA_${idKey}_${slot}_icon`);
                    const textEl = document.getElementById(`modeCTA_${idKey}_${slot}_text`);
                    const urlEl  = document.getElementById(`modeCTA_${idKey}_${slot}_url`);
                    if (iconEl) iconEl.value = data.icon || '';
                    if (textEl) textEl.value = data.text || '';
                    if (urlEl)  urlEl.value  = data.url  || '';
                });
            });
        }

        // â”€â”€â”€ Hero Buttons inline editor (Action Links tab) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        // Fill hero slot inputs for a given mode and update the preview buttons
        function populateHeroButtonsForm(mode) {
            mode = mode || currentHeroMode || 'live';
            currentHeroMode = mode;

            const cfg = autoStateConfig?.modes?.[mode] || {};
            const p = cfg.primary   || {};
            const s = cfg.secondary || {};

            const pIcon = document.getElementById('heroSlotPrimaryIcon');
            const pText = document.getElementById('heroSlotPrimaryText');
            const pUrl  = document.getElementById('heroSlotPrimaryUrl');
            const sIcon = document.getElementById('heroSlotSecondaryIcon');
            const sText = document.getElementById('heroSlotSecondaryText');
            const sUrl  = document.getElementById('heroSlotSecondaryUrl');

            if (pIcon) pIcon.value = p.icon || '';
            if (pText) pText.value = p.text || '';
            if (pUrl)  pUrl.value  = p.url  || '';
            if (sIcon) sIcon.value = s.icon || '';
            if (sText) sText.value = s.text || '';
            if (sUrl)  sUrl.value  = s.url  || '';

            updateHeroSlotPreview('primary');
            updateHeroSlotPreview('secondary');
            updateDiagramButtons();
        }

        // Switch the active mode tab in the Hero Buttons card
        function switchHeroMode(mode) {
            currentHeroMode = mode;
            document.querySelectorAll('#heroModeTabs .al-mode-tab').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.heroMode === mode);
            });
            populateHeroButtonsForm(mode);
        }

        // Update a preview button inside the Hero Buttons card from its inputs
        function updateHeroSlotPreview(slot) {
            const icon = document.getElementById(`heroSlot${slot.charAt(0).toUpperCase()+slot.slice(1)}Icon`)?.value?.trim() || '';
            const text = document.getElementById(`heroSlot${slot.charAt(0).toUpperCase()+slot.slice(1)}Text`)?.value?.trim() || (slot === 'primary' ? 'Primary Button' : 'Secondary Button');
            const preview = document.getElementById(`heroSlot${slot.charAt(0).toUpperCase()+slot.slice(1)}Preview`);
            if (preview) preview.textContent = (icon ? icon + ' ' : '') + text;
            updateDiagramButtons();
        }

        // Keep the diagram phone mock in sync with the currently-active preview mode
        function updateDiagramButtons() {
            // Use the preview mode (what fans will see) not the editing tab
            const activeMode = currentPreviewMode === 'profile' ? 'evergreen' : (currentPreviewMode || 'live');
            const cfg = autoStateConfig?.modes?.[activeMode] || {};
            const p = cfg.primary   || {};
            const s = cfg.secondary || {};

            const dPrimary   = document.getElementById('diagramPrimaryBtn');
            const dSecondary = document.getElementById('diagramSecondaryBtn');

            if (dPrimary)   dPrimary.textContent   = (p.icon ? p.icon + ' ' : 'â–¶ï¸ ') + (p.text || 'Listen Now');
            if (dSecondary) dSecondary.textContent  = (s.icon ? s.icon + ' ' : 'ðŸŽ« ') + (s.text || 'Get Tickets');

            // Artist name from profile
            const artistName   = document.getElementById('artistName')?.value?.trim();
            const artistHandle = document.getElementById('handle')?.value?.trim();
            const diagramName  = document.getElementById('diagramArtistName');
            if (diagramName && (artistName || artistHandle)) diagramName.textContent = artistName || artistHandle;

            // Action Links pills â€” show first 2 active CTAs
            const pillsRow = document.getElementById('diagramPillsRow');
            if (pillsRow && typeof ctaState !== 'undefined') {
                const active = Object.values(ctaState)
                    .filter(d => d.active)
                    .sort((a, b) => a.order - b.order);
                if (active.length > 0) {
                    const pill1 = active[0];
                    const pill2 = active[1];
                    pillsRow.innerHTML =
                        `<span class="quick-link-pill-demo">${pill1.icon || 'ðŸ”—'} ${pill1.text || 'Link'}</span>` +
                        (pill2 ? `<span class="quick-link-pill-demo">${pill2.icon || 'ðŸ”—'} ${pill2.text || 'Link'}</span>` : '') +
                        (active.length > 2 ? `<span class="quick-link-pill-demo" style="color:var(--text-tertiary);">+${active.length - 2} more</span>` : '') +
                        `<span class="al-diagram-pills-badge">â‘¢ Action Links</span>`;
                } else {
                    pillsRow.innerHTML =
                        `<span class="quick-link-pill-demo" style="color:var(--text-tertiary); border-style:dashed;">+ Add a link</span>` +
                        `<span class="al-diagram-pills-badge">â‘¢ Action Links</span>`;
                }
            }
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        // Toggle auto mode on/off
        function toggleAutoMode(element) {
            const switchEl = element.querySelector('.switch');
            const isCurrentlyActive = switchEl.classList.contains('active');
            
            // If disabling auto mode, confirm
            if (isCurrentlyActive) {
                const confirmed = confirm(
                    'âš ï¸ Disable Auto-State?\n\n' +
                    'Your page will stop adapting automatically to your release dates.\n\n' +
                    'You\'ll need to manually change modes instead.\n\n' +
                    'Continue?'
                );
                if (!confirmed) {
                    return; // Cancel
                }
            }
            
            switchEl.classList.toggle('active');
            
            autoStateConfig.enabled = switchEl.classList.contains('active');
            saveAutoStateConfig();
            
            // Update UI
            updateAutoStateUI();
            
            showToast(autoStateConfig.enabled ? 'Auto mode enabled' : 'Auto mode disabled');
        }

        // Set release date
        function setReleaseDate(dateString) {
            // Validate the date
            const validation = validateReleaseDate(dateString);
            
            if (!validation.valid) {
                showToast('âŒ ' + validation.message);
                return;
            }
            
            if (!dateString) {
                autoStateConfig.releaseDate = null;
            } else {
                autoStateConfig.releaseDate = dateString;
            }
            
            saveAutoStateConfig();
            calculateCurrentMode();
            updateAutoStateUI();
            updateOverviewTimeline(); // Update the overview timeline
            
            // Show confirmation toast
            if (dateString) {
                const date = new Date(dateString);
                const formatted = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                
                if (validation.warning) {
                    showToast(`âš ï¸ ${formatted} - ${validation.warning}`);
                } else {
                    showToast(`âœ“ Release date set to ${formatted}`);
                }
            }
            
            // Sync the profile-side date input (renamed to avoid ID clash)
            const profileDateEl = document.getElementById('releaseProfileDate');
            if (profileDateEl && dateString) {
                profileDateEl.value = dateString.includes('T') ? dateString : dateString + 'T00:00';
            }

            // Update checklist progress
            updateChecklist();

            // Mark release date task as complete
            markTaskComplete('setReleaseDate');
        }

        // Sync release date from profile preview input back to dashboard
        function syncReleaseDateFromProfile(datetimeValue) {
            if (!datetimeValue) return;
            const dateOnly = datetimeValue.split('T')[0];
            const dashboardInput = document.getElementById('releaseDate');
            if (dashboardInput) dashboardInput.value = dateOnly;
            setReleaseDate(dateOnly);
        }

        // Calculate what mode we should be in based on dates
        function calculateCurrentMode() {
            if (!autoStateConfig.enabled || !autoStateConfig.releaseDate) {
                autoStateConfig.currentMode = 'live';
                saveAutoStateConfig();
                return;
            }

            const now = new Date();
            const releaseDate = new Date(autoStateConfig.releaseDate);
            const daysDiff = Math.floor((now - releaseDate) / (1000 * 60 * 60 * 24));

            if (daysDiff < 0) {
                // Before release
                autoStateConfig.currentMode = 'pre-release';
            } else if (daysDiff <= autoStateConfig.autoSwitchDays) {
                // Within live window
                autoStateConfig.currentMode = 'live';
            } else {
                // After live window
                autoStateConfig.currentMode = 'evergreen';
            }

            saveAutoStateConfig();

            // Sync artist profile page state
            const profileModeMap = { 'pre-release': 'pre-release', 'live': 'live', 'evergreen': 'profile', 'gig': 'gig' };
            const profileMode = profileModeMap[autoStateConfig.currentMode] || 'live';
            if (typeof updatePageState === 'function') updatePageState(profileMode);
            if (typeof setActiveState === 'function') setActiveState(profileMode);

            // Sync dashboard preview hero buttons
            updatePreviewForMode(autoStateConfig.currentMode);
        }

        // Update auto-state UI to reflect current config
        function updateAutoStateUI() {
            // Update current mode badge
            const modeBadge = document.querySelector('#currentModeCard .badge-info');
            if (modeBadge) {
                const modeIcons = {
                    'pre-release': 'ðŸ’¿',
                    'live': 'â–¶ï¸',
                    'evergreen': 'ðŸŒŸ',
                    'gig': 'ðŸ’¼'
                };
                const modeNames = {
                    'pre-release': 'Pre-Release',
                    'live': 'Live Release',
                    'evergreen': 'Evergreen',
                    'gig': 'Gig Mode'
                };
                
                modeBadge.textContent = `${modeIcons[autoStateConfig.currentMode]} ${modeNames[autoStateConfig.currentMode]}`;
            }

            // Update description text
            const modeDescription = document.querySelector('#currentModeCard p');
            if (modeDescription) {
                if (autoStateConfig.releaseDate) {
                    const releaseDate = new Date(autoStateConfig.releaseDate);
                    const now = new Date();
                    const daysDiff = Math.floor((releaseDate - now) / (1000 * 60 * 60 * 24));
                    
                    if (daysDiff > 0) {
                        modeDescription.textContent = `Your release drops in ${daysDiff} day${daysDiff === 1 ? '' : 's'}. Fans see your Pre-save button and countdown.`;
                    } else if (daysDiff === 0) {
                        modeDescription.textContent = `Your release drops today! Fans see Listen Now button.`;
                    } else {
                        const daysAgo = Math.abs(daysDiff);
                        if (daysAgo <= autoStateConfig.autoSwitchDays) {
                            const daysLeft = autoStateConfig.autoSwitchDays - daysAgo;
                            modeDescription.textContent = `Released ${daysAgo} day${daysAgo === 1 ? '' : 's'} ago. In Live mode for ${daysLeft} more day${daysLeft === 1 ? '' : 's'}, then switches to Evergreen.`;
                        } else {
                            modeDescription.textContent = `Released ${daysAgo} days ago. Page switched to Evergreen mode. Fans see your standard profile.`;
                        }
                    }
                } else {
                    // No date set - show mode-specific descriptions
                    const modeDescriptions = {
                        'pre-release': 'Fans see your Pre-save button and release countdown.',
                        'live': 'Your page is showing in Live mode. Fans see your Listen Now button.',
                        'evergreen': 'Your page is in Evergreen mode. Fans see your standard profile.',
                        'gig': 'Your page is in Gig/Booking mode. Fans see booking options.'
                    };
                    modeDescription.textContent = modeDescriptions[autoStateConfig.currentMode];
                }
            }

            // Update timeline if it exists
            updateAutoStateTimeline();
        }

        // Update timeline visualization
        function updateAutoStateTimeline() {
            const timelineDiv = document.querySelector('#autoStateTimeline');
            if (!timelineDiv || !autoStateConfig.releaseDate) return;

            const releaseDate = new Date(autoStateConfig.releaseDate);
            const endLiveDate = new Date(releaseDate);
            endLiveDate.setDate(endLiveDate.getDate() + autoStateConfig.autoSwitchDays);

            const formatDate = (date) => {
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            };

            timelineDiv.innerHTML = `
                <div style="display: flex; gap: 8px; margin-bottom: 8px; align-items: center;">
                    <div style="flex: 1; text-align: center; padding: 8px; background: rgba(139, 92, 246, 0.1); border-radius: 6px;">
                        <div style="font-size: 11px; color: var(--text-tertiary); margin-bottom: 2px;">Before ${formatDate(releaseDate)}</div>
                        <div style="font-size: 13px; font-weight: 700;">ðŸ’¿ Pre-Release</div>
                    </div>
                    <div style="font-size: 18px; color: var(--text-tertiary);">â†’</div>
                    <div style="flex: 1; text-align: center; padding: 8px; background: rgba(16, 185, 129, 0.1); border-radius: 6px;">
                        <div style="font-size: 11px; color: var(--text-tertiary); margin-bottom: 2px;">${formatDate(releaseDate)} - ${formatDate(endLiveDate)}</div>
                        <div style="font-size: 13px; font-weight: 700;">â–¶ï¸ Live</div>
                    </div>
                    <div style="font-size: 18px; color: var(--text-tertiary);">â†’</div>
                    <div style="flex: 1; text-align: center; padding: 8px; background: rgba(8, 145, 178, 0.1); border-radius: 6px;">
                        <div style="font-size: 11px; color: var(--text-tertiary); margin-bottom: 2px;">After ${formatDate(endLiveDate)}</div>
                        <div style="font-size: 13px; font-weight: 700;">ðŸŒŸ Evergreen</div>
                    </div>
                </div>
            `;
        }

        // Update release title
        function updateReleaseTitle(title) {
            autoStateConfig.releaseTitle = title;
            saveAutoStateConfig();
            updateAutoStateUI();
        }

        // Update auto-switch days
        function updateAutoSwitchDays(days) {
            autoStateConfig.autoSwitchDays = parseInt(days);
            saveAutoStateConfig();
            calculateCurrentMode();
            updateAutoStateUI();
        }

        // Save auto-state settings
        function saveAutoStateSettings() {
            // Get values from form
            const title = document.getElementById('releaseTitle')?.value;
            const date = document.getElementById('releaseDate')?.value;
            const days = document.getElementById('autoSwitchDays')?.value;

            if (title) autoStateConfig.releaseTitle = title;
            if (days) autoStateConfig.autoSwitchDays = parseInt(days);
            
            // Save and recalculate
            saveAutoStateConfig();
            calculateCurrentMode();
            updateAutoStateUI();
            
            showToast('âœ“ Auto-State settings saved');
        }

        // Populate form fields on load
        function populateAutoStateForm() {
            const dateInput = document.getElementById('releaseDate');
            if (dateInput && autoStateConfig.releaseDate) {
                dateInput.value = autoStateConfig.releaseDate;
            }
        }

        // Toggle timeline visibility
        function toggleTimeline() {
            const content = document.getElementById('timelineContent');
            const icon = document.getElementById('timelineToggleIcon');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.style.transform = 'rotate(180deg)';
                icon.textContent = 'â–²';
                generateVisualTimeline(); // Generate the visual timeline
            } else {
                content.style.display = 'none';
                icon.style.transform = 'rotate(0deg)';
                icon.textContent = 'â–¼';
            }
        }

        // Generate visual timeline
        function generateVisualTimeline() {
            const timelineDiv = document.getElementById('autoStateTimeline');
            const releaseDate = autoStateConfig.releaseDate;
            
            if (!releaseDate) {
                timelineDiv.innerHTML = `
                    <div style="text-align: center; padding: 32px; color: var(--text-tertiary);">
                        <div style="font-size: 40px; margin-bottom: 12px;">ðŸ“…</div>
                        <div style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">Set a release date to see your timeline</div>
                        <div style="font-size: 13px;">Your timeline will show when your page switches between modes</div>
                    </div>
                `;
                return;
            }
            
            const release = new Date(releaseDate);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Calculate key dates
            const preReleaseDate = new Date(release);
            preReleaseDate.setDate(preReleaseDate.getDate() - 14); // 2 weeks before
            
            const liveEndDate = new Date(release);
            liveEndDate.setDate(liveEndDate.getDate() + 7); // 7 days after
            
            const evergreenDate = new Date(release);
            evergreenDate.setDate(evergreenDate.getDate() + 8); // 8 days after
            
            // Calculate current progress percentage
            let progressPercent = 0;
            const totalRange = evergreenDate - preReleaseDate;
            
            if (today < preReleaseDate) {
                progressPercent = 0;
            } else if (today >= evergreenDate) {
                progressPercent = 100;
            } else {
                progressPercent = ((today - preReleaseDate) / totalRange) * 100;
            }
            
            // Determine current mode
            let currentMode = 'pre-release';
            if (today >= evergreenDate) {
                currentMode = 'evergreen';
            } else if (today >= release) {
                currentMode = 'live';
            }
            
            // Highlight active mode card
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.remove('active');
            });
            document.getElementById('modeCard-' + currentMode)?.classList.add('active');
            
            // Format dates
            const formatDate = (date) => {
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            };
            
            const formatRelative = (date) => {
                const diff = Math.floor((date - today) / (1000 * 60 * 60 * 24));
                if (diff === 0) return 'Today';
                if (diff === 1) return 'Tomorrow';
                if (diff === -1) return 'Yesterday';
                if (diff > 0) return `In ${diff} days`;
                return `${Math.abs(diff)} days ago`;
            };
            
            timelineDiv.innerHTML = `
                <div class="timeline-container">
                    <div style="text-align: center; margin-bottom: 8px; font-size: 12px; font-weight: 600; color: var(--text-tertiary);">
                        YOUR AUTO-STATE TIMELINE
                    </div>
                    
                    <div class="timeline-track">
                        <div class="timeline-progress" style="width: ${progressPercent}%;"></div>
                        
                        <!-- Pre-Release Marker -->
                        <div class="timeline-marker ${currentMode === 'pre-release' ? 'active' : ''}" style="left: 0%;">
                            <div class="timeline-label ${currentMode === 'pre-release' ? 'active' : ''}">
                                ðŸ’¿ Pre-Release
                            </div>
                            <div class="timeline-date">
                                ${formatDate(preReleaseDate)}
                            </div>
                        </div>
                        
                        <!-- Release Day Marker -->
                        <div class="timeline-marker ${currentMode === 'live' && today < liveEndDate ? 'active' : ''}" style="left: 50%;">
                            <div class="timeline-label ${currentMode === 'live' ? 'active' : ''}">
                                â–¶ï¸ Release Day
                            </div>
                            <div class="timeline-date">
                                ${formatDate(release)}<br>
                                <strong style="color: var(--teal-600);">${formatRelative(release)}</strong>
                            </div>
                        </div>
                        
                        <!-- Evergreen Marker -->
                        <div class="timeline-marker ${currentMode === 'evergreen' ? 'active' : ''}" style="left: 100%;">
                            <div class="timeline-label ${currentMode === 'evergreen' ? 'active' : ''}">
                                ðŸŒŸ Evergreen
                            </div>
                            <div class="timeline-date">
                                ${formatDate(evergreenDate)}
                            </div>
                        </div>
                        
                        <!-- Phase Labels -->
                        <div class="timeline-phase" style="left: 0%; transform: translateX(0);">
                            Pre-Release Phase
                        </div>
                        <div class="timeline-phase" style="left: 50%; transform: translateX(-50%);">
                            Live Release (7 days)
                        </div>
                        <div class="timeline-phase" style="left: 100%; transform: translateX(-100%);">
                            Evergreen
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 8px;">
                        <div style="display: inline-flex; align-items: center; gap: 8px; padding: 8px 16px; background: var(--teal-50); border: 2px solid var(--teal-500); border-radius: 20px; font-size: 13px; font-weight: 600; color: var(--teal-700);">
                            ðŸ“ You are here: <strong>${currentMode === 'pre-release' ? 'Pre-Release Mode' : currentMode === 'live' ? 'Live Release Mode' : 'Evergreen Profile'}</strong>
                        </div>
                    </div>
                </div>
            `;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // THEME MANAGEMENT (Existing - Unchanged)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        // Theme Management - Synced with Artist Profile
        function setTheme(theme) {
            // Handle light theme (no attribute)
            if (theme === 'light') {
                document.documentElement.removeAttribute('data-theme');
            } else {
                document.documentElement.setAttribute('data-theme', theme);
            }
            
            // Save to localStorage (same key as artist profile)
            localStorage.setItem('able_theme', theme);
            
            // Update button states
            document.querySelectorAll('.theme-toggle-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            const themeBtn = document.getElementById(`theme-${theme}`);
            if (themeBtn) {
                themeBtn.classList.add('active');
            }
            
            // Show toast
            const themeNames = {
                light: 'â˜€ï¸ Light mode',
                dark: 'ðŸŒ™ Dark mode',
                contrast: 'ðŸŒ— Contrast mode'
            };
            showToast(`Switched to ${themeNames[theme]}`);
            
            // Update preview to match theme
            updatePreviewTheme(theme);
            try { applyAppearanceEverywhere(); } catch(e) {}

            // Reset charts so they re-render with correct theme colours
            if (typeof _activeCharts !== 'undefined') {
                _activeCharts.forEach(c => { try { c.destroy(); } catch(e) {} });
                _activeCharts = [];
                chartsInitialized = false;
            }

            // Update checklist progress
            updateChecklist();
        }

        // Update theme button active states in Appearance tab
        function updateThemeButtons(theme) {
            document.querySelectorAll('.theme-option').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-theme') === theme) {
                    btn.classList.add('active');
                }
            });
        }

        // Update preview panel to show how artist profile will look
        function updatePreviewTheme(theme) {
            const previewFrame = document.querySelector('.preview-frame');
            if (!previewFrame) return;
            
            // Apply theme to preview content
            if (theme === 'light') {
                previewFrame.removeAttribute('data-theme');
            } else if (theme === 'dark') {
                previewFrame.setAttribute('data-theme', 'dark');
            } else if (theme === 'contrast') {
                // Contrast mode: show preview in light mode (it's just a dashboard thing)
                previewFrame.removeAttribute('data-theme');
            }
        }

        // Load saved theme on page load
        // Update Overview Timeline Banner with Real Dates
        function updateOverviewTimeline() {
            const timelineSteps = document.getElementById('timelineSteps');
            const timelineSubtitle = document.getElementById('timelineSubtitle');
            
            if (!timelineSteps) return;
            
            const releaseDate = autoStateConfig.releaseDate ? new Date(autoStateConfig.releaseDate) : null;
            const now = new Date();
            
            // If no release date, show default state
            if (!releaseDate) {
                timelineSubtitle.textContent = 'Set a release date to see your automated timeline';
                timelineSteps.innerHTML = `
                    <div class="timeline-step">
                        <div class="timeline-step-icon">ðŸ’¿</div>
                        <div class="timeline-step-content">
                            <div class="timeline-step-label">PRE-RELEASE</div>
                            <div class="timeline-step-title">Build Hype Mode</div>
                            <div class="timeline-step-detail">Pre-save buttons & countdown</div>
                        </div>
                    </div>
                    <div class="timeline-step active">
                        <div class="timeline-step-icon">ðŸŒŸ</div>
                        <div class="timeline-step-content">
                            <div class="timeline-step-label">NOW</div>
                            <div class="timeline-step-title">Profile Mode</div>
                            <div class="timeline-step-detail">Set release date to activate Auto-State</div>
                        </div>
                    </div>
                    <div class="timeline-step">
                        <div class="timeline-step-icon">â–¶ï¸</div>
                        <div class="timeline-step-content">
                            <div class="timeline-step-label">NEXT</div>
                            <div class="timeline-step-title">Live Release Mode</div>
                            <div class="timeline-step-detail">When your track drops</div>
                        </div>
                    </div>
                    <div class="timeline-step">
                        <div class="timeline-step-icon">ðŸŽ¸</div>
                        <div class="timeline-step-content">
                            <div class="timeline-step-label">FUTURE</div>
                            <div class="timeline-step-title">Gig Mode</div>
                            <div class="timeline-step-detail">Tour dates & ticket sales</div>
                        </div>
                    </div>
                `;
                return;
            }
            
            // Calculate dates for each phase
            const preReleaseStart = new Date(releaseDate);
            preReleaseStart.setDate(preReleaseStart.getDate() - 14); // 14 days before
            
            const liveEnd = new Date(releaseDate);
            liveEnd.setDate(liveEnd.getDate() + autoStateConfig.autoSwitchDays); // configurable days after
            
            // Format dates
            const formatDate = (date) => {
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            };
            
            const formatFullDate = (date) => {
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            };
            
            // Calculate days until/since release
            const daysDiff = Math.floor((now - releaseDate) / (1000 * 60 * 60 * 24));
            const daysUntil = Math.abs(daysDiff);
            
            // Determine current mode
            const currentMode = autoStateConfig.currentMode || 'profile';
            
            // Update subtitle with countdown
            let subtitleText = 'Able automatically adapts your profile based on your release schedule';
            if (daysDiff < -14) {
                subtitleText = `Pre-Release starts in ${daysUntil - 14} days`;
            } else if (daysDiff < 0) {
                subtitleText = `ðŸ”¥ Release drops in ${daysUntil} days!`;
            } else if (daysDiff === 0) {
                subtitleText = `ðŸŽ‰ Release day is TODAY!`;
            } else if (daysDiff <= autoStateConfig.autoSwitchDays) {
                subtitleText = `Live Mode active - ${autoStateConfig.autoSwitchDays - daysDiff} days remaining`;
            } else {
                subtitleText = `In Evergreen Mode since ${formatDate(liveEnd)}`;
            }
            timelineSubtitle.textContent = subtitleText;
            
            // Build timeline HTML
            let html = '';
            
            // Pre-Release Step
            const preReleaseActive = daysDiff < 0 && daysDiff >= -14;
            html += `
                <div class="timeline-step ${preReleaseActive ? 'active' : ''}">
                    <div class="timeline-step-icon">ðŸ’¿</div>
                    <div class="timeline-step-content">
                        <div class="timeline-step-label">${daysDiff < -14 ? 'UPCOMING' : (preReleaseActive ? 'NOW' : 'COMPLETED')}</div>
                        <div class="timeline-step-title">Pre-Release Mode</div>
                        <div class="timeline-step-detail">${formatDate(preReleaseStart)} - ${formatDate(releaseDate)}</div>
                    </div>
                </div>
            `;
            
            // Live Release Step
            const liveActive = daysDiff >= 0 && daysDiff <= autoStateConfig.autoSwitchDays;
            html += `
                <div class="timeline-step ${liveActive ? 'active' : ''}">
                    <div class="timeline-step-icon">â–¶ï¸</div>
                    <div class="timeline-step-content">
                        <div class="timeline-step-label">${daysDiff < 0 ? 'UPCOMING' : (liveActive ? 'NOW' : 'COMPLETED')}</div>
                        <div class="timeline-step-title">Live Release Mode</div>
                        <div class="timeline-step-detail">${formatFullDate(releaseDate)} ${daysDiff === 0 ? 'ðŸŽ‰' : ''}</div>
                    </div>
                </div>
            `;
            
            // Evergreen Step
            const evergreenActive = daysDiff > autoStateConfig.autoSwitchDays;
            html += `
                <div class="timeline-step ${evergreenActive ? 'active' : ''}">
                    <div class="timeline-step-icon">ðŸŒŸ</div>
                    <div class="timeline-step-content">
                        <div class="timeline-step-label">${evergreenActive ? 'NOW' : 'FUTURE'}</div>
                        <div class="timeline-step-title">Evergreen Mode</div>
                        <div class="timeline-step-detail">After ${formatDate(liveEnd)}</div>
                    </div>
                </div>
            `;
            
            // Gig Mode (placeholder - future feature)
            html += `
                <div class="timeline-step">
                    <div class="timeline-step-icon">ðŸŽ¸</div>
                    <div class="timeline-step-content">
                        <div class="timeline-step-label">OPTIONAL</div>
                        <div class="timeline-step-title">Gig Mode</div>
                        <div class="timeline-step-detail">Set tour dates to activate</div>
                    </div>
                </div>
            `;
            
            timelineSteps.innerHTML = html;
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Check for theme in localStorage (matches artist profile key)
            const savedTheme = localStorage.getItem('able_theme') || 'light';
            
            // Ensure saved theme is valid
            const validThemes = ['light', 'dark', 'contrast'];
            const themeToLoad = validThemes.includes(savedTheme) ? savedTheme : 'light';
            
            setTheme(themeToLoad);
            
            // Initialize real-time preview system
            initializePreviewSystem();
            
            // Initialize auto-state config
            loadAutoStateConfig();
            calculateCurrentMode();
            
            // Wait for DOM to be ready, then populate and update UI
            setTimeout(() => {
                populateAutoStateForm();
                populateModeCTAFields(); // Fill Mode Buttons form from saved config
                populateHeroButtonsForm(currentPreviewMode || 'live'); // Fill Hero Buttons card
                updateAutoStateUI();
                updateOverviewTimeline(); // Update timeline with real dates
                updateChecklist(); // Check progress on load
                _initOverviewGreeting(); // Set time-based greeting
                // Sync preview URL handle
                const _urlH = document.getElementById('previewUrlHandle');
                if (_urlH) {
                    const _h = document.getElementById('handle')?.value?.trim();
                    if (_h) _urlH.textContent = _h;
                }
                populateProfileForm(); // Load profile data
                if (typeof updateDiagramButtons === 'function') updateDiagramButtons(); // Refresh diagram with artist name
                initializePalette(); // Load color palette
                initializeBrandColor(); // Load brand color
                initializeAppearanceSettings(); // Load appearance settings
                initializeTier1Settings(); // Load Tier 1 customizations
                try { applyAppearanceEverywhere(); } catch(e) {} // Sync appearance to all profile surfaces

                // Load music releases and render
                loadMusicState();
                (function() {
                    var _saved = localStorage.getItem(MUSIC_DISPLAY_MODE_KEY);
                    if (_saved && ['tracklist','embeds','both'].includes(_saved)) musicDisplayMode = _saved;
                })();
                renderMusicTab();
                updatePreviewMusic();

                // Load and render profile feed
                loadProfilePosts();
                renderFeedAdmin();
                renderProfileFeed();

                // Populate merch shop URL
                populateMerchShopUrl();

                // Load section actions state and initialise admin UI
                loadSectionActionsState();
                ['music', 'videos', 'events', 'merch', 'support'].forEach(function(k) {
                    rebuildSectionActionsAdmin(k);
                    populateSectionActionsSelect(k);
                });
                updateSectionActionBtns();

                // Render preview with correct initial state
                renderPreviewCTAStack('live');
                updatePreviewForMode('live');
                
                // Set min date to today for release date picker
                const releaseDateInput = document.getElementById('releaseDate');
                if (releaseDateInput) {
                    const today = new Date().toISOString().split('T')[0];
                    releaseDateInput.setAttribute('min', today);
                }

                // Apply saved objective mode (silently, no onboarding)
                var _savedObjMode = localStorage.getItem(OBJECTIVE_MODE_KEY);
                if (_savedObjMode) setObjectiveMode(_savedObjMode);
            }, 100);

            // Show onboarding modal for new users (after UI is fully ready)
            setTimeout(function() {
                if (localStorage.getItem(ONBOARDING_KEY) !== 'true') {
                    openOnboardingModal();
                }
            }, 600);

            // Setup mobile menu close on nav click
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    if (window.innerWidth <= 1200) {
                        closeMobileMenu();
                    }
                });
            });
            
            // Setup appearance section scroll listener for auto-highlighting
            const appearanceTab = document.querySelector('[data-content="appearance"]');
            if (appearanceTab) {
                appearanceTab.addEventListener('scroll', updateActiveNavOnScroll);
            }
        });

        // ============================================
        // PROFILE MANAGEMENT
        // ============================================
        
        const PROFILE_KEY = 'able_profile_data';
        
        // Default profile data
        const defaultProfile = {
            artistName: 'Maya Rivers',
            handle: 'mayarivers',
            bio: 'Indie soul artist exploring the space between midnight and dawn.',
            location: 'Los Angeles, CA',
            genres: 'Indie Soul, Alternative R&B',
            profileImage: null
        };
        
        // Load profile data
        function loadProfile() {
            try {
                const saved = localStorage.getItem(PROFILE_KEY);
                return saved ? JSON.parse(saved) : defaultProfile;
            } catch (e) {
                console.error('Error loading profile:', e);
                return defaultProfile;
            }
        }
        
        // Save profile data
        function saveProfileData(profileData) {
            try {
                localStorage.setItem(PROFILE_KEY, JSON.stringify(profileData));
                return true;
            } catch (e) {
                console.error('Error saving profile:', e);
                return false;
            }
        }
        
        // Populate profile form
        function populateProfileForm() {
            const profile = loadProfile();
            
            document.getElementById('artistName').value = profile.artistName || '';
            document.getElementById('handle').value = profile.handle || '';
            document.getElementById('bio').value = profile.bio || '';
            document.getElementById('location').value = profile.location || '';
            document.getElementById('genres').value = profile.genres || '';
            
            // Update character counters
            updateCharCounter('bio', 200);
            updateCharCounter('artistName', 50);
            updateCharCounter('handle', 30);
            
            // Load profile image if exists
            if (profile.profileImage) {
                showProfileImage(profile.profileImage);
            }
        }
        
        // Update character counter
        function updateCharCounter(fieldId, maxLength) {
            const field = document.getElementById(fieldId);
            const counter = document.getElementById(fieldId + 'Counter');
            
            if (field && counter) {
                const length = field.value.length;
                counter.textContent = `${length} / ${maxLength}`;
                
                if (length > maxLength * 0.9) {
                    counter.classList.add('warning');
                } else {
                    counter.classList.remove('warning');
                }
            }
        }

        // ============================================
        // BRAND COLOR MANAGEMENT
        // ============================================
        
        const BRAND_COLOR_KEY = 'able_brand_color';
        
        // Load brand color
        function loadBrandColor() {
            try {
                return localStorage.getItem(BRAND_COLOR_KEY) || '#0891b2';
            } catch (e) {
                return '#0891b2';
            }
        }
        
        // Save brand color
        function saveBrandColor(color) {
            try {
                localStorage.setItem(BRAND_COLOR_KEY, color);
                return true;
            } catch (e) {
                console.error('Error saving brand color:', e);
                return false;
            }
        }
        
        // Set brand color (from preset buttons)
        function setBrandColor(color, buttonElement) {
            // Update CSS variables
            updateBrandColorVariables(color);
            
            // Save to localStorage
            saveBrandColor(color);
            
            // Update active state on buttons
            document.querySelectorAll('.color-preset').forEach(btn => {
                btn.classList.remove('active');
            });
            if (buttonElement) {
                buttonElement.classList.add('active');
            }
            
            // Update color picker input value
            const brandPicker = document.getElementById('brandColorPicker');
            if (brandPicker) brandPicker.value = color;
            
            // Update preview
            updatePreviewBrandColor(color);
            // Wire to embedded profile
            const profileRoot = document.getElementById('profilePreviewRoot');
            if (profileRoot) {
                profileRoot.style.setProperty('--accent', color);
                profileRoot.style.setProperty('--accent-hover', adjustBrightness(color, -15));
                profileRoot.style.setProperty('--accent-soft', color + '20');
            }
            showToast('âœ“ Brand color updated');
        }
        
        // Set brand color from custom picker
        function setBrandColorFromPicker(color) {
            // Update CSS variables
            updateBrandColorVariables(color);
            
            // Save to localStorage
            saveBrandColor(color);
            
            // Update active state to custom button
            document.querySelectorAll('.color-preset').forEach(btn => {
                btn.classList.remove('active');
            });
            const customBtn = document.getElementById('customBrandColorBtn');
            if (customBtn) {
                customBtn.classList.add('active');
                customBtn.style.background = color;
            }
            
            // Update preview
            updatePreviewBrandColor(color);
            
            // Show success toast
            showToast('âœ“ Custom color applied');
        }
        
        // ============================================
        // COLOR PALETTE SYSTEM
        // ============================================
        
        const PALETTE_KEY = 'able_color_palette';
        
        // Load saved palette
        function loadPalette() {
            try {
                const saved = localStorage.getItem(PALETTE_KEY);
                return saved ? JSON.parse(saved) : {
                    name: 'ocean',
                    primary: '#0891b2',
                    secondary: '#06b6d4',
                    tertiary: '#67e8f9'
                };
            } catch (e) {
                return {
                    name: 'ocean',
                    primary: '#0891b2',
                    secondary: '#06b6d4',
                    tertiary: '#67e8f9'
                };
            }
        }
        
        // Save palette
        function savePalette(palette) {
            try {
                localStorage.setItem(PALETTE_KEY, JSON.stringify(palette));
                return true;
            } catch (e) {
                console.error('Error saving palette:', e);
                return false;
            }
        }
        
        // Apply a curated palette
        function applyPalette(name, primary, secondary, tertiary, buttonElement) {
            const palette = {
                name: name,
                primary: primary,
                secondary: secondary,
                tertiary: tertiary
            };
            
            // Save palette
            savePalette(palette);
            
            // ALSO save primary to old brand color key for backwards compatibility
            localStorage.setItem('able_brand_color', primary);
            
            // Update active state
            document.querySelectorAll('.palette-card').forEach(card => {
                card.classList.remove('active');
            });
            if (buttonElement) {
                buttonElement.classList.add('active');
            }
            
            // Clear single color active states
            document.querySelectorAll('.color-preset').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Apply colors
            updateBrandColorVariables(primary);
            updatePreviewBrandColor(primary);
            
            // Show toast
            const paletteNames = {
                'ocean': 'Ocean',
                'indie-soul': 'Indie Soul',
                'hiphop': 'Hip-Hop Gold',
                'neon': 'Neon Cyber',
                'pop': 'Pop Candy',
                'rock': 'Rock Classic',
                'jazz': 'Jazz Night',
                'folk': 'Folk Earthy',
                'rnb': 'R&B Luxe',
                'sunset': 'Sunset',
                'forest': 'Forest'
            };
            
            showToast(`âœ“ Palette: ${paletteNames[name] || name}`);
        }
        
        // Apply custom palette from color picker
        function applyCustomPalette(color) {
            const palette = {
                name: 'custom',
                primary: color,
                secondary: adjustBrightness(color, 10),
                tertiary: adjustBrightness(color, 20)
            };
            
            savePalette(palette);
            
            // Update active state to custom
            document.querySelectorAll('.palette-card').forEach(card => {
                card.classList.remove('active');
                if (card.getAttribute('data-palette') === 'custom') {
                    card.classList.add('active');
                }
            });
            
            // Apply color
            updateBrandColorVariables(color);
            updatePreviewBrandColor(color);
            
            showToast('âœ“ Custom color applied');
        }
        
        // Set single color (simple mode)
        function setSingleColor(color, buttonElement) {
            const palette = {
                name: 'single',
                primary: color,
                secondary: color,
                tertiary: color
            };
            
            savePalette(palette);
            
            // ALSO save to old brand color key for backwards compatibility
            localStorage.setItem('able_brand_color', color);
            
            // Update active state on single color buttons
            document.querySelectorAll('.color-preset').forEach(btn => {
                btn.classList.remove('active');
            });
            if (buttonElement) {
                buttonElement.classList.add('active');
            }
            
            // Clear palette active states
            document.querySelectorAll('.palette-card').forEach(card => {
                card.classList.remove('active');
            });
            
            // Apply color
            updateBrandColorVariables(color);
            updatePreviewBrandColor(color);
            
            showToast('âœ“ Color: ' + color);
        }
        
        // ============================================
        // APPEARANCE SECTION NAVIGATION
        // ============================================
        
        function scrollToSection(sectionId, event) {
            if (event) event.preventDefault();
            
            const section = document.getElementById(sectionId);
            if (section) {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
                
                // Update active state
                document.querySelectorAll('.appearance-nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                event.target.closest('.appearance-nav-link').classList.add('active');
            }
        }
        
        // Update active nav link on scroll
        function updateActiveNavOnScroll() {
            const sections = document.querySelectorAll('.appearance-section');
            const navLinks = document.querySelectorAll('.appearance-nav-link');
            
            let currentSection = '';
            
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                const sectionHeight = section.offsetHeight;
                const scrollPosition = document.querySelector('[data-content="appearance"]').scrollTop;
                
                if (scrollPosition >= sectionTop && scrollPosition < sectionTop + sectionHeight) {
                    currentSection = section.getAttribute('id');
                }
            });
            
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + currentSection) {
                    link.classList.add('active');
                }
            });
        }
        
        // Reset all appearance settings to defaults
        function resetAllAppearance() {
            if (!confirm('Reset all appearance settings to defaults? This cannot be undone.')) {
                return;
            }
            
            // Reset palette to Ocean
            applyPalette('ocean', '#0891b2', '#06b6d4', '#67e8f9', document.querySelector('[data-palette="ocean"]'));
            
            // Reset theme to Contrast
            setTheme('contrast');
            updateThemeButtons('contrast');
            
            // Reset button style
            setButtonStyle('rounded', document.querySelector('[data-style="rounded"]'));
            
            // Reset font
            setFontStyle('sans', document.querySelector('[data-font="sans"]'));
            
            // Reset background
            const settings = loadAppearanceSettings();
            if (settings.backgroundImage) {
                removeBackgroundImage();
            } else {
                setBackgroundPattern('grain', document.querySelector('[data-background="grain"]'));
            }
            
            // Reset aesthetic
            setAesthetic('default', document.querySelector('[data-aesthetic="default"]'));
            
            // Reset animation
            setAnimation('smooth', document.querySelector('[data-animation="smooth"]'));
            
            // Reset card style
            setCardStyle('elevated', document.querySelector('[data-cards="elevated"]'));
            
            // Reset corner style
            setCornerStyle('rounded', document.querySelector('[data-corners="rounded"]'));
            
            // Disable glassmorphism
            const glassToggle = document.getElementById('glassmorphismToggle');
            if (glassToggle && glassToggle.checked) {
                glassToggle.checked = false;
                toggleGlassmorphism(false);
            }
            
            showToast('âœ“ Reset to defaults');
        }
        
        // Initialize palette on load
        function initializePalette() {
            const palette = loadPalette();
            
            // Apply saved palette
            updateBrandColorVariables(palette.primary);
            
            // Set active state on palette card
            document.querySelectorAll('.palette-card').forEach(card => {
                if (card.getAttribute('data-palette') === palette.name) {
                    card.classList.add('active');
                }
            });
        }

        // Update CSS variables for brand color
        function updateBrandColorVariables(color) {
            const root = document.documentElement;
            
            // Force remove any old color values first
            root.style.removeProperty('--accent');
            root.style.removeProperty('--accent-hover');
            root.style.removeProperty('--accent-soft');
            root.style.removeProperty('--accent-gradient');
            
            // Then set new values
            root.style.setProperty('--accent', color);
            root.style.setProperty('--accent-hover', adjustBrightness(color, -10));
            root.style.setProperty('--accent-soft', color + '15'); // Add alpha
            root.style.setProperty('--accent-gradient', `linear-gradient(135deg, ${color} 0%, ${adjustBrightness(color, 15)} 100%)`);
            
            // Also update body for any inline styles
            document.body.style.setProperty('--accent', color);
            
            // Update preview dots
            const previewDot = document.getElementById('colorPreviewDot');
            if (previewDot) {
                previewDot.style.background = color;
            }
            
            // Update all preview dots
            document.querySelectorAll('.color-preview-dot').forEach(dot => {
                dot.style.background = color;
            });
            
            // Force repaint
            document.body.offsetHeight;
            // Propagate to all profile preview surfaces
            try { applyAppearanceEverywhere(); } catch(e) {}
        }

        // Update preview panel with brand color
        function updatePreviewBrandColor(color) {
            // Update profile header gradient
            const profileHeader = document.querySelector('.preview-frame .preview-content > div > div');
            if (profileHeader) {
                profileHeader.style.background = `linear-gradient(135deg, ${color} 0%, ${adjustBrightness(color, 10)} 100%)`;
                profileHeader.style.boxShadow = `0 8px 24px ${color}40`;
            }
            
            // Update hero short-container gradient tint
            const shortContainer = document.getElementById('previewShortContainer');
            if (shortContainer) {
                shortContainer.style.background = `linear-gradient(135deg, ${color} 0%, ${adjustBrightness(color, 15)} 100%)`;
            }

            // Update primary CTA button colour
            const mainCta = document.getElementById('previewMainCta');
            if (mainCta) {
                mainCta.style.background = `linear-gradient(135deg, ${color} 0%, ${adjustBrightness(color, 10)} 100%)`;
            }
            
            // Update all primary buttons in preview
            const previewButtons = document.querySelectorAll('.preview-frame .btn-primary');
            previewButtons.forEach(btn => {
                btn.style.background = color;
                btn.style.borderColor = color;
            });
            
            showToast('âœ“ Preview updated');
        }

        
        // Adjust color brightness (for hover states)
        function adjustBrightness(color, percent) {
            const num = parseInt(color.replace('#', ''), 16);
            const amt = Math.round(2.55 * percent);
            const R = Math.max(0, Math.min(255, (num >> 16) + amt));
            const G = Math.max(0, Math.min(255, ((num >> 8) & 0x00FF) + amt));
            const B = Math.max(0, Math.min(255, (num & 0x0000FF) + amt));
            return '#' + (0x1000000 + R * 0x10000 + G * 0x100 + B).toString(16).slice(1);
        }
        
        // ============================================
        // APPEARANCE CUSTOMIZATION (Button, Font, Background)
        // ============================================
        
        const APPEARANCE_KEY = 'able_appearance_settings';
        
        // Load appearance settings
        function loadAppearanceSettings() {
            try {
                const saved = localStorage.getItem(APPEARANCE_KEY);
                return saved ? JSON.parse(saved) : {
                    buttonStyle: 'rounded',
                    fontStyle: 'system-sans',
                    backgroundPattern: 'grain'
                };
            } catch (e) {
                return {
                    buttonStyle: 'rounded',
                    fontStyle: 'system-sans',
                    backgroundPattern: 'grain'
                };
            }
        }
        
        // Save appearance settings
        function saveAppearanceSettings(settings) {
            try {
                localStorage.setItem(APPEARANCE_KEY, JSON.stringify(settings));
                try { applyAppearanceEverywhere(); } catch(e) {}
                return true;
            } catch (e) {
                console.error('Error saving appearance:', e);
                return false;
            }
        }

        // â”€â”€ Single source-of-truth: apply all appearance state to one root â”€â”€
        function applyAppearanceToRoot(root) {
            if (!root) return;
            try {
                var _theme = localStorage.getItem('able_theme') || 'light';
                if (_theme === 'light') { root.removeAttribute('data-theme'); }
                else { root.setAttribute('data-theme', _theme); }

                // Brand color â€” read from live CSS var first (already updated by updateBrandColorVariables)
                var _color = (document.documentElement.style.getPropertyValue('--accent') || '').trim() || loadBrandColor();
                root.style.setProperty('--accent', _color);
                root.style.setProperty('--accent-hover', adjustBrightness(_color, -10));
                root.style.setProperty('--accent-soft', _color + '15');
                root.style.setProperty('--accent-gradient', 'linear-gradient(135deg,' + _color + ' 0%,' + adjustBrightness(_color, 15) + ' 100%)');

                // Font
                var _s = loadAppearanceSettings();
                var _fontMap = {
                    'system-sans':    '-apple-system,BlinkMacSystemFont,"SF Pro Display","Segoe UI",Roboto,sans-serif',
                    'rounded-sans':   'ui-rounded,"SF Pro Rounded",system-ui,"Nunito","Varela Round",sans-serif',
                    'condensed-sans': '"Arial Narrow","Helvetica Condensed","Roboto Condensed",sans-serif',
                    'classic-serif':  'Georgia,"Times New Roman","Garamond",serif',
                    'modern-serif':   '"Iowan Old Style","Palatino Linotype","Libre Baskerville",serif',
                    'monospace':      '"SF Mono",Monaco,"Courier New","Roboto Mono",monospace',
                    'sans':           '-apple-system,BlinkMacSystemFont,"SF Pro Display","Segoe UI",Roboto,sans-serif',
                    'serif':          'Georgia,"Times New Roman",serif'
                };
                root.style.fontFamily = _fontMap[_s.fontStyle] || _fontMap['system-sans'];

                // Tier-1 classes / attributes
                var _t1 = loadTier1Settings();
                if (_t1.aesthetic && _t1.aesthetic !== 'default') {
                    root.setAttribute('data-aesthetic', _t1.aesthetic);
                } else {
                    root.removeAttribute('data-aesthetic');
                }
                ['smooth','bouncy','snappy','glitchy','none'].forEach(function(a) { root.classList.remove('anim-' + a); });
                root.classList.add('anim-' + (_t1.animation || 'smooth'));
                ['elevated','flat','outlined','neumorphic','neon','handdrawn'].forEach(function(c) { root.classList.remove('cards-' + c); });
                root.classList.add('cards-' + (_t1.cardStyle || 'elevated'));
                ['rounded','extra-rounded','sharp','mixed','organic'].forEach(function(c) { root.classList.remove('corners-' + c); });
                root.classList.add('corners-' + (_t1.cornerStyle || 'rounded'));

                // Glassmorphism
                if (_s.glassmorphismEnabled) { root.classList.add('glassmorphism-enabled'); }
                else { root.classList.remove('glassmorphism-enabled'); }

                // Image mode: sync has-background-image + img-auto-readability to .profile-preview inside this root
                var _imgHasBg   = !!_s.backgroundImage;
                var _imgAutoR   = (_s.autoReadability !== false);
                var _pvTargets  = root.classList && root.classList.contains('profile-preview')
                    ? [root]
                    : Array.from(root.querySelectorAll ? root.querySelectorAll('.profile-preview') : []);
                _pvTargets.forEach(function(el) {
                    if (_imgHasBg) { el.classList.add('has-background-image'); }
                    else           { el.classList.remove('has-background-image'); }
                    if (_imgHasBg && _imgAutoR) { el.classList.add('img-auto-readability'); }
                    else                        { el.classList.remove('img-auto-readability'); }
                });
            } catch(e) { console.warn('[applyAppearanceToRoot]', e); }
        }

        // Apply appearance to every profile surface
        function applyAppearanceEverywhere() {
            // Right-side preview container (always in DOM)
            applyAppearanceToRoot(document.getElementById('profilePreviewFrame'));
            // Full-page overlay: profilePreviewRoot is moved here when active
            var _fp = document.getElementById('fullPageOverlay');
            if (_fp && _fp.classList.contains('active')) {
                applyAppearanceToRoot(document.getElementById('profilePreviewRoot'));
            }
            // Mobile overlay: re-sync the clone then apply
            var _mob = document.getElementById('mobilePreviewOverlay');
            if (_mob && _mob.classList.contains('active')) {
                syncMobilePreview();
                var _mc = document.getElementById('mobilePreviewContent');
                if (_mc && _mc.firstElementChild) { applyAppearanceToRoot(_mc.firstElementChild); }
            }
        }

        // Set button style
        function setButtonStyle(style, buttonElement) {
            const settings = loadAppearanceSettings();
            settings.buttonStyle = style;
            saveAppearanceSettings(settings);
            
            // Update active state
            document.querySelectorAll('.button-style-option').forEach(btn => {
                btn.classList.remove('active');
            });
            if (buttonElement) {
                buttonElement.classList.add('active');
            }
            
            // Apply button style class to all buttons
            applyButtonStyle(style);
            
            showToast(`âœ“ Button style: ${style}`);
        }
        
        // Apply button style to all buttons
        function applyButtonStyle(style) {
            // Remove all style classes first
            document.querySelectorAll('.btn, .btn-primary, .btn-secondary, button').forEach(btn => {
                btn.classList.remove('btn-style-rounded', 'btn-style-sharp', 'btn-style-pill');
                btn.classList.add(`btn-style-${style}`);
            });
            
            // Update preview buttons too
            document.querySelectorAll('.preview-frame button, .button-style-preview').forEach(btn => {
                btn.classList.remove('btn-style-rounded', 'btn-style-sharp', 'btn-style-pill');
                btn.classList.add(`btn-style-${style}`);
            });
        }
        
        // Set font style
        function setFontStyle(font, buttonElement) {
            const settings = loadAppearanceSettings();
            settings.fontStyle = font;
            saveAppearanceSettings(settings);
            
            // Update active state
            document.querySelectorAll('.font-option').forEach(btn => {
                btn.classList.remove('active');
            });
            if (buttonElement) {
                buttonElement.classList.add('active');
            }
            
            // Apply font style
            applyFontStyle(font);
            
            const fontLabels = {
                'system-sans': 'System Sans',
                'rounded-sans': 'Rounded Sans',
                'condensed-sans': 'Condensed',
                'classic-serif': 'Classic Serif',
                'modern-serif': 'Modern Serif',
                'monospace': 'Monospace',
                'sans': 'Sans-Serif',
                'serif': 'Serif'
            };
            showToast(`âœ“ Font: ${fontLabels[font] || font}`);
        }
        
        // Apply font style
        function applyFontStyle(font) {
            const fontMap = {
                'system-sans': '-apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif',
                'rounded-sans': 'ui-rounded, "SF Pro Rounded", system-ui, "Nunito", "Varela Round", sans-serif',
                'condensed-sans': '"Arial Narrow", "Helvetica Condensed", "Roboto Condensed", sans-serif',
                'classic-serif': 'Georgia, "Times New Roman", "Garamond", serif',
                'modern-serif': '"Iowan Old Style", "Palatino Linotype", "Libre Baskerville", serif',
                'monospace': '"SF Mono", Monaco, "Courier New", "Roboto Mono", monospace',
                // Legacy support
                'sans': '-apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif',
                'serif': 'Georgia, "Times New Roman", serif'
            };
            
            const fontFamily = fontMap[font] || fontMap['system-sans'];
            
            // Apply to body
            document.body.style.fontFamily = fontFamily;
            
            // Apply to preview
            const previewFrame = document.querySelector('.preview-frame');
            if (previewFrame) {
                previewFrame.style.fontFamily = fontFamily;
            }
        }
        
        // Set background pattern
        function setBackgroundPattern(pattern, buttonElement) {
            const settings = loadAppearanceSettings();
            settings.backgroundPattern = pattern;
            saveAppearanceSettings(settings);
            
            // Update active state
            document.querySelectorAll('.background-option').forEach(btn => {
                btn.classList.remove('active');
            });
            if (buttonElement) {
                buttonElement.classList.add('active');
            }
            
            // Apply background pattern
            applyBackgroundPattern(pattern);
            
            const labels = {
                grain: 'Paper Grain',
                solid: 'Solid',
                gradient: 'Gradient'
            };
            showToast(`âœ“ Background: ${labels[pattern]}`);
        }
        
        // Apply background pattern
        function applyBackgroundPattern(pattern) {
            const body = document.body;
            
            // Remove existing pattern
            body.style.backgroundImage = 'none';
            body.style.background = '';
            
            if (pattern === 'grain') {
                // Increased opacity from 0.03 to 0.08 for visibility
                body.style.background = 'var(--bg-primary)';
                body.style.backgroundImage = "url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400\" height=\"400\"><filter id=\"noise\"><feTurbulance type=\"fractalNoise\" baseFrequency=\"0.9\" numOctaves=\"4\" stitchTiles=\"stitch\"/></filter><rect width=\"400\" height=\"400\" filter=\"url(%23noise)\" opacity=\"0.08\"/></svg>')";
            } else if (pattern === 'gradient') {
                // More dramatic gradient
                body.style.background = 'radial-gradient(ellipse at top, var(--bg-secondary) 0%, var(--bg-primary) 50%, var(--bg-tertiary) 100%)';
                body.style.backgroundAttachment = 'fixed';
            } else {
                body.style.background = 'var(--bg-primary)';
            }
            
            // Update preview
            const previewContent = document.querySelector('.preview-content');
            if (previewContent) {
                previewContent.style.backgroundImage = 'none';
                previewContent.style.background = '';
                
                if (pattern === 'grain') {
                    previewContent.style.background = 'var(--bg-primary)';
                    previewContent.style.backgroundImage = "url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400\" height=\"400\"><filter id=\"noise\"><feTurbulence type=\"fractalNoise\" baseFrequency=\"0.9\" numOctaves=\"4\" stitchTiles=\"stitch\"/></filter><rect width=\"400\" height=\"400\" filter=\"url(%23noise)\" opacity=\"0.08\"/></svg>')";
                } else if (pattern === 'gradient') {
                    previewContent.style.background = 'radial-gradient(ellipse at top, var(--bg-secondary) 0%, var(--bg-primary) 50%, var(--bg-tertiary) 100%)';
                }
            }
        }
        
        // Handle background image upload
        function handleBackgroundImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Validate file type
            if (!file.type.startsWith('image/')) {
                showToast('âŒ Please upload an image file');
                return;
            }
            
            // Validate file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                showToast('âŒ Image must be under 5MB');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const imageData = e.target.result;
                
                // Save to localStorage with defaults
                const settings = loadAppearanceSettings();
                settings.backgroundImage = imageData;
                settings.backgroundPattern = 'image';
                settings.backgroundOpacity = 50;
                settings.backgroundBlur = 0;
                settings.backgroundBrightness = 100;
                settings.backgroundSaturation = 100;
                settings.backgroundPosition = 'center';
                settings.backgroundSize = 'cover';
                settings.glassmorphismEnabled = false;
                settings.autoReadability = true;
                settings.overlayStrength = 45;
                settings.overlayBlur = 12;
                saveAppearanceSettings(settings);
                
                // Apply image with all settings
                applyFullBackgroundImage(settings);
                
                // Update UI
                document.querySelectorAll('.background-option').forEach(opt => {
                    opt.classList.remove('active');
                    if (opt.getAttribute('data-background') === 'image') {
                        opt.classList.add('active');
                    }
                });
                
                // Show controls and set values
                const controls = document.getElementById('backgroundImageControls');
                if (controls) controls.style.display = 'block';
                
                const opacitySlider = document.getElementById('backgroundOpacitySlider');
                if (opacitySlider) opacitySlider.value = 50;
                const opacityValue = document.getElementById('opacityValue');
                if (opacityValue) opacityValue.textContent = '50%';
                
                const blurSlider = document.getElementById('backgroundBlurSlider');
                if (blurSlider) blurSlider.value = 0;
                const blurValue = document.getElementById('blurValue');
                if (blurValue) blurValue.textContent = '0px';
                
                const brightnessSlider = document.getElementById('backgroundBrightnessSlider');
                if (brightnessSlider) brightnessSlider.value = 100;
                const brightnessValue = document.getElementById('brightnessValue');
                if (brightnessValue) brightnessValue.textContent = '100%';
                
                const saturationSlider = document.getElementById('backgroundSaturationSlider');
                if (saturationSlider) saturationSlider.value = 100;
                const saturationValue = document.getElementById('saturationValue');
                if (saturationValue) saturationValue.textContent = '100%';
                
                const positionSelect = document.getElementById('backgroundPosition');
                if (positionSelect) positionSelect.value = 'center';
                const sizeSelect = document.getElementById('backgroundSize');
                if (sizeSelect) sizeSelect.value = 'cover';
                const glassToggle = document.getElementById('glassmorphismToggle');
                if (glassToggle) glassToggle.checked = false;

                const autoReadToggle = document.getElementById('autoReadabilityToggle');
                if (autoReadToggle) autoReadToggle.checked = true;
                const overlayStrSlider = document.getElementById('overlayStrengthSlider');
                if (overlayStrSlider) overlayStrSlider.value = 45;
                const overlayStrValue = document.getElementById('overlayStrengthValue');
                if (overlayStrValue) overlayStrValue.textContent = '45%';
                const overlayBlurSlider = document.getElementById('overlayBlurSlider');
                if (overlayBlurSlider) overlayBlurSlider.value = 12;
                const overlayBlurValue = document.getElementById('overlayBlurValue');
                if (overlayBlurValue) overlayBlurValue.textContent = '12px';

                showToast('âœ“ Background image uploaded');
            };
            reader.readAsDataURL(file);
        }
        
        // Apply complete background image with all effects
        function applyFullBackgroundImage(settings) {
            const body = document.body;
            const opacity = settings.backgroundOpacity || 50;
            const blur = settings.backgroundBlur || 0;
            const brightness = settings.backgroundBrightness || 100;
            const saturation = settings.backgroundSaturation || 100;
            const position = settings.backgroundPosition || 'center';
            const size = settings.backgroundSize || 'cover';
            const opacityDecimal = opacity / 100;
            
            // Remove any existing background pseudo-element style
            let bgStyle = document.getElementById('dynamic-bg-style');
            if (!bgStyle) {
                bgStyle = document.createElement('style');
                bgStyle.id = 'dynamic-bg-style';
                document.head.appendChild(bgStyle);
            }
            
            const _ovStrength = (settings.overlayStrength !== undefined) ? settings.overlayStrength : 45;
            const _ovBlur     = (settings.overlayBlur     !== undefined) ? settings.overlayBlur     : 12;
            const _autoRead   = (settings.autoReadability  !== false);

            // Create CSS for pseudo-element background (won't blur dashboard)
            bgStyle.textContent = `
                .profile-preview.has-background-image::before {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    z-index: -1;
                    background-image: linear-gradient(rgba(247, 247, 246, ${1 - opacityDecimal}), rgba(247, 247, 246, ${1 - opacityDecimal})), url(${settings.backgroundImage});
                    background-size: ${size};
                    background-position: ${position};
                    background-attachment: fixed;
                    filter: blur(${blur}px) brightness(${brightness}%) saturate(${saturation}%);
                }
                .profile-preview.has-background-image {
                    --img-scrim: ${_ovStrength / 100};
                    --card-glass-blur: ${_ovBlur}px;
                }
            `;

            // Add class to body; manage auto-readability class on all .profile-preview elements
            document.querySelector('.profile-preview')?.classList.add('has-background-image');
            document.querySelectorAll('.profile-preview').forEach(function(el) {
                if (_autoRead) { el.classList.add('img-auto-readability'); }
                else { el.classList.remove('img-auto-readability'); }
            });
            body.style.background = 'transparent';
            body.style.backgroundImage = 'none';
            body.style.filter = '';
            
            // Apply to preview
            const previewContent = document.querySelector('.preview-content');
            if (previewContent) {
                previewContent.style.background = 'var(--bg-primary)';
                previewContent.style.backgroundImage = `linear-gradient(rgba(247, 247, 246, ${1 - opacityDecimal}), rgba(247, 247, 246, ${1 - opacityDecimal})), url(${settings.backgroundImage})`;
                previewContent.style.backgroundSize = size;
                previewContent.style.backgroundPosition = position;
                previewContent.style.filter = `blur(${blur}px) brightness(${brightness}%) saturate(${saturation}%)`;
            }
        }
        
        // Unified control update function
        function updateBackgroundControl(controlType, value) {
            const settings = loadAppearanceSettings();
            if (!settings.backgroundImage) return;
            
            // Update specific setting
            switch(controlType) {
                case 'opacity':
                    settings.backgroundOpacity = parseInt(value);
                    const opacityValue = document.getElementById('opacityValue');
                    if (opacityValue) opacityValue.textContent = value + '%';
                    break;
                case 'blur':
                    settings.backgroundBlur = parseInt(value);
                    const blurValue = document.getElementById('blurValue');
                    if (blurValue) blurValue.textContent = value + 'px';
                    break;
                case 'brightness':
                    settings.backgroundBrightness = parseInt(value);
                    const brightnessValue = document.getElementById('brightnessValue');
                    if (brightnessValue) brightnessValue.textContent = value + '%';
                    break;
                case 'saturation':
                    settings.backgroundSaturation = parseInt(value);
                    const saturationValue = document.getElementById('saturationValue');
                    if (saturationValue) saturationValue.textContent = value + '%';
                    break;
                case 'position':
                    settings.backgroundPosition = value;
                    break;
                case 'size':
                    settings.backgroundSize = value;
                    break;
                case 'overlayStrength':
                    settings.overlayStrength = parseInt(value);
                    const overlayStrValue = document.getElementById('overlayStrengthValue');
                    if (overlayStrValue) overlayStrValue.textContent = value + '%';
                    break;
                case 'overlayBlur':
                    settings.overlayBlur = parseInt(value);
                    const overlayBlurVal = document.getElementById('overlayBlurValue');
                    if (overlayBlurVal) overlayBlurVal.textContent = value + 'px';
                    break;
                case 'autoReadability':
                    settings.autoReadability = !!value;
                    break;
            }

            saveAppearanceSettings(settings);
            applyFullBackgroundImage(settings);
        }
        
        // Toggle glassmorphism effect
        function toggleGlassmorphism(enabled) {
            const settings = loadAppearanceSettings();
            settings.glassmorphismEnabled = enabled;
            saveAppearanceSettings(settings);
            
            if (enabled) {
                document.body.classList.add('glassmorphism-enabled');
                document.documentElement.classList.add('glassmorphism-enabled');
                showToast('âœ“ Glassmorphism enabled');
            } else {
                document.body.classList.remove('glassmorphism-enabled');
                document.documentElement.classList.remove('glassmorphism-enabled');
                showToast('âœ“ Glassmorphism disabled');
            }
        }
        
        // Apply quick presets
        function applyBackgroundPreset(presetName) {
            const settings = loadAppearanceSettings();
            if (!settings.backgroundImage) {
                showToast('âŒ Upload a background image first');
                return;
            }
            
            const presets = {
                subtle: {
                    opacity: 25, blur: 0, brightness: 100, saturation: 100, glassmorphism: false,
                    autoReadability: true, overlayStrength: 30, overlayBlur: 8
                },
                glass: {
                    opacity: 70, blur: 10, brightness: 110, saturation: 100, glassmorphism: true,
                    autoReadability: true, overlayStrength: 50, overlayBlur: 14
                },
                bold: {
                    opacity: 90, blur: 0, brightness: 90, saturation: 120, glassmorphism: false,
                    autoReadability: true, overlayStrength: 55, overlayBlur: 10
                },
                mono: {
                    opacity: 50, blur: 5, brightness: 70, saturation: 0, glassmorphism: false,
                    autoReadability: true, overlayStrength: 40, overlayBlur: 10
                }
            };
            
            const preset = presets[presetName];
            if (!preset) return;
            
            // Apply preset values
            settings.backgroundOpacity      = preset.opacity;
            settings.backgroundBlur         = preset.blur;
            settings.backgroundBrightness   = preset.brightness;
            settings.backgroundSaturation   = preset.saturation;
            settings.glassmorphismEnabled   = preset.glassmorphism;
            settings.autoReadability        = preset.autoReadability;
            settings.overlayStrength        = preset.overlayStrength;
            settings.overlayBlur            = preset.overlayBlur;

            saveAppearanceSettings(settings);
            applyFullBackgroundImage(settings);

            // Update UI controls
            const opacitySlider = document.getElementById('backgroundOpacitySlider');
            if (opacitySlider) opacitySlider.value = preset.opacity;
            const opacityValue = document.getElementById('opacityValue');
            if (opacityValue) opacityValue.textContent = preset.opacity + '%';

            const blurSlider = document.getElementById('backgroundBlurSlider');
            if (blurSlider) blurSlider.value = preset.blur;
            const blurValue = document.getElementById('blurValue');
            if (blurValue) blurValue.textContent = preset.blur + 'px';

            const brightnessSlider = document.getElementById('backgroundBrightnessSlider');
            if (brightnessSlider) brightnessSlider.value = preset.brightness;
            const brightnessValue = document.getElementById('brightnessValue');
            if (brightnessValue) brightnessValue.textContent = preset.brightness + '%';

            const saturationSlider = document.getElementById('backgroundSaturationSlider');
            if (saturationSlider) saturationSlider.value = preset.saturation;
            const saturationValue = document.getElementById('saturationValue');
            if (saturationValue) saturationValue.textContent = preset.saturation + '%';

            const glassToggle = document.getElementById('glassmorphismToggle');
            if (glassToggle) glassToggle.checked = preset.glassmorphism;

            const autoReadToggle3 = document.getElementById('autoReadabilityToggle');
            if (autoReadToggle3) autoReadToggle3.checked = preset.autoReadability;
            const overlayStrSlider3 = document.getElementById('overlayStrengthSlider');
            if (overlayStrSlider3) overlayStrSlider3.value = preset.overlayStrength;
            const overlayStrValue3 = document.getElementById('overlayStrengthValue');
            if (overlayStrValue3) overlayStrValue3.textContent = preset.overlayStrength + '%';
            const overlayBlurSlider3 = document.getElementById('overlayBlurSlider');
            if (overlayBlurSlider3) overlayBlurSlider3.value = preset.overlayBlur;
            const overlayBlurValue3 = document.getElementById('overlayBlurValue');
            if (overlayBlurValue3) overlayBlurValue3.textContent = preset.overlayBlur + 'px';

            // Apply glassmorphism
            if (preset.glassmorphism) {
                document.body.classList.add('glassmorphism-enabled');
                document.documentElement.classList.add('glassmorphism-enabled');
            } else {
                document.body.classList.remove('glassmorphism-enabled');
                document.documentElement.classList.remove('glassmorphism-enabled');
            }
            
            const presetNames = {
                subtle: 'Subtle',
                glass: 'Glassmorphism',
                bold: 'Bold',
                mono: 'Monochrome'
            };
            showToast(`âœ“ Applied "${presetNames[presetName]}" preset`);
        }
        
        // Remove background image
        function removeBackgroundImage() {
            const settings = loadAppearanceSettings();
            settings.backgroundImage = null;
            settings.backgroundPattern = 'grain';
            settings.backgroundOpacity = null;
            settings.backgroundBlur = null;
            settings.backgroundBrightness = null;
            settings.backgroundSaturation = null;
            settings.backgroundPosition = null;
            settings.backgroundSize = null;
            settings.glassmorphismEnabled = false;
            saveAppearanceSettings(settings);
            
            // Hide controls
            const controls = document.getElementById('backgroundImageControls');
            if (controls) controls.style.display = 'none';
            
            // Remove glassmorphism
            document.body.classList.remove('glassmorphism-enabled');
            document.documentElement.classList.remove('glassmorphism-enabled');
            
            // Remove background class and clean up
            document.querySelectorAll('.profile-preview').forEach(function(el) {
                el.classList.remove('has-background-image');
                el.classList.remove('img-auto-readability');
            });
            document.body.style.filter = '';
            document.body.style.background = '';
            document.body.style.backgroundImage = '';
            
            // Remove dynamic background style
            const bgStyle = document.getElementById('dynamic-bg-style');
            if (bgStyle) bgStyle.remove();
            
            // Reset to grain
            applyBackgroundPattern('grain');
            
            // Update UI
            document.querySelectorAll('.background-option').forEach(opt => {
                opt.classList.remove('active');
                if (opt.getAttribute('data-background') === 'grain') {
                    opt.classList.add('active');
                }
            });
            
            showToast('âœ“ Background image removed');
        }
        
        // ============================================
        // TIER 1 CUSTOMIZATIONS - JavaScript
        // ============================================
        
        const TIER1_KEY = 'able_tier1_settings';
        
        // Load Tier 1 settings
        function loadTier1Settings() {
            try {
                const saved = localStorage.getItem(TIER1_KEY);
                return saved ? JSON.parse(saved) : {
                    aesthetic: 'default',
                    animation: 'smooth',
                    cardStyle: 'elevated',
                    cornerStyle: 'rounded'
                };
            } catch (e) {
                return {
                    aesthetic: 'default',
                    animation: 'smooth',
                    cardStyle: 'elevated',
                    cornerStyle: 'rounded'
                };
            }
        }
        
        // Save Tier 1 settings
        function saveTier1Settings(settings) {
            try {
                localStorage.setItem(TIER1_KEY, JSON.stringify(settings));
                try { applyAppearanceEverywhere(); } catch(e) {}
                return true;
            } catch (e) {
                console.error('Error saving Tier 1 settings:', e);
                return false;
            }
        }
        
        // Set Aesthetic
        function setAesthetic(aesthetic, buttonElement) {
            const settings = loadTier1Settings();
            settings.aesthetic = aesthetic;
            saveTier1Settings(settings);
            
            // Update active state
            document.querySelectorAll('.style-option[data-aesthetic]').forEach(btn => {
                btn.classList.remove('active');
            });
            if (buttonElement) {
                buttonElement.classList.add('active');
            }
            
            // Apply aesthetic
            applyAesthetic(aesthetic);
            
            const labels = {
                'default': 'Default',
                'vhs': 'VHS Retro',
                'brutalist': 'Brutalist',
                'glass': 'Glassmorphism',
                'film': 'Film Grain',
                'vaporwave': 'Vaporwave',
                'punk': 'Punk/DIY',
                'luxury': 'Luxury'
            };
            showToast(`âœ“ Aesthetic: ${labels[aesthetic] || aesthetic}`);
        }
        
        // Apply Aesthetic
        function applyAesthetic(aesthetic) {
            const body = document.body;
            const html = document.documentElement;
            
            // Remove all aesthetic classes
            const aesthetics = ['y2k', 'vhs', 'brutalist', 'glass', 'film', 'vaporwave', 'gothic', 'summer', 'punk', 'luxury'];
            aesthetics.forEach(a => {
                body.removeAttribute(`data-aesthetic`);
                html.removeAttribute(`data-aesthetic`);
            });
            
            // Apply new aesthetic
            if (aesthetic !== 'default') {
                body.setAttribute('data-aesthetic', aesthetic);
                html.setAttribute('data-aesthetic', aesthetic);
            }
        }
        
        // Set Animation Style
        function setAnimation(animation, buttonElement) {
            const settings = loadTier1Settings();
            settings.animation = animation;
            saveTier1Settings(settings);
            
            // Update active state
            document.querySelectorAll('.style-option[data-animation]').forEach(btn => {
                btn.classList.remove('active');
            });
            if (buttonElement) {
                buttonElement.classList.add('active');
            }
            
            // Apply animation
            applyAnimation(animation);
            
            const labels = {
                'smooth': 'Smooth',
                'bouncy': 'Bouncy',
                'snappy': 'Snappy',
                'glitchy': 'Glitchy',
                'none': 'None'
            };
            showToast(`âœ“ Animation: ${labels[animation] || animation}`);
        }
        
        // Apply Animation Style
        function applyAnimation(animation) {
            const body = document.body;
            
            // Remove all animation classes
            body.classList.remove('anim-smooth', 'anim-bouncy', 'anim-snappy', 'anim-glitchy', 'anim-none');
            
            // Apply new animation class
            body.classList.add(`anim-${animation}`);
        }
        
        // Set Card Style
        function setCardStyle(cardStyle, buttonElement) {
            const settings = loadTier1Settings();
            settings.cardStyle = cardStyle;
            saveTier1Settings(settings);
            
            // Update active state
            document.querySelectorAll('.style-option[data-cards]').forEach(btn => {
                btn.classList.remove('active');
            });
            if (buttonElement) {
                buttonElement.classList.add('active');
            }
            
            // Apply card style
            applyCardStyle(cardStyle);
            
            const labels = {
                'elevated': 'Elevated',
                'flat': 'Flat',
                'outlined': 'Outlined',
                'neumorphic': 'Neumorphic',
                'neon': 'Neon',
                'handdrawn': 'Handdrawn'
            };
            showToast(`âœ“ Card Style: ${labels[cardStyle] || cardStyle}`);
        }
        
        // Apply Card Style
        function applyCardStyle(cardStyle) {
            const body = document.body;
            
            // Remove all card style classes
            body.classList.remove('cards-elevated', 'cards-flat', 'cards-outlined', 'cards-neumorphic', 'cards-neon', 'cards-handdrawn');
            
            // Apply new card style class
            body.classList.add(`cards-${cardStyle}`);
        }
        
        // Set Corner Style
        function setCornerStyle(cornerStyle, buttonElement) {
            const settings = loadTier1Settings();
            settings.cornerStyle = cornerStyle;
            saveTier1Settings(settings);
            
            // Update active state
            document.querySelectorAll('.style-option[data-corners]').forEach(btn => {
                btn.classList.remove('active');
            });
            if (buttonElement) {
                buttonElement.classList.add('active');
            }
            
            // Apply corner style
            applyCornerStyle(cornerStyle);
            
            const labels = {
                'rounded': 'Rounded',
                'extra-rounded': 'Extra Rounded',
                'sharp': 'Sharp',
                'mixed': 'Mixed',
                'organic': 'Organic'
            };
            showToast(`âœ“ Corners: ${labels[cornerStyle] || cornerStyle}`);
        }
        
        // Apply Corner Style
        function applyCornerStyle(cornerStyle) {
            const body = document.body;
            
            // Remove all corner style classes
            body.classList.remove('corners-rounded', 'corners-extra-rounded', 'corners-sharp', 'corners-mixed', 'corners-organic');
            
            // Apply new corner style class
            body.classList.add(`corners-${cornerStyle}`);
        }
        
        // Initialize Tier 1 settings on page load
        function initializeTier1Settings() {
            const settings = loadTier1Settings();
            
            // Apply saved settings
            applyAesthetic(settings.aesthetic);
            applyAnimation(settings.animation);
            applyCardStyle(settings.cardStyle);
            applyCornerStyle(settings.cornerStyle);
            
            // Set active states on UI
            document.querySelectorAll('.style-option[data-aesthetic]').forEach(option => {
                if (option.getAttribute('data-aesthetic') === settings.aesthetic) {
                    option.classList.add('active');
                }
            });
            
            document.querySelectorAll('.style-option[data-animation]').forEach(option => {
                if (option.getAttribute('data-animation') === settings.animation) {
                    option.classList.add('active');
                }
            });
            
            document.querySelectorAll('.style-option[data-cards]').forEach(option => {
                if (option.getAttribute('data-cards') === settings.cardStyle) {
                    option.classList.add('active');
                }
            });
            
            document.querySelectorAll('.style-option[data-corners]').forEach(option => {
                if (option.getAttribute('data-corners') === settings.cornerStyle) {
                    option.classList.add('active');
                }
            });
        }

        // Initialize appearance settings on page load
        function initializeAppearanceSettings() {
            const settings = loadAppearanceSettings();
            
            // Apply saved settings
            applyButtonStyle(settings.buttonStyle);
            applyFontStyle(settings.fontStyle);
            
            // Check if there's a saved background image
            if (settings.backgroundImage) {
                applyFullBackgroundImage(settings);
                
                // Show and populate controls
                const controls = document.getElementById('backgroundImageControls');
                if (controls) controls.style.display = 'block';
                
                const opacitySlider = document.getElementById('backgroundOpacitySlider');
                if (opacitySlider) opacitySlider.value = settings.backgroundOpacity || 50;
                const opacityValue = document.getElementById('opacityValue');
                if (opacityValue) opacityValue.textContent = (settings.backgroundOpacity || 50) + '%';
                
                const blurSlider = document.getElementById('backgroundBlurSlider');
                if (blurSlider) blurSlider.value = settings.backgroundBlur || 0;
                const blurValue = document.getElementById('blurValue');
                if (blurValue) blurValue.textContent = (settings.backgroundBlur || 0) + 'px';
                
                const brightnessSlider = document.getElementById('backgroundBrightnessSlider');
                if (brightnessSlider) brightnessSlider.value = settings.backgroundBrightness || 100;
                const brightnessValue = document.getElementById('brightnessValue');
                if (brightnessValue) brightnessValue.textContent = (settings.backgroundBrightness || 100) + '%';
                
                const saturationSlider = document.getElementById('backgroundSaturationSlider');
                if (saturationSlider) saturationSlider.value = settings.backgroundSaturation || 100;
                const saturationValue = document.getElementById('saturationValue');
                if (saturationValue) saturationValue.textContent = (settings.backgroundSaturation || 100) + '%';
                
                const positionSelect = document.getElementById('backgroundPosition');
                if (positionSelect) positionSelect.value = settings.backgroundPosition || 'center';
                const sizeSelect = document.getElementById('backgroundSize');
                if (sizeSelect) sizeSelect.value = settings.backgroundSize || 'cover';
                const glassToggle = document.getElementById('glassmorphismToggle');
                if (glassToggle) glassToggle.checked = settings.glassmorphismEnabled || false;

                const autoReadToggle2 = document.getElementById('autoReadabilityToggle');
                if (autoReadToggle2) autoReadToggle2.checked = (settings.autoReadability !== false);
                const overlayStrSlider2 = document.getElementById('overlayStrengthSlider');
                if (overlayStrSlider2) overlayStrSlider2.value = settings.overlayStrength !== undefined ? settings.overlayStrength : 45;
                const overlayStrValue2 = document.getElementById('overlayStrengthValue');
                if (overlayStrValue2) overlayStrValue2.textContent = (settings.overlayStrength !== undefined ? settings.overlayStrength : 45) + '%';
                const overlayBlurSlider2 = document.getElementById('overlayBlurSlider');
                if (overlayBlurSlider2) overlayBlurSlider2.value = settings.overlayBlur !== undefined ? settings.overlayBlur : 12;
                const overlayBlurValue2 = document.getElementById('overlayBlurValue');
                if (overlayBlurValue2) overlayBlurValue2.textContent = (settings.overlayBlur !== undefined ? settings.overlayBlur : 12) + 'px';

                // Apply glassmorphism if enabled
                if (settings.glassmorphismEnabled) {
                    document.body.classList.add('glassmorphism-enabled');
                    document.documentElement.classList.add('glassmorphism-enabled');
                }
            } else {
                applyBackgroundPattern(settings.backgroundPattern);
            }
            
            // Set active states on UI
            document.querySelectorAll('.button-style-option').forEach(option => {
                if (option.getAttribute('data-style') === settings.buttonStyle) {
                    option.classList.add('active');
                }
            });
            
            document.querySelectorAll('.font-option').forEach(option => {
                if (option.getAttribute('data-font') === settings.fontStyle) {
                    option.classList.add('active');
                }
            });
            
            document.querySelectorAll('.background-option').forEach(option => {
                const bgType = settings.backgroundImage ? 'image' : settings.backgroundPattern;
                if (option.getAttribute('data-background') === bgType) {
                    option.classList.add('active');
                }
            });
        }

        // Initialize brand color on page load
        function initializeBrandColor() {
            const savedColor = loadBrandColor();
            
            // Apply saved color
            updateBrandColorVariables(savedColor);
            
            // Set active state on matching preset buttons in BOTH locations
            const allPresets = document.querySelectorAll('.color-preset[data-color]');
            let foundMatch = false;
            
            allPresets.forEach(preset => {
                if (preset.getAttribute('data-color') === savedColor) {
                    preset.classList.add('active');
                    foundMatch = true;
                }
            });
            
            // If no match found, it's a custom color - update both custom buttons
            if (!foundMatch) {
                const customBtns = [
                    document.getElementById('customBrandColorBtn'),
                    document.getElementById('customAppearanceColorBtn')
                ];
                customBtns.forEach(btn => {
                    if (btn) {
                        btn.classList.add('active');
                        btn.style.background = savedColor;
                    }
                });
            }
            
            // Set both color picker values
            const pickers = [
                document.getElementById('brandColorPicker'),
                document.getElementById('appearanceColorPicker')
            ];
            pickers.forEach(picker => {
                if (picker) {
                    picker.value = savedColor;
                }
            });
        }
        
        // Validate profile field
        function validateProfileField(input, fieldName) {
            const value = input.value.trim();
            
            if (fieldName === 'artistName') {
                if (value.length < 2) {
                    showValidationError(input, 'Artist name must be at least 2 characters');
                    return false;
                } else {
                    showValidationSuccess(input);
                    return true;
                }
            }
            
            if (fieldName === 'handle') {
                // Convert to lowercase and remove special chars
                input.value = value.toLowerCase().replace(/[^a-z0-9-_]/g, '');
                
                if (input.value.length < 3) {
                    showValidationError(input, 'Handle must be at least 3 characters');
                    return false;
                } else {
                    showValidationSuccess(input);
                    return true;
                }
            }
            
            return true;
        }
        
        // Handle profile image upload
        function handleProfileImageUpload(input) {
            const file = input.files[0];
            if (!file) return;
            
            // Validate file type
            if (!file.type.startsWith('image/')) {
                showToast('âŒ Please upload an image file');
                return;
            }
            
            // Validate file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                showToast('âŒ Image must be less than 5MB');
                return;
            }
            
            // Read and display image
            const reader = new FileReader();
            reader.onload = function(e) {
                showProfileImage(e.target.result);
                // Immediately sync avatar into phone preview (before saveProfile is clicked)
                var _profileRoot = document.getElementById('profilePreviewRoot');
                if (_profileRoot) {
                    var _avatarEl = _profileRoot.querySelector('.bio-avatar');
                    if (_avatarEl) {
                        _avatarEl.innerHTML = '<img src="' + e.target.result + '" alt="" style="width:100%;height:100%;object-fit:cover;border-radius:inherit;">';
                    }
                }
                showToast('âœ“ Image uploaded');
            };
            reader.readAsDataURL(file);
        }

        // Show profile image preview
        function showProfileImage(imageData) {
            const preview = document.getElementById('profileImagePreview');
            preview.innerHTML = `<img src="${imageData}" alt="Profile" class="upload-preview">`;
            preview.classList.add('has-image');
        }
        
        // Save profile
        function _markFieldError(id) {
            const el = document.getElementById(id);
            if (!el) return;
            el.classList.add('error');
            el.classList.remove('valid');
            const clear = () => { el.classList.remove('error'); el.removeEventListener('input', clear); };
            el.addEventListener('input', clear);
        }
        function _clearFieldErrors(...ids) {
            ids.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.classList.remove('error');
            });
        }

        function saveProfile() {
            // Get all field values
            const artistName = document.getElementById('artistName').value.trim();
            const handle = document.getElementById('handle').value.trim();
            const bio = document.getElementById('bio').value.trim();
            const location = document.getElementById('location').value.trim();
            const genres = document.getElementById('genres').value.trim();

            _clearFieldErrors('artistName', 'handle');

            // Validate required fields
            if (!artistName || artistName.length < 2) {
                _markFieldError('artistName');
                showToast('âŒ Artist name is required (min 2 characters)');
                document.getElementById('artistName').focus();
                return;
            }

            if (!handle || handle.length < 3) {
                _markFieldError('handle');
                showToast('âŒ Handle is required (min 3 characters)');
                document.getElementById('handle').focus();
                return;
            }
            
            // Get profile image
            const previewDiv = document.getElementById('profileImagePreview');
            const img = previewDiv.querySelector('img');
            const profileImage = img ? img.src : null;
            
            // Create profile object
            const profileData = {
                artistName,
                handle,
                bio,
                location,
                genres,
                profileImage,
                lastUpdated: new Date().toISOString()
            };
            
            // Save to localStorage
            if (saveProfileData(profileData)) {
                showToast('Profile saved successfully!');

                // Update sidebar handle
                const sidebarName = document.querySelector('.sidebar .artist-name');
                if (sidebarName) {
                    const h = document.getElementById('handle')?.value?.trim() || artistName;
                    sidebarName.textContent = h.startsWith('@') ? h : '@' + h;
                }

                // Update preview URL bar handle
                const urlHandle = document.getElementById('previewUrlHandle');
                if (urlHandle) {
                    const h = document.getElementById('handle')?.value?.trim() || 'yourname';
                    urlHandle.textContent = h;
                }

                // Refresh greeting with updated name
                _initOverviewGreeting();

                // Sync artist profile preview immediately
                if (typeof applyDashboardDataToProfile === 'function') {
                    applyDashboardDataToProfile();
                }

                // Update Action Links diagram name
                if (typeof updateDiagramButtons === 'function') updateDiagramButtons();
            } else {
                showToast('âŒ Error saving profile');
            }
        }
        
        // Reset profile to defaults
        function resetProfile() {
            if (confirm('Reset profile to default values?')) {
                saveProfileData(defaultProfile);
                populateProfileForm();
                showToast('âœ“ Profile reset to defaults');
            }
        }
        
        // ============================================
        // CTA LIBRARY SEARCH
        // ============================================
        
        // Filter CTA library by search term
        function filterCTALibrary(searchTerm) {
            const term = searchTerm.toLowerCase().trim();
            const content = document.getElementById('ctaLibraryContent');
            const clearBtn = document.getElementById('ctaSearchClear');
            const resultsDiv = document.getElementById('ctaSearchResults');
            
            // Show/hide clear button
            if (term) {
                clearBtn.style.display = 'block';
            } else {
                clearBtn.style.display = 'none';
                resultsDiv.textContent = '';
                // Show all categories
                const categories = content.querySelectorAll('[style*="margin-bottom: 20px"]');
                categories.forEach(cat => cat.style.display = 'block');
                return;
            }
            
            let totalVisible = 0;
            let totalHidden = 0;
            
            // Get all CTA categories
            const categories = content.querySelectorAll('[style*="margin-bottom: 20px"]');
            
            categories.forEach(category => {
                const buttons = category.querySelectorAll('button');
                let visibleInCategory = 0;
                
                buttons.forEach(button => {
                    const ctaText = button.textContent.toLowerCase();
                    
                    if (ctaText.includes(term)) {
                        button.style.display = 'inline-flex';
                        visibleInCategory++;
                        totalVisible++;
                    } else {
                        button.style.display = 'none';
                        totalHidden++;
                    }
                });
                
                // Hide category if no matches
                if (visibleInCategory === 0) {
                    category.style.display = 'none';
                } else {
                    category.style.display = 'block';
                }
            });
            
            // Update results count
            if (totalVisible === 0) {
                resultsDiv.textContent = `No CTAs found for "${searchTerm}"`;
                resultsDiv.style.color = 'var(--text-tertiary)';
            } else {
                resultsDiv.textContent = `${totalVisible} CTA${totalVisible !== 1 ? 's' : ''} found`;
                resultsDiv.style.color = 'var(--success-dark)';
            }
        }
        
        // Clear CTA search
        function clearCTASearch() {
            const input = document.getElementById('ctaSearchInput');
            input.value = '';
            filterCTALibrary('');
            input.focus();
        }
        
        // ============================================
        // VALIDATION SYSTEM
        // ============================================
        
        // Validation rules
        const validationRules = {
            ctaText: {
                minLength: 2,
                maxLength: 30,
                required: true,
                message: 'CTA text must be 2-30 characters'
            },
            releaseDate: {
                required: true,
                futureDate: true,
                message: 'Release date must be in the future'
            },
            url: {
                pattern: /^https?:\/\/.+/,
                message: 'URL must start with http:// or https://'
            },
            email: {
                pattern: /^[^\s@]+@[^\s@]+\.[^\s@]+$/,
                message: 'Please enter a valid email address'
            }
        };

        // Validate input field
        function validateFieldRule(input, ruleName) {
            const value = input.value.trim();
            const rule = validationRules[ruleName];
            
            if (!rule) return { valid: true };
            
            // Check required
            if (rule.required && !value) {
                return { valid: false, message: rule.message || 'This field is required' };
            }
            
            // Check min length
            if (rule.minLength && value.length < rule.minLength) {
                return { valid: false, message: rule.message };
            }
            
            // Check max length
            if (rule.maxLength && value.length > rule.maxLength) {
                return { valid: false, message: rule.message };
            }
            
            // Check pattern
            if (rule.pattern && !rule.pattern.test(value)) {
                return { valid: false, message: rule.message };
            }
            
            // Check future date
            if (rule.futureDate && value) {
                const selectedDate = new Date(value);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                if (selectedDate < today) {
                    return { valid: false, message: rule.message };
                }
            }
            
            return { valid: true };
        }

        // Show validation error
        function showValidationError(input, message) {
            // Add error class
            input.classList.add('error');
            input.classList.remove('success');
            
            // Remove existing error message
            const existingError = input.parentElement.querySelector('.error-message');
            if (existingError) {
                existingError.remove();
            }
            
            // Add new error message
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            input.parentElement.appendChild(errorDiv);
        }

        // Show validation success
        function showValidationSuccess(input) {
            input.classList.remove('error');
            input.classList.add('success');
            
            // Remove error message
            const existingError = input.parentElement.querySelector('.error-message');
            if (existingError) {
                existingError.remove();
            }
        }

        // Clear validation state
        function clearValidation(input) {
            input.classList.remove('error', 'success');
            const errorMsg = input.parentElement.querySelector('.error-message');
            if (errorMsg) errorMsg.remove();
        }

        // Validate release date
        function validateReleaseDate(dateString) {
            if (!dateString) {
                return { valid: false, message: 'Please select a release date' };
            }
            
            const selectedDate = new Date(dateString);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            if (selectedDate < today) {
                return { valid: false, message: 'Release date must be in the future' };
            }
            
            // Warn if more than 2 years away
            const twoYearsFromNow = new Date();
            twoYearsFromNow.setFullYear(twoYearsFromNow.getFullYear() + 2);
            
            if (selectedDate > twoYearsFromNow) {
                return { valid: true, warning: 'Date is more than 2 years away' };
            }
            
            return { valid: true };
        }

        // Toggle timeline visibility
        // ============================================
        // GETTING STARTED CHECKLIST TRACKING
        // ============================================
        
        const CHECKLIST_KEY = 'able_checklist_progress';
        
        // Load checklist progress from localStorage
        function loadChecklistProgress() {
            try {
                const saved = localStorage.getItem(CHECKLIST_KEY);
                return saved ? JSON.parse(saved) : {
                    enabledCTA: false,
                    addedCTA: false,
                    setReleaseDate: false,
                    choseTheme: false,
                    previewedPage: false
                };
            } catch (e) {
                return {
                    enabledCTA: false,
                    addedCTA: false,
                    setReleaseDate: false,
                    choseTheme: false,
                    previewedPage: false
                };
            }
        }
        
        // Save checklist progress
        function saveChecklistProgress(progress) {
            try {
                localStorage.setItem(CHECKLIST_KEY, JSON.stringify(progress));
            } catch (e) {
                console.error('Could not save checklist progress:', e);
            }
        }
        
        // Check what tasks are actually complete
        function checkRealProgress() {
            const progress = loadChecklistProgress();
            
            // Task 1: Check if any CTA is enabled
            const ctaData = localStorage.getItem(STORAGE_KEY);
            if (ctaData) {
                try {
                    const ctas = JSON.parse(ctaData);
                    const hasActiveCTA = Object.values(ctas).some(cta => cta.active === true);
                    if (hasActiveCTA && !progress.enabledCTA) {
                        progress.enabledCTA = true;
                    }
                } catch (e) {}
            }
            
            // Task 2: Check if user added CTA from library (check if there are more than default 2)
            if (ctaData) {
                try {
                    const ctas = JSON.parse(ctaData);
                    const ctaCount = Object.keys(ctas).length;
                    if (ctaCount > 2 && !progress.addedCTA) {
                        progress.addedCTA = true;
                    }
                } catch (e) {}
            }
            
            // Task 3: Check if release date is set (not default)
            const autoStateData = localStorage.getItem(AUTO_STATE_KEY);
            if (autoStateData) {
                try {
                    const config = JSON.parse(autoStateData);
                    const today = new Date().toISOString().split('T')[0];
                    if (config.releaseDate && config.releaseDate !== today && !progress.setReleaseDate) {
                        progress.setReleaseDate = true;
                    }
                } catch (e) {}
            }
            
            // Task 4: Check if theme was changed from default
            const theme = localStorage.getItem('able_theme');
            if (theme && theme !== 'light' && !progress.choseTheme) {
                progress.choseTheme = true;
            }
            
            // Task 5: previewedPage is marked manually when they click preview
            
            saveChecklistProgress(progress);
            return progress;
        }
        
        // Mark a task as complete
        function markTaskComplete(taskName) {
            const progress = loadChecklistProgress();
            progress[taskName] = true;
            saveChecklistProgress(progress);
            updateChecklist();
        }
        
        // Update checklist UI
        function updateChecklist() {
            const progress = checkRealProgress();
            const tasks = ['enabledCTA', 'addedCTA', 'setReleaseDate', 'choseTheme', 'previewedPage'];
            let completedCount = 0;
            
            tasks.forEach(taskName => {
                const item = document.querySelector(`[data-task="${taskName}"]`);
                if (!item) return;
                
                const icon = item.querySelector('.checklist-icon');
                const isComplete = progress[taskName];
                
                if (isComplete) {
                    completedCount++;
                    // Mark as complete with animation
                    item.style.background = 'rgba(16, 185, 129, 0.08)';
                    item.style.cursor = 'default';
                    icon.style.background = 'var(--success)';
                    icon.style.color = 'white';
                    icon.textContent = 'âœ“';
                } else {
                    // Keep as incomplete
                    item.style.background = 'var(--bg-tertiary)';
                    item.style.cursor = 'pointer';
                    icon.style.background = 'var(--border)';
                    icon.style.color = 'var(--text-tertiary)';
                }
            });
            
            // Update badge
            const badge = document.getElementById('checklistBadge');
            if (badge) {
                badge.textContent = `${completedCount} of 5`;
                if (completedCount === 5) {
                    badge.className = 'badge badge-success';
                    showToast('ðŸŽ‰ All set! Your page is ready!');
                } else {
                    badge.className = 'badge badge-info';
                }
            }

            // Update progress bar
            const pct = Math.round((completedCount / 5) * 100);
            const fill = document.getElementById('setupProgressFill');
            const pctLabel = document.getElementById('setupProgressPct');
            if (fill) fill.style.width = pct + '%';
            if (pctLabel) pctLabel.textContent = pct + '%';

            // Update active link count
            _updateActiveLinkCount();
        }

        function _updateActiveLinkCount() {
            const el = document.getElementById('activeLinkCount');
            if (!el) return;
            try {
                const ctaData = localStorage.getItem(STORAGE_KEY);
                if (ctaData) {
                    const ctas = JSON.parse(ctaData);
                    const count = Object.values(ctas).filter(c => c.active).length;
                    el.textContent = count;
                } else {
                    el.textContent = '0';
                }
            } catch(e) { el.textContent = 'â€”'; }
        }

        function _initOverviewGreeting() {
            const el = document.getElementById('overviewGreeting');
            if (!el) return;
            const h = new Date().getHours();
            const greet = h < 12 ? 'Good morning â˜€ï¸'
                        : h < 17 ? 'Good afternoon ðŸŽµ'
                        : h < 21 ? 'Good evening ðŸŒ™'
                        :          'Night owl mode ðŸ¦‰';
            const name = document.getElementById('artistName')?.value?.split(' ')[0] || '';
            el.textContent = name ? `${greet}, ${name}` : greet;
        }

        // Tab switching
        function switchTab(tabName) {
            // Scroll editor panel to top
            const editorPanel = document.querySelector('.editor-panel');
            if (editorPanel) editorPanel.scrollTop = 0;

            // Update sidebar nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            const sidebarTab = document.querySelector(`[data-tab="${tabName}"]`);
            if (sidebarTab) sidebarTab.classList.add('active');

            // Update mobile bottom nav
            document.querySelectorAll('.mobile-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            // Map tab names to bottom nav
            const bottomNavMap = {
                'overview': 0,
                'ctas': 1,
                'music': 2,
                'analytics': 3
            };
            if (bottomNavMap[tabName] !== undefined) {
                const navItems = document.querySelectorAll('.mobile-nav-item');
                if (navItems[bottomNavMap[tabName]]) {
                    navItems[bottomNavMap[tabName]].classList.add('active');
                }
            }

            // Update content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            const tabContent = document.querySelector(`[data-content="${tabName}"]`);
            if (tabContent) {
                tabContent.classList.add('active');
            } else {
                console.warn(`Tab content not found: ${tabName}`);
            }

            // Re-render platforms tab when switched to (picks up any saved data)
            if (tabName === 'platforms' && typeof initPlatformsTab === 'function') {
                initPlatformsTab();
            }
            
            // If switching to auto-state tab, update UI to reflect current mode
            if (tabName === 'auto-state') {
                setTimeout(() => {
                    calculateCurrentMode();
                    updateAutoStateUI();
                }, 50);
            }

            // If switching to analytics tab, initialize charts
            if (tabName === 'analytics') {
                setTimeout(() => {
                    initAnalyticsCharts();
                }, 150);
            }

            // Refresh section action dropdowns when entering a section tab
            // (ctaState may have been updated while on another tab)
            const _sectionTabMap = {
                music: 'music', videos: 'videos',
                events: 'events', merch: 'merch', supporters: 'support'
            };
            if (_sectionTabMap[tabName]) {
                populateSectionActionsSelect(_sectionTabMap[tabName]);
            }
        }

        // Mobile more menu functions
        function openMobileMenu() {
            const menu = document.getElementById('mobileMoreMenu');
            if (menu) {
                menu.style.display = 'flex';
            }
        }

        function closeMobileMoreMenu() {
            const menu = document.getElementById('mobileMoreMenu');
            if (menu) {
                menu.style.display = 'none';
            }
        }

        // ============================================
        // PHASE 3: MOBILE GESTURE SUPPORT
        // ============================================
        
        // Swipe between tabs on mobile
        let touchStartX = 0;
        let touchEndX = 0;
        
        function handleSwipe() {
            const swipeThreshold = 50;
            const swipeDistance = touchEndX - touchStartX;
            
            if (Math.abs(swipeDistance) > swipeThreshold) {
                const currentTab = document.querySelector('.tab-content.active');
                if (!currentTab) return;
                
                const allTabs = ['overview', 'profile', 'appearance', 'platforms', 'auto-state', 'ctas',
                               'music', 'videos', 'events', 'merch', 'supporters',
                               'analytics', 'share', 'settings'];
                const currentIndex = allTabs.indexOf(currentTab.getAttribute('data-content'));
                
                if (swipeDistance > 0 && currentIndex > 0) {
                    // Swipe right - go to previous tab
                    switchTab(allTabs[currentIndex - 1]);
                } else if (swipeDistance < 0 && currentIndex < allTabs.length - 1) {
                    // Swipe left - go to next tab
                    switchTab(allTabs[currentIndex + 1]);
                }
            }
        }
        
        // Add touch event listeners for swipe gestures on mobile
        if (window.innerWidth <= 1200) {
            document.addEventListener('touchstart', e => {
                touchStartX = e.changedTouches[0].screenX;
            });
            
            document.addEventListener('touchend', e => {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            });
        }

        // â”€â”€ Full Page Toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // Track where the profile lives so we can move it back
        let _profileOriginalParent = null;
        let _profileNextSibling    = null;

        function openFullPage() {
            const overlay    = document.getElementById('fullPageOverlay');
            const container  = document.getElementById('fullPageContent');
            const profileEl  = document.getElementById('profilePreviewRoot');
            const frameEl    = document.getElementById('profilePreviewFrame');

            if (!overlay || !profileEl) return;

            // Remember where it lives
            _profileOriginalParent = profileEl.parentNode;
            _profileNextSibling    = profileEl.nextSibling;

            // Move the real profile element into the overlay
            container.appendChild(profileEl);

            // Remove frame size constraints
            profileEl.style.cssText = '';

            // Show overlay
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
            overlay.scrollTop = 0;

            // Re-trigger animate-in for all sections (observer root changes)
            setTimeout(() => {
                profileEl.querySelectorAll('.section').forEach(s => {
                    s.classList.add('animate-in');
                });
            }, 50);
        }

        function closeFullPage() {
            const overlay   = document.getElementById('fullPageOverlay');
            const profileEl = document.getElementById('profilePreviewRoot');

            if (!overlay || !profileEl || !_profileOriginalParent) return;

            // Move profile back to its original place in the preview frame
            if (_profileNextSibling) {
                _profileOriginalParent.insertBefore(profileEl, _profileNextSibling);
            } else {
                _profileOriginalParent.appendChild(profileEl);
            }

            overlay.classList.remove('active');
            // Only restore scroll if no other overlay-like elements remain open
            if (!document.querySelector('.modal-overlay.active, .mobile-preview-overlay.active')) {
                document.body.style.overflow = '';
            }

            // Re-trigger animate-in for visible sections in the preview frame
            setTimeout(() => {
                profileEl.querySelectorAll('.section').forEach(s => {
                    s.classList.add('animate-in');
                });
            }, 50);
        }

        // Close on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeFullPage();
        });

                // Add click listeners to nav tabs
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                const tabName = this.getAttribute('data-tab');
                switchTab(tabName);
            });
        });

        // Toggle switch
        function toggleSwitch(element) {
            const switchEl = element.querySelector('.switch');
            switchEl.classList.toggle('active');
        }

        // Utility: run a render function and swallow errors so one bad render
        // never cascades to break unrelated parts of the UI.
        function safeRender(fn) {
            try { fn(); } catch(e) { console.warn('[safeRender] render error:', e); }
        }

        // Show toast â€” type auto-detected from message prefix or passed explicitly
        // type: 'success' | 'error' | 'warning'
        function showToast(message, type) {
            const toast = document.querySelector('.toast');
            if (!toast) return;
            const messageEl = document.getElementById('toast-message');
            const iconEl = document.getElementById('toast-icon');

            // Auto-detect type from emoji prefix if not supplied
            if (!type) {
                if (message.startsWith('âŒ')) type = 'error';
                else if (message.startsWith('âš ï¸')) type = 'warning';
                else type = 'success';
            }

            // Strip leading emoji + space so we don't double-show it
            const cleanMessage = message.replace(/^(âŒ|âš ï¸|âœ…)\s*/, '');

            const icons = { success: 'âœ“', error: 'âœ•', warning: '!' };
            if (iconEl) iconEl.textContent = icons[type] || 'âœ“';
            if (messageEl) messageEl.textContent = cleanMessage;

            toast.classList.remove('toast--error', 'toast--warning');
            if (type === 'error')   toast.classList.add('toast--error');
            if (type === 'warning') toast.classList.add('toast--warning');

            // Reset any prior timer
            clearTimeout(toast._hideTimer);
            toast.classList.add('show');

            const delay = type === 'error' ? 4000 : 3000;
            toast._hideTimer = setTimeout(() => {
                toast.classList.remove('show');
            }, delay);
        }

        // Preview tab switching is handled by switchPreviewDevice() via onclick attributes.

        // Auto-save â€” scoped to profile fields only
        let saveTimeout;
        ['artistName', 'handle', 'bio', 'location', 'genres'].forEach(id => {
            const el = document.getElementById(id);
            if (!el) return;
            el.addEventListener('input', function() {
                clearTimeout(saveTimeout);
                saveTimeout = setTimeout(() => {
                    // Collect current profile form values
                    const artistName = document.getElementById('artistName')?.value || '';
                    const handle = document.getElementById('handle')?.value || '';
                    const bio = document.getElementById('bio')?.value || '';
                    const location = document.getElementById('location')?.value || '';

                    // Save to localStorage
                    const profileData = {
                        artistName, handle, bio, location,
                        lastUpdated: new Date().toISOString()
                    };
                    localStorage.setItem('able_profile_data', JSON.stringify(profileData));

                    // Update artist page immediately
                    if (typeof applyDashboardDataToProfile === 'function') {
                        applyDashboardDataToProfile();
                    }

                    showToast('Auto-saved');
                }, 1000);
            });
        });
    </script>
    <!-- Mobile Bottom Navigation Bar -->
    <nav class="mobile-bottom-nav">
        <div class="mobile-bottom-nav-inner">
            <div class="mobile-nav-item active" onclick="switchTab('overview')">
                <div class="mobile-nav-icon">ðŸ </div>
                <div class="mobile-nav-label">Home</div>
            </div>
            <div class="mobile-nav-item" onclick="switchTab('ctas')">
                <div class="mobile-nav-icon">ðŸŽ¯</div>
                <div class="mobile-nav-label">Action Links</div>
            </div>
            <div class="mobile-nav-item" onclick="switchTab('music')">
                <div class="mobile-nav-icon">ðŸŽµ</div>
                <div class="mobile-nav-label">Music</div>
            </div>
            <div class="mobile-nav-item" onclick="switchTab('analytics')">
                <div class="mobile-nav-icon">ðŸ“Š</div>
                <div class="mobile-nav-label">Stats</div>
            </div>
            <div class="mobile-nav-item" onclick="openMobileMenu()">
                <div class="mobile-nav-icon">â‹¯</div>
                <div class="mobile-nav-label">More</div>
            </div>
        </div>
    </nav>

    <!-- Mobile More Menu Modal -->
    <div id="mobileMoreMenu" style="display: none; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); z-index: 2000; align-items: flex-end; justify-content: center;" onclick="closeMobileMoreMenu()">
        <div id="mobileMoreMenuContent" style="background: var(--bg-primary); width: 100%; max-height: 70vh; border-radius: 20px 20px 0 0; padding: 24px; padding-bottom: max(24px, env(safe-area-inset-bottom)); overflow-y: auto; -webkit-overflow-scrolling: touch; scroll-behavior: smooth; transform: translateY(0); transition: transform 0.3s var(--ease-smooth);" onclick="event.stopPropagation()">
            <!-- Swipe indicator -->
            <div style="width: 40px; height: 4px; background: var(--border); border-radius: 2px; margin: 0 auto 20px; opacity: 0.5;"></div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div style="font-size: 20px; font-weight: 700;">More Options</div>
                <button onclick="closeMobileMoreMenu()" style="width: 32px; height: 32px; border-radius: 50%; background: var(--bg-tertiary); border: none; font-size: 18px; cursor: pointer;">âœ•</button>
            </div>
            <div style="display: grid; gap: 4px;">
                <div class="mobile-menu-option" onclick="switchTab('profile'); closeMobileMoreMenu();"><span class="mobile-menu-option-icon">ðŸ‘¤</span><span>Profile</span>
                </div>
                <div class="mobile-menu-option" onclick="switchTab('platforms'); closeMobileMoreMenu();"><span class="mobile-menu-option-icon">ðŸ”—</span><span>Platforms</span>
                </div>
                <div class="mobile-menu-option" onclick="switchTab('auto-state'); closeMobileMoreMenu();"><span class="mobile-menu-option-icon">âœ¨</span><span>Auto-State</span>
                </div>
                <div class="mobile-menu-option" onclick="switchTab('videos'); closeMobileMoreMenu();"><span class="mobile-menu-option-icon">ðŸŽ¬</span><span>Videos</span>
                </div>
                <div class="mobile-menu-option" onclick="switchTab('events'); closeMobileMoreMenu();"><span class="mobile-menu-option-icon">ðŸ“…</span><span>Events</span>
                </div>
                <div class="mobile-menu-option" onclick="switchTab('merch'); closeMobileMoreMenu();"><span class="mobile-menu-option-icon">ðŸ›ï¸</span><span>Merch</span>
                </div>
                <div class="mobile-menu-option" onclick="switchTab('supporters'); closeMobileMoreMenu();"><span class="mobile-menu-option-icon">ðŸ’</span><span>Supporters</span>
                </div>
                <div class="mobile-menu-option" onclick="switchTab('share'); closeMobileMoreMenu();"><span class="mobile-menu-option-icon">ðŸ“±</span><span>Share</span>
                </div>
                <div class="mobile-menu-option" onclick="switchTab('settings'); closeMobileMoreMenu();"><span class="mobile-menu-option-icon">âš™ï¸</span><span>Settings</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ONBOARDING WIZARD -->
    <!-- MODALS -->
    
    <!-- Press Kit Generator Modal -->
    <div class="modal-overlay" id="pressKitModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Generate Press Kit</div>
                <button class="modal-close" onclick="closeModal('pressKitModal')">âœ•</button>
            </div>
            <div class="modal-body">
                <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 20px; line-height: 1.6;">
                    Choose what to include in your press kit. We'll generate a professional PDF you can send to media, venues, and promoters.
                </p>

                <div class="form-group">
                    <div class="form-label" style="margin-bottom: 12px;">Include Sections</div>
                    
                    <div class="switch-group" onclick="toggleSwitch(this)">
                        <div class="switch-info">
                            <div class="switch-label">Artist Bio</div>
                            <div class="switch-help">Your profile description</div>
                        </div>
                        <div class="switch active" data-press-kit="bio"></div>
                    </div>

                    <div class="switch-group" onclick="toggleSwitch(this)">
                        <div class="switch-info">
                            <div class="switch-label">Key Stats</div>
                            <div class="switch-help">Streams, followers, monthly listeners</div>
                        </div>
                        <div class="switch active" data-press-kit="stats"></div>
                    </div>

                    <div class="switch-group" onclick="toggleSwitch(this)">
                        <div class="switch-info">
                            <div class="switch-label">Recent Releases</div>
                            <div class="switch-help">Your latest tracks and albums</div>
                        </div>
                        <div class="switch active" data-press-kit="releases"></div>
                    </div>

                    <div class="switch-group" onclick="toggleSwitch(this)">
                        <div class="switch-info">
                            <div class="switch-label">Social Links</div>
                            <div class="switch-help">Instagram, Spotify, YouTube, etc.</div>
                        </div>
                        <div class="switch active" data-press-kit="social"></div>
                    </div>

                    <div class="switch-group" onclick="toggleSwitch(this)">
                        <div class="switch-info">
                            <div class="switch-label">Contact Information</div>
                            <div class="switch-help">Email and booking contact</div>
                        </div>
                        <div class="switch active" data-press-kit="contact"></div>
                    </div>
                </div>

                <div class="form-group">
                    <div class="form-field">
                        <textarea 
                            class="form-textarea" 
                            placeholder=" " 
                            id="pressQuotes"
                            rows="3"
                            style="min-height: 80px;"
                        ></textarea>
                        <label class="floating-label">Press Quotes (optional)</label>
                    </div>
                    <div style="font-size: 12px; color: var(--text-tertiary); margin-top: 6px;">
                        Add notable press mentions or reviews. One per line.
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('pressKitModal')">Cancel</button>
                <button class="btn btn-primary" id="generatePressKitBtn" onclick="generatePressKit()">
                    <span class="btn-text">ðŸ“¥ Generate PDF</span>
                    <span class="btn-spinner" style="display: none;">â³</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Add / Edit Release Modal -->
    <div class="modal-overlay" id="addReleaseModal">
        <div class="modal" style="max-width: 560px;">
            <div class="modal-header">
                <div class="modal-title" id="releaseModalTitle">Add Release</div>
                <button class="modal-close" onclick="closeModal('addReleaseModal')">âœ•</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="releaseEditId">

                <!-- Title + Type -->
                <div class="release-title-row">
                    <div class="form-field">
                        <input type="text" class="form-input" placeholder=" " id="releaseTitle" oninput="validateField(this, 'required')">
                        <label class="floating-label">Release Title *</label>
                        <span class="validation-icon success">âœ“</span>
                        <span class="validation-icon error">âœ•</span>
                    </div>
                    <select id="releaseType" class="form-input release-type-select" onchange="updateTracksSection()">
                        <option value="single">Single</option>
                        <option value="ep">EP</option>
                        <option value="album">Album</option>
                    </select>
                </div>

                <!-- Artwork URL -->
                <div class="form-group">
                    <div class="form-field">
                        <input type="url" class="form-input" placeholder=" " id="releaseArtwork">
                        <label class="floating-label">Artwork URL (optional)</label>
                    </div>
                </div>

                <!-- Display Mode -->
                <div class="form-group">
                    <div class="form-label" style="margin-bottom: 10px;">Display Mode</div>
                    <div class="display-mode-grid" id="displayModeToggle">
                        <div class="display-mode-btn active" data-mode="tracklist" onclick="selectDisplayMode('tracklist')">
                            <div class="display-mode-icon">â‰¡</div>
                            <div class="display-mode-label">Tracklist</div>
                            <div class="display-mode-sub">Apple Music style</div>
                        </div>
                        <div class="display-mode-btn" data-mode="embed" onclick="selectDisplayMode('embed')">
                            <div class="display-mode-icon">â–¶</div>
                            <div class="display-mode-label">Embed Player</div>
                            <div class="display-mode-sub">Inline playback</div>
                        </div>
                    </div>
                    <input type="hidden" id="releaseDisplayMode" value="tracklist">
                    <!-- Embed mode warning â€” shown when embed mode active but no embed URL -->
                    <div id="embedModeWarn" style="display:none;margin-top:8px;padding:7px 10px;border-radius:8px;background:rgba(234,179,8,.08);border:1px solid rgba(234,179,8,.3);color:var(--text-secondary);font-size:12px;">
                        âš ï¸ Add a Spotify, YouTube, or SoundCloud URL below so the embed player has something to load.
                    </div>
                </div>

                <!-- Streaming URLs -->
                <div class="form-group">
                    <div class="form-label" style="margin-bottom: 10px;">Streaming Links</div>
                    <div class="stream-links-stack">
                        <div class="stream-input-row">
                            <span class="stream-prefix" style="color:#1DB954;">SP</span>
                            <input type="url" class="form-input" placeholder="open.spotify.com/album/..." id="releaseSpotify">
                            <button type="button" onclick="fillExampleSpotify()" title="Auto-fill a test Spotify track URL" style="flex-shrink:0;padding:0 8px;height:36px;border-radius:8px;border:1px solid #1DB954;background:transparent;color:#1DB954;font-size:11px;font-weight:600;cursor:pointer;white-space:nowrap;">Example</button>
                        </div>
                        <div class="stream-input-row">
                            <span class="stream-prefix" style="color:#fc3c44;">AM</span>
                            <input type="url" class="form-input" placeholder="music.apple.com/album/..." id="releaseApple">
                        </div>
                        <div class="stream-input-row">
                            <span class="stream-prefix" style="color:#ff5500;">SC</span>
                            <input type="url" class="form-input" placeholder="soundcloud.com/..." id="releaseSoundcloud">
                        </div>
                        <div class="stream-input-row">
                            <span class="stream-prefix" style="color:#ff0000;">YT</span>
                            <input type="url" class="form-input" placeholder="youtube.com/watch?v=..." id="releaseYoutube">
                        </div>
                        <div class="stream-input-row">
                            <span class="stream-prefix" style="color:#010101;">TT</span>
                            <input type="url" class="form-input" placeholder="tiktok.com/@..." id="releaseTiktok">
                        </div>
                    </div>
                    <!-- oEmbed enrichment preview â€” hidden until a URL is recognised -->
                    <div id="releaseEnrichPreview" style="display:none;margin-top:8px;padding:8px 10px;border-radius:8px;border:1px solid var(--border);background:var(--bg-secondary);align-items:center;gap:10px;">
                        <img id="releaseEnrichThumb" src="" alt="" style="width:36px;height:36px;border-radius:6px;object-fit:cover;flex-shrink:0;display:none;">
                        <div style="flex:1;min-width:0;">
                            <div id="releaseEnrichLabel" style="font-size:11px;font-weight:600;color:var(--text-secondary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;"></div>
                            <div id="releaseEnrichStatus" style="font-size:10px;color:var(--accent);margin-top:1px;display:none;"></div>
                        </div>
                    </div>
                </div>

                <!-- Tracks list â€” label and add button driven by updateTracksSection() -->
                <div class="form-group" id="tracksSection">
                    <div class="form-label-row">
                        <div class="form-label" id="tracksSectionLabel">Track</div>
                        <button class="btn btn-secondary btn-small" id="addTrackRowBtn" onclick="addTrackRow()">+ Add Track</button>
                    </div>
                    <div class="tracks-list" id="trackRowsList"></div>
                </div>

                <!-- Credits structured editor -->
                <div class="form-group" id="creditsEditorGroup">
                    <label class="form-label">Credits <span style="font-weight:400;color:var(--text-tertiary);">(optional)</span></label>
                    <div style="display:flex;gap:8px;margin-bottom:6px;align-items:center;">
                        <input type="text" class="form-input" id="creditNameInput" placeholder="Name"
                               style="flex:1.2;"
                               onkeydown="if(event.key==='Enter'){event.preventDefault();document.getElementById('creditRoleInput').focus();}">
                        <input type="text" class="form-input" id="creditRoleInput" placeholder="Role (e.g. Producer)"
                               style="flex:1.6;"
                               onkeydown="if(event.key==='Enter'){event.preventDefault();addCreditRow();}">
                        <button type="button" class="btn btn-secondary btn-small" onclick="addCreditRow()"
                                style="flex-shrink:0;white-space:nowrap;height:40px;padding:0 12px;">+ Add</button>
                    </div>
                    <div id="creditsList"></div>
                    <div id="creditsEmptyHint" style="font-size:12px;color:var(--text-tertiary);padding:3px 0 2px;">Add producer, engineer, writer, etc.</div>
                </div>

            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addReleaseModal')">Cancel</button>
                <button class="btn btn-primary" id="saveReleaseBtn" onclick="saveRelease()">
                    <span class="btn-text">Save Release</span>
                </button>
            </div>
        </div>
    </div>

    <!-- stub so old openAddTrackModal refs don't break -->
    <div class="modal-overlay" id="addTrackModal" style="display:none;"></div>

    <!-- Add Video Modal -->
    <div class="modal-overlay" id="addVideoModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Add Video</div>
                <button class="modal-close" onclick="closeModal('addVideoModal')">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Video Title</label>
                    <input type="text" class="form-input" placeholder="e.g., Midnight Drive - Official Video" id="videoTitle">
                </div>
                <div class="form-group">
                    <label class="form-label">Video URL</label>
                    <input type="url" class="form-input" placeholder="YouTube, TikTok, or Vimeo URL" id="videoUrl">
                    <div class="form-help">Paste a YouTube or Vimeo link â€” title and thumbnail auto-fill</div>
                    <!-- oEmbed enrichment preview -->
                    <div id="videoEnrichPreview" style="display:none;margin-top:8px;padding:8px 10px;border-radius:8px;border:1px solid var(--border);background:var(--bg-secondary);align-items:center;gap:10px;">
                        <img id="videoEnrichThumb" src="" alt="" style="width:56px;height:32px;border-radius:4px;object-fit:cover;flex-shrink:0;display:none;">
                        <div style="flex:1;min-width:0;">
                            <div id="videoEnrichLabel" style="font-size:11px;font-weight:600;color:var(--text-secondary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;"></div>
                            <div id="videoEnrichStatus" style="font-size:10px;color:var(--accent);margin-top:1px;display:none;"></div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Platform</label>
                    <select class="form-input" id="videoPlatform">
                        <option value="youtube">YouTube</option>
                        <option value="tiktok">TikTok</option>
                        <option value="vimeo">Vimeo</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Credits <span style="font-weight:400;color:var(--text-tertiary);">(optional)</span></label>
                    <input type="text" class="form-input" id="videoCredits" placeholder="e.g. Prod. @name, Mix: @name" maxlength="120">
                    <div class="form-help">Credits (optional) â€” e.g. Prod. @name, Mix: @name</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addVideoModal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveVideo()">Add Video</button>
            </div>
        </div>
    </div>

    <!-- Add Event Modal -->
    <div class="modal-overlay" id="addEventModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Add Event</div>
                <button class="modal-close" onclick="closeModal('addEventModal')">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Event Name</label>
                    <input type="text" class="form-input" placeholder="e.g., Summer Tour - Los Angeles" id="eventName">
                </div>
                <div class="form-group">
                    <label class="form-label">Venue</label>
                    <input type="text" class="form-input" placeholder="e.g., The Troubadour" id="eventVenue">
                </div>
                <div class="form-group">
                    <label class="form-label">City</label>
                    <input type="text" class="form-input" placeholder="e.g., Los Angeles, CA" id="eventCity">
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                    <div class="form-group">
                        <label class="form-label">Date</label>
                        <input type="date" class="form-input" id="eventDate">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Time</label>
                        <input type="time" class="form-input" id="eventTime">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Ticket Link (optional)</label>
                    <input type="url" class="form-input" placeholder="https://..." id="eventTicketUrl">
                </div>
                <div id="eventEnrichPreview" style="display:none;margin:-4px 0 12px;padding:8px 12px;background:var(--bg-tertiary,rgba(0,0,0,0.04));border-radius:8px;border:1px solid var(--border);flex-direction:row;align-items:center;gap:10px;">
                    <div style="flex:1;min-width:0;">
                        <div id="eventEnrichLabel" style="font-size:12px;font-weight:600;color:var(--text-primary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;"></div>
                        <div id="eventEnrichStatus" style="font-size:11px;color:var(--accent);margin-top:2px;display:none;"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Credits <span style="font-weight:400;color:var(--text-tertiary);">(optional)</span></label>
                    <input type="text" class="form-input" id="eventCredits" placeholder="e.g. Prod. @name, Mix: @name" maxlength="120">
                    <div class="form-help">Credits (optional) â€” e.g. Prod. @name, Mix: @name</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addEventModal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveEvent()">Add Event</button>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div class="modal-overlay" id="addProductModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Add Product</div>
                <button class="modal-close" onclick="closeModal('addProductModal')">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Product Name</label>
                    <input type="text" class="form-input" placeholder="e.g., Tour T-Shirt" id="productName">
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" rows="3" placeholder="Brief description of your product" id="productDescription"></textarea>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                    <div class="form-group">
                        <label class="form-label">Price</label>
                        <input type="text" class="form-input" placeholder="$29.99" id="productPrice">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Stock</label>
                        <input type="number" class="form-input" placeholder="100" id="productStock">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Purchase Link</label>
                    <input type="url" class="form-input" placeholder="https://..." id="productUrl">
                </div>
                <div id="merchEnrichPreview" style="display:none;margin:-4px 0 12px;padding:8px 12px;background:var(--bg-tertiary,rgba(0,0,0,0.04));border-radius:8px;border:1px solid var(--border);flex-direction:row;align-items:center;gap:10px;">
                    <img id="merchEnrichThumb" style="width:44px;height:44px;border-radius:6px;object-fit:cover;flex-shrink:0;display:none;" alt="">
                    <div style="flex:1;min-width:0;">
                        <div id="merchEnrichLabel" style="font-size:12px;font-weight:600;color:var(--text-primary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;"></div>
                        <div id="merchEnrichStatus" style="font-size:11px;color:var(--accent);margin-top:2px;display:none;"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Product Image URL (optional)</label>
                    <input type="url" class="form-input" placeholder="https://..." id="productImage">
                </div>
                <div class="form-group">
                    <label class="form-label">Credits <span style="font-weight:400;color:var(--text-tertiary);">(optional)</span></label>
                    <input type="text" class="form-input" id="productCredits" placeholder="e.g. Prod. @name, Mix: @name" maxlength="120">
                    <div class="form-help">Credits (optional) â€” e.g. Prod. @name, Mix: @name</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addProductModal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveProduct()">Add Product</button>
            </div>
        </div>
    </div>

    <script>
        // Modal Functions
        function updateTracksSection() {
            const type = document.getElementById('releaseType').value;
            const label = document.getElementById('tracksSectionLabel');
            const addBtn = document.getElementById('addTrackRowBtn');
            const list = document.getElementById('trackRowsList');

            if (type === 'single') {
                label.textContent = 'Track';
                addBtn.style.display = 'none';
                // Keep only 1 row max
                while (list.children.length > 1) list.removeChild(list.lastChild);
                if (list.children.length === 0) addTrackRow();
            } else {
                label.textContent = 'Tracks';
                addBtn.style.display = '';
            }
        }

        // â”€â”€ Credits helpers (Prompt 5) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // _creditsDraft: working array for the current Add/Edit Release modal session.
        let _creditsDraft = [];

        // Convert legacy string credits â†’ [{name, role}] array.
        // Pass-through if already an array. Returns [] for falsy input.
        function _normalizeCredits(raw) {
            if (!raw) return [];
            if (Array.isArray(raw)) return raw.filter(function(c) { return c && c.name; });
            var s = String(raw).trim();
            if (!s) return [];
            return [{ name: s, role: '' }]; // best-effort migration from string
        }

        // Build the collapsed+expandable credits block for profile preview cards.
        // Uses existing .credits-section / .credits-toggle / .credits-grid CSS.
        function _buildCreditsHtml(rel) {
            var credits = _normalizeCredits(rel.credits);
            if (credits.length === 0) return '';
            // Collapsed summary: up to 2 names (+role), then "+N more"
            var shown = credits.slice(0, 2).map(function(c) {
                return escapeHtml(c.name) + (c.role ? ' (' + escapeHtml(c.role) + ')' : '');
            }).join(' Â· ');
            if (credits.length > 2) shown += ' Â· +' + (credits.length - 2);
            // Full expanded grid
            var grid = credits.map(function(c) {
                return '<div class="credit-item">' +
                    (c.role ? '<span class="credit-role">' + escapeHtml(c.role) + '</span>' : '') +
                    '<span class="credit-name">' + escapeHtml(c.name) + '</span>' +
                    '</div>';
            }).join('');
            return '<div class="credits-section">' +
                '<div class="credits-toggle" tabindex="0"' +
                ' onclick="toggleCreditsSection(this.closest(\'.credits-section\'))"' +
                ' onkeydown="if(event.key===\'Enter\'||event.key===\' \'){event.preventDefault();toggleCreditsSection(this.closest(\'.credits-section\'));}">' +
                '<span>Credits: ' + shown + '</span>' +
                '<span class="credits-toggle-icon">â–¾</span>' +
                '</div>' +
                '<div class="credits-content"><div class="credits-grid">' + grid + '</div></div>' +
                '</div>';
        }

        // Toggle the credits accordion open/closed.
        function toggleCreditsSection(section) {
            if (section) section.classList.toggle('expanded');
        }

        // Re-render the _creditsDraft list in the admin modal.
        function _renderCreditsDraft() {
            var list = document.getElementById('creditsList');
            var hint = document.getElementById('creditsEmptyHint');
            if (!list) return;
            if (_creditsDraft.length === 0) {
                list.innerHTML = '';
                if (hint) hint.style.display = '';
                return;
            }
            if (hint) hint.style.display = 'none';
            list.innerHTML = _creditsDraft.map(function(c, i) {
                return '<div style="display:flex;align-items:center;gap:6px;padding:5px 0;border-bottom:1px solid var(--border);">' +
                    '<span style="flex:1;font-size:13px;font-weight:600;">' + escapeHtml(c.name) + '</span>' +
                    (c.role ? '<span style="font-size:11px;color:var(--text-secondary);margin-right:4px;">' + escapeHtml(c.role) + '</span>' : '') +
                    '<button type="button" onclick="removeCreditFromDraft(' + i + ')"' +
                    ' style="background:none;border:none;cursor:pointer;color:var(--text-tertiary);font-size:18px;padding:0 2px;line-height:1;" title="Remove">Ã—</button>' +
                    '</div>';
            }).join('');
        }

        // Add a credit entry from the Name/Role inputs.
        function addCreditRow() {
            var name = (document.getElementById('creditNameInput').value || '').trim();
            if (!name) { showToast('âš ï¸ Credit name is required'); return; }
            var role = (document.getElementById('creditRoleInput').value || '').trim();
            _creditsDraft.push({ name: name, role: role });
            document.getElementById('creditNameInput').value = '';
            document.getElementById('creditRoleInput').value = '';
            document.getElementById('creditNameInput').focus();
            _renderCreditsDraft();
        }

        // Remove a credit entry by index.
        function removeCreditFromDraft(idx) {
            _creditsDraft.splice(idx, 1);
            _renderCreditsDraft();
        }

        function openAddReleaseModal(editId) {
            const modal = document.getElementById('addReleaseModal');
            const titleEl = document.getElementById('releaseModalTitle');

            // Reset form
            document.getElementById('releaseEditId').value = '';
            document.getElementById('releaseTitle').value = '';
            document.getElementById('releaseType').value = 'single';
            document.getElementById('releaseArtwork').value = '';
            document.getElementById('releaseSpotify').value = '';
            document.getElementById('releaseApple').value = '';
            document.getElementById('releaseSoundcloud').value = '';
            document.getElementById('releaseYoutube').value = '';
            document.getElementById('releaseTiktok').value = '';
            document.getElementById('trackRowsList').innerHTML = '';
            _creditsDraft = []; _renderCreditsDraft();
            selectDisplayMode('tracklist');

            // Reset oEmbed draft for this modal session
            _oembedDraft = { artworkUrl: '', provider: '', providerTitle: '', oembedTitle: '', titleAutoFilled: false };
            _hideEnrichPreview();

            if (editId) {
                // Edit mode â€” populate from state
                const rel = musicState.releases.find(r => r.id === editId);
                if (!rel) return;
                titleEl.textContent = 'Edit Release';
                document.getElementById('releaseEditId').value = editId;
                document.getElementById('releaseTitle').value = rel.title;
                document.getElementById('releaseType').value = rel.type;
                document.getElementById('releaseArtwork').value = rel.artwork || '';
                document.getElementById('releaseSpotify').value = rel.platforms.spotify || '';
                document.getElementById('releaseApple').value = rel.platforms.apple || '';
                document.getElementById('releaseSoundcloud').value = rel.platforms.soundcloud || '';
                document.getElementById('releaseYoutube').value = rel.platforms.youtube || '';
                document.getElementById('releaseTiktok').value = rel.platforms.tiktok || '';
                selectDisplayMode(rel.displayMode || 'tracklist');
                _creditsDraft = _normalizeCredits(rel.credits); _renderCreditsDraft();
                // Re-populate tracks
                (rel.tracks || []).forEach(t => addTrackRow(t.title, t.duration));
                // Pre-populate draft from saved oEmbed data so it's preserved on save
                _oembedDraft.artworkUrl    = rel.artworkUrl    || '';
                _oembedDraft.provider      = rel.provider      || '';
                _oembedDraft.providerTitle = rel.providerTitle || '';
                _oembedDraft.oembedTitle   = rel.oembedTitle   || '';
            } else {
                titleEl.textContent = 'Add Release';
                // Start with one blank track row
                addTrackRow();
            }

            // Attach enrichment listeners once per modal lifetime (guard with data attribute)
            if (!modal.dataset.enrichInit) {
                modal.dataset.enrichInit = '1';
                ['releaseSpotify', 'releaseYoutube', 'releaseSoundcloud'].forEach(function(id) {
                    var el = document.getElementById(id);
                    if (!el) return;
                    el.addEventListener('change', _triggerReleaseEnrichment);
                    el.addEventListener('blur',   _triggerReleaseEnrichment);
                });
                // Track manual title edits so we don't overwrite after user types
                var _titleEl = document.getElementById('releaseTitle');
                if (_titleEl) _titleEl.addEventListener('input', function() { _oembedDraft.titleAutoFilled = false; });
            }

            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
            updateTracksSection();
            setTimeout(() => document.getElementById('releaseTitle').focus(), 100);
        }

        function openAddTrackModal() {
            // Legacy alias â€” opens the new release modal
            openAddReleaseModal();
        }

        function selectDisplayMode(mode) {
            document.getElementById('releaseDisplayMode').value = mode;
            document.querySelectorAll('.display-mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.mode === mode);
            });
            // Show warning when embed mode has no embeddable URL
            var warn = document.getElementById('embedModeWarn');
            if (warn) {
                if (mode === 'embed') {
                    var spv = (document.getElementById('releaseSpotify')?.value || '').trim();
                    var ytv = (document.getElementById('releaseYoutube')?.value || '').trim();
                    var scv = (document.getElementById('releaseSoundcloud')?.value || '').trim();
                    warn.style.display = (!spv && !ytv && !scv) ? '' : 'none';
                } else {
                    warn.style.display = 'none';
                }
            }
        }

        // â”€â”€ Global profile display mode (tracklist | embeds | both) â”€â”€
        function setMusicDisplayMode(mode) {
            const valid = ['tracklist', 'embeds', 'both'];
            if (!valid.includes(mode)) mode = 'both';
            musicDisplayMode = mode;
            _musicPreviewExpanded = false;
            _musicEmbedExpanded   = false;
            try { localStorage.setItem(MUSIC_DISPLAY_MODE_KEY, mode); } catch(e) {}
            renderMusicTab();
            updatePreviewMusic();
        }

        // â”€â”€ Force-refresh the preview and briefly flash the frame â”€â”€
        function previewMusicNow() {
            updatePreviewMusic();
            const frame = document.getElementById('profilePreviewFrame');
            if (frame) {
                frame.style.transition = 'box-shadow 0.15s ease';
                frame.style.boxShadow = '0 0 0 3px var(--accent, #0891b2)';
                setTimeout(() => { frame.style.boxShadow = ''; }, 650);
            }
        }

        let trackRowCount = 0;
        function addTrackRow(title = '', duration = '') {
            trackRowCount++;
            const list = document.getElementById('trackRowsList');
            const row = document.createElement('div');
            row.className = 'track-input-row';
            row.dataset.rowId = trackRowCount;
            row.innerHTML = `
                <div class="track-num-badge">â€“</div>
                <input type="text" class="form-input" placeholder="Track title" value="${title}" style="font-size: 13px; padding: 8px 12px; min-height: 0;">
                <input type="text" class="form-input" placeholder="0:00" value="${duration}" style="font-size: 13px; padding: 8px 12px; min-height: 0; text-align: center;">
                <button class="icon-btn delete" onclick="removeTrackRow(this)" style="flex-shrink:0;">âœ•</button>
            `;
            list.appendChild(row);
            renumberTrackRows(); // single source of truth for numbering
        }

        function removeTrackRow(btn) {
            btn.closest('.track-input-row').remove();
            renumberTrackRows();
        }

        function renumberTrackRows() {
            document.querySelectorAll('#trackRowsList .track-num-badge').forEach((badge, i) => {
                badge.textContent = i + 1;
            });
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MUSIC STATE â€” Single Source of Truth
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function loadMusicState() {
            try {
                const saved = localStorage.getItem(MUSIC_KEY);
                if (saved) musicState = JSON.parse(saved);
            } catch(e) {
                musicState = { releases: [] };
            }
        }

        function saveMusicState() {
            try {
                localStorage.setItem(MUSIC_KEY, JSON.stringify(musicState));
            } catch(e) {}
        }

        function fillExampleSpotify() {
            var inp = document.getElementById('releaseSpotify');
            if (!inp) return;
            inp.value = 'https://open.spotify.com/track/0VjIjW4GlUZAMYd2vXMi3b';
            var warn = document.getElementById('embedModeWarn');
            if (warn) warn.style.display = 'none';
        }

        function saveRelease() {
            const title = document.getElementById('releaseTitle').value.trim();
            if (!title) {
                showToast('âš ï¸ Please enter a release title');
                return;
            }

            // Embed mode requires at least one embeddable URL
            const _dm = document.getElementById('releaseDisplayMode').value;
            if (_dm === 'embed') {
                const _sp = document.getElementById('releaseSpotify').value.trim();
                const _yt = document.getElementById('releaseYoutube').value.trim();
                const _sc = document.getElementById('releaseSoundcloud').value.trim();
                if (!_sp && !_yt && !_sc) {
                    var _w = document.getElementById('embedModeWarn');
                    if (_w) _w.style.display = '';
                    showToast('âš ï¸ Add a Spotify, YouTube, or SoundCloud URL for Embed mode');
                    return;
                }
            }

            const editId = document.getElementById('releaseEditId').value;

            // Collect track rows
            const tracks = [];
            document.querySelectorAll('#trackRowsList .track-input-row').forEach(row => {
                const inputs = row.querySelectorAll('input[type="text"]');
                const t = inputs[0].value.trim();
                const d = inputs[1].value.trim();
                if (t) tracks.push({ title: t, duration: d || '' });
            });

            const release = {
                id: editId || 'rel_' + Date.now(),
                title,
                type: document.getElementById('releaseType').value,
                artwork: document.getElementById('releaseArtwork').value.trim(),
                // oEmbed enrichment fields (backwards-compatible â€” absent on old releases)
                artworkUrl:    _oembedDraft.artworkUrl    || undefined,
                provider:      _oembedDraft.provider      || undefined,
                providerTitle: _oembedDraft.providerTitle || undefined,
                oembedTitle:   _oembedDraft.oembedTitle   || undefined,
                displayMode: document.getElementById('releaseDisplayMode').value,
                credits: _creditsDraft.slice(),
                platforms: {
                    spotify:    document.getElementById('releaseSpotify').value.trim(),
                    apple:      document.getElementById('releaseApple').value.trim(),
                    soundcloud: document.getElementById('releaseSoundcloud').value.trim(),
                    youtube:    document.getElementById('releaseYoutube').value.trim(),
                    tiktok:     document.getElementById('releaseTiktok').value.trim(),
                },
                tracks
            };

            if (editId) {
                const idx = musicState.releases.findIndex(r => r.id === editId);
                if (idx > -1) musicState.releases[idx] = release;
            } else {
                musicState.releases.unshift(release);
            }

            saveMusicState();
            closeModal('addReleaseModal');
            showToast(`âœ… "${title}" saved`);
            try { renderMusicTab(); } catch(e) { console.error('renderMusicTab error', e); }
            try { updatePreviewMusic(); } catch(e) { console.error('updatePreviewMusic error', e); }
        }

        function deleteRelease(id) {
            const rel = musicState.releases.find(r => r.id === id);
            const name = rel ? rel.title : 'this release';
            showConfirm(
                'Remove Release?',
                `"${name}" will be removed from your profile.`,
                'ðŸ—‘'
            ).then(confirmed => {
                if (!confirmed) return;
                musicState.releases = musicState.releases.filter(r => r.id !== id);
                saveMusicState();
                renderMusicTab();
                updatePreviewMusic();
                showToast('Release removed');
            });
        }

        // â”€â”€ Render the Music tab release list â”€â”€
        function renderMusicTab() {
            try {
            const _errBanner = document.getElementById('musicTabErrorBanner');
            if (_errBanner) _errBanner.style.display = 'none';
            const container = document.getElementById('musicReleaseList');
            if (!container) return;

            // Sync global display mode selector
            var _mdSel = document.getElementById('musicProfileDisplayMode');
            if (_mdSel) _mdSel.value = musicDisplayMode;

            const emptyState = document.getElementById('musicEmptyState');
            const addBtn     = document.getElementById('musicAddBtn');

            if (musicState.releases.length === 0) {
                container.innerHTML = '';
                if (emptyState) emptyState.style.display = '';
                if (addBtn)     addBtn.style.display     = 'none';
                return;
            }

            if (emptyState) emptyState.style.display = 'none';
            if (addBtn)     addBtn.style.display     = '';


            container.innerHTML = musicState.releases.map(rel => {
                const typeLabel = (rel.type || 'single').charAt(0).toUpperCase() + (rel.type || 'single').slice(1);
                const trackCount = rel.tracks ? rel.tracks.length : 0;
                const modeIcon = rel.displayMode === 'embed' ? 'â–¶' : 'â‰¡';
                const modeLabel = rel.displayMode === 'embed' ? 'Embed' : 'Tracklist';
                const platforms = rel.platforms || {};
                const modeWarn  = (rel.displayMode === 'embed' && !_isEmbedEligible(rel))
                    ? ' <span style="font-size:10px;color:#f59e0b;" title="Add a Spotify, YouTube, or SoundCloud URL to enable embedding">âš  needs URL</span>' : '';

                const pills = [
                    { key: 'sp', label: 'SP', url: platforms.spotify },
                    { key: 'am', label: 'AM', url: platforms.apple },
                    { key: 'sc', label: 'SC', url: platforms.soundcloud },
                    { key: 'yt', label: 'YT', url: platforms.youtube },
                    { key: 'tt', label: 'TT', url: platforms.tiktok },
                ].map(p => `<span class="release-pill ${p.key}${p.url ? ' has-url' : ''}">${p.label}</span>`).join('');

                const _artSrc = rel.artworkUrl || rel.artwork || '';
                const artwork = _artSrc
                    ? `<img src="${_artSrc}" class="release-artwork-placeholder" style="object-fit:cover;border-radius:6px;" onerror="this.style.display='none'">`
                    : `<div class="release-artwork-placeholder">ðŸŽµ</div>`;

                return `
                <div class="release-card" data-release-id="${rel.id}">
                    <div class="release-card-header">
                        ${artwork}
                        <div class="release-info">
                            <div class="release-title">${rel.title}</div>
                            <div class="release-meta">${typeLabel}${trackCount ? ' Â· ' + trackCount + ' track' + (trackCount !== 1 ? 's' : '') : ''}</div>
                        </div>
                        <div class="release-actions">
                            <button class="icon-btn" onclick="openAddReleaseModal('${rel.id}')" title="Edit">âœï¸</button>
                            <button class="icon-btn delete" onclick="deleteRelease('${rel.id}')" title="Delete">ðŸ—‘</button>
                        </div>
                    </div>
                    <div class="release-card-footer">
                        <div class="release-platform-pills">${pills}</div>
                        <span class="release-mode-badge">${modeIcon} ${modeLabel}${modeWarn}</span>
                    </div>
                </div>`;
            }).join('');
            } catch(e) {
                console.warn('[renderMusicTab]', e);
                const _b = document.getElementById('musicTabErrorBanner');
                if (_b) { var _m = _b.querySelector('#musicTabErrorMsg'); if (_m) _m.textContent = 'Releases list failed to render â€” check console for details.'; _b.style.display = 'flex'; }
            }
        }

        function resetMusicUI() {
            var b = document.getElementById('musicTabErrorBanner');
            if (b) b.style.display = 'none';
            safeRender(renderMusicTab);
            safeRender(updatePreviewMusic);
        }

        // â”€â”€ Update preview panel music section â”€â”€
        var _musicPreviewExpanded = false;
        var _musicEmbedExpanded   = false; // independent expander for embeds sub-block in Both mode

        function _toggleMusicPreviewExpand() {
            _musicPreviewExpanded = !_musicPreviewExpanded;
            updatePreviewMusic();
        }

        function _toggleMusicEmbedExpand() {
            _musicEmbedExpanded = !_musicEmbedExpanded;
            updatePreviewMusic();
        }

        // True when a release has at least one URL that can be embedded
        function _isEmbedEligible(rel) {
            var p = rel.platforms || {};
            return !!(normalizeSpotifyEmbedUrl(p.spotify) ||
                      normalizeYouTubeEmbedUrl(p.youtube) ||
                      normalizeSoundCloudEmbedUrl(p.soundcloud));
        }

        // Build one tracklist card (used in Tracklist and Both modes)
        function _buildTracklistCard(rel) {
            const platforms    = rel.platforms || {};
            const hasPlatforms = Object.values(platforms).some(u => u);
            const pills = [
                { label: 'SP', color: '#1DB954', url: platforms.spotify },
                { label: 'AM', color: '#fc3c44', url: platforms.apple },
                { label: 'SC', color: '#ff5500', url: platforms.soundcloud },
                { label: 'YT', color: '#ff0000', url: platforms.youtube },
            ].filter(p => p.url).map(p =>
                `<span style="font-size:10px;font-weight:800;color:${p.color};border:1.5px solid ${p.color};border-radius:999px;padding:2px 7px;">${p.label}</span>`
            ).join('');
            const typeLabel  = (rel.type || 'single').charAt(0).toUpperCase() + (rel.type || 'single').slice(1);
            const tracksHtml = (rel.tracks || []).slice(0, 6).map((t, i) =>
                `<div style="display:flex;align-items:center;gap:8px;padding:5px 0;border-bottom:1px solid var(--border);font-size:12px;">` +
                `<span style="width:16px;text-align:center;color:var(--text-tertiary);font-size:11px;font-weight:600;">${i+1}</span>` +
                `<span style="flex:1;font-weight:500;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;">${t.title}</span>` +
                `<span style="color:var(--text-tertiary);font-size:11px;">${t.duration || ''}</span></div>`
            ).join('');
            const moreCount = Math.max(0, (rel.tracks || []).length - 6);
            const _tSrc     = rel.artworkUrl || rel.artwork || '';
            const _tThumb   = _tSrc
                ? `<img src="${_tSrc}" style="width:40px;height:40px;border-radius:6px;object-fit:cover;flex-shrink:0;" onerror="this.style.display='none'">`
                : `<div style="width:40px;height:40px;border-radius:6px;background:linear-gradient(135deg,var(--accent),#06b6d4);flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:16px;">ðŸŽµ</div>`;
            return `<div class="able-card" style="overflow:hidden;">` +
                `<div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">${_tThumb}` +
                `<div style="flex:1;min-width:0;"><div style="font-size:13px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${rel.title}</div>` +
                `<div style="font-size:11px;color:var(--text-tertiary);">${typeLabel}</div></div></div>` +
                `${tracksHtml}` +
                `${moreCount > 0 ? `<div style="font-size:11px;color:var(--text-tertiary);padding-top:6px;text-align:center;">+${moreCount} more tracks</div>` : ''}` +
                `${hasPlatforms ? `<div style="display:flex;gap:5px;flex-wrap:wrap;margin-top:8px;">${pills}</div>` : ''}` +
                `${_buildCreditsHtml(rel)}</div>`;
        }

        // Build one embed card â€” call only after confirming _isEmbedEligible
        function _buildEmbedCard(rel) {
            const platforms  = rel.platforms || {};
            const typeLabel  = (rel.type || 'single').charAt(0).toUpperCase() + (rel.type || 'single').slice(1);
            const spEmbed    = normalizeSpotifyEmbedUrl(platforms.spotify);
            const ytEmbed    = normalizeYouTubeEmbedUrl(platforms.youtube);
            const scEmbed    = normalizeSoundCloudEmbedUrl(platforms.soundcloud);
            const _eSrc      = rel.artworkUrl || rel.artwork || '';
            const _eThumb    = _eSrc
                ? `<img src="${_eSrc}" style="width:36px;height:36px;border-radius:6px;object-fit:cover;flex-shrink:0;" onerror="this.style.display='none'">`
                : '';
            const _eHeader   = `<div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;padding:10px 10px 0;">${_eThumb}<div style="flex:1;min-width:0;"><div style="font-size:12px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${rel.title}</div><div style="font-size:10px;color:var(--text-tertiary);">${typeLabel}</div></div></div>`;
            if (spEmbed) {
                const h           = spEmbed.height || 152;
                const spKindLabel = spEmbed.kind === 'album' ? ' Â· Album' : spEmbed.kind === 'playlist' ? ' Â· Playlist' : ' Â· Track';
                const spLabel     = `<div style="font-size:11px;font-weight:600;color:#1DB954;margin-bottom:4px;padding:0 10px;">ðŸŸ¢ Spotify player${spKindLabel}</div>`;
                const spBtn       = `<button type="button" class="able-embedLoadBtn" style="background:#1DB954;color:#000;border-color:#1DB954;">ðŸŽµ Load Spotify player</button><div class="able-embedHint">Tap to load Â· Spotify</div>`;
                const iHtml       = `<div class="able-embedWrap" style="padding:0 10px 10px;"><div class="able-embedLazy" data-embed-src="${spEmbed.src}" data-embed-kind="spotify" data-embed-height="${h}" style="min-height:${h}px;">${spBtn}</div></div>`;
                return `<div style="overflow:hidden;padding:0;" class="able-card">${_eHeader}${spLabel}${iHtml}${_buildCreditsHtml(rel)}</div>`;
            }
            if (ytEmbed) {
                const ytLabel = `<div style="font-size:11px;font-weight:600;color:#ff0000;margin-bottom:4px;padding:0 10px;">â–¶ï¸ YouTube video</div>`;
                const ytBtn   = `<button type="button" class="able-embedLoadBtn">â–¶ï¸ Load video</button><div class="able-embedHint">Tap to load Â· YouTube</div>`;
                const iHtml   = `<div class="able-embedWrap" style="padding:0 10px 10px;"><div class="able-embedRatio able-embedLazy" data-embed-src="${ytEmbed.src}" data-embed-kind="youtube">${ytBtn}</div></div>`;
                return `<div style="overflow:hidden;padding:0;" class="able-card">${_eHeader}${ytLabel}${iHtml}${_buildCreditsHtml(rel)}</div>`;
            }
            if (scEmbed) {
                const scLabel = `<div style="font-size:11px;font-weight:600;color:#ff5500;margin-bottom:4px;padding:0 10px;">ðŸŽ§ SoundCloud player</div>`;
                const scBtn   = `<button type="button" class="able-embedLoadBtn">ðŸŽ§ Load SoundCloud player</button><div class="able-embedHint">Tap to load Â· SoundCloud</div>`;
                const iHtml   = `<div class="able-embedWrap" style="padding:0 10px 10px;"><div class="able-embedLazy" data-embed-src="${scEmbed.src}" data-embed-kind="soundcloud" data-embed-height="180" style="min-height:180px;">${scBtn}</div></div>`;
                return `<div style="overflow:hidden;padding:0;" class="able-card">${_eHeader}${scLabel}${iHtml}${_buildCreditsHtml(rel)}</div>`;
            }
            return ''; // shouldn't reach here if caller filters by _isEmbedEligible
        }

        function updatePreviewMusic() {
            try {
            const _errBanner = document.getElementById('musicTabErrorBanner');
            if (_errBanner) _errBanner.style.display = 'none';
            const section = document.getElementById('previewMusicSection');
            const cards = document.getElementById('previewMusicCards');
            if (!section || !cards) return;

            if (musicState.releases.length === 0) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';

            // Render by global display mode
            if (musicDisplayMode === 'both') {
                // Both: tracklist sub-block (ALL releases) + embeds sub-block (eligible only)
                const _allRels   = musicState.releases;
                const _embedElig = _allRels.filter(_isEmbedEligible);

                // Tracklist sub-block â€” cap 6, _musicPreviewExpanded
                const TL_CAP     = 6;
                const _tlCapped  = _musicPreviewExpanded ? _allRels : _allRels.slice(0, TL_CAP);
                const _tlHasMore = !_musicPreviewExpanded && _allRels.length > TL_CAP;
                let _html        = _tlCapped.map(_buildTracklistCard).join('');
                if (_tlHasMore) {
                    _html += `<button type="button" onclick="_toggleMusicPreviewExpand()" style="width:100%;padding:8px;margin-top:4px;border:1px dashed var(--border);border-radius:8px;background:none;color:var(--text-secondary);font-size:12px;cursor:pointer;">â–¼ View all ${_allRels.length} releases</button>`;
                } else if (_musicPreviewExpanded && _allRels.length > TL_CAP) {
                    _html += `<button type="button" onclick="_toggleMusicPreviewExpand()" style="width:100%;padding:8px;margin-top:4px;border:1px dashed var(--border);border-radius:8px;background:none;color:var(--text-secondary);font-size:12px;cursor:pointer;">â–² Show less</button>`;
                }

                // Embeds sub-block â€” cap 3, _musicEmbedExpanded (independent)
                if (_embedElig.length > 0) {
                    const EM_CAP     = 3;
                    const _emCapped  = _musicEmbedExpanded ? _embedElig : _embedElig.slice(0, EM_CAP);
                    const _emHasMore = !_musicEmbedExpanded && _embedElig.length > EM_CAP;
                    _html += `<div style="margin-top:16px;padding-top:12px;border-top:1px solid var(--border);"><div style="font-size:11px;font-weight:700;color:var(--text-secondary);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:8px;">Embeds</div>`;
                    _html += _emCapped.map(_buildEmbedCard).join('');
                    if (_emHasMore) {
                        _html += `<button type="button" onclick="_toggleMusicEmbedExpand()" style="width:100%;padding:8px;margin-top:4px;border:1px dashed var(--border);border-radius:8px;background:none;color:var(--text-secondary);font-size:12px;cursor:pointer;">â–¼ View all ${_embedElig.length} embeds</button>`;
                    } else if (_musicEmbedExpanded && _embedElig.length > EM_CAP) {
                        _html += `<button type="button" onclick="_toggleMusicEmbedExpand()" style="width:100%;padding:8px;margin-top:4px;border:1px dashed var(--border);border-radius:8px;background:none;color:var(--text-secondary);font-size:12px;cursor:pointer;">â–² Show fewer embeds</button>`;
                    }
                    _html += `</div>`;
                }

                cards.innerHTML = _html;

            } else if (musicDisplayMode === 'embeds') {
                // Embeds only: show ONLY embed-eligible releases as embed cards
                const _visible = musicState.releases.filter(_isEmbedEligible);
                if (_visible.length === 0) { section.style.display = 'none'; return; }
                const CAP      = 3;
                const _capped  = _musicPreviewExpanded ? _visible : _visible.slice(0, CAP);
                const _hasMore = !_musicPreviewExpanded && _visible.length > CAP;
                cards.innerHTML = _capped.map(_buildEmbedCard).join('');
                if (_hasMore) {
                    cards.innerHTML += `<button type="button" onclick="_toggleMusicPreviewExpand()" style="width:100%;padding:8px;margin-top:4px;border:1px dashed var(--border);border-radius:8px;background:none;color:var(--text-secondary);font-size:12px;cursor:pointer;">â–¼ View all ${_visible.length} embeds</button>`;
                } else if (_musicPreviewExpanded && _visible.length > CAP) {
                    cards.innerHTML += `<button type="button" onclick="_toggleMusicPreviewExpand()" style="width:100%;padding:8px;margin-top:4px;border:1px dashed var(--border);border-radius:8px;background:none;color:var(--text-secondary);font-size:12px;cursor:pointer;">â–² Show less</button>`;
                }

            } else {
                // Tracklist mode: ALL releases as tracklist cards (ignores per-release displayMode)
                const _visible = musicState.releases;
                const CAP      = 6;
                const _capped  = _musicPreviewExpanded ? _visible : _visible.slice(0, CAP);
                const _hasMore = !_musicPreviewExpanded && _visible.length > CAP;
                cards.innerHTML = _capped.map(_buildTracklistCard).join('');
                if (_hasMore) {
                    cards.innerHTML += `<button type="button" onclick="_toggleMusicPreviewExpand()" style="width:100%;padding:8px;margin-top:4px;border:1px dashed var(--border);border-radius:8px;background:none;color:var(--text-secondary);font-size:12px;cursor:pointer;">â–¼ View all ${_visible.length} releases</button>`;
                } else if (_musicPreviewExpanded && _visible.length > CAP) {
                    cards.innerHTML += `<button type="button" onclick="_toggleMusicPreviewExpand()" style="width:100%;padding:8px;margin-top:4px;border:1px dashed var(--border);border-radius:8px;background:none;color:var(--text-secondary);font-size:12px;cursor:pointer;">â–² Show less</button>`;
                }
            }

            initLazyEmbeds(cards);
            if (typeof renderProfileCredits === 'function') safeRender(renderProfileCredits);
            } catch(e) {
                console.warn('[updatePreviewMusic]', e);
                const _b = document.getElementById('musicTabErrorBanner');
                if (_b) { var _m = _b.querySelector('#musicTabErrorMsg'); if (_m) _m.textContent = 'Preview failed to update â€” check console for details.'; _b.style.display = 'flex'; }
            }
        }

        // â”€â”€ Extract Spotify track/album ID from URL â”€â”€
        // â”€â”€ Embed URL normalisers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // Each returns { src: string } or null.

        function normalizeSpotifyEmbedUrl(url) {
            if (!url) return null;
            try {
                // spotify:track:ID  /  spotify:album:ID  /  spotify:playlist:ID (URI form)
                var uriM = url.match(/^spotify:(track|album|playlist):([A-Za-z0-9]+)$/);
                if (uriM) {
                    var spKind1 = uriM[1];
                    return { src: 'https://open.spotify.com/embed/' + spKind1 + '/' + uriM[2],
                             kind: spKind1, height: spKind1 === 'track' ? 152 : 380 };
                }
                // Already an embed URL â€” pass through, re-canonicalise
                var embM = url.match(/spotify\.com\/embed\/(track|album|playlist)\/([A-Za-z0-9]+)/);
                if (embM) {
                    var spKind2 = embM[1];
                    return { src: 'https://open.spotify.com/embed/' + spKind2 + '/' + embM[2],
                             kind: spKind2, height: spKind2 === 'track' ? 152 : 380 };
                }
                // Standard share URL â†’ open.spotify.com/(track|album|playlist)/ID
                var shrM = url.match(/spotify\.com\/(track|album|playlist)\/([A-Za-z0-9]+)/);
                if (shrM) {
                    var spKind3 = shrM[1];
                    return { src: 'https://open.spotify.com/embed/' + spKind3 + '/' + shrM[2],
                             kind: spKind3, height: spKind3 === 'track' ? 152 : 380 };
                }
            } catch(e) {}
            return null;
        }

        function normalizeYouTubeEmbedUrl(url) {
            if (!url) return null;
            try {
                // Already embed URL
                var embM = url.match(/youtube\.com\/embed\/([A-Za-z0-9_-]{11})/);
                if (embM) return { src: 'https://www.youtube.com/embed/' + embM[1] };
                // youtu.be short link
                var shortM = url.match(/youtu\.be\/([A-Za-z0-9_-]{11})/);
                if (shortM) return { src: 'https://www.youtube.com/embed/' + shortM[1] };
                // /watch?v=ID  /shorts/ID  /v/ID
                var longM = url.match(/youtube\.com\/(?:watch\?v=|shorts\/|v\/)([A-Za-z0-9_-]{11})/);
                if (longM) return { src: 'https://www.youtube.com/embed/' + longM[1] };
            } catch(e) {}
            return null;
        }

        function normalizeSoundCloudEmbedUrl(url) {
            if (!url) return null;
            try {
                if (/soundcloud\.com\//.test(url))
                    return { src: 'https://w.soundcloud.com/player/?url=' + encodeURIComponent(url) +
                        '&color=%230891b2&auto_play=false&hide_related=true&show_comments=false' +
                        '&show_user=true&show_reposts=false&show_teaser=false&visual=false',
                        height: 180 };
            } catch(e) {}
            return null;
        }

        // â”€â”€â”€ Release Link Enrichment v1 (oEmbed) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        var OEMBED_CACHE_KEY = 'able_oembed_cache_v1';
        var OEMBED_TTL_MS = 7 * 24 * 60 * 60 * 1000; // 7 days

        function _loadOEmbedCache() {
            try { return JSON.parse(localStorage.getItem(OEMBED_CACHE_KEY) || '{}'); } catch(e) { return {}; }
        }
        function _saveOEmbedCache(cache) {
            try { localStorage.setItem(OEMBED_CACHE_KEY, JSON.stringify(cache)); } catch(e) {}
        }

        function detectProviderFromUrl(url) {
            if (!url) return null;
            try {
                if (/spotify\.com/.test(url))           return 'spotify';
                if (/youtu\.be|youtube\.com/.test(url)) return 'youtube';
                if (/soundcloud\.com/.test(url))        return 'soundcloud';
                if (/vimeo\.com/.test(url))             return 'vimeo';
            } catch(e) {}
            return null;
        }

        function getOEmbed(url, provider) {
            if (!url || !provider) return Promise.resolve(null);
            var cache = _loadOEmbedCache();
            var cached = cache[url];
            if (cached && (Date.now() - cached.t) < OEMBED_TTL_MS) return Promise.resolve(cached.data);
            var endpoint;
            if      (provider === 'spotify')    endpoint = 'https://open.spotify.com/oembed?url=' + encodeURIComponent(url);
            else if (provider === 'youtube')    endpoint = 'https://www.youtube.com/oembed?url=' + encodeURIComponent(url) + '&format=json';
            else if (provider === 'soundcloud') endpoint = 'https://soundcloud.com/oembed?format=json&url=' + encodeURIComponent(url);
            else if (provider === 'vimeo')      endpoint = 'https://vimeo.com/api/oembed.json?url=' + encodeURIComponent(url);
            else return Promise.resolve(null);
            return fetch(endpoint)
                .then(function(res) { return res.ok ? res.json() : null; })
                .then(function(data) {
                    if (!data) return null;
                    var result = { title: data.title || '', thumbnail_url: data.thumbnail_url || '', provider_name: data.provider_name || provider };
                    cache[url] = { t: Date.now(), data: result };
                    _saveOEmbedCache(cache);
                    return result;
                })
                .catch(function() { return null; });
        }

        // Draft: holds enrichment data for the currently-open Add Release modal
        var _oembedDraft = { artworkUrl: '', provider: '', providerTitle: '', oembedTitle: '', titleAutoFilled: false };
        var _oembedTimer = null;

        function _triggerReleaseEnrichment() {
            clearTimeout(_oembedTimer);
            _oembedTimer = setTimeout(_runReleaseEnrichment, 400);
        }

        function _runReleaseEnrichment() {
            var spEl = document.getElementById('releaseSpotify');
            var ytEl = document.getElementById('releaseYoutube');
            var scEl = document.getElementById('releaseSoundcloud');
            var spUrl = spEl ? spEl.value.trim() : '';
            var ytUrl = ytEl ? ytEl.value.trim() : '';
            var scUrl = scEl ? scEl.value.trim() : '';
            var url = null, provider = null;
            if (spUrl && detectProviderFromUrl(spUrl) === 'spotify')         { url = spUrl; provider = 'spotify'; }
            else if (ytUrl && detectProviderFromUrl(ytUrl) === 'youtube')    { url = ytUrl; provider = 'youtube'; }
            else if (scUrl && detectProviderFromUrl(scUrl) === 'soundcloud') { url = scUrl; provider = 'soundcloud'; }
            if (!url) { _hideEnrichPreview(); return; }
            getOEmbed(url, provider).then(function(data) {
                if (!data) { _hideEnrichPreview(); return; }
                _oembedDraft.artworkUrl    = data.thumbnail_url || '';
                _oembedDraft.provider      = provider;
                _oembedDraft.providerTitle = data.provider_name || provider;
                _oembedDraft.oembedTitle   = data.title || '';
                var titleEl = document.getElementById('releaseTitle');
                var statusMsg = '';
                if (titleEl && !titleEl.value.trim() && data.title) {
                    titleEl.value = data.title.trim();
                    _oembedDraft.titleAutoFilled = true;
                    statusMsg = 'Auto-filled title';
                }
                _showEnrichPreview(data, provider, statusMsg);
            }).catch(function() { _hideEnrichPreview(); });
        }

        function _showEnrichPreview(data, provider, statusMsg) {
            var row    = document.getElementById('releaseEnrichPreview');
            var thumb  = document.getElementById('releaseEnrichThumb');
            var label  = document.getElementById('releaseEnrichLabel');
            var status = document.getElementById('releaseEnrichStatus');
            if (!row) return;
            var provLabels = { spotify: 'Spotify', youtube: 'YouTube', soundcloud: 'SoundCloud' };
            if (thumb) {
                if (data.thumbnail_url) { thumb.src = data.thumbnail_url; thumb.style.display = 'block'; }
                else { thumb.style.display = 'none'; }
            }
            if (label) label.textContent = 'Detected: ' + (provLabels[provider] || provider) + (data.title ? ' â€” ' + data.title : '');
            if (status) { status.textContent = statusMsg || ''; status.style.display = statusMsg ? '' : 'none'; }
            row.style.display = 'flex';
        }

        function _hideEnrichPreview() {
            var row = document.getElementById('releaseEnrichPreview');
            if (row) row.style.display = 'none';
        }

        // â”€â”€ Lazy embed loader â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function injectLazyEmbed(el) {
            if (!el || el.dataset.loaded) return;
            el.dataset.loaded = '1';
            var src  = el.dataset.embedSrc;
            var kind = el.dataset.embedKind;
            var h    = parseInt(el.dataset.embedHeight, 10) || 0;
            if (!src) return;
            if (kind === 'spotify') {
                if (!h) h = 152;
                el.style.minHeight = h + 'px';
                el.style.height    = h + 'px';
                el.innerHTML = '<iframe style="border-radius:12px;display:block;" src="' + src +
                    '" width="100%" height="' + h +
                    '" frameborder="0" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>';
            } else if (kind === 'soundcloud') {
                if (!h) h = 180;
                el.style.minHeight = h + 'px';
                el.innerHTML = '<iframe width="100%" height="' + h +
                    '" scrolling="no" frameborder="no" allow="autoplay" src="' + src +
                    '" style="display:block;"></iframe>';
            } else {
                // YouTube â€” .able-embedRatio CSS handles 16:9 via padding-top:56.25%
                el.innerHTML = '<iframe src="' + src +
                    '" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen" allowfullscreen></iframe>';
            }
        }

        function initLazyEmbeds(root) {
            root = root || document;
            var nodes = root.querySelectorAll ? root.querySelectorAll('.able-embedLazy:not([data-loaded])') : [];
            if (!nodes.length) return;
            var observer = null;
            if (typeof IntersectionObserver !== 'undefined') {
                observer = new IntersectionObserver(function(entries, obs) {
                    entries.forEach(function(entry) {
                        if (entry.isIntersecting) {
                            injectLazyEmbed(entry.target);
                            obs.unobserve(entry.target);
                        }
                    });
                }, { threshold: 0.15, rootMargin: '200px' });
            }
            nodes.forEach(function(el) {
                if (el.dataset.loaded) return;
                var btn = el.querySelector('.able-embedLoadBtn');
                if (btn) btn.addEventListener('click', function() {
                    btn.textContent = 'â³ Loadingâ€¦';
                    btn.disabled = true;
                    btn.style.opacity = '0.7';
                    btn.style.cursor = 'default';
                    setTimeout(function() { injectLazyEmbed(el); }, 150);
                });
                if (observer) observer.observe(el);
            });
        }

        // â”€â”€ Vimeo embed normaliser â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function normalizeVimeoEmbedUrl(url) {
            if (!url) return null;
            try {
                // vimeo.com/123456789  or  player.vimeo.com/video/123456789
                var m = url.match(/(?:vimeo\.com\/(?:video\/)?|player\.vimeo\.com\/video\/)(\d+)/);
                if (m) return { src: 'https://player.vimeo.com/video/' + m[1] + '?title=0&byline=0&portrait=0', kind: 'vimeo' };
            } catch(e) {}
            return null;
        }

        // â”€â”€â”€ Videos oEmbed draft (separate from release _oembedDraft) â”€â”€â”€â”€â”€
        var _videoOembedDraft = { artworkUrl: '', provider: '', providerTitle: '', oembedTitle: '', titleAutoFilled: false };
        var _videoOembedTimer = null;

        function _triggerVideoEnrichment() {
            clearTimeout(_videoOembedTimer);
            _videoOembedTimer = setTimeout(_runVideoEnrichment, 400);
        }

        function _runVideoEnrichment() {
            var urlEl = document.getElementById('videoUrl');
            var url = urlEl ? urlEl.value.trim() : '';
            var provider = detectProviderFromUrl(url);
            if (!url || !provider || (provider !== 'youtube' && provider !== 'vimeo')) {
                _hideVideoEnrichPreview();
                return;
            }
            // Auto-select platform dropdown
            var platEl = document.getElementById('videoPlatform');
            if (platEl) platEl.value = (provider === 'vimeo' ? 'vimeo' : 'youtube');
            getOEmbed(url, provider).then(function(data) {
                if (!data) { _hideVideoEnrichPreview(); return; }
                _videoOembedDraft.artworkUrl    = data.thumbnail_url || '';
                _videoOembedDraft.provider      = provider;
                _videoOembedDraft.providerTitle = data.provider_name || provider;
                _videoOembedDraft.oembedTitle   = data.title || '';
                var titleEl = document.getElementById('videoTitle');
                var statusMsg = '';
                if (titleEl && !titleEl.value.trim() && data.title) {
                    titleEl.value = data.title.trim();
                    _videoOembedDraft.titleAutoFilled = true;
                    statusMsg = 'Auto-filled title';
                }
                _showVideoEnrichPreview(data, provider, statusMsg);
            }).catch(function() { _hideVideoEnrichPreview(); });
        }

        function _showVideoEnrichPreview(data, provider, statusMsg) {
            var row    = document.getElementById('videoEnrichPreview');
            var thumb  = document.getElementById('videoEnrichThumb');
            var label  = document.getElementById('videoEnrichLabel');
            var status = document.getElementById('videoEnrichStatus');
            if (!row) return;
            var provLabels = { youtube: 'YouTube', vimeo: 'Vimeo' };
            if (thumb) {
                if (data.thumbnail_url) { thumb.src = data.thumbnail_url; thumb.style.display = 'block'; }
                else { thumb.style.display = 'none'; }
            }
            if (label) label.textContent = 'Detected: ' + (provLabels[provider] || provider) + (data.title ? ' â€” ' + data.title : '');
            if (status) { status.textContent = statusMsg || ''; status.style.display = statusMsg ? '' : 'none'; }
            row.style.display = 'flex';
        }

        function _hideVideoEnrichPreview() {
            var row = document.getElementById('videoEnrichPreview');
            if (row) row.style.display = 'none';
        }

        // â”€â”€â”€ Events ticket-link provider detection (no network fetch) â”€â”€â”€â”€â”€â”€
        var _eventOembedDraft = { provider: '', providerTitle: '' };
        var _eventEnrichTimer = null;

        function _detectEventProvider(url) {
            if (!url) return null;
            try {
                var u = url.toLowerCase();
                if (u.indexOf('eventbrite.') > -1)   return { provider: 'eventbrite',   providerTitle: 'Eventbrite' };
                if (u.indexOf('dice.fm') > -1)        return { provider: 'dice',         providerTitle: 'Dice' };
                if (u.indexOf('songkick.com') > -1)   return { provider: 'songkick',     providerTitle: 'Songkick' };
                if (u.indexOf('ticketmaster.') > -1)  return { provider: 'ticketmaster', providerTitle: 'Ticketmaster' };
                if (u.indexOf('bandsintown.com') > -1)return { provider: 'bandsintown',  providerTitle: 'Bands in Town' };
                if (u.indexOf('seetickets.') > -1)    return { provider: 'seetickets',   providerTitle: 'See Tickets' };
                if (u.indexOf('ra.co') > -1)          return { provider: 'ra',           providerTitle: 'Resident Advisor' };
                if (u.indexOf('skiddle.com') > -1)    return { provider: 'skiddle',      providerTitle: 'Skiddle' };
                if (u.indexOf('ticketweb.') > -1)     return { provider: 'ticketweb',    providerTitle: 'TicketWeb' };
            } catch(e) {}
            return null;
        }

        function _triggerEventEnrichment() {
            clearTimeout(_eventEnrichTimer);
            _eventEnrichTimer = setTimeout(_runEventEnrichment, 300);
        }

        function _runEventEnrichment() {
            var urlEl = document.getElementById('eventTicketUrl');
            var url = urlEl ? urlEl.value.trim() : '';
            if (!url) {
                _hideEventEnrichPreview();
                _eventOembedDraft = { provider: '', providerTitle: '' };
                return;
            }
            var result = _detectEventProvider(url);
            if (!result) {
                _hideEventEnrichPreview();
                _eventOembedDraft = { provider: '', providerTitle: '' };
                return;
            }
            _eventOembedDraft.provider      = result.provider;
            _eventOembedDraft.providerTitle = result.providerTitle;
            _showEventEnrichPreview(result.provider, result.providerTitle);
        }

        function _showEventEnrichPreview(provider, providerTitle) {
            var row    = document.getElementById('eventEnrichPreview');
            var label  = document.getElementById('eventEnrichLabel');
            var status = document.getElementById('eventEnrichStatus');
            if (!row) return;
            if (label)  label.textContent = 'Ticket link: ' + (providerTitle || provider);
            if (status) status.style.display = 'none';
            row.style.display = 'flex';
        }

        function _hideEventEnrichPreview() {
            var row = document.getElementById('eventEnrichPreview');
            if (row) row.style.display = 'none';
        }

        // â”€â”€â”€ Merch / commerce link provider detection (URL-based) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        var _merchDraft = { provider: '', providerTitle: '', artworkUrl: '', oembedTitle: '', titleAutoFilled: false };
        var _merchEnrichTimer = null;

        function _detectMerchProvider(url) {
            if (!url) return null;
            try {
                var u = url.toLowerCase();
                if (u.indexOf('.myshopify.com') > -1 || u.indexOf('shopify.com') > -1) return { provider: 'shopify',   providerTitle: 'Shopify' };
                if (u.indexOf('bandcamp.com') > -1)     return { provider: 'bandcamp',   providerTitle: 'Bandcamp' };
                if (u.indexOf('gumroad.com') > -1)      return { provider: 'gumroad',    providerTitle: 'Gumroad' };
                if (u.indexOf('etsy.com') > -1)         return { provider: 'etsy',       providerTitle: 'Etsy' };
                if (u.indexOf('sellfy.com') > -1)       return { provider: 'sellfy',     providerTitle: 'Sellfy' };
                if (u.indexOf('bigcartel.com') > -1)    return { provider: 'bigcartel',  providerTitle: 'Big Cartel' };
                if (u.indexOf('ko-fi.com') > -1)        return { provider: 'kofi',       providerTitle: 'Ko-fi' };
                if (u.indexOf('patreon.com') > -1)      return { provider: 'patreon',    providerTitle: 'Patreon' };
                if (u.indexOf('paypal.me') > -1)        return { provider: 'paypal',     providerTitle: 'PayPal' };
                if (u.indexOf('square.site') > -1 || u.indexOf('squareup.com') > -1) return { provider: 'square', providerTitle: 'Square' };
                if (u.indexOf('woocommerce') > -1 || (u.indexOf('/shop') > -1 && u.indexOf('/product') > -1)) return { provider: 'woocommerce', providerTitle: 'WooCommerce' };
            } catch(e) {}
            return null;
        }

        function _triggerMerchEnrichment() {
            clearTimeout(_merchEnrichTimer);
            _merchEnrichTimer = setTimeout(_runMerchEnrichment, 350);
        }

        function _runMerchEnrichment() {
            var urlEl   = document.getElementById('productUrl');
            var titleEl = document.getElementById('productName');
            var url = urlEl ? urlEl.value.trim() : '';
            if (!url) { _hideMerchEnrichPreview(); _merchDraft = { provider: '', providerTitle: '', artworkUrl: '', oembedTitle: '', titleAutoFilled: false }; return; }
            var result = _detectMerchProvider(url);
            if (!result) { _hideMerchEnrichPreview(); _merchDraft.provider = ''; _merchDraft.providerTitle = ''; return; }
            _merchDraft.provider      = result.provider;
            _merchDraft.providerTitle = result.providerTitle;
            // Derive title hint from URL slug if title is blank
            var autoTitle = '';
            try {
                var slug = url.replace(/[?#].*/, '').split('/').filter(Boolean).pop() || '';
                autoTitle = slug.replace(/[-_]/g, ' ').replace(/\.\w+$/, '').trim();
                if (autoTitle && autoTitle.length > 2 && titleEl && !titleEl.value.trim()) {
                    titleEl.value = autoTitle.charAt(0).toUpperCase() + autoTitle.slice(1);
                    _merchDraft.titleAutoFilled = true;
                    _merchDraft.oembedTitle     = titleEl.value;
                }
            } catch(se) {}
            _showMerchEnrichPreview(result.provider, result.providerTitle);
        }

        function _showMerchEnrichPreview(provider, providerTitle) {
            var row    = document.getElementById('merchEnrichPreview');
            var label  = document.getElementById('merchEnrichLabel');
            var status = document.getElementById('merchEnrichStatus');
            if (!row) return;
            if (label)  label.textContent = 'Store: ' + (providerTitle || provider);
            if (status) status.style.display = 'none';
            row.style.display = 'flex';
        }

        function _hideMerchEnrichPreview() {
            var row = document.getElementById('merchEnrichPreview');
            if (row) row.style.display = 'none';
        }

        // Legacy thin wrappers â€” kept so any external call sites don't break
        function extractSpotifyId(url) {
            var r = normalizeSpotifyEmbedUrl(url);
            if (!r) return '';
            var m = r.src.match(/\/embed\/(track|album|playlist)\/([A-Za-z0-9]+)/);
            return m ? m[2] : '';
        }
        function extractYouTubeId(url) {
            var r = normalizeYouTubeEmbedUrl(url);
            if (!r) return '';
            var m = r.src.match(/\/embed\/([A-Za-z0-9_-]{11})/);
            return m ? m[1] : '';
        }

        // Legacy save (no-op now, kept so nothing breaks)
        function saveTrack() {
            openAddReleaseModal();
        }

        function openAddVideoModal() {
            var modal = document.getElementById('addVideoModal');
            if (!modal) return;
            // Reset form + draft on every open
            document.getElementById('videoTitle').value = '';
            document.getElementById('videoUrl').value = '';
            document.getElementById('videoCredits').value = '';
            document.getElementById('videoPlatform').value = 'youtube';
            _videoOembedDraft = { artworkUrl: '', provider: '', providerTitle: '', oembedTitle: '', titleAutoFilled: false };
            _hideVideoEnrichPreview();
            // Attach listeners once (dataset guard)
            if (!modal.dataset.enrichInit) {
                modal.dataset.enrichInit = '1';
                var urlEl = document.getElementById('videoUrl');
                if (urlEl) {
                    urlEl.addEventListener('change', _triggerVideoEnrichment);
                    urlEl.addEventListener('blur',   _triggerVideoEnrichment);
                }
                var titleEl = document.getElementById('videoTitle');
                if (titleEl) titleEl.addEventListener('input', function() { _videoOembedDraft.titleAutoFilled = false; });
            }
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function openAddEventModal() {
            var modal = document.getElementById('addEventModal');
            if (!modal) return;
            // Reset form + draft on every open
            document.getElementById('eventName').value      = '';
            document.getElementById('eventVenue').value     = '';
            document.getElementById('eventCity').value      = '';
            document.getElementById('eventDate').value      = '';
            document.getElementById('eventTime').value      = '';
            document.getElementById('eventTicketUrl').value = '';
            document.getElementById('eventCredits').value   = '';
            _eventOembedDraft = { provider: '', providerTitle: '' };
            _hideEventEnrichPreview();
            // Attach ticket URL listeners once (dataset guard)
            if (!modal.dataset.enrichInit) {
                modal.dataset.enrichInit = '1';
                var ticketEl = document.getElementById('eventTicketUrl');
                if (ticketEl) {
                    ticketEl.addEventListener('input',  _triggerEventEnrichment);
                    ticketEl.addEventListener('change', _triggerEventEnrichment);
                    ticketEl.addEventListener('blur',   _triggerEventEnrichment);
                }
            }
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function openAddProductModal() {
            var modal = document.getElementById('addProductModal');
            if (!modal) return;
            // Reset all fields + draft on every open
            document.getElementById('productName').value        = '';
            document.getElementById('productDescription').value = '';
            document.getElementById('productPrice').value       = '';
            document.getElementById('productStock').value       = '';
            document.getElementById('productUrl').value         = '';
            document.getElementById('productImage').value       = '';
            document.getElementById('productCredits').value     = '';
            _merchDraft = { provider: '', providerTitle: '', artworkUrl: '', oembedTitle: '', titleAutoFilled: false };
            _hideMerchEnrichPreview();
            // Attach purchase URL listener once (dataset guard)
            if (!modal.dataset.enrichInit) {
                modal.dataset.enrichInit = '1';
                var urlEl = document.getElementById('productUrl');
                if (urlEl) {
                    urlEl.addEventListener('input',  _triggerMerchEnrichment);
                    urlEl.addEventListener('change', _triggerMerchEnrichment);
                    urlEl.addEventListener('blur',   _triggerMerchEnrichment);
                }
                var nameEl = document.getElementById('productName');
                if (nameEl) nameEl.addEventListener('input', function() { _merchDraft.titleAutoFilled = false; });
            }
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId) {
            const m = document.getElementById(modalId);
            if (m) m.classList.remove('active');
            // Restore body scroll if no modal-like overlays remain open
            if (!document.querySelector('.modal-overlay.active, #fullPageOverlay.active, .mobile-preview-overlay.active')) {
                document.body.style.overflow = '';
            }
        }

        // Close modal when clicking overlay
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', function(e) {
                if (e.target === this) {
                    // confirmModal has a Promise-based API â€” use its dedicated closer
                    if (this.id === 'confirmModal') closeConfirmModal();
                    else closeModal(this.id);
                }
            });
        });

        // Save Functions (with toast notifications)

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // VIDEOS â€” persistence + list rendering
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const VIDEOS_KEY = 'able_videos';

        function loadVideos() {
            try { return JSON.parse(localStorage.getItem(VIDEOS_KEY) || '[]'); }
            catch(e) { return []; }
        }

        function saveVideos(videos) {
            try { localStorage.setItem(VIDEOS_KEY, JSON.stringify(videos)); }
            catch(e) { console.error('Failed to save videos', e); }
        }

        function saveVideo() {
            const title    = document.getElementById('videoTitle').value.trim();
            const url      = document.getElementById('videoUrl').value.trim();
            const platform = document.getElementById('videoPlatform').value;
            if (!title || !url) {
                showToast('âš ï¸ Please enter both title and URL');
                return;
            }
            const credits = document.getElementById('videoCredits').value.trim();
            const videos = loadVideos();
            videos.push({
                id: Date.now(), title, url, platform, credits,
                artworkUrl:    _videoOembedDraft.artworkUrl    || undefined,
                provider:      _videoOembedDraft.provider      || undefined,
                providerTitle: _videoOembedDraft.providerTitle || undefined,
                oembedTitle:   _videoOembedDraft.oembedTitle   || undefined,
            });
            saveVideos(videos);
            showToast(`âœ… "${title}" added to your videos`);
            closeModal('addVideoModal');
            renderVideoList();
        }

        function deleteVideo(id) {
            const videos = loadVideos().filter(v => v.id !== id);
            saveVideos(videos);
            renderVideoList();
            showToast('Video removed');
        }

        function getYouTubeId(url) {
            try {
                const u = new URL(url);
                if (u.hostname.includes('youtu.be')) return u.pathname.slice(1);
                if (u.hostname.includes('youtube.com')) return u.searchParams.get('v') || '';
            } catch(e) {}
            return '';
        }

        function renderVideoList() {
            const container = document.getElementById('videoList');
            if (!container) return;
            const videos = loadVideos();

            const emptyState = document.getElementById('videoEmptyState');
            const listCard   = document.getElementById('videoListCard');
            if (videos.length === 0) {
                container.innerHTML = '';
                if (emptyState) emptyState.style.display = '';
                if (listCard)   listCard.style.display   = 'none';

                // Update artist page (clear videos)
                if (typeof renderProfileVideos === 'function') {
                    renderProfileVideos();
                }
                return;
            }
            if (emptyState) emptyState.style.display = 'none';
            if (listCard)   listCard.style.display   = '';

            container.innerHTML = videos.map(v => {
                const _vThumbSrc = v.artworkUrl || (getYouTubeId(v.url) ? 'https://img.youtube.com/vi/' + getYouTubeId(v.url) + '/mqdefault.jpg' : '');
                const thumb = _vThumbSrc
                    ? `<img src="${_vThumbSrc}" alt="" style="width:80px;height:45px;object-fit:cover;border-radius:6px;flex-shrink:0;" onerror="this.style.display='none'">`
                    : `<span style="width:80px;height:45px;display:flex;align-items:center;justify-content:center;background:var(--bg-tertiary);border-radius:6px;font-size:22px;flex-shrink:0;">${v.platform === 'tiktok' ? 'ðŸŽ¬' : 'ðŸŽ¥'}</span>`;
                return `
                <div class="list-item" style="display:flex;align-items:center;gap:12px;padding:12px 0;border-bottom:1px solid var(--border);">
                    ${thumb}
                    <div style="flex:1;min-width:0;">
                        <div style="font-weight:700;font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${escapeHtml(v.title)}</div>
                        <div style="font-size:11px;color:var(--text-tertiary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${escapeHtml(v.url)}</div>
                    </div>
                    <button onclick="deleteVideo(${v.id})" class="icon-btn delete" title="Remove" style="flex-shrink:0;">âœ•</button>
                </div>`;
            }).join('');

            // Update artist page videos
            if (typeof renderProfileVideos === 'function') {
                renderProfileVideos();
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // EVENTS â€” persistence + list rendering
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const EVENTS_KEY = 'able_events';

        function loadEvents() {
            try { return JSON.parse(localStorage.getItem(EVENTS_KEY) || '[]'); }
            catch(e) { return []; }
        }

        function saveEvents(events) {
            try { localStorage.setItem(EVENTS_KEY, JSON.stringify(events)); }
            catch(e) { console.error('Failed to save events', e); }
        }

        function saveEvent() {
            const name      = document.getElementById('eventName').value.trim();
            const venue     = document.getElementById('eventVenue').value.trim();
            const city      = document.getElementById('eventCity').value.trim();
            const date      = document.getElementById('eventDate').value;
            const time      = document.getElementById('eventTime').value;
            const ticketUrl = document.getElementById('eventTicketUrl').value.trim();
            if (!name || !venue || !date) {
                showToast('âš ï¸ Please fill in event name, venue, and date');
                return;
            }
            const credits = document.getElementById('eventCredits').value.trim();
            const events = loadEvents();
            events.push({
                id: Date.now(), name, venue, city, date, time, ticketUrl, credits,
                provider:      _eventOembedDraft.provider      || undefined,
                providerTitle: _eventOembedDraft.providerTitle || undefined,
            });
            // Sort by date ascending
            events.sort((a, b) => new Date(a.date) - new Date(b.date));
            saveEvents(events);
            showToast(`âœ… Event "${name}" added`);
            closeModal('addEventModal');
            renderEventList();
        }

        function deleteEvent(id) {
            const events = loadEvents().filter(e => e.id !== id);
            saveEvents(events);
            renderEventList();
            showToast('Event removed');
        }

        function renderEventList() {
            const eventsErrBanner = document.getElementById('eventsTabErrorBanner');
            try {
                if (eventsErrBanner) eventsErrBanner.style.display = 'none';
                const container = document.getElementById('eventList');
                if (!container) return;
                const events = loadEvents();

                const emptyState = document.getElementById('eventEmptyState');
                const listCard   = document.getElementById('eventListCard');
                if (events.length === 0) {
                    container.innerHTML = '';
                    if (emptyState) emptyState.style.display = '';
                    if (listCard)   listCard.style.display   = 'none';
                    try { renderProfileBento(); } catch(be) { console.warn('bento error', be); }
                    return;
                }
                if (emptyState) emptyState.style.display = 'none';
                if (listCard)   listCard.style.display   = '';

                container.innerHTML = events.map(e => {
                    const d     = new Date(e.date + 'T00:00:00');
                    const month = d.toLocaleString('default', { month: 'short' }).toUpperCase();
                    const day   = d.getDate();
                    const ticketLabel = e.providerTitle || 'Tickets';
                    return `
                    <div class="list-item" style="display:flex;align-items:center;gap:12px;padding:12px 0;border-bottom:1px solid var(--border);">
                        <div style="text-align:center;min-width:40px;background:var(--accent-soft);border-radius:8px;padding:6px 4px;">
                            <div style="font-size:10px;font-weight:800;color:var(--accent);">${month}</div>
                            <div style="font-size:18px;font-weight:900;line-height:1;">${day}</div>
                        </div>
                        <div style="flex:1;min-width:0;">
                            <div style="font-weight:700;font-size:13px;">${e.name}</div>
                            <div style="font-size:11px;color:var(--text-tertiary);">${e.venue}${e.city ? ' Â· ' + e.city : ''}${e.time ? ' Â· ' + e.time : ''}</div>
                        </div>
                        ${e.ticketUrl ? `<a href="${e.ticketUrl.replace(/"/g,'%22')}" target="_blank" class="al-url-ok" style="font-weight:700;color:var(--accent);text-decoration:none;white-space:nowrap;font-size:11px;">${ticketLabel} â†—</a>` : ''}
                        <button onclick="deleteEvent(${e.id})" class="icon-btn delete" style="flex-shrink:0;" title="Remove">âœ•</button>
                    </div>`;
                }).join('');

                try { renderProfileBento(); } catch(be) { console.warn('bento error', be); }
            } catch(err) {
                console.error('renderEventList error:', err);
                if (eventsErrBanner) eventsErrBanner.style.display = '';
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MERCH â€” persistence + list rendering
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const MERCH_KEY = 'able_merch';

        function loadMerch() {
            try { return JSON.parse(localStorage.getItem(MERCH_KEY) || '[]'); }
            catch(e) { return []; }
        }

        function saveMerch(merch) {
            try { localStorage.setItem(MERCH_KEY, JSON.stringify(merch)); }
            catch(e) { console.error('Failed to save merch', e); }
        }

        function saveProduct() {
            const name        = document.getElementById('productName').value.trim();
            const description = document.getElementById('productDescription').value.trim();
            const price       = document.getElementById('productPrice').value.trim();
            const stock       = document.getElementById('productStock').value.trim();
            const url         = document.getElementById('productUrl').value.trim();
            const image       = document.getElementById('productImage').value.trim();
            if (!name || !price) {
                showToast('âš ï¸ Please enter product name and price');
                return;
            }
            const credits = document.getElementById('productCredits').value.trim();
            const merch = loadMerch();
            merch.push({
                id: Date.now(), name, description, price, stock, url, image, credits,
                provider:      _merchDraft.provider      || undefined,
                providerTitle: _merchDraft.providerTitle || undefined,
                artworkUrl:    _merchDraft.artworkUrl    || undefined,
                oembedTitle:   _merchDraft.oembedTitle   || undefined,
            });
            saveMerch(merch);
            showToast(`âœ… "${name}" added to your merch`);
            closeModal('addProductModal');
            renderMerchList();
        }

        function deleteProduct(id) {
            const merch = loadMerch().filter(p => p.id !== id);
            saveMerch(merch);
            renderMerchList();
            showToast('Product removed');
        }

        // Save the store URL into the merch data array metadata
        function saveMerchShopUrl(url) {
            try {
                const raw = localStorage.getItem(MERCH_KEY);
                let merch = raw ? JSON.parse(raw) : [];
                // Store shopUrl as a property on the array (survives as plain object in JSON if needed)
                // We persist it as a separate key to keep array data clean
                localStorage.setItem('able_merch_shop_url', url);
                if (typeof updateSectionActionBtns === 'function') updateSectionActionBtns();
            } catch(e) { console.error('Failed to save merch shop URL', e); }
        }

        // Load merch shop URL and populate the input
        function populateMerchShopUrl() {
            const input = document.getElementById('merchShopUrl');
            if (input) {
                input.value = localStorage.getItem('able_merch_shop_url') || '';
            }
        }

        function renderMerchList() {
            const merchErrBanner = document.getElementById('merchTabErrorBanner');
            try {
                if (merchErrBanner) merchErrBanner.style.display = 'none';
                const container = document.getElementById('merchList');
                if (!container) return;
                const merch = loadMerch();

                const emptyState = document.getElementById('merchEmptyState');
                const listCard   = document.getElementById('merchListCard');
                if (merch.length === 0) {
                    container.innerHTML = '';
                    if (emptyState) emptyState.style.display = '';
                    if (listCard)   listCard.style.display   = 'none';
                    try { renderProfileMerch(); } catch(be) { console.warn('merch bridge error', be); }
                    return;
                }
                if (emptyState) emptyState.style.display = 'none';
                if (listCard)   listCard.style.display   = '';

                const imgSrc = p => p.artworkUrl || p.image || '';
                const viewLabel = p => p.providerTitle || 'View';
                container.innerHTML = merch.map(p => `
                    <div class="list-item" style="display:flex;align-items:center;gap:12px;padding:12px 0;border-bottom:1px solid var(--border);">
                        <div style="width:40px;height:40px;border-radius:8px;background:${imgSrc(p) ? 'none' : 'var(--accent-soft)'};flex-shrink:0;overflow:hidden;">
                            ${imgSrc(p) ? `<img src="${imgSrc(p).replace(/"/g,'%22')}" style="width:100%;height:100%;object-fit:cover;" onerror="this.style.display='none'">` : '<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:18px;">ðŸ›ï¸</div>'}
                        </div>
                        <div style="flex:1;min-width:0;">
                            <div style="font-weight:700;font-size:13px;">${p.name}</div>
                            <div style="font-size:11px;color:var(--text-tertiary);">${p.price}${p.stock ? ' Â· ' + p.stock + ' in stock' : ''}${p.providerTitle ? ' Â· ' + p.providerTitle : ''}</div>
                        </div>
                        ${p.url ? `<a href="${p.url.replace(/"/g,'%22')}" target="_blank" class="al-url-ok" style="font-weight:700;color:var(--accent);text-decoration:none;white-space:nowrap;font-size:11px;">${viewLabel(p)} â†—</a>` : ''}
                        <button onclick="deleteProduct(${p.id})" class="icon-btn delete" style="flex-shrink:0;" title="Remove">âœ•</button>
                    </div>
                `).join('');

                try { renderProfileMerch(); } catch(be) { console.warn('merch bridge error', be); }
            } catch(err) {
                console.error('renderMerchList error:', err);
                if (merchErrBanner) merchErrBanner.style.display = '';
            }
        }

        // â”€â”€ Init embedded profile â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // setTimeout 0 ensures profile JS declarations (let currentState etc) are
        // hoisted before we call updatePageState()
        setTimeout(function initEmbeddedProfile() {
            try {
                const autoRaw = localStorage.getItem('able_dashboard_autostate');
                const auto = autoRaw ? JSON.parse(autoRaw) : null;
                const modeMap = {'pre-release':'pre-release','live':'live','evergreen':'profile','gig':'gig'};
                const mode = auto ? (modeMap[auto.currentMode] || 'live') : 'live';
                if (typeof updatePageState === 'function') {
                    updatePageState(mode);
                    setActiveState(mode);
                }
                const color = localStorage.getItem('able_brand_color');
                if (color) {
                    const pr = document.getElementById('profilePreviewRoot');
                    if (pr) {
                        pr.style.setProperty('--accent', color);
                        pr.style.setProperty('--accent-hover', adjustBrightness(color, -15));
                        pr.style.setProperty('--accent-soft', color + '20');
                    }
                }
                const profRaw = localStorage.getItem('able_profile_data');
                if (profRaw) {
                    const p = JSON.parse(profRaw);
                    if (p.artistName) {
                        document.querySelectorAll('.profile-preview .artist-name').forEach(el => { el.textContent = p.artistName; });
                    }
                    if (p.bio) {
                        const bioEl = document.querySelector('.profile-preview .bio-text');
                        if (bioEl) bioEl.textContent = p.bio;
                    }
                }
            } catch(e) { console.warn('Profile init:', e); }
        }, 0);

        // Init all three lists on page load + on tab switch
        (function initContentLists() {
            renderVideoList();
            renderEventList();
            renderMerchList();
        })();

        const _origSwitchTab2 = switchTab;
        switchTab = function(tabName) {
            _origSwitchTab2(tabName);
            if (tabName === 'videos') renderVideoList();
            if (tabName === 'events') renderEventList();
            if (tabName === 'merch')  renderMerchList();
        };

        // Escape key closes modals
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal-overlay.active').forEach(modal => {
                    closeModal(modal.id);
                });
            }

            // Arrow key tab navigation â€” skip when focus is inside a text input
            if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
                const tag = document.activeElement?.tagName;
                const isEditable = tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT'
                    || document.activeElement?.isContentEditable;
                if (isEditable) return;

                const tabs = [
                    'overview', 'profile', 'appearance', 'platforms', 'auto-state', 'ctas',
                    'music', 'videos', 'events', 'merch', 'supporters', 'analytics', 'share', 'feed', 'settings'
                ];
                const active = document.querySelector('.nav-tab.active');
                const currentTab = active ? active.getAttribute('data-tab') : tabs[0];
                const currentIndex = tabs.indexOf(currentTab);

                let nextIndex;
                if (e.key === 'ArrowDown') {
                    nextIndex = Math.min(currentIndex + 1, tabs.length - 1);
                } else {
                    nextIndex = Math.max(currentIndex - 1, 0);
                }

                if (nextIndex !== currentIndex) {
                    e.preventDefault();
                    switchTab(tabs[nextIndex]);

                    // Keep the active nav item visible in the sidebar
                    const nextTab = document.querySelector(`[data-tab="${tabs[nextIndex]}"]`);
                    if (nextTab) nextTab.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
                }
            }
        });

        // Copy profile URL
        function copyShareLink(inputId, btn) {
            const input = document.getElementById(inputId);
            if (!input) return;
            const url = input.value;
            const originalText = btn.textContent;
            navigator.clipboard.writeText(url).then(() => {
                btn.textContent = 'Copied!';
                btn.classList.add('btn-primary');
                btn.classList.remove('btn-secondary');
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.classList.remove('btn-primary');
                    btn.classList.add('btn-secondary');
                }, 1800);
            }).catch(() => {
                input.select();
                document.execCommand('copy');
                showToast('âœ… Copied: ' + url);
            });
        }

        function copyProfileUrl() {
            const handle = (document.getElementById('handle')?.value || 'maya').trim().replace(/^@/, '').replace(/\s+/g, '-').toLowerCase() || 'maya';
            const url = 'able.to/' + handle;
            navigator.clipboard.writeText(url).then(() => {
                showToast('âœ… Copied: ' + url);
            }).catch(() => {
                // Fallback for older browsers
                const input = document.createElement('input');
                input.value = url;
                document.body.appendChild(input);
                input.select();
                document.execCommand('copy');
                document.body.removeChild(input);
                showToast('âœ… Copied: ' + url);
            });
        }

        function setAnalyticsRange(btn) {
            document.querySelectorAll('.analytics-range-btn').forEach(b => {
                b.classList.remove('btn-primary');
                b.classList.add('btn-secondary');
            });
            btn.classList.remove('btn-secondary');
            btn.classList.add('btn-primary');
            // Update the card title to reflect range
            const range = btn.dataset.range;
            const label = btn.textContent.trim();
            const cardTitle = document.querySelector('[data-content="analytics"] .card-header .card-title');
            if (cardTitle) cardTitle.textContent = label;
        }

        // Initialize Analytics Charts
        let chartsInitialized = false;
        let _activeCharts = [];

        function initAnalyticsCharts() {
            // Destroy existing charts so theme changes re-render correctly
            _activeCharts.forEach(c => { try { c.destroy(); } catch(e) {} });
            _activeCharts = [];
            chartsInitialized = false;
            
            // Check if canvases exist
            const pageViewsCtx = document.getElementById('pageViewsChart');
            if (!pageViewsCtx) return;

            // Get theme colors
            const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            const textColor = isDark ? '#ffffff' : '#0a0a0a';
            const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
            
            Chart.defaults.color = textColor;
            Chart.defaults.borderColor = gridColor;
            Chart.defaults.font.family = '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';

            // Page Views Over Time (Line Chart)
            _activeCharts.push(new Chart(pageViewsCtx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Page Views',
                        data: [142, 189, 156, 223, 198, 234, 105],
                        borderColor: '#0891b2',
                        backgroundColor: 'rgba(8, 145, 178, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#0891b2',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: isDark ? '#2d2d2d' : '#ffffff',
                            titleColor: textColor,
                            bodyColor: textColor,
                            borderColor: gridColor,
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return context.parsed.y + ' views';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: gridColor
                            },
                            ticks: {
                                color: textColor
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: textColor
                            }
                        }
                    }
                }
            }));

            // Top Links Bar Chart
            const topLinksCtx = document.getElementById('topLinksChart');
            _activeCharts.push(new Chart(topLinksCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Listen Now', 'Get Tickets', 'Shop Merch', 'Instagram', 'Inner Circle'],
                        datasets: [{
                            label: 'Clicks',
                            data: [452, 284, 189, 156, 67],
                            backgroundColor: [
                                'rgba(8, 145, 178, 0.8)',
                                'rgba(16, 185, 129, 0.8)',
                                'rgba(245, 158, 11, 0.8)',
                                'rgba(139, 92, 246, 0.8)',
                                'rgba(236, 72, 153, 0.8)'
                            ],
                            borderColor: [
                                '#0891b2',
                                '#10b981',
                                '#f59e0b',
                                '#8b5cf6',
                                '#ec4899'
                            ],
                            borderWidth: 2,
                            borderRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                backgroundColor: isDark ? '#2d2d2d' : '#ffffff',
                                titleColor: textColor,
                                bodyColor: textColor,
                                borderColor: gridColor,
                                borderWidth: 1,
                                padding: 12,
                                displayColors: false,
                                callbacks: {
                                    label: function(context) {
                                        return context.parsed.y + ' clicks';
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: gridColor
                                },
                                ticks: {
                                    color: textColor
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    color: textColor
                                }
                            }
                        }
                    }
                }));

            // Traffic Sources Doughnut Chart
            const trafficSourcesCtx = document.getElementById('trafficSourcesChart');
            _activeCharts.push(new Chart(trafficSourcesCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Instagram', 'TikTok', 'Direct'],
                        datasets: [{
                            data: [65, 22, 13],
                            backgroundColor: [
                                'rgba(8, 145, 178, 0.8)',
                                'rgba(16, 185, 129, 0.8)',
                                'rgba(245, 158, 11, 0.8)'
                            ],
                            borderColor: [
                                '#0891b2',
                                '#10b981',
                                '#f59e0b'
                            ],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                backgroundColor: isDark ? '#2d2d2d' : '#ffffff',
                                titleColor: textColor,
                                bodyColor: textColor,
                                borderColor: gridColor,
                                borderWidth: 1,
                                padding: 12,
                                callbacks: {
                                    label: function(context) {
                                        return context.label + ': ' + context.parsed + '%';
                                    }
                                }
                            }
                        }
                    }
                }));

            // Fan Locations Horizontal Bar Chart
            const fanLocationsCtx = document.getElementById('fanLocationsChart');
            _activeCharts.push(new Chart(fanLocationsCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Los Angeles', 'New York', 'London', 'Austin', 'Chicago', 'Miami'],
                        datasets: [{
                            label: 'Visitors',
                            data: [342, 289, 156, 134, 98, 87],
                            backgroundColor: 'rgba(8, 145, 178, 0.8)',
                            borderColor: '#0891b2',
                            borderWidth: 2,
                            borderRadius: 6
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                backgroundColor: isDark ? '#2d2d2d' : '#ffffff',
                                titleColor: textColor,
                                bodyColor: textColor,
                                borderColor: gridColor,
                                borderWidth: 1,
                                padding: 12,
                                displayColors: false,
                                callbacks: {
                                    label: function(context) {
                                        return context.parsed.x + ' visitors';
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                beginAtZero: true,
                                grid: {
                                    color: gridColor
                                },
                                ticks: {
                                    color: textColor
                                }
                            },
                            y: {
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    color: textColor
                                }
                            }
                        }
                    }
                }));

            chartsInitialized = true;
        }

        // ===================================
        // ===================================
        // CTA DRAG AND DROP
        // ===================================
        
        let draggedElement = null;
        let draggedOverElement = null;

        function initCTADragAndDrop() {
            const ctaList = document.getElementById('ctaList');
            if (!ctaList) return;

            const draggableItems = ctaList.querySelectorAll('.list-item[draggable="true"]');

            draggableItems.forEach(item => {
                // Skip items already initialised by this function â€” prevents duplicate
                // listeners accumulating each time the CTAs tab is re-entered.
                if (item.dataset.dndInit) return;
                item.dataset.dndInit = '1';

                // Drag start
                item.addEventListener('dragstart', function(e) {
                    draggedElement = this;
                    this.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/html', this.innerHTML);
                });

                // Drag end
                item.addEventListener('dragend', function(e) {
                    this.classList.remove('dragging');
                    // Remove all drag-over classes
                    draggableItems.forEach(item => item.classList.remove('drag-over'));
                    draggedElement = null;
                    draggedOverElement = null;
                    
                    // Save new order
                    updateCTAOrder();
                });

                // Drag over
                item.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    
                    if (this === draggedElement) return;
                    
                    // Remove drag-over from all items
                    draggableItems.forEach(item => item.classList.remove('drag-over'));
                    
                    // Add drag-over to current item
                    this.classList.add('drag-over');
                    draggedOverElement = this;
                });

                // Drag enter
                item.addEventListener('dragenter', function(e) {
                    e.preventDefault();
                });

                // Drag leave
                item.addEventListener('dragleave', function(e) {
                    if (e.target === this) {
                        this.classList.remove('drag-over');
                    }
                });

                // Drop
                item.addEventListener('drop', function(e) {
                    e.stopPropagation();
                    e.preventDefault();
                    
                    if (draggedElement === this) return;
                    
                    // Get all items
                    const allItems = Array.from(ctaList.querySelectorAll('.list-item[draggable="true"]'));
                    const draggedIndex = allItems.indexOf(draggedElement);
                    const droppedIndex = allItems.indexOf(this);
                    
                    // Reorder in DOM
                    if (draggedIndex < droppedIndex) {
                        this.parentNode.insertBefore(draggedElement, this.nextSibling);
                    } else {
                        this.parentNode.insertBefore(draggedElement, this);
                    }
                    
                    // Show toast
                    showToast('âœ… CTA order updated');
                });
            });
        }


        // Initialize drag and drop when CTAs tab is opened
        const ctasTab = document.querySelector('[data-tab="ctas"]');
        if (ctasTab) {
            ctasTab.addEventListener('click', function() {
                setTimeout(() => {
                    initCTADragAndDrop();
                }, 100);
            });
        }

        // Also initialize on page load if CTAs tab is active
        window.addEventListener('load', function() {
            if (document.querySelector('[data-content="ctas"].active')) {
                initCTADragAndDrop();
            }
        });

        // ===================================
        // FORM VALIDATION
        // ===================================
        
        function validateField(input, type) {
            const value = input.value.trim();
            let isValid = false;
            
            // Remove previous validation classes
            input.classList.remove('valid', 'error');
            
            // Check validation type
            if (type === 'required') {
                isValid = value.length > 0;
            } else if (type === 'url') {
                // URL is optional, so empty is valid
                if (value.length === 0) {
                    isValid = true;
                } else {
                    // Check if it's a valid URL
                    try {
                        new URL(value);
                        isValid = true;
                    } catch {
                        isValid = false;
                    }
                }
            } else if (type === 'email') {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                isValid = emailRegex.test(value);
            }
            
            // Apply validation class
            if (value.length > 0) {
                input.classList.add(isValid ? 'valid' : 'error');
            }
            
            return isValid;
        }

        // Button loading state
        function setButtonLoading(buttonId, loading) {
            const button = document.getElementById(buttonId);
            if (!button) return;
            
            const text = button.querySelector('.btn-text');
            const spinner = button.querySelector('.btn-spinner');
            
            if (loading) {
                button.disabled = true;
                button.style.opacity = '0.7';
                button.style.cursor = 'not-allowed';
                if (text) text.style.display = 'none';
                if (spinner) spinner.style.display = 'inline-block';
            } else {
                button.disabled = false;
                button.style.opacity = '1';
                button.style.cursor = 'pointer';
                if (text) text.style.display = 'inline-block';
                if (spinner) spinner.style.display = 'none';
            }
        }

        // ===================================
        // PRESS KIT GENERATOR
        // ===================================
        
        function openPressKitModal() {
            document.getElementById('pressKitModal').classList.add('active');
        }

        function generatePressKit() {
            // Get selected sections
            const sections = {
                bio: document.querySelector('[data-press-kit="bio"]').classList.contains('active'),
                stats: document.querySelector('[data-press-kit="stats"]').classList.contains('active'),
                releases: document.querySelector('[data-press-kit="releases"]').classList.contains('active'),
                social: document.querySelector('[data-press-kit="social"]').classList.contains('active'),
                contact: document.querySelector('[data-press-kit="contact"]').classList.contains('active')
            };
            
            const quotes = document.getElementById('pressQuotes').value;
            
            // Show loading
            setButtonLoading('generatePressKitBtn', true);
            
            // Generate HTML press kit
            setTimeout(() => {
                try {
                    // Get data from profile inputs
                    const artistName = document.getElementById('artistName')?.value || 'Maya Rivers';
                    const bio = document.getElementById('bio')?.value || 'Indie soul artist â€¢ Los Angeles';
                    const today = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                    
                    // Build HTML
                    let html = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>${artistName} - Press Kit</title>
    <style>
        @page { margin: 0; }
        /* body rule scoped to .profile-preview */
        .header {
            background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%);
            color: white;
            padding: 40px;
            margin-bottom: 40px;
        }
        .header h1 {
            margin: 0 0 10px 0;
            font-size: 42px;
            font-weight: 900;
        }
        .header .subtitle {
            font-size: 18px;
            opacity: 0.95;
            margin: 5px 0;
        }
        .content {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 40px 60px;
        }
        .section {
            margin-bottom: 40px;
        }
        .section-header {
            background: #f0fafb;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #0891b2;
        }
        .section-header h2 {
            margin: 0;
            font-size: 16px;
            text-transform: uppercase;
            color: #0891b2;
            letter-spacing: 1px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        .stat {
            padding: 16px;
            background: #fafafa;
            border-radius: 8px;
        }
        .stat-value {
            font-size: 24px;
            font-weight: 900;
            color: #0891b2;
            margin-bottom: 4px;
        }
        .stat-label {
            font-size: 13px;
            color: #666;
        }
        .release {
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        .release:last-child {
            border-bottom: none;
        }
        .release-title {
            font-weight: 700;
            font-size: 15px;
        }
        .release-meta {
            color: #666;
            font-size: 14px;
            margin-top: 4px;
        }
        .quote {
            background: #fafafa;
            border-left: 3px solid #0891b2;
            padding: 16px 20px;
            margin: 12px 0;
            font-style: italic;
            border-radius: 4px;
        }
        .contact-item {
            display: flex;
            margin: 8px 0;
        }
        .contact-label {
            font-weight: 700;
            width: 140px;
            color: #0891b2;
        }
        .contact-value {
            color: #666;
        }
        .footer {
            text-align: center;
            color: #999;
            font-size: 12px;
            padding: 40px;
            border-top: 1px solid #eee;
        }
        @media print {
            .header {
                background: #0891b2;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        /* body rule scoped to .profile-preview */
        }
    <\/style>
<\/head>
<body>
    <div class="header">
        <h1>${artistName}<\/h1>
        <div class="subtitle">Electronic Press Kit<\/div>
        <div class="subtitle" style="opacity: 0.8; font-size: 14px;">${today}<\/div>
    <\/div>

    <div class="content">`;
                    
                    // Bio section
                    if (sections.bio) {
                        html += `
        <div class="section">
            <div class="section-header">
                <h2>Biography</h2>
            </div>
            <p>${bio}</p>
        </div>`;
                    }
                    
                    // Stats section
                    if (sections.stats) {
                        html += `
        <div class="section">
            <div class="section-header">
                <h2>Key Statistics</h2>
            </div>
            <div class="stats-grid">
                <div class="stat">
                    <div class="stat-value">127,000</div>
                    <div class="stat-label">Monthly Listeners</div>
                </div>
                <div class="stat">
                    <div class="stat-value">2.4M</div>
                    <div class="stat-label">Total Streams</div>
                </div>
                <div class="stat">
                    <div class="stat-value">45,000+</div>
                    <div class="stat-label">Social Following</div>
                </div>
                <div class="stat">
                    <div class="stat-value">89,000</div>
                    <div class="stat-label">Spotify Saves</div>
                </div>
            </div>
        </div>`;
                    }
                    
                    // Releases section
                    if (sections.releases) {
                        html += `
        <div class="section">
            <div class="section-header">
                <h2>Recent Releases</h2>
            </div>
            <div class="release">
                <div class="release-title">"Midnight Drive"</div>
                <div class="release-meta">Single â€¢ February 2026</div>
            </div>
            <div class="release">
                <div class="release-title">"Neon Lights"</div>
                <div class="release-meta">EP â€¢ November 2025</div>
            </div>
            <div class="release">
                <div class="release-title">"City Dreams"</div>
                <div class="release-meta">Album â€¢ June 2025</div>
            </div>
        </div>`;
                    }
                    
                    // Press quotes
                    if (quotes && quotes.trim()) {
                        html += `
        <div class="section">
            <div class="section-header">
                <h2>Press Highlights</h2>
            </div>`;
                        const quoteLines = quotes.split('\n').filter(q => q.trim());
                        quoteLines.forEach(quote => {
                            html += `<div class="quote">"${quote.trim()}"</div>`;
                        });
                        html += `</div>`;
                    }
                    
                    // Social section
                    if (sections.social) {
                        html += `
        <div class="section">
            <div class="section-header">
                <h2>Social & Streaming</h2>
            </div>
            <div class="contact-item">
                <div class="contact-label">Spotify</div>
                <div class="contact-value">spotify.com/artist/mayarivers</div>
            </div>
            <div class="contact-item">
                <div class="contact-label">Instagram</div>
                <div class="contact-value">@mayarivers</div>
            </div>
            <div class="contact-item">
                <div class="contact-label">YouTube</div>
                <div class="contact-value">youtube.com/@mayarivers</div>
            </div>
        </div>`;
                    }
                    
                    // Contact section
                    if (sections.contact) {
                        html += `
        <div class="section">
            <div class="section-header">
                <h2>Contact Information</h2>
            </div>
            <div class="contact-item">
                <div class="contact-label">Booking</div>
                <div class="contact-value">booking@mayarivers.com</div>
            </div>
            <div class="contact-item">
                <div class="contact-label">Management</div>
                <div class="contact-value">management@mayarivers.com</div>
            </div>
            <div class="contact-item">
                <div class="contact-label">Press Inquiries</div>
                <div class="contact-value">press@mayarivers.com</div>
            </div>
        </div>`;
                    }
                    
                    html += `
    <\/div>

    <div class="footer">
        Generated by Able \u2022 able.to/${artistName.toLowerCase().replace(/\s+/g, '')}
    <\/div>

    <div id="fullPageOverlay">
        <button id="fullPageBackBtn" onclick="closeFullPage()">
            Back to Dashboard
        <\/button>
        <div id="fullPageContent" class="full-page-profile"><\/div>
    <\/div>

<\/body>
<\/html>`;
                    
                    // Create download
                    const blob = new Blob([html], { type: 'text/html' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = artistName.replace(/\s+/g, '_') + '_Press_Kit.html';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    showToast('âœ… Press kit downloaded! Open it and use Print â†’ Save as PDF');
                    setButtonLoading('generatePressKitBtn', false);
                    closeModal('pressKitModal');
                } catch (error) {
                    console.error('Press kit generation error:', error);
                    showToast('âš ï¸ Error generating press kit. Please try again.');
                    setButtonLoading('generatePressKitBtn', false);
                }
            }, 800);
        }

        // ===================================
        // REAL-TIME PREVIEW UPDATES
        // ===================================
        
        // Update preview artist name
        function updatePreviewArtistName(value) {
            const previewName = document.getElementById('previewArtistName');
            if (previewName) {
                previewName.textContent = value || 'Your Artist Name';
                addPreviewFlash(previewName);
            }
            document.querySelectorAll('.profile-preview .artist-name').forEach(el => {
                el.textContent = value || 'Maya Rivers';
            });
        }

        // Update preview bio
        function updatePreviewBio(value) {
            const previewBio = document.getElementById('previewBio');
            if (previewBio) {
                previewBio.textContent = value || 'Your bio appears here';
                addPreviewFlash(previewBio);
            }
            const profileBio = document.querySelector('.profile-preview .bio-text');
            if (profileBio) profileBio.textContent = value || '';
        }

        // Add visual flash to show update
        function addPreviewFlash(element) {
            element.style.transition = 'none';
            element.style.background = 'rgba(8, 145, 178, 0.15)';
            element.style.borderRadius = '4px';
            element.style.padding = '4px 8px';
            element.style.margin = '-4px -8px';
            
            setTimeout(() => {
                element.style.transition = 'all 0.3s ease';
                element.style.background = 'transparent';
                element.style.padding = '0';
                element.style.margin = '0';
            }, 100);
        }

        // Update theme and preview when theme changes
        const originalSetTheme = window.setTheme;
        if (originalSetTheme) {
            window.setTheme = function(theme) {
                originalSetTheme(theme);
                setTimeout(() => updatePreviewTheme(theme), 50);
            };
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PLATFORMS TAB
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const PLATFORMS_KEY = 'able_platforms';

        const PLATFORM_DEFINITIONS = {
            music: [
                { id: 'spotify',    icon: 'ðŸŸ¢', name: 'Spotify',       placeholder: 'open.spotify.com/artist/...' },
                { id: 'apple',      icon: 'ðŸŽµ', name: 'Apple Music',   placeholder: 'music.apple.com/artist/...' },
                { id: 'youtube',    icon: 'â–¶ï¸', name: 'YouTube Music', placeholder: 'music.youtube.com/channel/...' },
                { id: 'soundcloud', icon: 'ðŸŽ§', name: 'SoundCloud',    placeholder: 'soundcloud.com/yourname' },
                { id: 'tidal',      icon: 'ðŸŒŠ', name: 'Tidal',         placeholder: 'tidal.com/artist/...' },
                { id: 'bandcamp',   icon: 'ðŸ“»', name: 'Bandcamp',      placeholder: 'yourname.bandcamp.com' },
                { id: 'deezer',     icon: 'ðŸŽ¶', name: 'Deezer',        placeholder: 'deezer.com/artist/...' },
                { id: 'amazon',     icon: 'ðŸ“¦', name: 'Amazon Music',  placeholder: 'music.amazon.com/artists/...' },
            ],
            social: [
                { id: 'instagram',  icon: 'ðŸ“¸', name: 'Instagram',  placeholder: 'instagram.com/yourname' },
                { id: 'tiktok',     icon: 'ðŸŽ¬', name: 'TikTok',     placeholder: 'tiktok.com/@yourname' },
                { id: 'youtube_s',  icon: 'ðŸ“º', name: 'YouTube',    placeholder: 'youtube.com/@yourname' },
                { id: 'twitter',    icon: 'ðŸ¦', name: 'X / Twitter', placeholder: 'x.com/yourname' },
                { id: 'facebook',   icon: 'ðŸ‘¤', name: 'Facebook',   placeholder: 'facebook.com/yourpage' },
                { id: 'twitch',     icon: 'ðŸ’œ', name: 'Twitch',     placeholder: 'twitch.tv/yourname' },
                { id: 'threads',    icon: 'ðŸ§µ', name: 'Threads',    placeholder: 'threads.net/@yourname' },
            ],
            commerce: [
                { id: 'shopify',      icon: 'ðŸ›ï¸', name: 'Merch Store',  placeholder: 'yourstore.com or shopify URL' },
                { id: 'ticketmaster', icon: 'ðŸŽ«', name: 'Ticketmaster', placeholder: 'ticketmaster.com/artist/...' },
                { id: 'eventbrite',   icon: 'ðŸŽŸï¸', name: 'Eventbrite',   placeholder: 'eventbrite.com/o/...' },
                { id: 'dice',         icon: 'ðŸŽ²', name: 'Dice.fm',      placeholder: 'dice.fm/artist/...' },
                { id: 'patreon',      icon: 'ðŸ’', name: 'Patreon',      placeholder: 'patreon.com/yourname' },
                { id: 'kofi',         icon: 'â˜•', name: 'Ko-fi',        placeholder: 'ko-fi.com/yourname' },
            ]
        };

        function loadPlatforms() {
            try {
                const saved = localStorage.getItem(PLATFORMS_KEY);
                return saved ? JSON.parse(saved) : {};
            } catch(e) { return {}; }
        }

        function savePlatforms(platforms) {
            try {
                localStorage.setItem(PLATFORMS_KEY, JSON.stringify(platforms));
            } catch(e) { console.error('Failed to save platforms', e); }
        }

        function escapeAttr(str) {
            return str.replace(/&/g, '&amp;').replace(/"/g, '&quot;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }

        function escapeHtml(str) {
            return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
        }

        function renderPlatformList(containerId, defs) {
            const container = document.getElementById(containerId);
            if (!container) return;
            const platforms = loadPlatforms();

            container.innerHTML = defs.map(p => {
                const url = platforms[p.id] || '';
                const connected = url.trim().length > 0;
                return `
                    <div class="platform-row">
                        <span class="platform-row-icon">${p.icon}</span>
                        <span class="platform-row-name">${p.name}</span>
                        <input
                            class="platform-row-input"
                            type="text"
                            placeholder="${escapeAttr(p.placeholder)}"
                            value="${escapeAttr(url)}"
                            data-platform-id="${p.id}"
                            oninput="onPlatformInput(this)"
                        />
                        <span class="platform-row-status ${connected ? 'connected' : 'empty'}"
                              id="platform-status-${p.id}">
                            ${connected ? 'âœ“' : 'Â·'}
                        </span>
                    </div>`;
            }).join('');
        }

        function onPlatformInput(input) {
            const id = input.getAttribute('data-platform-id');
            let url = input.value.trim();

            // Auto-prefix https:// if user typed a bare domain
            if (url && !url.startsWith('http://') && !url.startsWith('https://')) {
                url = 'https://' + url;
            }

            const platforms = loadPlatforms();
            if (url) {
                platforms[id] = url;
            } else {
                delete platforms[id];
            }
            savePlatforms(platforms);
            
            // Update artist page streaming buttons
            if (typeof renderProfileStreaming === 'function') {
                renderProfileStreaming();
            }

            // Update status indicator live
            const status = document.getElementById(`platform-status-${id}`);
            if (status) {
                status.textContent = url ? 'âœ“' : 'Â·';
                status.className = `platform-row-status ${url ? 'connected' : 'empty'}`;
            }
        }

        function initPlatformsTab() {
            renderPlatformList('platformMusicList',    PLATFORM_DEFINITIONS.music);
            renderPlatformList('platformSocialList',   PLATFORM_DEFINITIONS.social);
            renderPlatformList('platformCommerceList', PLATFORM_DEFINITIONS.commerce);
        }

        // Initialise when platforms tab is opened
        // Init platforms tab on page load
        initPlatformsTab();


        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // EMBEDDED PROFILE JS
        // State management, section reordering, countdown etc
        // setTheme/adjustBrightness removed (dashboard has them)
        // applyDashboardData removed (wired directly below)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        // State Management
        let currentState = 'pre-release';
        let autoMode = true;
        let cart = [];

        // DOM Elements
        const stateControl = document.getElementById('stateControl');
        const autoToggle = document.getElementById('autoToggle');
        const autoSwitch = document.getElementById('autoSwitch');
        const releaseSettings = document.getElementById('releaseSettings');
        const stateBadge = document.getElementById('stateBadge');
        const countdownBanner = document.getElementById('countdownBanner');
        const _profileMainCta = document.getElementById('mainCta');
        const themeToggle = document.getElementById('themeToggle');
        const cartButton = document.getElementById('cartButton');
        const cartPanel = document.getElementById('cartPanel');
        const cartClose = document.getElementById('cartClose');
        const pastShowsToggle = document.getElementById('pastShowsToggle');
        const pastShows = document.getElementById('pastShows');
        const pageHeader = document.getElementById('pageHeader');
        const settingsToggle = document.getElementById('settingsToggle');
        const controlsCard = document.getElementById('controlsCard');
        const headerSubtitle = document.querySelector('.header-subtitle');

        // Settings Toggle
        if (settingsToggle && controlsCard) {
            settingsToggle.addEventListener('click', () => {
                controlsCard.classList.toggle('visible');
                settingsToggle.classList.toggle('active');
            });
        }

        // State Configuration
        const stateConfig = {
            // Pre-release: countdown is the focus.
            // Only streaming + tracklist hidden (music doesn't exist yet).
            // Everything else reordered by priority â€” still accessible, just deprioritised.
            'pre-release': {
                badge: 'Pre-Release',
                primaryCta: 'Pre-save on Spotify',
                secondaryCta: 'Get Support Pack',
                showCountdown: true,
                hideSections: ['streaming', 'tracklist'],
                sectionOrder: [
                    'bio', 'support', 'tour', 'events',
                    'credits', 'videos', 'subscribe', 'artists',
                    'merch', 'activity', 'bts', 'qr'
                ]
            },
            // Live: streaming and tracklist front and centre, everything accessible
            'live': {
                badge: 'Out Now',
                primaryCta: {
                    watch: 'Listen Now',
                    support: 'Get Support Pack',
                    tickets: 'Get Tickets'
                },
                secondaryCta: 'Share',
                showCountdown: false,
                hideSections: [],
                sectionOrder: [
                    'streaming', 'tracklist', 'tour', 'merch',
                    'support', 'credits', 'videos', 'bio', 'events',
                    'artists', 'activity', 'bts', 'subscribe', 'qr'
                ]
            },
            // Evergreen / profile mode: full artist page, catalogue feel
            'profile': {
                badge: 'Artist',
                primaryCta: 'Listen on Spotify',
                secondaryCta: 'Contact for Booking',
                showCountdown: false,
                hideSections: [],
                sectionOrder: [
                    'streaming', 'bio', 'tracklist', 'merch',
                    'tour', 'support', 'credits', 'videos', 'artists',
                    'activity', 'bts', 'events', 'subscribe', 'qr'
                ]
            },
            // Gig mode: at a show â€” tour and merch first, everything still there
            'gig': {
                badge: 'For Hire',
                primaryCta: 'Get Tickets',
                secondaryCta: 'Listen Now',
                showCountdown: false,
                hideSections: [],
                sectionOrder: [
                    'tour', 'merch', 'streaming', 'support',
                    'tracklist', 'bio', 'credits', 'videos', 'events',
                    'artists', 'activity', 'bts', 'subscribe', 'qr'
                ]
            }
        };

        // Live goal setting (would come from artist settings)
        let liveGoal = 'watch';

        // State Control
        if (stateControl) {
            stateControl.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') {
                    const state = e.target.dataset.state;
                    setActiveState(state);
                    updatePageState(state);
                    // Update greeting after state change
                    setTimeout(updateTimeOfDay, 10);
                }
            });
        }

        function setActiveState(state) {
            if (stateControl) {
                stateControl.querySelectorAll('button').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.state === state);
                });
            }
        }

        function updatePageState(state) {
            currentState = state;
            const config = stateConfig[state];
            
            if (stateBadge) {
                stateBadge.textContent = config.badge;
            }
            
            // Update header subtitle â€” use current artist name, not hardcoded
            if (headerSubtitle) {
                const artistNameEl = document.querySelector('.artist-name');
                const name = artistNameEl ? artistNameEl.textContent : 'Maya Rivers';
                headerSubtitle.textContent = `${name} Â· ${config.badge}`;
            }
            
            // Update primary + secondary CTAs from per-mode config
            try {
                const modeKey = state === 'profile' ? 'evergreen' : state;
                const modeCfg = (typeof autoStateConfig !== 'undefined') ? autoStateConfig?.modes?.[modeKey] : null;
                const primaryData   = modeCfg?.primary;
                const secondaryData = modeCfg?.secondary;

                if (_profileMainCta) {
                    if (primaryData && (primaryData.text || primaryData.icon)) {
                        _profileMainCta.textContent = (primaryData.icon || '') + ' ' + (primaryData.text || '');
                        if (primaryData.url) _profileMainCta.onclick = () => window.open(primaryData.url, '_blank');
                        else _profileMainCta.onclick = null;
                    } else {
                        _profileMainCta.textContent = (state === 'live' && typeof config.primaryCta === 'object')
                            ? config.primaryCta[liveGoal]
                            : config.primaryCta;
                        _profileMainCta.onclick = null;
                    }
                }

                const secondaryCta = document.getElementById('secondaryCta');
                if (secondaryCta) {
                    if (secondaryData && (secondaryData.text || secondaryData.icon)) {
                        secondaryCta.textContent = (secondaryData.icon || '') + ' ' + (secondaryData.text || '');
                        if (secondaryData.url) {
                            secondaryCta.onclick = () => window.open(secondaryData.url, '_blank');
                            secondaryCta.style.display = '';
                        } else {
                            secondaryCta.onclick = null;
                            secondaryCta.style.display = 'none'; /* hide: configured but no URL */
                        }
                    } else {
                        secondaryCta.textContent = config.secondaryCta;
                        secondaryCta.onclick = null;
                        secondaryCta.style.display = '';
                    }
                }
            } catch(e) {
                if (_profileMainCta) _profileMainCta.textContent = (typeof config.primaryCta === 'object') ? config.primaryCta[liveGoal] : config.primaryCta;
                const sec = document.getElementById('secondaryCta');
                if (sec) sec.textContent = config.secondaryCta;
            }
            
            if (countdownBanner) {
                countdownBanner.classList.toggle('visible', config.showCountdown);
            }
            
            // â”€â”€ Section reordering + hide/show â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            const container = document.getElementById('sectionsContainer');
            if (container && config.sectionOrder) {
                // First show all sections (reset from previous state)
                container.querySelectorAll('.section').forEach(s => {
                    s.classList.remove('hidden');
                });

                // Reorder sections by appending in priority order
                // appendChild moves existing nodes â€” no cloning needed
                config.sectionOrder.forEach(sectionId => {
                    const el = document.getElementById(sectionId);
                    if (el) container.appendChild(el);
                });

                // Any sections not in the order list stay at the end
                // (won't happen if sectionOrder is complete, but safe fallback)
            }

            // Apply hide to sections that genuinely shouldn't show
            // Scoped to profilePreviewRoot so dashboard UI is never affected
            document.querySelectorAll('#profilePreviewRoot .section').forEach(section => {
                const sectionId = section.id;
                if (config.hideSections.includes(sectionId)) {
                    section.classList.add('hidden');
                } else {
                    section.classList.remove('hidden');
                }
            });

            // Refresh section action buttons whenever mode changes
            if (typeof updateSectionActionBtns === 'function') updateSectionActionBtns();
        }

        // â”€â”€ Scroll Animation Observer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // Sections start at opacity:0 and need animate-in class to show.
        // root must be the scrollable preview frame so sections are detected
        // when they scroll into view inside that container (not the main viewport).
        const _profileRootEl   = document.getElementById('profilePreviewRoot');
        const _profileFrameEl  = document.getElementById('profilePreviewFrame');

        const _observerOptions = {
            root: _profileFrameEl || null,
            threshold: 0.05,
            rootMargin: '0px 0px -20px 0px'
        };

        const _animateOnScroll = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('animate-in');
                }
            });
        }, _observerOptions);

        // Observe all sections within the profile
        if (_profileRootEl) {
            _profileRootEl.querySelectorAll('.section').forEach(section => {
                _animateOnScroll.observe(section);
            });
        }

        // Reveal all sections immediately so the full profile is visible when scrolled.
        // The IntersectionObserver still stagger-animates sections as they come into view.
        setTimeout(() => {
            if (_profileRootEl) {
                _profileRootEl.querySelectorAll('.section').forEach(section => {
                    section.classList.add('animate-in');
                });
            }
        }, 100);

        // â”€â”€ Scroll progress bar + section dots â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function _updateScrollUI() {
            const root = document.getElementById('profilePreviewRoot');
            const progress = document.getElementById('scrollProgress');
            if (!root || !progress) return;

            // Scroll progress â€” reads from the scrollable preview frame first, then falls back
            const frame = document.getElementById('profilePreviewFrame');
            const scrollTop = (frame && frame.scrollTop) || root.scrollTop || window.pageYOffset || 0;
            const scrollHeight = frame
                ? frame.scrollHeight - frame.clientHeight
                : (root.scrollHeight - root.clientHeight) || (document.body.scrollHeight - window.innerHeight);
            const pct = scrollHeight > 0 ? Math.min(100, (scrollTop / scrollHeight) * 100) : 0;
            progress.style.width = pct + '%';

            // Section dot active state
            const sectionIds = ['hero', 'streaming', 'tour', 'merch', 'artists'];
            const dots = document.querySelectorAll('.profile-preview .section-dot');
            let activeIdx = 0;
            sectionIds.forEach((id, i) => {
                const el = document.getElementById(id);
                if (el) {
                    const rect = el.getBoundingClientRect();
                    const rootRect = root.getBoundingClientRect ? root.getBoundingClientRect() : { top: 0 };
                    if (rect.top - rootRect.top <= 80) activeIdx = i;
                }
            });
            dots.forEach((dot, i) => dot.classList.toggle('active', i === activeIdx));
        }

        // Wire scroll progress to window, profile root, and the scrollable preview frame
        window.addEventListener('scroll', _updateScrollUI, { passive: true });
        const _profRoot = document.getElementById('profilePreviewRoot');
        if (_profRoot) {
            _profRoot.addEventListener('scroll', _updateScrollUI, { passive: true });
        }
        const _profFrame = document.getElementById('profilePreviewFrame');
        if (_profFrame) {
            _profFrame.addEventListener('scroll', _updateScrollUI, { passive: true });
        }
        _updateScrollUI(); // Initial call

        // Auto Mode Toggle â€” syncs both profile-side local var and dashboard autoStateConfig
        if (autoToggle) {
            autoToggle.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                autoMode = !autoMode;
                if (autoSwitch) {
                    autoSwitch.classList.toggle('active', autoMode);
                }
                if (releaseSettings) {
                    releaseSettings.classList.toggle('visible', autoMode);
                }
                // Persist to dashboard config so the setting survives refresh
                if (typeof autoStateConfig !== 'undefined') {
                    autoStateConfig.enabled = autoMode;
                    if (typeof saveAutoStateConfig === 'function') saveAutoStateConfig();
                }
            });
        }

        // Theme Toggle - cycles through light â†’ dark â†’ contrast
        const themes = ['light', 'dark', 'contrast'];
        const themeIcons = { light: 'ðŸŒ™', dark: 'ðŸŒ“', contrast: 'â˜€ï¸' };
        const themeLabels = { light: 'Light', dark: 'Dark', contrast: 'High Contrast' };
        let currentThemeIndex = 0;

        
        // Load saved theme
        const _profileSavedTheme = localStorage.getItem('theme');
        if (_profileSavedTheme && themes.includes(_profileSavedTheme)) {
            currentThemeIndex = themes.indexOf(_profileSavedTheme);
            setTheme(_profileSavedTheme);
        }

        // Cart Panel
        cartButton.addEventListener('click', () => {
            cartPanel.classList.add('open');
        });

        cartClose.addEventListener('click', () => {
            cartPanel.classList.remove('open');
        });

        // Past Shows Toggle
        pastShowsToggle.addEventListener('click', () => {
            pastShows.classList.toggle('visible');
            pastShowsToggle.textContent = pastShows.classList.contains('visible') 
                ? 'Hide Past Shows â–²' 
                : 'Show Past Shows â–¼';
        });

        // Ripple Effect on Tour Cards
        function createRipple(event) {
            const card = event.currentTarget;
            const ripple = document.createElement('span');
            ripple.classList.add('ripple');
            
            const rect = card.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            const x = event.clientX - rect.left - size / 2;
            const y = event.clientY - rect.top - size / 2;
            
            ripple.style.width = ripple.style.height = size + 'px';
            ripple.style.left = x + 'px';
            ripple.style.top = y + 'px';
            
            card.appendChild(ripple);
            
            setTimeout(() => ripple.remove(), 600);
        }

        // Add ripple to all tour cards
        document.querySelectorAll('.tour-card').forEach(card => {
            card.addEventListener('click', createRipple);
        });

        // Countdown Timer â€” reads from autoStateConfig (single source of truth)
        function updateCountdown() {
            const countdownEl  = document.getElementById('countdownTime');      // dashboard status bar
            const heroEl       = document.getElementById('heroCountdownTime');  // profile hero overlay
            const statusEl     = document.getElementById('autoStatus');
            const indicatorEl  = document.getElementById('asModeIndicator');
            const modeLabelEl  = document.getElementById('asModeLabel');

            // If no release date configured, show a prompt instead of fake data
            if (!autoStateConfig || !autoStateConfig.releaseDate) {
                if (countdownEl)  countdownEl.textContent  = 'â€”';
                if (heroEl)       heroEl.textContent       = 'â€”';
                if (statusEl)     statusEl.textContent     = 'Enter a release date to enable Auto-State';
                if (indicatorEl)  indicatorEl.textContent  = 'ðŸŒŸ';
                if (modeLabelEl)  modeLabelEl.textContent  = 'Evergreen';
                return;
            }

            const releaseDate = new Date(autoStateConfig.releaseDate);
            const now  = new Date();
            const diff = releaseDate - now;

            if (diff > 0) {
                const days    = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours   = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                const timeStr = `${days}d ${hours}h ${minutes}m ${seconds}s`;

                if (countdownEl)  countdownEl.textContent  = timeStr;
                if (heroEl)       heroEl.textContent       = timeStr;
                if (statusEl)     statusEl.textContent     = `Pre-Release Â· drops in ${days} day${days !== 1 ? 's' : ''}`;
                if (indicatorEl)  indicatorEl.textContent  = 'ðŸ’¿';
                if (modeLabelEl)  modeLabelEl.textContent  = 'Pre-Release';
            } else {
                // Determine live vs evergreen
                const daysDiff = Math.floor((now - releaseDate) / (1000 * 60 * 60 * 24));
                const liveWindow = (autoStateConfig.autoSwitchDays || 7);
                const isLive = daysDiff <= liveWindow;

                if (countdownEl)  countdownEl.textContent  = isLive ? 'OUT NOW' : 'â€”';
                if (heroEl)       heroEl.textContent       = isLive ? 'OUT NOW' : 'â€”';
                if (statusEl)     statusEl.textContent     = isLive ? 'Live mode active' : 'Evergreen mode';
                if (indicatorEl)  indicatorEl.textContent  = isLive ? 'â–¶ï¸' : 'ðŸŒŸ';
                if (modeLabelEl)  modeLabelEl.textContent  = isLive ? 'Live Release' : 'Evergreen';

                // Auto-switch from pre-release to live when date passes
                if (autoMode && currentState === 'pre-release') {
                    setActiveState('live');
                    updatePageState('live');
                }
            }

            // Keep the profile-side date input in sync
            const profileDateEl = document.getElementById('releaseProfileDate');
            if (profileDateEl && autoStateConfig.releaseDate && !profileDateEl.value) {
                const d = autoStateConfig.releaseDate;
                profileDateEl.value = d.includes('T') ? d : d + 'T00:00';
            }
        }

        setInterval(updateCountdown, 1000);
        updateCountdown();

        // Add to Cart functionality
        document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                this.textContent = 'Added âœ“';
                this.classList.add('added');
                setTimeout(() => {
                    this.textContent = 'Add to Cart';
                    this.classList.remove('added');
                }, 2000);
            });
        });

        // Size selector
        document.querySelectorAll('.merch-size-selector').forEach(selector => {
            selector.addEventListener('click', (e) => {
                if (e.target.classList.contains('size-btn') && !e.target.disabled) {
                    selector.querySelectorAll('.size-btn').forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');
                }
            });
        });

        // Filter buttons
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // Subscribe form
        const subscribeBtn = document.querySelector('.subscribe-form .btn');
        if (subscribeBtn) {
            subscribeBtn.addEventListener('click', () => {
                const subscribeForm = document.getElementById('subscribeForm');
                const subscribeSuccess = document.getElementById('subscribeSuccess');
                if (subscribeForm) {
                    subscribeForm.style.display = 'none';
                }
                if (subscribeSuccess) {
                    subscribeSuccess.classList.add('visible');
                }
            });
        }

        // Simple QR Code placeholder (draw a pattern)
        const canvas = document.getElementById('qrCanvas');
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = '#000';
        
        // Draw a simple QR-like pattern
        const size = 8;
        for (let i = 0; i < 20; i++) {
            for (let j = 0; j < 20; j++) {
                if (Math.random() > 0.5 || (i < 3 && j < 3) || (i < 3 && j > 16) || (i > 16 && j < 3)) {
                    ctx.fillRect(i * size, j * size, size - 1, size - 1);
                }
            }
        }

        // Follow button functionality
        document.querySelectorAll('.artist-follow-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                if (this.textContent === 'Follow') {
                    this.textContent = 'Following';
                    this.style.background = 'var(--accent)';
                    this.style.color = 'white';
                    this.style.borderColor = 'var(--accent)';
                } else {
                    this.textContent = 'Follow';
                    this.style.background = '';
                    this.style.color = '';
                    this.style.borderColor = '';
                }
            });
        });


        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ABLE DASHBOARD BRIDGE
        // Reads all dashboard localStorage keys and applies them to the profile
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function applyDashboardDataToProfile() {
            const profileRoot = document.getElementById('profilePreviewRoot');
            if (!profileRoot) return;

            // 1. Profile name & bio
            try {
                const profileData = localStorage.getItem('able_profile_data');
                if (profileData) {
                    const data = JSON.parse(profileData);
                    
                    // Update artist name in hero
                    const artistNameEl = profileRoot.querySelector('.artist-name');
                    if (artistNameEl && data.artistName) {
                        artistNameEl.textContent = data.artistName;
                    }
                    
                    // Update handle
                    const handleEl = profileRoot.querySelector('.artist-handle');
                    if (handleEl && data.handle) {
                        handleEl.textContent = data.handle;
                    }

                    // Update QR URL to reflect current handle (S12-03)
                    const qrUrlEl = profileRoot.querySelector('.qr-url');
                    if (qrUrlEl && data.handle) {
                        qrUrlEl.textContent = 'able.to/' + data.handle.replace(/^@/, '');
                    }
                    
                    // Update bio text
                    const bioEl = profileRoot.querySelector('.bio-text');
                    if (bioEl && data.bio) {
                        bioEl.textContent = data.bio;
                    }
                    
                    // Update bio avatar â€” show photo if uploaded, otherwise initials
                    const avatarEl = profileRoot.querySelector('.bio-avatar');
                    if (avatarEl) {
                        if (data.profileImage) {
                            avatarEl.innerHTML = `<img src="${data.profileImage}" alt="${escapeAttr(data.artistName || '')}" style="width:100%;height:100%;object-fit:cover;border-radius:inherit;">`;
                        } else if (data.artistName) {
                            const initials = data.artistName
                                .split(' ')
                                .map(w => w[0])
                                .join('')
                                .toUpperCase()
                                .slice(0, 2);
                            avatarEl.innerHTML = '';
                            avatarEl.textContent = initials;
                        }
                    }
                }
            } catch(e) {
                console.error('Profile bridge error:', e);
            }

            // Update hero release title from auto-state config
            try {
                const autoRaw = localStorage.getItem('able_dashboard_autostate');
                if (autoRaw) {
                    const auto = JSON.parse(autoRaw);
                    const heroTitle = profileRoot.querySelector('#heroShortTitle');
                    if (heroTitle && auto.releaseTitle) {
                        heroTitle.textContent = auto.releaseTitle;
                    }
                }
            } catch(e) {}

            // Populate quick links strip â€” capped (4 mobile / 6 desktop) + "More" pill
            try {
                const strip = profileRoot.querySelector('#quickLinksStrip');
                if (strip) {
                    const ctaRaw = localStorage.getItem('able_dashboard_ctas');
                    if (ctaRaw) {
                        const ctas = JSON.parse(ctaRaw);
                        const active = Object.entries(ctas)
                            .filter(([, d]) => d.active)
                            .sort(([, a], [, b]) => a.order - b.order);
                        // Dedupe: strip pills whose URL matches the current-mode hero buttons
                        const _bHeroU = (typeof _getHeroUrlSet === 'function') ? _getHeroUrlSet() : new Set();
                        const activeDeduped = _bHeroU.size === 0 ? active : active.filter(([, d]) => {
                            if (!d.url) return true;
                            const _n = (typeof _normUrl === 'function') ? _normUrl(d.url) : d.url.trim();
                            if (_n && _bHeroU.has(_n)) {
                                if (window._ableDedupeDebug) console.log('DEDUPE: removed Quick Action \'' + d.text + '\' (matches Hero) [bridge]');
                                return false;
                            }
                            return true;
                        });
                        strip.classList.remove('ql-more-open');
                        strip.innerHTML = (typeof buildQuickLinksPillsHtml === 'function')
                            ? buildQuickLinksPillsHtml(activeDeduped, strip)  // pass strip for width-based cap
                            : activeDeduped.map(([, d]) =>
                                `<a href="${escapeAttr(d.url || '#')}" target="_blank" class="quick-link-pill" rel="noopener"><span class="pill-emoji">${d.icon}</span>${escapeHtml(d.text)}</a>`
                              ).join('');
                    }
                }
            } catch(e) {}

            // Aggregate credits section
            if (typeof renderProfileCredits === 'function') safeRender(renderProfileCredits);

            // Wire up any lazy embeds that may have been rendered into the preview
            initLazyEmbeds(profileRoot);
        }

        // 1b. Credits Bridge â€” aggregate collaborators across all releases
        var _creditsExpanded = false;

        function aggregateCredits(releases) {
            var map = {};
            (releases || []).forEach(function(rel) {
                var creds = (typeof _normalizeCredits === 'function')
                    ? _normalizeCredits(rel.credits)
                    : (Array.isArray(rel.credits) ? rel.credits : []);
                var seenInRelease = {};
                creds.forEach(function(c) {
                    if (!c || !c.name) return;
                    var key = c.name.trim().replace(/\s+/g, ' ').toLowerCase();
                    if (!key) return;
                    if (!map[key]) {
                        map[key] = {
                            name: c.name.trim().replace(/\s+/g, ' '),
                            roles: [],
                            count: 0,
                            releases: []
                        };
                    }
                    // count each person once per release
                    if (!seenInRelease[key]) { map[key].count++; seenInRelease[key] = true; }
                    // merge roles (case-insensitive dedup)
                    if (c.role) {
                        var rKey = c.role.trim().toLowerCase();
                        if (!map[key].roles.some(function(r) { return r.toLowerCase() === rKey; })) {
                            map[key].roles.push(c.role.trim());
                        }
                    }
                    // record release title
                    if (rel.title && map[key].releases.indexOf(rel.title) === -1) {
                        map[key].releases.push(rel.title);
                    }
                });
            });
            return Object.values(map).sort(function(a, b) {
                return b.count - a.count || a.name.localeCompare(b.name);
            });
        }

        function renderProfileCredits() {
            var profileRoot = document.getElementById('profilePreviewRoot');
            if (!profileRoot) return;
            var section = profileRoot.querySelector('#credits');
            var listEl  = profileRoot.querySelector('#profileCreditsList');
            if (!section || !listEl) return;

            var releases = [];
            try { releases = JSON.parse(localStorage.getItem('able_music_releases') || '[]'); } catch(e) {}
            var aggregated = aggregateCredits(releases);

            if (aggregated.length === 0) { section.style.display = 'none'; return; }
            section.style.display = 'block';

            var CAP_COLLAPSED = 6, CAP_EXPANDED = 12;
            var shown   = _creditsExpanded ? aggregated.slice(0, CAP_EXPANDED) : aggregated.slice(0, CAP_COLLAPSED);
            var hasMore = aggregated.length > CAP_COLLAPSED;

            var rowsHtml = shown.map(function(p, i) {
                var badge     = String(i + 1);
                var rolesText = p.roles.length ? p.roles.join(', ') : '';
                var relText   = p.releases.length
                    ? 'Appears on: ' + p.releases.map(function(r) { return escapeHtml(r); }).join(', ')
                    : '';
                var hasDetail = relText.length > 0;
                return '<div class="credit-row' + (hasDetail ? ' detail-clickable' : '') + '"' +
                    (hasDetail ? ' onclick="toggleCreditDetail(this)"' : '') + '>' +
                    '<div class="credit-row-badge">' + escapeHtml(badge) + '</div>' +
                    '<div class="credit-row-main">' +
                    '<div class="credit-row-name">' + escapeHtml(p.name) + '</div>' +
                    (rolesText ? '<div class="credit-row-roles">' + escapeHtml(rolesText) + '</div>' : '') +
                    (hasDetail ? '<div class="credit-row-detail">' + relText + '</div>' : '') +
                    '</div></div>';
            }).join('');

            var toggleHtml = '';
            if (hasMore) {
                var btnLabel = _creditsExpanded
                    ? 'â–² Show fewer'
                    : 'â–¼ Show ' + Math.min(aggregated.length - CAP_COLLAPSED, CAP_EXPANDED - CAP_COLLAPSED) + ' more';
                toggleHtml = '<button type="button" onclick="_toggleCreditsExpand()" style="width:100%;padding:8px;margin-top:6px;border:1px dashed var(--border);border-radius:8px;background:none;color:var(--text-secondary);font-size:12px;cursor:pointer;font-family:inherit;">' + btnLabel + '</button>';
            }

            listEl.innerHTML = rowsHtml + toggleHtml;
        }

        function toggleCreditDetail(row) {
            if (row) row.classList.toggle('detail-open');
        }

        function _toggleCreditsExpand() {
            _creditsExpanded = !_creditsExpanded;
            safeRender(renderProfileCredits);
        }

        // 2. Videos Bridge
        function renderProfileVideos() {
            const profileRoot = document.getElementById('profilePreviewRoot');
            if (!profileRoot) return;
            try {
                const collage = profileRoot.querySelector('.video-collage');
                if (!collage) return;

                var videos = [];
                try { videos = JSON.parse(localStorage.getItem('able_videos') || '[]'); } catch(e) {}
                var vidSection = profileRoot.querySelector('#videos');
                if (!videos.length) {
                    collage.innerHTML = '';
                    if (vidSection) vidSection.style.display = 'none';
                    return;
                }
                if (vidSection) vidSection.style.display = '';

                // â”€â”€ Helper: build a single video card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                function _buildVideoCard(v, featured) {
                    var ytEmbed  = (typeof normalizeYouTubeEmbedUrl === 'function') ? normalizeYouTubeEmbedUrl(v.url) : null;
                    var vimEmbed = (typeof normalizeVimeoEmbedUrl  === 'function') ? normalizeVimeoEmbedUrl(v.url)   : null;
                    var isEmbed  = !!(ytEmbed || vimEmbed);

                    // Thumbnail: oEmbed thumb > YT API > placeholder
                    var ytId = (typeof getYouTubeId === 'function') ? getYouTubeId(v.url) : '';
                    var thumbSrc = v.artworkUrl || (ytId ? 'https://img.youtube.com/vi/' + ytId + '/mqdefault.jpg' : '');
                    var provLabel = v.providerTitle || (v.platform === 'vimeo' ? 'Vimeo' : v.platform === 'tiktok' ? 'TikTok' : 'YouTube');

                    if (isEmbed) {
                        // Lazy-load embed (16:9)
                        var embed = ytEmbed || vimEmbed;
                        var thumbHtml = thumbSrc
                            ? `<img src="${thumbSrc}" style="width:100%;height:100%;object-fit:cover;position:absolute;inset:0;border-radius:10px;" onerror="this.style.display='none'">`
                            : `<div style="position:absolute;inset:0;background:linear-gradient(135deg,#1a1a2e,#16213e);border-radius:10px;"></div>`;
                        var kindColor = (embed === vimEmbed) ? '#1ab7ea' : '#ff0000';
                        var kindLabel = (embed === vimEmbed) ? 'ðŸŽ¬ Vimeo' : 'â–¶ï¸ YouTube';
                        return `<div style="margin-bottom:${featured ? '12px' : '8px'};">
                            <div style="font-size:10px;font-weight:700;color:${kindColor};margin-bottom:4px;">${kindLabel}</div>
                            <div style="font-size:12px;font-weight:700;margin-bottom:6px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${v.title}</div>
                            <div class="able-embedWrap"><div class="able-embedRatio able-embedLazy" data-embed-src="${embed.src}" data-embed-kind="${embed.kind || 'youtube'}" style="position:relative;">
                                ${thumbHtml}
                                <div style="position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;z-index:1;">
                                    <button type="button" class="able-embedLoadBtn">â–¶ï¸ Load video</button>
                                    <div class="able-embedHint">Tap to load Â· ${provLabel}</div>
                                </div>
                            </div></div>
                            ${v.credits ? `<div style="font-size:10px;color:var(--text-tertiary);margin-top:4px;">Credits: ${v.credits}</div>` : ''}
                        </div>`;
                    } else {
                        // Non-embeddable fallback card
                        var thumbEl = thumbSrc
                            ? `<img src="${thumbSrc}" style="width:48px;height:48px;border-radius:8px;object-fit:cover;flex-shrink:0;" onerror="this.style.display='none'">`
                            : `<div style="width:48px;height:48px;border-radius:8px;background:var(--bg-tertiary);flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:20px;">${v.platform === 'tiktok' ? 'ðŸŽ¬' : 'ðŸŽ¥'}</div>`;
                        return `<div class="able-card" style="padding:10px;display:flex;align-items:center;gap:10px;margin-bottom:8px;">
                            ${thumbEl}
                            <div style="flex:1;min-width:0;">
                                <div style="font-size:11px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${v.title}</div>
                                <div style="font-size:10px;color:var(--text-tertiary);margin-top:1px;">${provLabel}</div>
                                ${v.credits ? `<div style="font-size:10px;color:var(--text-tertiary);margin-top:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">Credits: ${v.credits}</div>` : ''}
                            </div>
                            <a href="${v.url}" target="_blank" rel="noopener" style="flex-shrink:0;padding:5px 10px;border-radius:8px;background:var(--accent);color:#fff;font-size:11px;font-weight:700;text-decoration:none;white-space:nowrap;">Open on ${provLabel}</a>
                        </div>`;
                    }
                }

                // Render up to 4 videos
                collage.innerHTML = videos.slice(0, 4).map(function(v, i) {
                    return _buildVideoCard(v, i === 0);
                }).join('');

                // Wire lazy embeds
                if (typeof initLazyEmbeds === 'function') initLazyEmbeds(collage);
            } catch(e) {
                console.error('Videos bridge error:', e);
            }
        }

        // Apply on load
        applyDashboardDataToProfile();
        renderProfileVideos();
        // Wire section action buttons to active CTAs on load
        if (typeof updateSectionActionBtns === 'function') updateSectionActionBtns();

        // 3. Events/Bento Bridge
        function renderProfileBento() {
            var profileRoot = document.getElementById('profilePreviewRoot');
            if (!profileRoot) return;

            try {
                var bentoGrid = profileRoot.querySelector('#bentoGrid');
                var evSection = profileRoot.querySelector('#events');
                if (!bentoGrid) return;

                bentoGrid.innerHTML = '';

                var eventsRaw = [];
                try { eventsRaw = JSON.parse(localStorage.getItem('able_events') || '[]'); } catch(pe) {}

                if (!eventsRaw.length) {
                    if (evSection) evSection.style.display = 'none';
                    return;
                }

                // Split upcoming vs past
                var today = new Date();
                today.setHours(0, 0, 0, 0);
                var upcoming = eventsRaw.filter(function(e) { return new Date(e.date + 'T00:00:00') >= today; });
                var past     = eventsRaw.filter(function(e) { return new Date(e.date + 'T00:00:00') < today; });
                // Upcoming ascending, past descending (most recent first)
                upcoming.sort(function(a, b) { return new Date(a.date) - new Date(b.date); });
                past.sort(function(a, b)     { return new Date(b.date) - new Date(a.date); });

                // Show up to 6 events: upcoming first, then fill with recent past
                var display = upcoming.concat(past).slice(0, 6);

                if (!display.length) {
                    if (evSection) evSection.style.display = 'none';
                    return;
                }

                // Events exist â€” ensure section is visible
                if (evSection) evSection.style.display = '';

                var colors = ['#ec4899', '#0891b2', '#8b5cf6', '#f59e0b', '#10b981', '#ef4444'];
                var sizes  = ['size-small', 'size-large', 'size-small', 'size-medium', 'size-medium', 'size-small'];

                display.forEach(function(event, i) {
                    var eventDate = new Date(event.date + 'T00:00:00');
                    var isPast    = eventDate < today;
                    var month     = eventDate.toLocaleString('en', { month: 'short' }).toUpperCase();
                    var day       = eventDate.getDate();
                    var pastStyle = isPast ? 'opacity:0.5;' : '';

                    // Alternate: even index â†’ date tile, odd index â†’ event tile
                    if (i % 2 === 0) {
                        bentoGrid.innerHTML += '<div class="bento-tile size-small type-date" style="--accent-color:' + colors[i % colors.length] + ';' + pastStyle + '"><div class="bento-date">' + month + '<br>' + day + '</div></div>';
                    } else {
                        var size = sizes[i] || 'size-medium';
                        var ticketBtn = event.ticketUrl
                            ? '<a href="' + event.ticketUrl.replace(/"/g, '%22') + '" target="_blank" class="bento-cta-pill">' + (event.providerTitle || 'Get Tickets') + ' â†—</a>'
                            : '';
                        bentoGrid.innerHTML += '<div class="bento-tile ' + size + ' type-event" style="' + pastStyle + '"><div class="bento-content"><div class="bento-title">' + event.name + '</div><div class="bento-subtitle">' + event.venue + (event.city ? ', ' + event.city : '') + '</div>' + (event.time ? '<div class="bento-time">' + event.time + '</div>' : '') + ticketBtn + '</div></div>';
                    }
                });

            } catch(e) {
                console.error('Bento bridge error:', e);
            }
        }

        renderProfileBento();

        // 4. Merch Bridge
        function renderProfileMerch() {
            var profileRoot = document.getElementById('profilePreviewRoot');
            if (!profileRoot) return;

            try {
                var merchSection = profileRoot.querySelector('#merch');
                var merchGrid    = profileRoot.querySelector('.merch-bento-grid');
                if (!merchGrid) return;

                merchGrid.innerHTML = '';

                var merch = [];
                try { merch = JSON.parse(localStorage.getItem('able_merch') || '[]'); } catch(pe) {}

                if (!merch.length) {
                    // Hide merch section cleanly when empty
                    if (merchSection) merchSection.style.display = 'none';
                    return;
                }
                if (merchSection) merchSection.style.display = '';

                var products  = merch.slice(0, 6);
                var sizes     = ['size-large', 'size-medium', 'size-medium', 'size-small', 'size-small', 'size-small'];
                var gradients = [
                    '#a855f7 0%, #ec4899 100%',
                    '#1e3a5f 0%, #0d1b2a 100%',
                    '#0891b2 0%, #06b6d4 100%',
                    '#ef4444 0%, #dc2626 100%',
                    '#f59e0b 0%, #d97706 100%',
                    '#10b981 0%, #059669 100%'
                ];

                products.forEach(function(product, i) {
                    var size      = sizes[i] || 'size-medium';
                    var gradient  = gradients[i] || gradients[0];
                    var imgSrc    = product.artworkUrl || product.image || '';
                    var bgStyle   = imgSrc
                        ? 'background:url(' + imgSrc.replace(/"/g, '%22') + ') center/cover no-repeat;'
                        : 'background:linear-gradient(135deg,' + gradient + ');';
                    var ctaLabel  = product.providerTitle || 'Shop Item';
                    var ctaBtn    = product.url
                        ? '<a href="' + product.url.replace(/"/g, '%22') + '" target="_blank" class="bento-cta-pill">' + ctaLabel + ' â†—</a>'
                        : '';

                    merchGrid.innerHTML += '<div class="merch-bento-tile ' + size + '"><div class="merch-bento-image" style="' + bgStyle + '">' + (i === 0 ? '<span class="merch-badge badge-new">New</span>' : '') + '</div><div class="merch-bento-info"><div class="merch-bento-name">' + product.name + '</div>' + (product.description ? '<div class="merch-bento-desc">' + product.description + '</div>' : '') + '<div class="merch-bento-price">' + product.price + '</div>' + ctaBtn + '</div></div>';
                });

            } catch(e) {
                console.error('Merch bridge error:', e);
            }
        }

        renderProfileMerch();

        // 5. Platforms/Streaming Bridge
        function renderProfileStreaming() {
            const profileRoot = document.getElementById('profilePreviewRoot');
            if (!profileRoot) return;

            try {
                // Find streaming pills container and always clear placeholder pills
                const container = profileRoot.querySelector('.streaming-pills-container');
                if (!container) return;
                container.innerHTML = '';

                const platformsData = localStorage.getItem('able_platforms');
                const platforms = platformsData ? JSON.parse(platformsData) : {};

                // Platform config - only show music streaming platforms
                const streamingPlatforms = [
                    { id: 'spotify',    icon: 'â—', name: 'Spotify',       class: 'spotify' },
                    { id: 'apple',      icon: 'â—', name: 'Apple Music',   class: 'apple' },
                    { id: 'youtube',    icon: 'â—', name: 'YouTube Music', class: 'youtube' },
                    { id: 'soundcloud', icon: 'â—', name: 'SoundCloud',    class: 'soundcloud' },
                    { id: 'tidal',      icon: 'â—', name: 'Tidal',         class: 'tidal' },
                    { id: 'bandcamp',   icon: 'â—', name: 'Bandcamp',      class: 'bandcamp' },
                    { id: 'amazon',     icon: 'â—', name: 'Amazon Music',  class: 'amazon' },
                    { id: 'deezer',     icon: 'â—', name: 'Deezer',        class: 'deezer' },
                ];

                // Build all pills in one pass â€” avoid innerHTML+= O(nÂ²) re-parse loop
                const pillHtml = streamingPlatforms
                    .filter(p => { const u = platforms[p.id]; return u && u.trim(); })
                    .map(p => `<a href="${platforms[p.id]}" target="_blank" class="streaming-pill ${p.class}"><span class="pill-icon">${p.icon}</span><span class="pill-text">${p.name}</span></a>`)
                    .join('');

                container.innerHTML = pillHtml ||
                    '<div style="padding:20px;text-align:center;color:var(--text-tertiary);font-size:14px;">Configure streaming platforms in the Platforms tab</div>';

            } catch(e) {
                console.error('Streaming bridge error:', e);
            }
        }

        renderProfileStreaming();

        // Re-apply whenever localStorage changes (when dashboard updates)
        window.addEventListener('storage', function(e) {
            if (e.key === 'able_profile_data') {
                applyDashboardDataToProfile();
            }
        });

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PROFILE FEED
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function loadProfilePosts() {
            try {
                const saved = localStorage.getItem(PROFILE_POSTS_KEY);
                if (saved) profilePosts = JSON.parse(saved);
                if (!profilePosts || !Array.isArray(profilePosts.posts)) profilePosts = { posts: [] };
            } catch(e) { profilePosts = { posts: [] }; }
        }

        function saveProfilePosts() {
            try { localStorage.setItem(PROFILE_POSTS_KEY, JSON.stringify(profilePosts)); } catch(e) {}
        }

        function _postId() {
            return 'p_' + Date.now() + '_' + Math.random().toString(36).slice(2, 7);
        }

        const _POST_TYPE_LABELS = {
            update: 'ðŸ“£ Update', release: 'ðŸŽµ Release', event: 'ðŸŽŸ Event', merch: 'ðŸ› Merch'
        };

        function submitProfilePost() {
            const title = (document.getElementById('postTitle')?.value || '').trim();
            const body  = (document.getElementById('postBody')?.value  || '').trim();
            if (!title) { showToast('âš ï¸ Add a title for your post'); return; }

            const attachLabel = (document.getElementById('postAttachLabel')?.value || '').trim();
            const attachUrl   = (document.getElementById('postAttachUrl')?.value   || '').trim();

            const post = {
                id:          _postId(),
                type:        document.getElementById('postType')?.value || 'update',
                title,
                body,
                createdAt:   new Date().toISOString(),
                attachments: (attachLabel && attachUrl)
                    ? [{ kind: 'url', label: attachLabel, url: attachUrl }] : []
            };

            profilePosts.posts.unshift(post);
            saveProfilePosts();

            // Clear form
            ['postTitle', 'postBody', 'postAttachLabel', 'postAttachUrl'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.value = '';
            });
            const ptEl = document.getElementById('postType');
            if (ptEl) ptEl.value = 'update';

            renderFeedAdmin();
            renderProfileFeed();
            showToast('âœ… Update posted');
        }

        function deleteProfilePost(id) {
            profilePosts.posts = (profilePosts.posts || []).filter(p => p.id !== id);
            saveProfilePosts();
            renderFeedAdmin();
            renderProfileFeed();
            showToast('Post removed');
        }

        function _escHF(s) {
            return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
        }

        function renderFeedAdmin() {
            const list = document.getElementById('feedAdminList');
            if (!list) return;
            const posts = profilePosts.posts || [];
            if (!posts.length) {
                list.innerHTML = '<div class="empty-state" style="padding:24px 0;"><div class="empty-state-icon">ðŸ“¢</div><div class="empty-state-title">No posts yet</div></div>';
                return;
            }
            list.innerHTML = posts.map(p => {
                const date = new Date(p.createdAt).toLocaleDateString(undefined, { month:'short', day:'numeric', year:'numeric' });
                return `
                <div style="display:flex;align-items:flex-start;gap:10px;padding:10px 0;border-bottom:1px solid var(--border);">
                    <div style="flex:1;min-width:0;">
                        <div style="display:flex;align-items:center;gap:6px;margin-bottom:2px;flex-wrap:wrap;">
                            <span style="font-size:10px;font-weight:700;background:var(--accent-soft);color:var(--accent);padding:2px 6px;border-radius:4px;">${_escHF(_POST_TYPE_LABELS[p.type] || p.type)}</span>
                            <span style="font-size:10px;color:var(--text-tertiary);">${date}</span>
                        </div>
                        <div style="font-size:13px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${_escHF(p.title)}</div>
                        ${p.body ? `<div style="font-size:11px;color:var(--text-secondary);margin-top:2px;overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;">${_escHF(p.body)}</div>` : ''}
                    </div>
                    <button class="icon-btn delete" onclick="deleteProfilePost('${_escHF(p.id)}')" title="Remove" style="flex-shrink:0;font-size:14px;padding:6px;">ðŸ—‘</button>
                </div>`;
            }).join('');
        }

        let _feedExpanded = false;

        function toggleFeedExpand() {
            _feedExpanded = !_feedExpanded;
            renderProfileFeed();
        }

        function renderProfileFeed() {
            const section = document.getElementById('profileFeedSection');
            const cards   = document.getElementById('profileFeedCards');
            const banner  = document.getElementById('profileFeedNewBanner');
            const toggle  = document.getElementById('profileFeedToggle');
            if (!section || !cards) return;

            const posts = profilePosts.posts || [];
            if (!posts.length) { section.style.display = 'none'; return; }

            section.style.display = '';

            // "New since last visit" logic
            const lastVisitRaw = localStorage.getItem(LAST_VISIT_KEY);
            const lastVisit    = lastVisitRaw ? new Date(lastVisitRaw) : null;
            const newCount     = lastVisit ? posts.filter(p => new Date(p.createdAt) > lastVisit).length : 0;

            if (banner) {
                if (newCount > 0) {
                    banner.textContent = newCount + ' new update' + (newCount > 1 ? 's' : '') + ' since your last visit';
                    banner.style.display = '';
                } else {
                    banner.style.display = 'none';
                }
            }

            const visible = _feedExpanded ? posts : posts.slice(0, 3);

            cards.innerHTML = visible.map(p => {
                const date  = new Date(p.createdAt).toLocaleDateString(undefined, { month:'short', day:'numeric' });
                const isNew = lastVisit && new Date(p.createdAt) > lastVisit;
                const att   = (p.attachments || [])[0];
                return `
                <div class="able-card">
                    <div style="display:flex;align-items:center;gap:6px;margin-bottom:6px;flex-wrap:wrap;">
                        <span style="font-size:10px;font-weight:700;background:var(--accent-soft);color:var(--accent);padding:2px 7px;border-radius:999px;">${_escHF(_POST_TYPE_LABELS[p.type] || p.type)}</span>
                        ${isNew ? '<span style="font-size:10px;font-weight:800;background:#22c55e;color:#fff;padding:2px 6px;border-radius:999px;letter-spacing:.02em;">NEW</span>' : ''}
                        <span style="font-size:10px;color:var(--text-tertiary);margin-left:auto;">${date}</span>
                    </div>
                    <div style="font-size:13px;font-weight:700;margin-bottom:4px;">${_escHF(p.title)}</div>
                    ${p.body ? `<div style="font-size:12px;color:var(--text-secondary);overflow:hidden;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;">${_escHF(p.body)}</div>` : ''}
                    ${att ? `<a href="${_escHF(att.url)}" target="_blank" rel="noopener" style="display:inline-block;margin-top:8px;font-size:12px;font-weight:600;color:var(--accent);border:1.5px solid var(--accent);border-radius:999px;padding:4px 12px;text-decoration:none;">${_escHF(att.label || 'Open')}</a>` : ''}
                </div>`;
            }).join('');

            if (toggle) {
                if (posts.length > 3) {
                    toggle.style.display = '';
                    toggle.textContent = _feedExpanded
                        ? 'Collapse â–²'
                        : 'View all ' + posts.length + ' updates â–¼';
                } else {
                    toggle.style.display = 'none';
                }
            }

            // Stamp last-visit after first render so next visit detects new posts
            try { localStorage.setItem(LAST_VISIT_KEY, new Date().toISOString()); } catch(e) {}
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // TEST MODE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function toggleTestMode() {
            const body    = document.getElementById('testModeBody');
            const chevron = document.getElementById('testModeChevron');
            if (!body) return;
            const open = body.style.display === 'none';
            body.style.display    = open ? '' : 'none';
            if (chevron) chevron.textContent = open ? 'â–² collapse' : 'â–¼ expand';
        }

        // â”€â”€ A. Seed demo data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function seedDemoData() {
            try {
                // Eight releases: 4 tracklist + 4 embed (tests caps + "View all" expander)
                musicState.releases = [
                    {
                        id: 'demo_tracklist_1',
                        title: 'Midnight Drive EP',
                        type: 'ep',
                        artwork: '', artworkUrl: '',
                        displayMode: 'tracklist',
                        credits: [
                            { name: 'Demo Studio',   role: 'Producer' },
                            { name: 'Ava Noel',      role: 'Writer'   },
                            { name: 'J. Morgan',     role: 'Mix'      },
                            { name: 'K. Reves',      role: 'Master'   },
                            { name: 'Art House',     role: 'Artwork'  },
                        ],
                        platforms: {
                            spotify:    'https://open.spotify.com/album/5Z9iiGl2FcIfa3BMiv6OIw',
                            apple:      'https://music.apple.com/album/midnight-drive-ep/000000001',
                            soundcloud: '',
                            youtube:    'https://www.youtube.com/watch?v=dQw4w9WgXcQ',
                            tiktok:     ''
                        },
                        tracks: [
                            { title: 'Midnight Drive',    duration: '4:12' },
                            { title: 'Neon Lights',       duration: '3:45' },
                            { title: 'Lost in the City',  duration: '5:02' },
                            { title: 'Afterglow',         duration: '3:58' },
                            { title: 'Signal Break',      duration: '4:30' }
                        ]
                    },
                    {
                        id: 'demo_tracklist_2',
                        title: 'Static Waves LP',
                        type: 'album',
                        artwork: '', artworkUrl: '',
                        displayMode: 'tracklist',
                        credits: '',
                        platforms: {
                            spotify:    'https://open.spotify.com/album/1ATL5GLyefJaxhQzSPVrLX',
                            apple:      '',
                            soundcloud: '',
                            youtube:    '',
                            tiktok:     ''
                        },
                        tracks: [
                            { title: 'Static Waves',     duration: '3:21' },
                            { title: 'Undertow',         duration: '4:15' },
                            { title: 'Phosphene',        duration: '5:40' },
                            { title: 'Red Line',         duration: '3:55' },
                            { title: 'Drift',            duration: '4:08' },
                            { title: 'Low End Theory',   duration: '3:50' },
                            { title: 'Resonance',        duration: '5:12' },
                            { title: 'Outro',            duration: '2:30' }
                        ]
                    },
                    {
                        id: 'demo_tracklist_3',
                        title: 'Interlude 001',
                        type: 'ep',
                        artwork: '', artworkUrl: '',
                        displayMode: 'tracklist',
                        credits: '',
                        platforms: {
                            spotify:    '',
                            apple:      '',
                            soundcloud: 'https://soundcloud.com/demo/sets/interlude-001',
                            youtube:    '',
                            tiktok:     ''
                        },
                        tracks: [
                            { title: 'Part I',   duration: '2:45' },
                            { title: 'Part II',  duration: '3:10' },
                            { title: 'Part III', duration: '3:55' }
                        ]
                    },
                    {
                        id: 'demo_tracklist_4',
                        title: 'Pressure Drop',
                        type: 'single',
                        artwork: '', artworkUrl: '',
                        displayMode: 'tracklist',
                        credits: [
                            { name: 'J. Coles',     role: 'Mix'    },
                            { name: 'Demo Studio',  role: 'Master' },
                        ],
                        platforms: {
                            spotify:    'https://open.spotify.com/track/1AoSF6GX6nGPMGq5CWQMQ3',
                            apple:      '',
                            soundcloud: '',
                            youtube:    '',
                            tiktok:     ''
                        },
                        tracks: [
                            { title: 'Pressure Drop',               duration: '3:58' },
                            { title: 'Pressure Drop (Instrumental)', duration: '3:58' }
                        ]
                    },
                    {
                        id: 'demo_embed_1',
                        title: 'Blinding Lights (Spotify Embed)',
                        type: 'single',
                        artwork: '', artworkUrl: '',
                        displayMode: 'embed',
                        credits: '',
                        platforms: {
                            spotify:    'https://open.spotify.com/track/0VjIjW4GlUZAMYd2vXMi3b',
                            apple:      '',
                            soundcloud: '',
                            youtube:    '',
                            tiktok:     ''
                        },
                        tracks: []
                    },
                    {
                        id: 'demo_embed_2',
                        title: 'Shape of You (Spotify + YouTube)',
                        type: 'single',
                        artwork: '', artworkUrl: '',
                        displayMode: 'embed',
                        credits: '',
                        platforms: {
                            spotify:    'https://open.spotify.com/track/7qiZfU4dY1lWllzX7mPBI3',
                            apple:      '',
                            soundcloud: '',
                            youtube:    'https://www.youtube.com/watch?v=JGwWNGJdvx8',
                            tiktok:     ''
                        },
                        tracks: []
                    },
                    {
                        id: 'demo_embed_3',
                        title: 'Bohemian Rhapsody (YouTube Embed)',
                        type: 'single',
                        artwork: '', artworkUrl: '',
                        displayMode: 'embed',
                        credits: '',
                        platforms: {
                            spotify:    '',
                            apple:      '',
                            soundcloud: '',
                            youtube:    'https://www.youtube.com/watch?v=fJ9rUzIMcZQ',
                            tiktok:     ''
                        },
                        tracks: []
                    },
                    {
                        id: 'demo_embed_4',
                        title: 'War (Album Embed)',
                        type: 'album',
                        artwork: '', artworkUrl: '',
                        displayMode: 'embed',
                        credits: '',
                        platforms: {
                            spotify:    'https://open.spotify.com/album/3JL2EWiEbYBNIPO4D7kfKv',
                            apple:      '',
                            soundcloud: '',
                            youtube:    '',
                            tiktok:     ''
                        },
                        tracks: []
                    }
                ];
                saveMusicState();

                // Set display mode to 'both' so both releases appear
                musicDisplayMode = 'both';
                try { localStorage.setItem(MUSIC_DISPLAY_MODE_KEY, 'both'); } catch(e) {}

                // Seed minimal streaming platforms so pills render
                try {
                    const existingPlatforms = JSON.parse(localStorage.getItem(PLATFORMS_KEY) || '{}');
                    existingPlatforms.spotify    = existingPlatforms.spotify    || 'https://open.spotify.com/artist/demo';
                    existingPlatforms.youtube    = existingPlatforms.youtube    || 'https://www.youtube.com/@demo';
                    localStorage.setItem(PLATFORMS_KEY, JSON.stringify(existingPlatforms));
                } catch(e) {}

                // Seed Events (deterministic â€” stable IDs, relative dates)
                var _t0 = new Date();
                function _fd(n) { var d = new Date(_t0); d.setDate(d.getDate() + n); return d.toISOString().split('T')[0]; }
                function _pd(n) { var d = new Date(_t0); d.setDate(d.getDate() - n); return d.toISOString().split('T')[0]; }
                var demoEvents = [
                    { id:'demo_ev_1', name:'Midnight Drive â€” Album Launch', venue:'Scala',               city:'London, UK',     date:_fd(14), time:'20:00', ticketUrl:'https://dice.fm/event/demo1',                  credits:'', provider:'dice',         providerTitle:'Dice' },
                    { id:'demo_ev_2', name:'Summer Tour â€” Manchester',      venue:'Albert Hall',          city:'Manchester, UK', date:_fd(28), time:'19:30', ticketUrl:'https://www.eventbrite.co.uk/e/demo2',          credits:'', provider:'eventbrite',   providerTitle:'Eventbrite' },
                    { id:'demo_ev_3', name:'Headline Show â€” Berlin',        venue:'Berghain Kantine',     city:'Berlin, DE',     date:_fd(45), time:'21:00', ticketUrl:'',                                             credits:'', provider:'',            providerTitle:'' },
                    { id:'demo_ev_4', name:'RA Pick â€” Amsterdam',           venue:'Shelter',              city:'Amsterdam, NL',  date:_fd(60), time:'23:00', ticketUrl:'https://ra.co/events/demo4',                   credits:'', provider:'ra',          providerTitle:'Resident Advisor' },
                    { id:'demo_ev_5', name:'Last Tour â€” New York (Past)',   venue:'Brooklyn Steel',       city:'New York, NY',   date:_pd(30), time:'20:00', ticketUrl:'https://www.ticketmaster.com/event/demo5',     credits:'', provider:'ticketmaster', providerTitle:'Ticketmaster' },
                    { id:'demo_ev_6', name:'SXSW Showcase (Past)',          venue:"Stubb's Amphitheatre", city:'Austin, TX',     date:_pd(90), time:'22:00', ticketUrl:'',                                             credits:'', provider:'',            providerTitle:'' },
                ];
                demoEvents.sort(function(a, b) { return new Date(a.date) - new Date(b.date); });
                try { localStorage.setItem(EVENTS_KEY, JSON.stringify(demoEvents)); } catch(ee) {}

                // Seed Merch (deterministic â€” stable IDs)
                var demoMerch = [
                    { id:'demo_merch_1', name:'Midnight Drive Tee',         description:'100% organic cotton, screen-printed logo', price:'Â£30', stock:'50',  url:'https://demo.bandcamp.com/merch/tee',              credits:'', provider:'bandcamp', providerTitle:'Bandcamp', artworkUrl:'' },
                    { id:'demo_merch_2', name:'Signed Vinyl â€” Limited Ed.', description:'Hand-signed 12" heavyweight vinyl',         price:'Â£25', stock:'25',  url:'https://demo.bandcamp.com/merch/vinyl',            credits:'', provider:'bandcamp', providerTitle:'Bandcamp', artworkUrl:'' },
                    { id:'demo_merch_3', name:'Logo Hoodie',                description:'Heavyweight 350gsm, embroidered',           price:'Â£55', stock:'',    url:'https://demostore.myshopify.com/products/hoodie',  credits:'', provider:'shopify',  providerTitle:'Shopify',  artworkUrl:'' },
                    { id:'demo_merch_4', name:'Digital Bundle',             description:'Full discography â€” MP3 + FLAC',             price:'Â£8',  stock:'',    url:'https://demo.gumroad.com/l/bundle',                credits:'', provider:'gumroad',  providerTitle:'Gumroad',  artworkUrl:'' },
                    { id:'demo_merch_5', name:'Tour Poster â€” A2 Print',     description:'GiclÃ©e print on 250gsm stock',              price:'Â£15', stock:'100', url:'',                                                 credits:'', provider:'',        providerTitle:'',         artworkUrl:'' },
                ];
                try { localStorage.setItem(MERCH_KEY, JSON.stringify(demoMerch)); } catch(me) {}

                safeRender(renderMusicTab);
                safeRender(updatePreviewMusic);
                if (typeof renderProfileStreaming === 'function') safeRender(renderProfileStreaming);
                safeRender(renderEventList);
                safeRender(renderMerchList);
                showToast('ðŸŒ± Seeded demo data â€” Music, Events + Merch');
            } catch(e) {
                console.error('[seedDemoData]', e);
                showToast('âš ï¸ Seed failed â€” check console');
            }
        }

        // â”€â”€ Helper: canonical list of all Able localStorage keys â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function getAbleStorageKeys() {
            return [
                STORAGE_KEY, MUSIC_KEY, MUSIC_DISPLAY_MODE_KEY, AUTO_STATE_KEY,
                SECTION_ACTIONS_KEY, VIDEOS_KEY, EVENTS_KEY, MERCH_KEY,
                'able_merch_shop_url', PLATFORMS_KEY, PROFILE_KEY, BRAND_COLOR_KEY,
                APPEARANCE_KEY, TIER1_KEY, CHECKLIST_KEY, PROFILE_POSTS_KEY,
                LAST_VISIT_KEY, ONBOARDING_KEY, OEMBED_CACHE_KEY
            ].filter(Boolean);
        }

        // â”€â”€ B. Clear local data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function clearAbleLocalData() {
            try {
                const ableKeys = getAbleStorageKeys();

                ableKeys.forEach(k => { try { localStorage.removeItem(k); } catch(e) {} });

                // Reset in-memory state to defaults
                musicState       = { releases: [] };
                musicDisplayMode = 'both';
                sectionActionsState = {};
                ctaState = {};
                profilePosts = { posts: [] };
                _feedExpanded = false;
                loadCTAState(); // restore defaults

                safeRender(renderMusicTab);
                safeRender(updatePreviewMusic);
                safeRender(rebuildUIFromState);
                safeRender(renderFeedAdmin);
                safeRender(renderProfileFeed);
                showToast('ðŸ—‘ Able local data cleared');
            } catch(e) {
                console.error('[clearAbleLocalData]', e);
                showToast('âš ï¸ Clear failed â€” check console');
            }
        }

        // â”€â”€ C. Smoke checks â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function runSmokeChecks() {
            const out   = document.getElementById('smokeCheckOutput');
            const lines = [];
            let pass = 0, fail = 0;

            function check(label, ok) {
                const sym = ok ? 'PASS' : 'FAIL';
                lines.push(`[${sym}] ${label}`);
                if (ok) pass++; else fail++;
            }

            try {
                // 1. Preview containers exist
                check('previewMusicSection exists in DOM',
                    !!document.getElementById('previewMusicSection'));
                check('previewMusicCards exists in DOM',
                    !!document.getElementById('previewMusicCards'));

                // 2. Seed data so subsequent checks have something to test
                const origReleases   = JSON.parse(JSON.stringify(musicState.releases));
                const origMode       = musicDisplayMode;
                musicState.releases = [
                    { id: 'chk_tracklist', title: 'Check TL', type: 'single', artwork: '',
                      displayMode: 'tracklist', credits: '', platforms: {}, tracks: [] },
                    { id: 'chk_embed', title: 'Check EM', type: 'single', artwork: '',
                      displayMode: 'embed', credits: '',
                      platforms: { spotify: 'https://open.spotify.com/track/0VjIjW4GlUZAMYd2vXMi3b' },
                      tracks: [] }
                ];

                // 3. mode='both' â€” both releases should appear in preview
                musicDisplayMode = 'both';
                safeRender(updatePreviewMusic);
                const cardsEl = document.getElementById('previewMusicCards');
                check('mode=both: previewMusicSection visible',
                    document.getElementById('previewMusicSection')?.style.display !== 'none');
                check('mode=both: previewMusicCards has content',
                    !!(cardsEl && cardsEl.innerHTML.trim().length > 0));

                // 4. mode='embeds' â€” only embed release visible (lazy placeholder, not inline iframe)
                musicDisplayMode = 'embeds';
                safeRender(updatePreviewMusic);
                const embedHtml = cardsEl ? cardsEl.innerHTML : '';
                check('mode=embeds: has lazy embed placeholder (.able-embedLazy)',
                    embedHtml.includes('able-embedLazy'));
                check('mode=embeds: does NOT contain tracklist structure',
                    !embedHtml.includes('chk_tracklist') && !embedHtml.includes('"Check TL"'));

                // 5. mode='tracklist' â€” only tracklist release visible (no iframe)
                musicDisplayMode = 'tracklist';
                safeRender(updatePreviewMusic);
                const tlHtml = cardsEl ? cardsEl.innerHTML : '';
                check('mode=tracklist: no iframe',
                    !tlHtml.includes('<iframe'));
                check('mode=tracklist: tracklist card rendered',
                    tlHtml.includes('Check TL'));

                // 5b. music cards: no horizontal overflow (mobile-safe guard)
                if (cardsEl) {
                    check('music cards: no horizontal overflow',
                        cardsEl.scrollWidth <= cardsEl.offsetWidth + 2);
                }

                // 6. Modal scroll lock: open then close, body overflow should reset
                const wasOverflow = document.body.style.overflow;
                const dummyModal  = document.getElementById('addReleaseModal');
                if (dummyModal) {
                    dummyModal.classList.add('active');
                    document.body.style.overflow = 'hidden';
                    closeModal('addReleaseModal');
                    check('closeModal restores body overflow',
                        document.body.style.overflow !== 'hidden');
                } else {
                    check('addReleaseModal exists for scroll test', false);
                }

                // 7. showToast null-safety â€” must not throw when toast el is missing
                let toastThrew = false;
                try {
                    // Temporarily detach toast element
                    const toastEl = document.querySelector('.toast');
                    const toastParent = toastEl ? toastEl.parentNode : null;
                    if (toastEl && toastParent) toastEl.remove();
                    showToast('smoke-check-toast');
                    if (toastEl && toastParent) toastParent.appendChild(toastEl);
                } catch(e) { toastThrew = true; }
                check('showToast is null-safe (no throw without .toast el)', !toastThrew);

                // 8. Events DOM + data sanity
                check('addEventModal exists',        !!document.getElementById('addEventModal'));
                check('eventsTabErrorBanner exists', !!document.getElementById('eventsTabErrorBanner'));
                var eventsArr = [];
                try { eventsArr = JSON.parse(localStorage.getItem(EVENTS_KEY) || '[]'); } catch(ev_e) {}
                check('Events: data is an Array', Array.isArray(eventsArr));
                if (eventsArr.length > 0) {
                    var evDateOk = !isNaN(new Date(eventsArr[0].date + 'T00:00:00').getTime());
                    check('Events[0].date is parseable', evDateOk);
                    var evUrlOk  = eventsArr.filter(function(e) { return e.ticketUrl; })
                        .every(function(e) { try { new URL(e.ticketUrl); return true; } catch(ue) { return false; } });
                    check('Events with ticketUrl have valid URLs (warn only)', evUrlOk);
                } else {
                    check('Events[0].date parseable (skipped â€” 0 events)', true);
                    check('Events ticketUrl valid (skipped â€” 0 events)', true);
                }

                // 9. Merch DOM + data sanity
                check('addProductModal exists',       !!document.getElementById('addProductModal'));
                check('merchTabErrorBanner exists',   !!document.getElementById('merchTabErrorBanner'));
                var merchArr = [];
                try { merchArr = JSON.parse(localStorage.getItem(MERCH_KEY) || '[]'); } catch(me_e) {}
                check('Merch: data is an Array', Array.isArray(merchArr));
                if (merchArr.length > 0) {
                    check('Merch prices: no double-$ formatting',
                        merchArr.every(function(p) { return !p.price || !p.price.startsWith('$$'); }));
                    var mUrlOk = merchArr.filter(function(p) { return p.url; })
                        .every(function(p) { try { new URL(p.url); return true; } catch(ue) { return false; } });
                    check('Merch with url have valid URLs (warn only)', mUrlOk);
                } else {
                    check('Merch price format ok (skipped â€” 0 products)', true);
                    check('Merch URLs valid (skipped â€” 0 products)', true);
                }

                // 10. CTA guardrails (warn-only)
                var ctaRaw = {};
                try { ctaRaw = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}'); } catch(ce) {}
                var activeCTAs = Object.values(ctaRaw).filter(function(c) { return c && c.active; });
                check('Active Quick Actions â‰¤ 8 (warn only)', activeCTAs.length <= 8);

                // 11. Total CTA surface count (warn-only) â€” hero + pills + section buttons
                var heroCTACount = [_profileMainCta, document.getElementById('secondaryCta')]
                    .filter(function(b) { return b && b.style.display !== 'none'; }).length;
                var sectionBtnCount = document.querySelectorAll('.profile-preview .section-action-btn').length;
                var totalCtaSurface = heroCTACount + activeCTAs.length + sectionBtnCount;
                check(
                    'Total CTA surface â‰¤ 10 [hero:' + heroCTACount + ' pills:' + activeCTAs.length +
                    ' section:' + sectionBtnCount + ' = ' + totalCtaSurface + '] (warn only)',
                    totalCtaSurface <= 10
                );

                // 12. Quick-links strip: no horizontal overflow at current width (warn-only)
                var qlStripEl = document.getElementById('quickLinksStrip');
                var qlOverflow = qlStripEl ? (qlStripEl.scrollWidth > qlStripEl.clientWidth + 2) : false;
                check('Quick-links strip: no horizontal overflow (warn only)', !qlOverflow);

                // 13. Active action links with no URL â€” fans would hit dead pills (warn-only)
                var emptyUrlActive = activeCTAs.filter(function(c) { return !c.url || !c.url.trim(); });
                check(
                    'Active Action Links: all have URLs [' + emptyUrlActive.length + ' empty] (warn only)',
                    emptyUrlActive.length === 0
                );

                // 14. Drag-and-drop init guard: every rendered list item has data-dnd-init (warn-only)
                var ctaListItems = document.querySelectorAll('#ctaList .list-item');
                var uninitDrag = Array.prototype.filter.call(ctaListItems, function(el) { return !el.dataset.dndInit; });
                check(
                    'Action Links: all list items have dnd-init guard [' + uninitDrag.length + ' without] (warn only)',
                    uninitDrag.length === 0
                );

                // 15-17. Credits data integrity (run against user's actual releases)
                var _allCreds = [];
                origReleases.forEach(function(rel) {
                    _allCreds = _allCreds.concat(_normalizeCredits(rel.credits));
                });
                var _missingName = _allCreds.filter(function(c) { return !c.name || !c.name.trim(); });
                check('Credits: no entry missing name [' + _missingName.length + ' of ' + _allCreds.length + ' total] (warn only)', _missingName.length === 0);
                var _longCred = _allCreds.filter(function(c) { return (c.name||'').length > 80 || (c.role||'').length > 80; });
                check('Credits: no name/role >80 chars [' + _longCred.length + '] (warn only)', _longCred.length === 0);
                var _credSections = document.querySelectorAll('.profile-preview .credits-section');
                var _credOverflow = Array.prototype.some.call(_credSections, function(el) { return el.scrollWidth > el.clientWidth + 2; });
                check('Credits: no horizontal overflow in preview card (warn only)', !_credOverflow);

                // 18. Profile credits section: no horizontal overflow (warn-only)
                var _profCredSec  = document.querySelector('#profilePreviewRoot #credits');
                var _profCredOver = _profCredSec ? (_profCredSec.scrollWidth > _profCredSec.clientWidth + 2) : false;
                check('Profile Credits section: no horizontal overflow (warn only)', !_profCredOver);

                // 19a. Full profile root: no horizontal overflow (warn-only, S15-07)
                var _fullRootEl  = document.getElementById('profilePreviewRoot');
                var _rootOverflow = _fullRootEl ? (_fullRootEl.scrollWidth > _fullRootEl.clientWidth + 2) : false;
                check('Full profile root: no horizontal overflow (warn only)', !_rootOverflow);

                // 19. Credits dedupe: aggregated count â‰¤ raw entry count (sanity guard)
                var _rawCredCount2 = 0;
                origReleases.forEach(function(rel) { _rawCredCount2 += _normalizeCredits(rel.credits).length; });
                var _aggCount = (typeof aggregateCredits === 'function') ? aggregateCredits(origReleases).length : 0;
                check(
                    'Credits dedupe: aggregated [' + _aggCount + '] â‰¤ raw entries [' + _rawCredCount2 + '] (warn only)',
                    _aggCount <= _rawCredCount2
                );

                // Restore original state
                musicState.releases = origReleases;
                musicDisplayMode    = origMode;
                safeRender(renderMusicTab);
                safeRender(updatePreviewMusic);

            } catch(e) {
                lines.push(`[ERROR] Unexpected exception: ${e.message}`);
                console.error('[runSmokeChecks]', e);
            }

            const summary = `Smoke checks: ${pass} passed, ${fail} failed\n` +
                            'â”€'.repeat(36) + '\n' + lines.join('\n');
            console.log(summary);
            if (out) {
                out.textContent  = summary;
                out.style.display = '';
            }
            showToast(fail === 0 ? `âœ… All ${pass} checks passed` : `âš ï¸ ${fail} check(s) failed â€” see panel`);
        }

        // â”€â”€ D. Print state summary + copy snapshot â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function copyDebugSnapshot() {
            try {
                // Gather counts
                var releases  = (musicState && musicState.releases) ? musicState.releases : [];
                var eventsS   = []; try { eventsS  = JSON.parse(localStorage.getItem(EVENTS_KEY)  || '[]'); } catch(e2) {}
                var merchS    = []; try { merchS   = JSON.parse(localStorage.getItem(MERCH_KEY)   || '[]'); } catch(e2) {}
                var ctaRawS   = {}; try { ctaRawS  = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}'); } catch(e2) {}
                var activeLinks = Object.values(ctaRawS).filter(function(c) { return c && c.active; });

                // Current auto-state mode + hero CTAs
                var autoS = {}; try { autoS = JSON.parse(localStorage.getItem(AUTO_STATE_KEY) || '{}'); } catch(e2) {}
                var currentMode = (autoS && autoS.currentMode) || 'live';
                var modeConf = (autoS && autoS.modes && autoS.modes[currentMode]) || {};

                // Summary lines
                var lines = [
                    'â”€â”€ Able State Summary â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€',
                    'Generated: ' + new Date().toLocaleString(),
                    '',
                    'Counts:',
                    '  Releases:     ' + releases.length,
                    '  Events:       ' + eventsS.length + ' (' + eventsS.filter(function(e) { return new Date(e.date + 'T00:00:00') >= new Date(new Date().toDateString()); }).length + ' upcoming)',
                    '  Merch items:  ' + merchS.length,
                    '  Active links: ' + activeLinks.length,
                    '',
                    'Hero CTAs (mode: ' + currentMode + '):',
                    '  Primary:   ' + ((modeConf.primaryText || modeConf.primary) ? (modeConf.primaryIcon || '') + ' ' + (modeConf.primaryText || modeConf.primary) : '(not set)'),
                    '  Secondary: ' + ((modeConf.secondaryText || modeConf.secondary) ? (modeConf.secondaryIcon || '') + ' ' + (modeConf.secondaryText || modeConf.secondary) : '(not set)'),
                    '',
                    'Music display mode: ' + musicDisplayMode,
                    '',
                    'LS keys present: ' + getAbleStorageKeys().filter(function(k) { return !!localStorage.getItem(k); }).join(', '),
                ].join('\n');

                console.log(lines);
                const out = document.getElementById('smokeCheckOutput');
                if (out) { out.textContent = lines; out.style.display = ''; }

                // Also copy full JSON snapshot to clipboard
                var ableKeys = [];
                for (var i = 0; i < localStorage.length; i++) {
                    var k = localStorage.key(i);
                    if (k && k.startsWith('able_')) ableKeys.push(k);
                }
                var snapshot = {
                    time: new Date().toISOString(),
                    summary: { releases: releases.length, events: eventsS.length, merch: merchS.length, activeLinks: activeLinks.length },
                    currentMode: currentMode,
                    musicDisplayMode: musicDisplayMode,
                    lsKeys: ableKeys.sort(),
                };
                var text = JSON.stringify(snapshot, null, 2);
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(text)
                        .then(function() { showToast('ðŸ“‹ Snapshot copied â€” summary shown in panel'); })
                        .catch(function() { console.log(text); showToast('âš ï¸ Clipboard failed â€” snapshot logged'); });
                } else {
                    console.log('[Debug Snapshot]', text);
                    showToast('ðŸ“‹ Summary shown in panel; snapshot logged to console');
                }
            } catch(e) {
                console.error('[copyDebugSnapshot]', e);
                showToast('âš ï¸ Snapshot failed â€” check console');
            }
        }

        // ============================================
        // MAGIC MOMENT ONBOARDING v1
        // ============================================

        const ONBOARDING_KEY = 'able_onboarding_complete';

        function openOnboardingModal() {
            var modal = document.getElementById('onboardingModal');
            if (!modal) return;
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeOnboardingModal() {
            var modal = document.getElementById('onboardingModal');
            if (modal) modal.classList.remove('active');
            if (!document.querySelector('.modal-overlay.active')) {
                document.body.style.overflow = '';
            }
        }

        function skipOnboarding() {
            try { localStorage.setItem(ONBOARDING_KEY, 'true'); } catch(e) {}
            closeOnboardingModal();
        }

        // Platform detection table â€” matched top to bottom, first match wins per URL
        var _OB_PLATFORMS = [
            { re: /spotify\.com/,                         key: 'listen-spotify',     text: 'Listen on Spotify',       icon: 'ðŸŸ¢', priority: 10 },
            { re: /music\.apple\.com|itunes\.apple\.com/, key: 'listen-apple',       text: 'Listen on Apple Music',   icon: 'ðŸŽµ', priority: 11 },
            { re: /soundcloud\.com/,                      key: 'listen-soundcloud',  text: 'Listen on SoundCloud',    icon: 'ðŸŽ§', priority: 12 },
            { re: /tidal\.com/,                           key: 'listen-tidal',       text: 'Listen on Tidal',         icon: 'ðŸ’¿', priority: 13 },
            { re: /deezer\.com/,                          key: 'listen-deezer',      text: 'Listen on Deezer',        icon: 'ðŸŽ¶', priority: 14 },
            { re: /youtube\.com|youtu\.be/,               key: 'watch-youtube',      text: 'Watch on YouTube',        icon: 'â–¶ï¸', priority: 20 },
            { re: /vimeo\.com/,                           key: 'watch-vimeo',        text: 'Watch on Vimeo',          icon: 'ðŸŽ¬', priority: 21 },
            { re: /eventbrite\.com/,                      key: 'tickets-eventbrite', text: 'Get Tickets',             icon: 'ðŸŽ«', priority: 30 },
            { re: /dice\.fm/,                             key: 'tickets-dice',       text: 'Get Tickets on DICE',     icon: 'ðŸŽ«', priority: 31 },
            { re: /songkick\.com/,                        key: 'tickets-songkick',   text: 'Get Tickets on Songkick', icon: 'ðŸŽ«', priority: 32 },
            { re: /bandcamp\.com/,                        key: 'shop-bandcamp',      text: 'Buy on Bandcamp',         icon: 'ðŸŽ¸', priority: 40 },
            { re: /myshopify\.com|shopify\.com/,          key: 'shop-shopify',       text: 'Shop Now',                icon: 'ðŸ›’', priority: 41 },
            { re: /gumroad\.com/,                         key: 'shop-gumroad',       text: 'Shop on Gumroad',         icon: 'ðŸ›’', priority: 42 },
            { re: /etsy\.com/,                            key: 'shop-etsy',          text: 'Shop on Etsy',            icon: 'ðŸ›’', priority: 43 },
            { re: /sellfy\.com/,                          key: 'shop-sellfy',        text: 'Shop on Sellfy',          icon: 'ðŸ›’', priority: 44 },
            { re: /paypal\.me|paypal\.com\/paypalme/,     key: 'support-paypal',     text: 'Support via PayPal',      icon: 'ðŸ’–', priority: 50 },
            { re: /buymeacoffee\.com/,                    key: 'support-bmc',        text: 'Buy Me a Coffee',         icon: 'â˜•', priority: 51 },
            { re: /ko-fi\.com/,                           key: 'support-kofi',       text: 'Support on Ko-fi',        icon: 'ðŸ’–', priority: 52 },
            { re: /patreon\.com/,                         key: 'support-patreon',    text: 'Support on Patreon',      icon: 'ðŸ’', priority: 53 },
            { re: /instagram\.com/,                       key: 'instagram',          text: 'Follow on Instagram',     icon: 'ðŸ“¸', priority: 60 },
            { re: /tiktok\.com/,                          key: 'tiktok',             text: 'Follow on TikTok',        icon: 'ðŸ“±', priority: 61 },
            { re: /twitter\.com|x\.com/,                  key: 'twitter',            text: 'Follow on X',             icon: 'ðŸ¦', priority: 62 },
            { re: /facebook\.com/,                        key: 'facebook',           text: 'Follow on Facebook',      icon: 'ðŸ‘¥', priority: 63 },
            { re: /threads\.net/,                         key: 'threads',            text: 'Follow on Threads',       icon: 'ðŸ§µ', priority: 64 },
            { re: /linktr\.ee/,                           key: 'linktree',           text: 'Linktree',                icon: 'ðŸŒ³', priority: 70 },
        ];

        function parseOnboardingLinks(text) {
            var results = [];
            var seenKeys = {};
            var lines = (text || '').split(/[\n\r,]+/);
            lines.forEach(function(line) {
                var url = line.trim();
                if (!url || !/^https?:\/\//i.test(url)) return;
                for (var i = 0; i < _OB_PLATFORMS.length; i++) {
                    var p = _OB_PLATFORMS[i];
                    if (p.re.test(url)) {
                        if (!seenKeys[p.key]) {
                            seenKeys[p.key] = true;
                            results.push({ key: p.key, text: p.text, icon: p.icon, priority: p.priority, url: url });
                        }
                        break;
                    }
                }
            });
            results.sort(function(a, b) { return a.priority - b.priority; });
            return results;
        }

        // â”€â”€ Onboarding Step 2 helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        const OBJECTIVE_MODE_KEY = 'able_objective_mode';
        var _currentObjectiveMode = null;
        var _obSelectedMode = null;

        function _obSelectMode(btn) {
            document.querySelectorAll('.ob-mode-card').forEach(function(b) { b.classList.remove('selected'); });
            btn.classList.add('selected');
            _obSelectedMode = btn.dataset.obMode;
            var warn = document.getElementById('obModeWarn');
            if (warn) warn.style.display = 'none';
        }

        function _showOnboardingStep2() {
            var modal = document.getElementById('onboardingModal');
            if (!modal) return;
            var inner = modal.querySelector('div');
            if (!inner) return;
            _obSelectedMode = null;

            var MODES = [
                { value: 'streams',    label: 'Streams',    emoji: 'ðŸŽµ' },
                { value: 'tickets',    label: 'Tickets',    emoji: 'ðŸŽ«' },
                { value: 'merch',      label: 'Merch',      emoji: 'ðŸ›’' },
                { value: 'support',    label: 'Support',    emoji: 'ðŸ’–' },
                { value: 'engagement', label: 'Engagement', emoji: 'ðŸ“±' },
                { value: 'press',      label: 'Press Pack', emoji: 'ðŸ“„' },
            ];

            var btnHtml = MODES.map(function(m) {
                return '<button type="button" class="ob-mode-card" data-ob-mode="' + m.value + '" onclick="_obSelectMode(this)">' +
                    '<span style="font-size:22px;line-height:1;">' + m.emoji + '</span>' +
                    '<span style="font-size:12px;font-weight:600;line-height:1.2;">' + m.label + '</span>' +
                '</button>';
            }).join('');

            inner.innerHTML =
                '<h2 style="font-size:1.3rem;font-weight:700;margin:0 0 6px;color:var(--text-primary);">What are you promoting right now?</h2>' +
                '<p style="color:var(--text-secondary);margin:0 0 16px;font-size:14px;line-height:1.5;">Able will highlight the right sections and set your hero buttons.</p>' +
                '<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:16px;">' + btnHtml + '</div>' +
                '<div id="obModeWarn" style="display:none;margin-bottom:10px;font-size:13px;color:#ef4444;font-weight:500;"></div>' +
                '<div style="display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap;">' +
                    '<button type="button" onclick="skipOnboarding()" style="padding:10px 18px;border-radius:9999px;border:1px solid var(--border);background:transparent;color:var(--text-secondary);font-size:14px;font-weight:500;cursor:pointer;line-height:1;">Skip</button>' +
                    '<button type="button" onclick="applyObjectiveAndFinish()" style="padding:10px 22px;border-radius:9999px;border:none;background:#0891b2;color:#fff;font-size:14px;font-weight:600;cursor:pointer;line-height:1;">Apply</button>' +
                '</div>';
        }

        function applyObjectiveAndFinish() {
            var warn = document.getElementById('obModeWarn');
            if (!_obSelectedMode) {
                if (warn) { warn.textContent = 'Please choose an option first.'; warn.style.display = ''; }
                return;
            }
            setObjectiveMode(_obSelectedMode);
            skipOnboarding(); // sets ONBOARDING_KEY + closes modal
            showToast('âœ… Objective set â€” you can update this anytime');
        }

        function setObjectiveMode(mode) {
            var VALID = ['streams', 'tickets', 'merch', 'support', 'engagement', 'press', 'live'];
            if (!mode || !VALID.includes(mode)) mode = 'live';
            _currentObjectiveMode = mode;
            try { localStorage.setItem(OBJECTIVE_MODE_KEY, mode); } catch(e) {}
            _applyObjectiveSections(mode);
            _applyObjectiveHero(mode);
            safeRender(rerenderQuickLinksStrip);
        }

        // Elevate one section to appear right after #streaming in the preview
        function _applyObjectiveSections(mode) {
            try {
                var container = document.getElementById('sectionsContainer');
                if (!container) return;

                var PRIORITY = {
                    streams:    'previewMusicSection',
                    tickets:    'events',
                    merch:      'merch',
                    support:    'support',
                    engagement: 'videos',
                    press:      null,
                    live:       null,
                };

                var targetId = PRIORITY[mode];
                if (!targetId) return;

                var target = document.getElementById(targetId);
                if (!target) return;

                // Move target to right after #streaming (anchor) or first child
                var anchor = document.getElementById('streaming');
                var insertAfter = anchor || null;
                if (insertAfter && insertAfter.nextElementSibling &&
                        insertAfter.nextElementSibling.id !== targetId) {
                    insertAfter.after(target);
                } else if (!insertAfter && container.firstElementChild &&
                        container.firstElementChild.id !== targetId) {
                    container.prepend(target);
                }
            } catch(e) { console.warn('[_applyObjectiveSections]', e); }
        }

        // Set hero CTA buttons based on available ctaState entries for the objective
        function _applyObjectiveHero(mode) {
            try {
                var mainBtn = document.getElementById('mainCta');
                var secBtn  = document.getElementById('secondaryCta');
                if (!mainBtn && !secBtn) return;

                var INTENT_KEYS = {
                    listen:  ['listen-spotify', 'listen-apple', 'listen-soundcloud', 'listen-tidal', 'listen-deezer', 'listen-now'],
                    watch:   ['watch-youtube', 'watch-vimeo'],
                    tickets: ['tickets-eventbrite', 'tickets-dice', 'tickets-songkick', 'get-tickets'],
                    shop:    ['shop-bandcamp', 'shop-shopify', 'shop-gumroad', 'shop-etsy', 'shop-sellfy', 'shop-merch'],
                    support: ['support-paypal', 'support-bmc', 'support-kofi', 'support-patreon', 'inner-circle'],
                    follow:  ['instagram', 'tiktok', 'twitter', 'facebook', 'threads'],
                };

                var MODE_HERO = {
                    streams:    { p: ['listen'],            s: ['watch', 'follow'] },
                    tickets:    { p: ['tickets'],           s: ['listen', 'watch'] },
                    merch:      { p: ['shop'],              s: ['listen', 'support'] },
                    support:    { p: ['support'],           s: ['listen', 'shop'] },
                    engagement: { p: ['watch'],             s: ['follow', 'listen'] },
                    press:      { p: ['listen', 'watch'],   s: ['follow'] },
                    live:       { p: ['listen'],            s: ['tickets'] },
                };

                var heroCfg = MODE_HERO[mode] || MODE_HERO.live;

                function findCTA(intentList) {
                    for (var ii = 0; ii < intentList.length; ii++) {
                        var keys = INTENT_KEYS[intentList[ii]] || [];
                        for (var ki = 0; ki < keys.length; ki++) {
                            var entry = ctaState[keys[ki]];
                            if (entry && entry.active && entry.url) return entry;
                        }
                    }
                    return null;
                }

                var primary   = findCTA(heroCfg.p);
                var secondary = findCTA(heroCfg.s);

                if (mainBtn && primary) {
                    mainBtn.textContent = primary.icon + ' ' + primary.text;
                }
                if (secBtn && secondary) {
                    secBtn.textContent = secondary.icon + ' ' + secondary.text;
                }
            } catch(e) { console.warn('[_applyObjectiveHero]', e); }
        }

        function importOnboardingLinks() {
            var warn = document.getElementById('onboardingWarn');
            var input = document.getElementById('onboardingLinksInput');
            if (!input) return;
            if (warn) warn.style.display = 'none';

            var parsed = parseOnboardingLinks(input.value || '');
            if (!parsed.length) {
                if (warn) {
                    warn.textContent = 'No recognised links found. Make sure URLs start with https:// and try again.';
                    warn.style.display = '';
                }
                return;
            }

            // Collect existing URLs to avoid adding duplicates
            var existingUrls = {};
            Object.values(ctaState).forEach(function(v) { if (v && v.url) existingUrls[v.url] = true; });

            // Compute next available order slot
            var maxOrder = 0;
            Object.values(ctaState).forEach(function(v) { if (v && v.order > maxOrder) maxOrder = v.order; });

            var added = 0;
            parsed.forEach(function(p) {
                if (existingUrls[p.url]) return; // exact URL already present
                if (ctaState[p.key]) {
                    // Key already exists â€” fill URL if blank, else skip
                    if (!ctaState[p.key].url) {
                        ctaState[p.key].url = p.url;
                        ctaState[p.key].active = true;
                        existingUrls[p.url] = true;
                        added++;
                    }
                } else {
                    // New platform â€” create entry
                    maxOrder++;
                    ctaState[p.key] = { active: true, text: p.text, icon: p.icon, order: maxOrder, url: p.url };
                    existingUrls[p.url] = true;
                    added++;
                }
            });

            saveCTAState();

            safeRender(rebuildUIFromState);
            safeRender(function() { renderPreviewCTAStack('live'); });
            safeRender(rerenderQuickLinksStrip);
            safeRender(updateSectionActionBtns);

            // Transition to Step 2 instead of closing
            _showOnboardingStep2();
        }


    </script>


    <!-- Full Page Overlay -->
    <div id="fullPageOverlay">
        <button id="fullPageBackBtn" onclick="closeFullPage()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
            Back to Dashboard
        </button>
        <div id="fullPageContent" class="full-page-profile"></div>
    </div>

</body>
</html>